Ext.namespace('Js.Center.Monitor.SysMonitor.HandleSpeedMonitor');Js.Center.Monitor.SysMonitor.HandleSpeedMonitor.func=function(node,monitornodeid){var _pageSize=12;var fields=["id","modulename","getspeed","putcount","putspeed","queuecount","queuename","moSend1001","getcount"];Js.Center.Monitor.SysMonitor.HandleSpeedMonitor.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.SysMonitor.SysMonitorQueryURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"id",totalProperty:"totalCount"}),sortInfo:{field:'queuename',direction:'DESC'},baseParams:{cmd:monitornodeid}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"id"});var cm=new Ext.grid.ColumnModel([{header:"模块名称",tooltip:"模块名称",dataIndex:"modulename",sortable:true},{header:"队列名称",tooltip:"队列名称",dataIndex:"queuename",sortable:true},{header:"入数量",tooltip:"入数量",dataIndex:"putcount",sortable:true},{header:"取数量",tooltip:"取数量",dataIndex:"getcount",sortable:true},{header:"入速度",tooltip:"入速度",dataIndex:"putspeed",sortable:true},{header:"取速度",tooltip:"取速度",dataIndex:"getspeed",sortable:true},{header:"剩余数量",tooltip:"剩余数量",dataIndex:"queuecount",sortable:true}]);var monitorGrid=new WXTL.Widgets.CommonGrid.GridPanel({anchor:'100% 100%',needPage:false,pageSize:_pageSize,store:Js.Center.Monitor.SysMonitor.HandleSpeedMonitor.Infostore,sm:sm,cm:cm,needMenu:false,needRightMenu:false});Js.Center.Monitor.SysMonitor.HandleSpeedMonitor.mainPanel=new Ext.Panel({frame:true,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{anchor:'98%',collapsible:true},items:[monitorGrid]});GridMain(node,Js.Center.Monitor.SysMonitor.HandleSpeedMonitor.mainPanel,"","","getHandleSpeedInfo('"+monitornodeid+"','"+node.id+"')");getHandleSpeedInfo(monitornodeid,node.id)};function getHandleSpeedInfo(taskId,nodeId){try{center.activeTab.items.items[0].items.items[0].store.baseParams={cmd:"-U"+taskId+" -Cqueue"};center.activeTab.items.items[0].items.items[0].store.reload();setTimeout(function(){var _nodeId="tab"+nodeId;if(center.activeTab.id==_nodeId&&center.activeTab.monitorNodeid==taskId){getHandleSpeedInfo(taskId,nodeId)}},3000)}catch(err){Ext.Msg.alert("温馨提示","系统请求异常!")}};Ext.namespace('Js.Center.Monitor.SysMonitor.MonitorNode');Js.Center.Monitor.SysMonitor.MonitorNode.info=function(node){if(Ext.get("Js.Center.Monitor.SysMonitor.MonitorNode.Nodepanel")==null){nodeMonitor=function(rowIndex){var row=Js.Center.Monitor.SysMonitor.MonitorNode.Infostore.getAt(rowIndex);var nodeId='nodemonitorinfo'+row.get("numtaskid");var nodeText="• "+row.get("vc2taskname")+'监控';var url='Js.Center.Monitor.SysMonitor.SysMonitorinfo';var nodeMonitorid=row.get("numtaskid");if(nodeText.length>1){nodeText=nodeText.substring(1,nodeText.length)}var node=eval({"id":nodeId,"monitorNodeid":nodeMonitorid,"text":nodeText,"url":url});var tab=center.getItem("tab"+nodeId);if(tab){center.remove(tab);tab.removeAll()}if(!center.getItem("tab"+nodeId)){loadflag=false;tab=center.add({id:"tab"+node.id,monitorNodeid:nodeMonitorid,iconCls:'openroomiconinfo',xtype:"panel",title:node.text,closable:true,layout:"fit"}).show();WXTL.Common.showWaitLoading(true);eval(url+'(node,nodeMonitorid)');}center.setActiveTab(tab);};handleSpeedMonitor=function(rowIndex){var row=Js.Center.Monitor.SysMonitor.MonitorNode.Infostore.getAt(rowIndex);var nodeId='handlespeedmonitor'+row.get("numtaskid");var nodeText="• "+row.get("vc2taskname")+'速度';var url='Js.Center.Monitor.SysMonitor.HandleSpeedMonitor.func';var nodeMonitorid=row.get("numtaskid");if(nodeText.length>1){nodeText=nodeText.substring(1,nodeText.length)}var node=eval({"id":nodeId,"monitorNodeid":nodeMonitorid,"text":nodeText,"url":url});var tab=center.getItem("tab"+nodeId);if(tab){center.remove(tab);tab.removeAll()}if(!center.getItem("tab"+nodeId)){loadflag=false;tab=center.add({id:"tab"+node.id,monitorNodeid:nodeMonitorid,iconCls:'openroomiconinfo',xtype:"panel",title:node.text,closable:true,layout:"fit"}).show();WXTL.Common.showWaitLoading(true);eval(url+'(node,nodeMonitorid)');}center.setActiveTab(tab)};viewValidData=function(rowIndex){var row=Js.Center.Monitor.SysMonitor.MonitorNode.Infostore.getAt(rowIndex);var nodeId='viewvaliddata'+row.get("numtaskid");var nodeText="• "+row.get("vc2taskname")+'有效数据';var url='Js.Center.Monitor.SysMonitor.ViewValidData.func';var nodeMonitorid=row.get("numtaskid");if(nodeText.length>1){nodeText=nodeText.substring(1,nodeText.length)}var node=eval({"id":nodeId,"monitorNodeid":nodeMonitorid,"text":nodeText,"url":url});var tab=center.getItem("tab"+nodeId);if(tab){center.remove(tab);tab.removeAll()}if(!center.getItem("tab"+nodeId)){loadflag=false;tab=center.add({id:"tab"+node.id,monitorNodeid:nodeMonitorid,iconCls:'openroomiconinfo',xtype:"panel",title:node.text,closable:true,layout:"fit"}).show();WXTL.Common.showWaitLoading(true);eval(url+'(node,nodeMonitorid)');}center.setActiveTab(tab)};var _pageSize=12;var fields=["numtaskid","vc2taskname","vc2taskdesc"];Js.Center.Monitor.SysMonitor.MonitorNode.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.System.Deployment.DeploymentQueryURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numtaskid",totalProperty:"totalCount"}),sortInfo:{field:'numtaskid',direction:'DESC'},baseParams:{vc2taskname:'',flag:'selectbykey'}});Js.Center.Monitor.SysMonitor.MonitorNode.Infostore.load({params:{start:0,limit:_pageSize,vc2taskname:'',flag:'selectbykey'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numtaskid"});var cm=new Ext.grid.ColumnModel([sm,{header:"网元编号",tooltip:"网元编号",dataIndex:"numtaskid",sortable:true},{header:"网元名称",tooltip:"网元名称",dataIndex:"vc2taskname",sortable:true},{header:"网元描述",tooltip:"网元描述",dataIndex:"vc2taskdesc",sortable:true},{header:"操作",tooltip:"操作",dataIndex:"filename",renderer:function(value,meta,record,rowIndex,colIndex,store){return"<a href='#' onclick='nodeMonitor("+rowIndex+")'>监控</a>  <a href='#' onclick='handleSpeedMonitor("+rowIndex+")'>速度</a>  <a href='#' onclick='viewValidData("+rowIndex+")'>有效数据</a>"}}]);var NodeGrid=new WXTL.Widgets.CommonGrid.GridPanel({anchor:'100% 100%',pageSize:_pageSize,store:Js.Center.Monitor.SysMonitor.MonitorNode.Infostore,sm:sm,cm:cm,needMenu:false,needRightMenu:false});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({height:120,queryMethod:"Js.Center.Monitor.SysMonitor.MonitorNode.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2taskname",id:"Js.Center.Monitor.SysMonitor.MonitorNode.vc2taskname",fieldLabel:"网元名称",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50}]}]}]});Js.Center.Monitor.SysMonitor.MonitorNode.queryGrid=function(){if(selectPanel.getForm().isValid()){var _vc2taskname=Ext.get("Js.Center.Monitor.SysMonitor.MonitorNode.vc2taskname").getValue();var _flag='selectbykey';Js.Center.Monitor.SysMonitor.MonitorNode.Infostore.baseParams={vc2taskname:_vc2taskname,flag:_flag};Js.Center.Monitor.SysMonitor.MonitorNode.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.Monitor.SysMonitor.MonitorNode.NodePanel=new Ext.Panel({frame:true,id:"Js.Center.Monitor.SysMonitor.MonitorNode.Nodepanel",bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,NodeGrid]})};GridMain(node,Js.Center.Monitor.SysMonitor.MonitorNode.NodePanel,"openroomiconinfo","Js.Center.Monitor.SysMonitor.MonitorNode.Infostore")};Ext.namespace('Js.Center.Monitor.SysMonitor');Js.Center.Monitor.SysMonitor.SysMonitorinfo=function(node,monitornodeid){var _commonModulepageSize=12;var commonModulefields=["id","name","status","lastruntime","nodename"];Js.Center.Monitor.SysMonitor.commonModuleInfostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.SysMonitor.SysMonitorListURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:commonModulefields,root:"data",id:"id",totalProperty:"totalCount"}),sortInfo:{field:'id',direction:'DESC'},baseParams:{flag:'2'}});Js.Center.Monitor.SysMonitor.commonModuleInfostore.load({params:{start:0,limit:_commonModulepageSize,flag:'2',monitornodeid:monitornodeid}});var commonModulesm=new Ext.grid.CheckboxSelectionModel({dataIndex:"id"});var commonModulecm=new Ext.grid.ColumnModel([{header:"通用模块ID",tooltip:"通用模块ID",dataIndex:"id",sortable:true},{header:"通用模块名称",tooltip:"通用模块名称",dataIndex:"name",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){return value}},{header:"状态",tooltip:"状态",dataIndex:"status",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){if(value=="init"){return"初始化"}else if(value=="ready"){return"就绪"}else if(value=="start"){return"运行"}else if(value=="pause"){return"暂停"}else if(value=="stop"){return"停止"}else if(value=="stopping"){return"停止中"}else if(value=="r"){return""}else{return"状态错误"}}},{header:"操作",tooltip:"操作",dataIndex:"id",width:200,renderer:function(value,meta,record,rowIndex,colIndex,store){var strStart="<a href='#' onclick='commandFunction(\"commonmodulemonitor\",\""+value+"\",\"start\","+rowIndex+","+monitornodeid+")'>启动</a>";var strStop="<a href='#' onclick='commandFunction(\"commonmodulemonitor\",\""+value+"\",\"stop\","+rowIndex+","+monitornodeid+")'>停止</a>";var strStatus=record.data.status;if(strStatus=="start"){strStart="启动"}else if(strStatus=="pause"){}else if(strStatus=="stop"){strStop="停止";}else if(strStatus=="ready"){strStart="启动"}else if(strStatus=="init"){strStart="启动"}else if(strStatus=="stopping"){strStart="启动";strStop="停止"}else if(strStatus=="r"){strStart="启动";strStop="停止"}return strStart+"----"+strStop}}]);var SysMonitorCommonModuleGrid=new Ext.grid.GridPanel({anchor:'0 0',width:536,store:Js.Center.Monitor.SysMonitor.commonModuleInfostore,viewConfig:{autoFill:true,forceFit:true},autoHeight:true,sm:commonModulesm,cm:commonModulecm});var _communicationModulepageSize=12;var communicationModulefields=["id","name","status","lastruntime","nodename"];Js.Center.Monitor.SysMonitor.communicationModuleInfostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.SysMonitor.SysMonitorListURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:communicationModulefields,root:"data",id:"id",totalProperty:"totalCount"}),sortInfo:{field:'id',direction:'DESC'},baseParams:{flag:'3'}});Js.Center.Monitor.SysMonitor.communicationModuleInfostore.load({params:{start:0,limit:_communicationModulepageSize,flag:'3',monitornodeid:monitornodeid}});var communicationModulesm=new Ext.grid.CheckboxSelectionModel({dataIndex:"id"});var communicationModulecm=new Ext.grid.ColumnModel([{header:"通信模块ID",tooltip:"通信模块ID",dataIndex:"id",sortable:true},{header:"通信模块名称",tooltip:"通信模块名称",dataIndex:"name",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){return"<span id='Js.Center.Monitor.SysMonitor.SysMonitorCommonModuleGrid"+record.id+"' onMouseOut='Js.Center.Monitor.SysMonitor.mouseOutClose(\""+record.id+"\")'  onclick='Js.Center.Monitor.SysMonitor.ModuleShow(\""+record.id+"\",\""+value+"\","+monitornodeid+")'><font qtip='"+value+"'>"+value+"</font></span>"}},{header:"状态",tooltip:"状态",dataIndex:"status",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){if(value=="init"){return"初始化"}else if(value=="ready"){return"就绪"}else if(value=="start"){return"运行"}else if(value=="pause"){return"暂停"}else if(value=="stop"){return"停止"}else if(value=="stopping"){return"停止中"}else if(value=="r"){return""}else{return"状态错误"}}},{header:"操作",tooltip:"操作",dataIndex:"id",width:200,renderer:function(value,meta,record,rowIndex,colIndex,store){var strStart="<a href='#' onclick='commandFunction(\"communicatemodulemonitor\",\""+value+"\",\"start\","+rowIndex+","+monitornodeid+")'>启动</a>";var strStop="<a href='#' onclick='commandFunction(\"communicatemodulemonitor\",\""+value+"\",\"stop\","+rowIndex+","+monitornodeid+")'>停止</a>";var strStatus=record.data.status;if(strStatus=="start"){strStart="启动"}if(strStatus=="pause"){}if(strStatus=="stop"){strStop="停止";}if(strStatus=="ready"){strStart="启动"}if(strStatus=="init"){strStart="启动"}if(strStatus=="stopping"){strStart="启动";strStop="停止"}if(strStatus=="r"){strStart="启动";strStop="停止"}return strStart+"----"+strStop}}]);var SysMonitorcommunicationModuleGrid=new Ext.grid.GridPanel({anchor:'100% 100%',width:536,store:Js.Center.Monitor.SysMonitor.communicationModuleInfostore,viewConfig:{autoFill:true,forceFit:true},autoHeight:true,sm:communicationModulesm,cm:communicationModulecm});var _ModulepageSize=12;var Modulefields=["id","name","status","lastruntime","nodename"];Js.Center.Monitor.SysMonitor.ModuleInfostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.SysMonitor.SysMonitorListURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:Modulefields,root:"data",id:"id",totalProperty:"totalCount"}),sortInfo:{field:'id',direction:'DESC'},baseParams:{flag:'4'}});Js.Center.Monitor.SysMonitor.ModuleInfostore.load({params:{start:0,limit:_ModulepageSize,flag:'4',monitornodeid:monitornodeid}});var Modulesm=new Ext.grid.CheckboxSelectionModel({dataIndex:"id"});var Modulecm=new Ext.grid.ColumnModel([{header:"功能模块ID",tooltip:"功能模块ID",dataIndex:"id",sortable:true},{header:"功能模块名称",tooltip:"功能模块名称",dataIndex:"name",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){return value}},{header:"状态",tooltip:"状态",dataIndex:"status",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){if(value=="init"){return"初始化"}else if(value=="ready"){return"就绪"}else if(value=="start"){return"运行"}else if(value=="pause"){return"暂停"}else if(value=="stop"){return"停止"}else if(value=="stopping"){return"停止中"}else if(value=="r"){return""}else{return"状态错误"}}}]);var SysMonitorModuleGrid=new Ext.grid.GridPanel({anchor:'100% 100%',width:536,store:Js.Center.Monitor.SysMonitor.ModuleInfostore,viewConfig:{autoFill:true,forceFit:true},autoHeight:true,sm:Modulesm,cm:Modulecm});var _ComponentspageSize=12;var Componentsfields=["id","name","status","lastruntime","qsize","esize","sch","status","lastovertime","nodename"];Js.Center.Monitor.SysMonitor.ComponentsInfostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.SysMonitor.SysMonitorListURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:Componentsfields,root:"data",id:"id",totalProperty:"totalCount"}),sortInfo:{field:'id',direction:'DESC'},baseParams:{flag:'5'}});Js.Center.Monitor.SysMonitor.ComponentsInfostore.load({params:{start:0,limit:_ComponentspageSize,flag:'5',monitornodeid:monitornodeid},"callback":function(){commandCommonFunction(monitornodeid,'start','232',node.id)}});var Componentssm=new Ext.grid.CheckboxSelectionModel({dataIndex:"id"});var Componentscm=new Ext.grid.ColumnModel([{header:"任务ID",tooltip:"任务ID",dataIndex:"id",sortable:true},{header:"任务名称",tooltip:"任务名称",dataIndex:"name",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){return value}},{header:"待处理",tooltip:"待处理",dataIndex:"qsize",hidden:true,sortable:true},{header:"已执行",tooltip:"已执行",dataIndex:"esize",hidden:true,sortable:true},{header:"调度规则",tooltip:"调度规则",dataIndex:"sch",hidden:true,sortable:true},{header:"状态",tooltip:"状态",dataIndex:"status",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){if(value=="init"){return"初始化"}else if(value=="ready"){return"就绪"}else if(value=="start"){return"运行"}else if(value=="pause"){return"暂停"}else if(value=="stop"){return"停止"}else if(value=="stopping"){return"停止中"}else if(value=="r"){return""}else{return"状态错误"}}},{header:"操作",tooltip:"操作",dataIndex:"id",width:200,renderer:function(value,meta,record,rowIndex,colIndex,store){var strStart="<a href='#' onclick='commandFunction(\"componentsmonitor\",\""+value+"\",\"start\","+rowIndex+","+monitornodeid+")'>启动</a>";var strPause="<a href='#' onclick='commandFunction(\"componentsmonitor\",\""+value+"\",\"pause\","+rowIndex+","+monitornodeid+")'>暂停</a>";var strStop="<a href='#' onclick='commandFunction(\"componentsmonitor\",\""+value+"\",\"stop\","+rowIndex+","+monitornodeid+")'>停止</a>";var srtExe="<a href='#' onclick='commandFunction(\"componentsmonitor\",\""+value+"\",\"exe\","+rowIndex+","+monitornodeid+")'>手动执行</a>";var strStatus=record.data.status;if(strStatus=="start"){strStart="启动"}if(strStatus=="pause"){strPause="暂停"}if(strStatus=="stop"){strStop="停止";strPause="暂停"}if(strStatus=="ready"){strStart="启动"}if(strStatus=="init"){strStart="启动"}if(strStatus=="stopping"){strStart="启动";strPause="暂停";strStop="停止"}if(strStatus=="r"){strStart="启动";strPause="暂停";strStop="停止";srtExe="手动执行"}return strStart+"----"+strPause+"----"+strStop+"----"+srtExe}}]);var SysMonitorComponentsGrid=new Ext.grid.GridPanel({anchor:'100% 100%',width:536,store:Js.Center.Monitor.SysMonitor.ComponentsInfostore,viewConfig:{autoFill:true,forceFit:true},autoHeight:true,sm:Componentssm,cm:Componentscm});Js.Center.Monitor.SysMonitor.SysMonitorPanel=new Ext.Panel({frame:true,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[{xtype:'portal',margins:'20 5 5 0',anchor:"98%",items:[{columnWidth:.5,items:[{title:'通用模块监控',autoHeight:true,autoScroll:true,style:'padding:10px 0 10px 10px',items:[SysMonitorCommonModuleGrid]},{title:'通信模块监控',autoHeight:true,autoScroll:true,style:'padding:10px 0 10px 10px',items:[SysMonitorcommunicationModuleGrid]}]},{columnWidth:.5,items:[{title:'功能模块监控',autoHeight:true,autoScroll:true,style:'padding:10px 0 10px 10px',items:[SysMonitorModuleGrid]},{title:'任务监控',autoHeight:true,autoScroll:true,style:'padding:10px 0 10px 10px',items:[SysMonitorComponentsGrid]}]}]}]});Js.Center.Monitor.SysMonitor.winShow=new Ext.Window({title:"监视信息",width:260,height:260,hidden:true,headerAsText:true,border:false,bodyBorder:false,plain:false,hideBorders:true,closable:true,autoScroll:false,closeAction:'hide',bodyStyle:"padding:10px 10px 10px 10px;background:#ffffff;",items:[{xtype:"label",fieldLabel:'',cls:'x-window-mc-showlabel',name:'vc2Message',id:'Js.Center.Monitor.SysMonitor.vc2Message',html:""}],needButtons:false});Js.Center.Monitor.SysMonitor.ModuleShow=function(id,value,monitorNodeId){var urlParam="?cmd=-U"+monitorNodeId+" -F"+id+" -Cview";var commandCommonData=doSynRequest(Js.Center.SysMonitor.SysMonitorQueryURL+urlParam);var showInfo="";if(commandCommonData.success==true){var filesCount=commandCommonData.data.length;for(var i=0;i<filesCount;i++){showInfo+="<B>"+commandCommonData.data[i].cname+":</B>"+commandCommonData.data[i].value+"<br>"}}else{showInfo="没有监视信息！"}var positionX=Ext.fly("Js.Center.Monitor.SysMonitor.SysMonitorCommonModuleGrid"+id+"").getX();var positionY=Ext.fly("Js.Center.Monitor.SysMonitor.SysMonitorCommonModuleGrid"+id+"").getY();if(positionY<200){positionY=positionY+10}else{positionY=positionY-200}Js.Center.Monitor.SysMonitor.winShow.doLayout();Js.Center.Monitor.SysMonitor.winShow.setPosition(positionX+50,positionY);Js.Center.Monitor.SysMonitor.winShow.show();Ext.get("Js.Center.Monitor.SysMonitor.vc2Message").dom.innerHTML=showInfo};Js.Center.Monitor.SysMonitor.mouseOutClose=function(id){if(Js.Center.Monitor.SysMonitor.winShow.hidden==false){Js.Center.Monitor.SysMonitor.winShow.hide()}};GridMain(node,Js.Center.Monitor.SysMonitor.SysMonitorPanel,"","","commandCommonFunction('"+monitornodeid+"','start','232','"+node.id+"')");};function commandFunction(flag,id,command,rowIndex,monitorNodeId){try{Ext.Msg.confirm("温馨提示!","您确定要执行该操作吗?",function(btn){if(btn=="yes"){var commondOp;commondOp="-U"+monitorNodeId+" -C"+command+" -P"+id;var commondjson=doSynRequest(Js.Center.SysMonitor.SysMonitorQueryURL+"?cmd="+commondOp);if(commondjson.success==true){var record="";if(flag=="commonmodulemonitor"){record=center.activeTab.findByType("grid")[0].store.getAt(rowIndex)}else{if(flag=="modulemonitor"){record=center.activeTab.findByType("grid")[2].store.getAt(rowIndex)}else{if(flag=="componentsmonitor"){record=center.activeTab.findByType("grid")[3].store.getAt(rowIndex)}else{if(flag=="communicatemodulemonitor"){record=center.activeTab.findByType("grid")[1].store.getAt(rowIndex)}else{Ext.Msg.alert("温馨提示","类型错误!")}}}}if(record==""){Ext.Msg.alert("温馨提示","数据源错误!")}else{if(command=="stop"){command="stopping"}if(command!="exe"){record.set("status",command);record.commit()}Ext.Msg.alert("温馨提示","操作成功!")}}else{Ext.Msg.alert("温馨提示","操作失败!")}}})}catch(err){Ext.Msg.alert("温馨提示","客户端请求异常!")}};function commandCommonFunction(id,command,param,nodeId){try{var urlParam="?cmd=-U"+id+" -Clist";var commandCommonData=doSynRequest(Js.Center.SysMonitor.SysMonitorQueryURL+urlParam);var commonModuleData=center.activeTab.findByType("grid")[0].store;var communicaData=center.activeTab.findByType("grid")[1].store;var moduleData=center.activeTab.findByType("grid")[2].store;var ComponentsData=center.activeTab.findByType("grid")[3].store;if(commandCommonData.success==true){if(commandCommonData.data.length>=1){for(var i=0;i<commandCommonData.data.length;i++){var addFalg=true;for(var j=0;j<commonModuleData.data.length;j++){if(commandCommonData.data[i].id==commonModuleData.data.items[j].data.id&&commandCommonData.data[i].type.toLowerCase()=="commonmodule"){commonModuleData.getById(commonModuleData.data.items[j].data.id).set('status',commandCommonData.data[i].status);addFalg=false}}for(var j=0;j<communicaData.data.length;j++){if(commandCommonData.data[i].id==communicaData.data.items[j].data.id&&commandCommonData.data[i].type.toLowerCase()=="module"){communicaData.getById(communicaData.data.items[j].data.id).set('status',commandCommonData.data[i].status);addFalg=false}}for(var j=0;j<moduleData.data.length;j++){if(commandCommonData.data[i].id==moduleData.data.items[j].data.id&&commandCommonData.data[i].type.toLowerCase()=="function"){moduleData.getById(moduleData.data.items[j].data.id).set('status',commandCommonData.data[i].status);addFalg=false}}for(var j=0;j<ComponentsData.data.length;j++){if(commandCommonData.data[i].id==ComponentsData.data.items[j].data.id&&commandCommonData.data[i].type.toLowerCase()=="components"){ComponentsData.getById(ComponentsData.data.items[j].data.id).set('status',commandCommonData.data[i].status);ComponentsData.getById(ComponentsData.data.items[j].data.id).set('qsize',commandCommonData.data[i].qsize);ComponentsData.getById(ComponentsData.data.items[j].data.id).set('esize',commandCommonData.data[i].esize);ComponentsData.getById(ComponentsData.data.items[j].data.id).set('sch',commandCommonData.data[i].sch);ComponentsData.getById(ComponentsData.data.items[j].data.id).set('lastovertime',commandCommonData.data[i].lastovertime);ComponentsData.getById(ComponentsData.data.items[j].data.id).set('lastruntime',commandCommonData.data[i].lastruntime);addFalg=false}}if(addFalg){var MyRecordType=Ext.data.Record.create([{name:"id",type:"string"},{name:"name",type:"string"},{name:"status",type:"string"}]);var oneRecord=new MyRecordType({id:commandCommonData.data[i].id,name:commandCommonData.data[i].name,status:commandCommonData.data[i].status});oneRecord.id=commandCommonData.data[i].id;if(commandCommonData.data[i].type.toLowerCase()=="commonmodule"){commonModuleData.add(oneRecord)}else if(commandCommonData.data[i].type.toLowerCase()=="module"){communicaData.add(oneRecord)}else if(commandCommonData.data[i].type.toLowerCase()=="function"){moduleData.add(oneRecord)}else if(commandCommonData.data[i].type.toLowerCase()=="components"){ComponentsData.add(oneRecord)}}}commonModuleData.commitChanges();communicaData.commitChanges();moduleData.commitChanges();ComponentsData.commitChanges()}setTimeout(function(){var _nodeId="tab"+nodeId;if(center.activeTab.id==_nodeId&&center.activeTab.monitorNodeid==id){commandCommonFunction(id,'start','232',nodeId)}},3000)}else{Ext.Msg.alert("温馨提示","服务器请求异常!")}}catch(err){Ext.Msg.alert("温馨提示","客户端请求异常!")}};Ext.namespace('Js.Center.SysMonitor');Js.Center.SysMonitor.SysMonitorQueryURL='cmd.ashx';Js.Center.SysMonitor.SysMonitorListURL='URL/Monitor/SysMonitor/SysMonitorQuery.ashx';Ext.namespace('Js.Center.System.Deployment');Js.Center.System.Deployment.DeploymentQueryURL="URL/deployment/node.ashx";Ext.namespace('Js.Center.Monitor.SysMonitor.ViewValidData');Js.Center.Monitor.SysMonitor.ViewValidData.func=function(node,monitornodeid){var _pageSize=12;var fields=["id","count","name","fno"];Js.Center.Monitor.SysMonitor.ViewValidData.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.SysMonitor.SysMonitorQueryURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"id",totalProperty:"totalCount"}),sortInfo:{field:'name',direction:'DESC'},baseParams:{cmd:"-U"+monitornodeid+" -F601 -Cviewbussta"}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"id"});var cm=new Ext.grid.ColumnModel([{header:"文件编号",tooltip:"文件编号",dataIndex:"fno",sortable:true},{header:"文件名称",tooltip:"文件名称",dataIndex:"name",sortable:true},{header:"总数",tooltip:"总数",dataIndex:"count",sortable:true}]);var monitorGrid=new WXTL.Widgets.CommonGrid.GridPanel({anchor:'100% 100%',needPage:false,pageSize:_pageSize,store:Js.Center.Monitor.SysMonitor.ViewValidData.Infostore,sm:sm,cm:cm,needMenu:false,needRightMenu:false});Js.Center.Monitor.SysMonitor.ViewValidData.mainPanel=new Ext.Panel({frame:true,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{anchor:'98%',collapsible:true},items:[monitorGrid]});GridMain(node,Js.Center.Monitor.SysMonitor.ViewValidData.mainPanel,"","","viewValidDataInfo('"+monitornodeid+"','"+node.id+"')");viewValidDataInfo(monitornodeid,node.id)};function viewValidDataInfo(taskId,nodeId){try{center.activeTab.items.items[0].items.items[0].store.baseParams={cmd:"-U"+taskId+" -F601 -Cviewbussta"};center.activeTab.items.items[0].items.items[0].store.reload();setTimeout(function(){var _nodeId="tab"+nodeId;if(center.activeTab.id==_nodeId&&center.activeTab.monitorNodeid==taskId){viewValidDataInfo(taskId,nodeId)}},3000)}catch(err){Ext.Msg.alert("温馨提示","系统请求异常!")}};