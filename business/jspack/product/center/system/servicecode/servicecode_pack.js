Ext.namespace('Js.Center.Business');Js.Center.Business.ServiceCodeURL='URL/business/servicecode/servicecode.ashx';Js.Center.Business.ServiceCodeUpdateURL='URL/business/servicecode/servicecode.ashx';Ext.namespace('Js.Center.Business.ServiceCodeAdd');Js.Center.Common.GatewayStore.Add=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.GatewayURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:['numgwid','vc2gatewayname'],root:'data',id:'numgwid'}),baseParams:{columnlist:'numgwid,vc2gatewayname',flag:'selectall',serviceflag:'selectbyservicetype',instids:'numinstid'}});Js.Center.Business.ServiceCodeAdd.func=function(){WXTL.Common.showWaitLoading(true);Js.Center.Common.GatewayStore.Add.reload({params:{vc2servicetype:"-1",serviceflag:'selectbyservicetype',instids:'numinstid'}});var addServiceCodeInfofp=new Ext.form.FormPanel({frame:true,labelWidth:80,defaults:{anchor:"90%",msgTarget:"side"},items:[{layout:'column',items:[{xtype:"hidden",name:"flag",value:"insert"},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2svc",fieldLabel:"<font color=red>业务代码</font>",allowBlank:false,blankText:"业务编码不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:10,maxLengthText:'长度不能超过10！'},{xtype:"combo",name:"vc2type",fieldLabel:"<font color=red>计费类型</font>",hiddenName:"vc2type",emptyText:"请选择",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:1,allowBlank:false,blankText:"计费类型不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["免费","0"],["按条","1"],["包月","2"]]})},{xtype:'numberfield',name:'vc2feevalue',fieldLabel:"<font color=red>资费(分)</font>",allowBlank:false,blankText:'资费不允许为空',maxValue:9999999999,maxText:'最大不能超过9999999999',minValue:0,minText:'最小不能小于1'},{xtype:"textfield",name:"vc2longcode",fieldLabel:"服务代码",allowBlank:true,maxLength:20,maxLengthText:'长度不能超过20！'}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2svcname",fieldLabel:"<font color=red>业务名称</font>",allowBlank:false,blankText:"业务名称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50,maxLengthText:'长度不能超过50！'},{xtype:"combo",name:"vc2servicetype",fieldLabel:"<font color=red>短彩类型</font>",hiddenName:"vc2servicetype",readOnly:true,allowBlank:false,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",emptyText:'-=请选择=-',blankText:"短彩类型不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["短信","1"],["彩信","2"],["wap","3"]]}),listeners:{"select":function(){Ext.getCmp('Js.Center.Business.ServiceCodeAdd.tempnumgwid').reset();Js.Center.Common.GatewayStore.Add.load({params:{vc2servicetype:this.getValue(),serviceflag:'selectbyservicetype'}})}}},{xtype:"combo",name:"numgwid",id:"Js.Center.Business.ServiceCodeAdd.tempnumgwid",fieldLabel:"<font color=red>网关名称</font>",hiddenName:"numgwid",readOnly:true,mode:"local",store:Js.Center.Common.GatewayStore.Add,triggerAction:'all',selectOnFocus:true,emptyText:'-=请先选择短彩类型=-',width:130,allowBlank:false,blankText:"网关名称不允许为空",displayField:'vc2gatewayname',valueField:'numgwid',mode:'local'},{xtype:"lovcombo",name:"numinstid",fieldLabel:"<font color=red>通道地区</font>",hiddenName:"numinstid",allowBlank:false,blankText:"地区不允许为空",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numinstid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.InstStore,onSelect:function(record,index){if(this.fireEvent('beforeselect',this,record,index)!==false){if(false==this.store.data.items[0].data.checked||0==index){if(0==index&&false==record.get(this.checkField)){this.clearValue()}record.set(this.checkField,!record.get(this.checkField))}if(this.store.isFiltered()){this.doQuery(this.allQuery)}this.setValue(this.getCheckedValue());this.fireEvent('select',this,record,index)}}}]},{columnWidth:1,layout:'form',defaultType:"textfield",defaults:{anchor:"95%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0px 0 10px 15px",items:[{xtype:"textarea",align:"right",name:"vc2dsc",fieldLabel:"描述",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:100,maxLengthText:'长度不能超过100！'}]}]}]});var mainForm=addServiceCodeInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加通道",mainForm:mainForm,updateURL:Js.Center.Business.ServiceCodeUpdateURL,displayStore:Js.Center.Business.ServiceCode.Infostore,items:[addServiceCodeInfofp],needButtons:false,buttons:[new Ext.Button({text:'确定',minWidth:70,handler:function(){if(addServiceCodeInfofp.getForm().isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.Business.ServiceCodeAdd.window.mainFormSubmitFunc()}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){Js.Center.Common.GatewayStore.Add.removeAll();addServiceCodeInfofp.getForm().reset()}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){Js.Center.Business.ServiceCodeAdd.window.hide()}})],listeners:{"beforehide":function(){Js.Center.Common.GatewayStore.Add.removeAll();}}})};Ext.namespace('Js.Center.Business.ServiceCodeUpdate');Js.Center.Business.ServiceCodeUpdate.func=function(row){Js.Center.Business.ServiceCodeUpdate.GatewayStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.GatewayURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:['numgwid','vc2gatewayname'],root:'data',id:'numgwid'}),baseParams:{flag:'selectall',columnlist:'numgwid,vc2gatewayname'}});var gatewayCombo={xtype:"combo",name:"numgwid",id:"Js.Center.Business.ServiceCodeUpdate.tempnumgwid",fieldLabel:"<font color=red>网关名称</font>",hiddenName:"numgwid",readOnly:true,mode:"local",store:Js.Center.Business.ServiceCodeUpdate.GatewayStore,typeAhead:true,triggerAction:'all',selectOnFocus:true,emptyText:'-=请选择=-',forceSelection:true,width:130,allowBlank:false,blankText:"网关名称不允许为空",displayField:'vc2gatewayname',valueField:'numgwid',mode:'local'};var updateServiceCodeInfofp=new Ext.form.FormPanel({frame:true,labelWidth:80,defaults:{anchor:"90%",msgTarget:"side"},items:[{layout:'column',items:[{xtype:"hidden",name:"flag",value:"updateall"},{xtype:"hidden",name:"numsvcid",fieldLabel:"编号"},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2svc",fieldLabel:"<font color=red>业务代码</font>",allowBlank:false,blankText:"业务编码不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:10,maxLengthText:'长度不能超过10！'},{xtype:"combo",name:"vc2type",fieldLabel:"<font color=red>计费类型</font>",hiddenName:"vc2type",emptyText:"请选择",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",allowBlank:false,blankText:"计费类型不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["免费","0"],["按条","1"],["包月","2"]]})},{xtype:'numberfield',name:'vc2feevalue',fieldLabel:"<font color=red>资费(分)</font>",allowBlank:false,blankText:'资费不允许为空',maxValue:9999999999,maxText:'最大不能超过9999999999',minValue:0,minText:'最小不能小于0'},{xtype:"textfield",name:"vc2longcode",fieldLabel:"服务代码",allowBlank:true,maxLength:20,maxLengthText:'长度不能超过20！'}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2svcname",fieldLabel:"<font color=red>业务名称</font>",allowBlank:false,blankText:"业务名称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50,maxLengthText:'长度不能超过50！'},{xtype:"combo",name:"vc2servicetype",fieldLabel:"<font color=red>短彩类型</font>",hiddenName:"vc2servicetype",readOnly:true,allowBlank:false,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",selectOnFocus:true,emptyText:'-=请选择=-',blankText:"短彩类型不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["短信","1"],["彩信","2"],["wap","3"]]}),listeners:{"select":function(){Ext.getCmp('Js.Center.Business.ServiceCodeUpdate.tempnumgwid').setValue('-=请选择=-');Js.Center.Business.ServiceCodeUpdate.GatewayStore.reload({params:{vc2servicetype:this.getValue(),serviceflag:'selectbyservicetype'}})}}},gatewayCombo,{xtype:"lovcombo",name:"numinstid",fieldLabel:"<font color=red>通道地区</font>",hiddenName:"numinstid",id:"Js.Center.Business.ServiceCodeUpdate.numinstid",allowBlank:false,blankText:"地区不允许为空",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numinstid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.InstStore,onSelect:function(record,index){if(this.fireEvent('beforeselect',this,record,index)!==false){if(false==this.store.data.items[0].data.checked||0==index){if(0==index&&false==record.get(this.checkField)){this.clearValue()}record.set(this.checkField,!record.get(this.checkField))}if(this.store.isFiltered()){this.doQuery(this.allQuery)}this.setValue(this.getCheckedValue());this.fireEvent('select',this,record,index)}}}]},{columnWidth:1,layout:'form',defaultType:"textfield",defaults:{anchor:"95%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0px 0 10px 15px",items:[{xtype:"textarea",align:"right",name:"vc2dsc",fieldLabel:"描述",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:100,maxLengthText:'长度不能超过100！'}]}]}]});var mainForm=updateServiceCodeInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"修改通道",mainForm:mainForm,updateURL:Js.Center.Business.ServiceCodeUpdateURL,displayStore:Js.Center.Business.ServiceCode.Infostore,updateState:true,updateRecord:row,needButtons:false,items:[updateServiceCodeInfofp],buttons:[new Ext.Button({text:'确定',minWidth:70,handler:function(){if(updateServiceCodeInfofp.getForm().isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.Business.ServiceCodeUpdate.window.mainFormSubmitFunc()}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){updateServiceCodeInfofp.getForm().reset();Js.Center.Business.ServiceCodeUpdate.window.mainForm.loadRecord(Js.Center.Business.ServiceCodeUpdate.window.updateRecord);getSvcInst()}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){Js.Center.Business.ServiceCodeUpdate.window.hide()}})],needLoadDataStore:true,loadDataStoreFunc:function(){Js.Center.Business.ServiceCodeUpdate.GatewayStore.reload({params:{vc2servicetype:Js.Center.Business.ServiceCodeUpdate.window.updateRecord.get("vc2servicetype"),serviceflag:'selectbyservicetype'},callback:function(records,options,success){Ext.getCmp("Js.Center.Business.ServiceCodeUpdate.tempnumgwid").setValue(Js.Center.Business.ServiceCodeUpdate.window.updateRecord.get("numgwid"))}});getSvcInst()}});getSvcInst=function(){var svcinst=Js.Center.Business.ServiceCodeUpdate.window.updateRecord.get("numsvcid");var Url="URL/business/servicecode/servicecode.ashx?flag=selectsvcinst&svcid="+svcinst;var JsonInst=eval(doSynRequest(Url));var strSvcInst="";for(var i=0;i<JsonInst.totalCount;i++){strSvcInst+=JsonInst.data[i].numinstid;if((i+1)!=JsonInst.totalCount){strSvcInst+=','}}Ext.getCmp("Js.Center.Business.ServiceCodeUpdate.numinstid").setValue(strSvcInst)}};Ext.namespace('Js.Center.Business.ServiceCodedelete');Js.Center.Business.ServiceCodedelete.func=function(row){var deleteSplit="";for(var i=0;i<row.length;i++){if(row.length==1){deleteSplit=row[i].data.numsvcid}else{if(i<(row.length-1)){deleteSplit=row[i].data.numsvcid+","+deleteSplit}if(i==(row.length-1)){deleteSplit=deleteSplit+row[i].data.numsvcid}}};var params={ids:deleteSplit,flag:"delete"};doAjax(Js.Center.Business.ServiceCodeUpdateURL,params,Js.Center.Business.ServiceCode.Infostore)};Ext.namespace('Js.Center.Business.ServiceCode');Js.Center.Business.ServiceCode.serviceCodeInfo=function(node){if(Ext.get("Js.Center.Business.ServiceCode.servicecodepanel")==null){Js.Center.Common.GatewayStore.Search=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.GatewayURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:['numgwid','vc2gatewayname'],root:'data',id:'numgwid'}),baseParams:{columnlist:'numgwid,vc2gatewayname',flag:'selectall',serviceflag:'selectbyservicetype'}});Js.Center.Common.GatewayStore.Search.reload();Js.Center.Common.InstStore.reload();var feeTypeStore=new Ext.data.SimpleStore({fields:["vc2name","value"],data:[["免费","0"],["按条","1"],["包月","2"]]});var _pageSize=12;var fields=["numsvcid","vc2svc","vc2svcname","datstart","datend","numgwid","vc2feevalue","nummonthcnt","vc2prodseq","numstatflag","vc2ischg","vc2svctype","vc2type","vc2dsc","vc2gatewayname","vc2servicetype","vc2longcode"];Js.Center.Business.ServiceCode.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.ServiceCodeURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numsvcid",totalProperty:"totalCount"}),sortInfo:{field:'vc2svcname',direction:'DESC'},baseParams:{vc2svcname:'',vc2svc:'',numgwid:'',vc2servicetype:'-1',flag:'selectbykey'}});Js.Center.Business.ServiceCode.Infostore.load({params:{start:0,limit:_pageSize,vc2svcname:'',vc2svc:'',numgwid:'',flag:'selectbykey'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numsvcid"});var cm=new Ext.grid.ColumnModel([sm,{header:"业务名称",tooltip:"业务名称",dataIndex:"vc2svcname",sortable:true},{header:"业务代码",tooltip:"业务代码",dataIndex:"vc2svc",sortable:true},{header:"计费类型",tooltip:"计费类型",dataIndex:"vc2type",sortable:true,renderer:function(value){if(value=="0"){return"免费"}else if(value=="1"){return"按条"}else if(value=="2"){return"包月"}}},{header:"短彩类型",tooltip:"短彩类型",dataIndex:"vc2servicetype",sortable:true,renderer:function(value){if(value=="1"){return"短信"}else if(value=="2"){return"彩信"}else if(value=="3"){return"wap"}else if(value=="4"){return"短信PV"}else if(value=="5"){return"彩信PV"}else if(value=="6"){return"wapPV"}}},{header:"网关名称",tooltip:"网关名称",dataIndex:"vc2gatewayname",sortable:true},{header:"服务代码",tooltip:"服务代码",dataIndex:"vc2longcode",sortable:true},{header:"描述",tooltip:"描述",dataIndex:"vc2dsc",sortable:true}]);var serviceCodeGrid=new WXTL.Widgets.CommonGrid.GridPanel({id:"Js.Center.Business.ServiceCode.servicecodeGridPanel",anchor:'100% 100%',pageSize:_pageSize,store:Js.Center.Business.ServiceCode.Infostore,afterEditURL:Js.Center.Business.servicecodeUpdateURL,inertMethod:'Js.Center.Business.ServiceCodeAdd',updateMethod:'Js.Center.Business.ServiceCodeUpdate',deleteMethod:'Js.Center.Business.ServiceCodedelete.func',sm:sm,cm:cm});var gatewayCombo=new WXTL.Widgets.CommonForm.ComboBox({xtype:"combo",name:"numgwid_ext",id:"Js.Center.Business.ServiceCode.numgwid_ext",fieldLabel:"网关名称",hiddenName:"Js.Center.Business.ServiceCode.servicodegwid",readOnly:true,mode:"local",displayField:"vc2gatewayname",valueField:"numgwid",triggerAction:"all",emptyText:'-=请先选择短彩类型=-',valueNotFoundText:'-=请先选择短彩类型=-',store:Js.Center.Common.GatewayStore.Search,initCancleText:function(o){var obj=this;o.on("select",function(){});this.store.on("datachanged",function(a){if(a.getAt(0)!=null&&a.getAt(0).data[obj.valueField]!=''){var r=new Ext.data.Record({});r.set(o.valueField,'');r.set(o.displayField,'-=请先选择短彩类型=-');a.insert(0,r)}})}});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"Js.Center.Business.ServiceCode.servicecodeSelectPanel",height:150,labelWidth:100,needButtons:false,queryMethod:"Js.Center.Business.ServiceCode.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",fieldLabel:'业务名称',name:'vc2svcname',id:'Js.Center.Business.ServiceCode.servicecodeinfosvcname',regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50,maxLengthText:'长度不能超过50！'},{xtype:"combo",name:"vc2servicetype",fieldLabel:"短彩类型",hiddenName:"Js.Center.Business.ServiceCode.stype",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择短彩类型=-","-1"],["短信","1"],["彩信","2"],["wap","3"]]}),listeners:{"select":function(){Ext.getCmp('Js.Center.Business.ServiceCode.numgwid_ext').setValue('');Js.Center.Common.GatewayStore.Search.reload({params:{vc2servicetype:this.getValue(),serviceflag:'selectbyservicetype'}})}}}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",fieldLabel:'业务代码',name:'vc2svc',id:'Js.Center.Business.ServiceCode.servicecodeinfosvc',regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:10,maxLengthText:'长度不能超过10！'},gatewayCombo]}]}],buttons:[new Ext.Button({text:'查询',handler:function(){Js.Center.Business.ServiceCode.queryGrid()}}),new Ext.Button({text:'重置',handler:function(){selectPanel.getForm().reset();Js.Center.Common.GatewayStore.Search.removeAll()}})]});Js.Center.Business.ServiceCode.queryGrid=function(){if(selectPanel.getForm().isValid()){var serviceCodeName=Ext.get("Js.Center.Business.ServiceCode.servicecodeinfosvcname").getValue();var vc2svc=Ext.get("Js.Center.Business.ServiceCode.servicecodeinfosvc").getValue();var numgwid=Ext.get("Js.Center.Business.ServiceCode.servicodegwid").getValue();var stype=Ext.get("Js.Center.Business.ServiceCode.stype").getValue();var flag='selectbykey';Js.Center.Business.ServiceCode.Infostore.baseParams={vc2svcname:serviceCodeName,vc2svc:vc2svc,numgwid:numgwid,vc2servicetype:stype,flag:flag};Js.Center.Business.ServiceCode.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.Business.ServiceCode.ServiceCodePanel=new Ext.Panel({id:"Js.Center.Business.ServiceCode.servicecodepanel",frame:true,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,serviceCodeGrid]})};GridMain(node,Js.Center.Business.ServiceCode.ServiceCodePanel,"openroomiconinfo","Js.Center.Business.ServiceCode.Infostore")};