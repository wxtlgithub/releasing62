Ext.namespace('Js.Center.Business.Product.ppbalanceAdd');Ext.QuickTips.init();Js.Center.Business.Product.ppbalanceAdd.func=function(){if(Js.Center.Business.Product.ppbalanceAdd.window==null){var ppbalanceAddInfofp=new Ext.form.FormPanel({frame:true,labelWidth:130,layout:'form',defaults:{anchor:"99%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 10px",items:[{xtype:"hidden",name:"flag",value:"addrotestarbalance"},{xtype:"hidden",name:"numprodid",id:"Js.Center.Business.Product.ppbalanceAdd.numprodid",value:""},{xtype:"hidden",name:"numtypeid",value:"3"},{xtype:"textfield",fieldLabel:"选择可使用的通道",hidden:true},{html:'<div id="Js.Center.Business.Product.ppbalanceAdd.productPanelFieldSet" style="float:left;margin:0px;border:1px solid #c3daf9;width:98%;height:150px;"></div>'}]});var mainForm=ppbalanceAddInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加均衡策略",mainForm:mainForm,updateURL:Js.Center.Business.RoutestraURL,displayStore:Js.Center.Business.productpolicy.BalancedInfostore,items:[ppbalanceAddInfofp],needLoadDataStore:true,width:590,loadDataStoreFunc:function(){var numprodid=Ext.fly("Js.Center.Business.productpolicy.propermitsvcnumprodid").getValue();Js.Center.Business.Product.ppbalanceAdd.window.mainForm.items.items[1].setValue(numprodid);createProductPanel(1,2)},needButtons:false,buttons:[new Ext.Button({text:'确定',minWidth:70,handler:function(){if(Js.Center.Business.Product.ppbalanceAdd.window.mainForm.isValid()){Js.Center.Business.Product.ppbalanceAdd.window.mainFormSubmitFunc()}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){Js.Center.Business.Product.ppbalanceAdd.window.mainForm.reset()}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){Js.Center.Business.Product.ppbalanceAdd.window.hide()}})]})}function createProductPanel(productsid,numstraid){document.getElementById('Js.Center.Business.Product.ppbalanceAdd.productPanelFieldSet').innerHTML='';Ext.get('Js.Center.Business.Product.ppbalanceAdd.productPanelFieldSet').dom.innerHTML='';var productList=new WXTL.Widgets.CommonForm.CheckboxGroup.RemoteCheckboxGroup({url:Js.Center.Business.RoutestraURL,queryparams:'flag=addrotestarbalancestore',requestname:'numsvcids',defaultsItemsName:'numsvcids',defaultsItemsboxLable:'对不起，没有相关通道信息。',numcolumns:3,fieldLabel:'<font color=red>通道组</font>',messageID:1,reader:new Ext.data.JsonReader({totalProperty:'totalProperty',root:'data',fields:[{name:'id'},{name:'name'},{name:'boxLabel',mapping:"vc2svcname"},{name:'inputValue',mapping:"numsvcid"},{name:'checked',mapping:'ischecked'}]})});var productPanel=new Ext.Panel({style:'padding:0 0 0 5px',applyTo:'Js.Center.Business.Product.ppbalanceAdd.productPanelFieldSet',width:530,autoScroll:true,items:[{items:[productList]}]});productPanel.doLayout()}};Ext.namespace('Js.Center.Business.Product.ppbalanceDelete');Js.Center.Business.Product.ppbalanceDelete.func=function(row){var deleteSplit="";for(var i=0;i<row.length;i++){if(row.length==1){deleteSplit=row[i].data.numstraid}else{if(i<(row.length-1)){deleteSplit=row[i].data.numstraid+","+deleteSplit}if(i==(row.length-1)){deleteSplit=deleteSplit+row[i].data.numstraid}}};var params={ids:deleteSplit,numprodid:row[0].data.numprodid,numtypeid:3,flag:"deleterotestarbalance"};doAjax(Js.Center.Business.RoutestraURL,params,Js.Center.Business.productpolicy.BalancedInfostore)};Ext.namespace('Js.Center.Business.Product.ppbalanceUpdate');Ext.QuickTips.init();Js.Center.Business.Product.ppbalanceUpdate.func=function(row){if(Js.Center.Business.Product.ppbalanceUpdate.window==null){var ppbalanceUpdateInfofp=new Ext.form.FormPanel({frame:true,labelWidth:130,layout:'form',defaults:{anchor:"99%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"hidden",name:"flag",value:"updaterotestarbalance"},{xtype:"hidden",name:"numprodid",id:"Js.Center.Business.Product.ppbalanceUpdate.numprodid",value:""},{xtype:"hidden",name:"numtypeid",value:"3"},{xtype:"hidden",name:"numstraid",fieldLabel:"路由策略id"},{xtype:"textfield",fieldLabel:"选择可使用的通道",hidden:true},{html:'<div id="Js.Center.Business.Product.ppbalanceUpdate.productPanelFieldSet" style="float:left;margin:0px;border:1px solid #c3daf9;width:100%;height:150px;"></div>'}]});var mainForm=ppbalanceUpdateInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"修改均衡策略",mainForm:mainForm,updateURL:Js.Center.Business.RoutestraURL,displayStore:Js.Center.Business.productpolicy.BalancedInfostore,updateState:true,updateRecord:row,items:[ppbalanceUpdateInfofp],needLoadDataStore:true,width:590,loadDataStoreFunc:function(){var numprodid=Ext.fly("Js.Center.Business.productpolicy.propermitsvcnumprodid").getValue();Js.Center.Business.Product.ppbalanceUpdate.window.mainForm.items.items[1].setValue(numprodid);createProductPanel(Js.Center.Business.Product.ppbalanceUpdate.window.updateRecord.get("numprodid"),Js.Center.Business.Product.ppbalanceUpdate.window.updateRecord.get("numstraid"))},needButtons:false,buttons:[new Ext.Button({text:'确定',minWidth:70,handler:function(){if(Js.Center.Business.Product.ppbalanceUpdate.window.mainForm.isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.Business.Product.ppbalanceUpdate.window.mainForm.submit({url:Js.Center.Business.Product.ppbalanceUpdate.window.updateURL,method:"POST",success:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);var falg=objJson.success;if(falg==true){Ext.Msg.alert("温馨提示","操作成功了!");Js.Center.Business.Product.ppbalanceUpdate.window.hide();Js.Center.Business.Product.ppbalanceUpdate.window.displayStore.reload()}else Ext.Msg.alert('温馨提示',objJson.info)},failure:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);Ext.Msg.alert('温馨提示',objJson.info)}})}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){Js.Center.Business.Product.ppbalanceUpdate.window.mainForm.reset()}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){Js.Center.Business.Product.ppbalanceUpdate.window.hide()}})]})}function createProductPanel(productsid,numstraid){document.getElementById('Js.Center.Business.Product.ppbalanceUpdate.productPanelFieldSet').innerHTML='';Ext.get('Js.Center.Business.Product.ppbalanceUpdate.productPanelFieldSet').dom.innerHTML='';var productList=new WXTL.Widgets.CommonForm.CheckboxGroup.RemoteCheckboxGroup({url:Js.Center.Business.RoutestraURL,queryparams:'flag=updatgerotestarbalancestore&numprodid='+productsid+'&numstraid='+numstraid,requestname:'numsvcids',defaultsItemsName:'numsvcids',defaultsItemsboxLable:'对不起，没有相关通道信息。',numcolumns:3,messageID:1,reader:new Ext.data.JsonReader({totalProperty:'totalProperty',root:'data',fields:[{name:'id'},{name:'name'},{name:'boxLabel',mapping:"vc2svcname"},{name:'inputValue',mapping:"numsvcid"},{name:'checked',mapping:'ischecked'}]})});var productPanel=new Ext.Panel({style:'padding:0 0 0 5px',applyTo:'Js.Center.Business.Product.ppbalanceUpdate.productPanelFieldSet',width:530,autoScroll:true,items:[{items:[productList]}]});productPanel.doLayout()}};Ext.namespace('Js.Center.Business.Product.ppmainbackupAdd');Ext.QuickTips.init();Js.Center.Business.Product.ppmainbackupAdd.func=function(){if(Js.Center.Business.Product.ppmainbackupAdd.window==null){var AddgatewayInfofp=new Ext.form.FormPanel({frame:true,labelWidth:80,items:[{layout:'column',items:[{xtype:"hidden",name:"flag",value:"addrotestaras"},{xtype:"hidden",name:"numtypeid",value:"2"},{xtype:"hidden",id:"Js.Center.Business.Product.ppmainbackupAdd.numprodid",name:"numprodid"},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"combo",name:"numsvcid",fieldLabel:"<font color=red>主通道</font>",hiddenName:"numsvcid",id:"Js.Center.Business.Product.ppmainbackupAdd.numsvcid",allowBlank:false,blankText:"主通道不允许为空",readOnly:true,mode:"local",displayField:"vc2svcname",valueField:"numsvcid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.ServiceCodeStore,listeners:{"select":function(){if(Ext.fly("Js.Center.Business.Product.ppmainbackupAdd.numsvcid").getValue()==Ext.fly("Js.Center.Business.Product.ppmainbackupAdd.numassvcid").getValue()){Js.Center.Business.Product.ppmainbackupAdd.window.mainForm.items.items[3].reset()}}}}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"combo",name:"numassvcid",fieldLabel:"<font color=red>备用通道</font>",hiddenName:"numassvcid",id:"Js.Center.Business.Product.ppmainbackupAdd.numassvcid",allowBlank:false,blankText:"备用通道不允许为空",readOnly:true,mode:"local",displayField:"vc2svcname",valueField:"numsvcid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.ServiceCodeStore,listeners:{"select":function(){if(Ext.fly("Js.Center.Business.Product.ppmainbackupAdd.numsvcid").getValue()==Ext.fly("Js.Center.Business.Product.ppmainbackupAdd.numassvcid").getValue()){Js.Center.Business.Product.ppmainbackupAdd.window.mainForm.items.items[4].reset()}}}}]}]}]});var mainForm=AddgatewayInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加主备策略",mainForm:mainForm,updateURL:Js.Center.Business.RoutestraURL,displayStore:Js.Center.Business.productpolicy.MainBackupInfostore,items:[AddgatewayInfofp],needLoadDataStore:true,loadDataStoreFunc:function(){Js.Center.Common.ServiceCodeStore.reload();var numprodid=Ext.fly("Js.Center.Business.productpolicy.propermitsvcnumprodid").getValue();Ext.getCmp("Js.Center.Business.Product.ppmainbackupAdd.numprodid").setValue(numprodid)},needButtons:false,buttons:[new Ext.Button({text:'确定',minWidth:70,handler:function(){if(Js.Center.Business.Product.ppmainbackupAdd.window.mainForm.isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.Business.Product.ppmainbackupAdd.window.mainForm.submit({url:Js.Center.Business.Product.ppmainbackupAdd.window.updateURL,method:"POST",success:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);var falg=objJson.success;if(falg==true){Ext.Msg.alert("温馨提示","操作成功了!");Js.Center.Business.Product.ppmainbackupAdd.window.hide();Js.Center.Business.Product.ppmainbackupAdd.window.displayStore.reload()}else Ext.Msg.alert('温馨提示',objJson.info)},failure:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);Ext.Msg.alert('温馨提示',objJson.info)}})}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){Js.Center.Business.Product.ppmainbackupAdd.window.mainForm.reset()}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){Js.Center.Business.Product.ppmainbackupAdd.window.hide()}})]})}};Ext.namespace('Js.Center.Business.Product.ppmainbackupDelete');Js.Center.Business.Product.ppmainbackupDelete.func=function(row){var deleteSplit="";for(var i=0;i<row.length;i++){if(row.length==1){deleteSplit=row[i].data.numstraid}else{if(i<(row.length-1)){deleteSplit=row[i].data.numstraid+","+deleteSplit}if(i==(row.length-1)){deleteSplit=deleteSplit+row[i].data.numstraid}}};var params={ids:deleteSplit,numprodid:row[0].data.numprodid,numtypeid:2,flag:"deleterotestaras"};doAjax(Js.Center.Business.RoutestraURL,params,Js.Center.Business.productpolicy.MainBackupInfostore)};Ext.namespace('Js.Center.Business.Product.ppmainbackupUpdate');Js.Center.Business.Product.ppmainbackupUpdate.func=function(row){if(Js.Center.Business.Product.ppmainbackupUpdate.window==null){var updateGatewaymfp=new Ext.form.FormPanel({frame:true,labelWidth:80,items:[{layout:'column',items:[{xtype:"hidden",name:"flag",value:'updaterotestaras'},{xtype:"hidden",name:"numstraid"},{xtype:"hidden",name:"numtypeid",value:"2"},{xtype:"hidden",id:"Js.Center.Business.Product.ppmainbackupUpdate.numprodid",name:"numprodid"},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"combo",name:"numsvcid",fieldLabel:"<font color=red>主通道</font>",hiddenName:"numsvcid",id:"Js.Center.Business.Product.ppmainbackupUpdate.numsvcid",allowBlank:false,blankText:"主通道区不允许为空",readOnly:true,mode:"local",displayField:"vc2svcname",valueField:"numsvcid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.ServiceCodeStore,listeners:{"select":function(){if(Ext.fly("Js.Center.Business.Product.ppmainbackupUpdate.numsvcid").getValue()==Ext.fly("Js.Center.Business.Product.ppmainbackupUpdate.numassvcid").getValue()){Ext.getCmp("Js.Center.Business.Product.ppmainbackupUpdate.numsvcid").reset()}}}}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"combo",name:"numassvcid",fieldLabel:"<font color=red>备用通道</font>",id:"Js.Center.Business.Product.ppmainbackupUpdate.numassvcid",hiddenName:"numassvcid",allowBlank:false,blankText:"备用通道不允许为空",readOnly:true,mode:"local",displayField:"vc2svcname",valueField:"numsvcid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.ServiceCodeStore,listeners:{"select":function(){if(Ext.fly("Js.Center.Business.Product.ppmainbackupUpdate.numsvcid").getValue()==Ext.fly("Js.Center.Business.Product.ppmainbackupUpdate.numassvcid").getValue()){Ext.getCmp("Js.Center.Business.Product.ppmainbackupUpdate.numassvcid").reset()}}}}]}]}]});var mainForm=updateGatewaymfp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"修改主备策略",mainForm:mainForm,updateURL:Js.Center.Business.RoutestraURL,displayStore:Js.Center.Business.productpolicy.MainBackupInfostore,updateState:true,updateRecord:row,items:[updateGatewaymfp],needLoadDataStore:true,loadDataStoreFunc:function(){Js.Center.Common.ServiceCodeStore.reload();if(Js.Center.Business.Product.ppmainbackupUpdate.window.mainForm)Js.Center.Business.Product.ppmainbackupUpdate.window.mainForm.reset();Js.Center.Business.Product.ppmainbackupUpdate.window.center();if(Js.Center.Business.Product.ppmainbackupUpdate.window.updateState&&Js.Center.Business.Product.ppmainbackupUpdate.window.updateRecord!=null){Js.Center.Business.Product.ppmainbackupUpdate.window.mainForm.loadRecord(Js.Center.Business.Product.ppmainbackupUpdate.window.updateRecord)}},needButtons:false,buttons:[new Ext.Button({text:'确定',minWidth:70,handler:function(){if(Js.Center.Business.Product.ppmainbackupUpdate.window.mainForm.isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.Business.Product.ppmainbackupUpdate.window.mainFormSubmitFunc()}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){Js.Center.Business.Product.ppmainbackupUpdate.window.mainForm.reset();if(Js.Center.Business.Product.ppmainbackupUpdate.window.updateRecord.get('vc2type')==1||Js.Center.Business.Product.ppmainbackup.window.updateRecord.get('vc2type')==4){Ext.getCmp("Js.Center.Business.Product.ppmainbackup.Package").setValue(1);Ext.getCmp("Js.Center.Business.Product.ppmainbackup.Package").disable()}else{Ext.getCmp("Js.Center.Business.Product.ppmainbackup.Package").enable()}if(Js.Center.Business.Product.ppmainbackupUpdate.window.updateState&&Js.Center.Business.Product.ppmainbackupUpdate.window.updateRecord!=null)Js.Center.Business.Product.ppmainbackupUpdate.window.mainForm.loadRecord(Js.Center.Business.Product.ppmainbackupUpdate.window.updateRecord)}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){if(Js.Center.Business.Product.ppmainbackupUpdate.window.closeAction=='close'){Js.Center.Business.Product.ppmainbackupUpdate.window.close()}else{Js.Center.Business.Product.ppmainbackupUpdate.window.hide()}}})]})}};Ext.namespace('Js.Center.Business.ProductAdd');Ext.QuickTips.init();Js.Center.Business.ProductAdd.func=function(){var AddproductInfofp=new Ext.form.FormPanel({frame:true,labelWidth:80,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"hidden",name:"flag",value:"insert"},{xtype:"textfield",name:"vc2name",fieldLabel:"<font color=red>通道组名称</font>",allowBlank:false,blankText:"通道组名称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:10},{xtype:"combo",name:"vc2servicetype",fieldLabel:"<font color=red>短彩类型</font>",hiddenName:"vc2servicetype",readOnly:true,allowBlank:false,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:"1",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["短信","1"],["彩信","2"],["wap","3"]]})},{height:100,xtype:"textarea",name:"vc2dsc",fieldLabel:"通道组描述",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:100}]});var mainForm=AddproductInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加通道组",mainForm:mainForm,updateURL:Js.Center.Business.ProductUpdateURL,displayStore:Js.Center.Business.Product.Infostore,items:[AddproductInfofp]});};Ext.namespace('Js.Center.Business.ProductDelete');Js.Center.Business.ProductDelete.func=function(row){var deleteSplit="";for(var i=0;i<row.length;i++){if(row.length==1){deleteSplit=row[i].data.numprodid}else{if(i<(row.length-1)){deleteSplit=row[i].data.numprodid+","+deleteSplit}if(i==(row.length-1)){deleteSplit=deleteSplit+row[i].data.numprodid}}};var params={ids:deleteSplit,flag:"delete"};doAjax(Js.Center.Business.ProductUpdateURL,params,Js.Center.Business.Product.Infostore)};Ext.namespace('Js.Center.Business.Product');Js.Center.Business.Product.productinfo=function(node){if(Ext.get("Js.Center.Business.Product.ProductPanel")==null){permission=function(){var row=productGrid.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("提示信息","您没有选中任何行!")}else if(row.length>1){Ext.Msg.alert("提示信息","对不起只能选择一个!")}else if(row.length==1){Js.Center.Business.productpolicy.window.updateRecord=row[0];Js.Center.Business.productpolicy.window.mainForm.loadRecord(row[0]);Js.Center.Business.productpolicy.window.show()}};doPermission=function(){var row=productGrid.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("提示信息","您没有选中任何行!")}else if(row.length>1){Ext.Msg.alert("提示信息","对不起只能选择一个!")}else if(row.length==1){Js.Center.Business.ProductPermitsvc.func(row[0])}};var _pageSize=12;var fields=["numprodid","numsvcid","numbusiid","numcaid","vc2prodid","vc2name","vc2dsc","vc2validflag","datstart","datend","numlevel","vc2type","numtprodid","numsrc","numsrcid","numstatflag","numchnid","numcomflg","numbwflg","vc2servcode","numpriflag","vc2showname","numcpid","vc2sendtype","numprange","numuserid","vc2username","datcreattime","vc2servicetype"];Js.Center.Business.Product.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.ProductURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numprodid",totalProperty:"totalCount"}),sortInfo:{field:'datcreattime',direction:'DESC'},baseParams:{productname:'',adduserid:'',vc2servicetype:'-1',flag:'selectbykey'}});Js.Center.Business.Product.Infostore.load({params:{start:0,limit:_pageSize,productname:'',adduserid:'',vc2servicetype:'-1',flag:'selectbykey'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numprodid"});var cm=new Ext.grid.ColumnModel([sm,{header:"通道组序号",tooltip:"通道组序号",dataIndex:"numprodid",sortable:true},{header:"通道组名称",tooltip:"通道组名称",dataIndex:"vc2name",sortable:true},{header:"短彩类型",tooltip:"短彩类型",dataIndex:"vc2servicetype",sortable:true,renderer:function(value){if(value=="1"){return"短信"}else if(value=="2"){return"彩信"}else if(value=="3"){return"wap"}else if(value=="4"){return"短信PV"}else if(value=="5"){return"彩信PV"}else if(value=="6"){return"wapPV"}}},{header:"创建日期",tooltip:"创建日期",dataIndex:"datcreattime",sortable:true},{header:"创建人",tooltip:"创建人",dataIndex:"vc2username",sortable:true},{header:"通道组描述",tooltip:"通道组描述",dataIndex:"vc2dsc"}]);var arrInitLoadFunc=new Array();arrInitLoadFunc[0]="Js.Center.Business.ProductPermitsvc.func";arrInitLoadFunc[1]="Js.Center.Business.productpolicy.func";arrInitLoadFunc[2]="Js.Center.Business.Product.ppmainbackupAdd.func";arrInitLoadFunc[3]="Js.Center.Business.Product.ppmainbackupUpdate.func";arrInitLoadFunc[4]="Js.Center.Business.Product.ppbalanceAdd.func";var productGrid=new WXTL.Widgets.CommonGrid.GridPanel({anchor:'100% 100%',pageSize:_pageSize,needMenu:false,store:Js.Center.Business.Product.Infostore,afterEditURL:Js.Center.Business.ProductUpdateURL,inertMethod:'Js.Center.Business.ProductAdd',updateMethod:'Js.Center.Business.ProductUpdate',deleteMethod:'Js.Center.Business.ProductDelete.func',otherInitLoadFunc:arrInitLoadFunc,sm:sm,cm:cm,tbar:new Ext.Toolbar({items:[{iconCls:'addicon',text:"添加",handler:function(){productGrid.doInsert();}},"","-","",{text:"修改",iconCls:"editicon",handler:function(){productGrid.doEdit()}},"","-","",{text:"删除",iconCls:"deleteicon",handler:function(){productGrid.doDelete()}},"","-","",{text:"配置路由",iconCls:"addicon",handler:permission}]})});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"productSelectPanel",height:110,queryMethod:"Js.Center.Business.Product.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",fieldLabel:'通道组名称',name:'vc2name',id:'prodinfovc2name',regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:10}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"hidden",name:"numuserid",fieldLabel:"操作人",hiddenName:"prodinfouserid",readOnly:true,mode:"local",displayField:"vc2username",valueField:"numuserid",triggerAction:"all",emptyText:'-=请选择=-',store:Js.Center.Common.UserStore},{xtype:"combo",name:"vc2servicetype",fieldLabel:"短彩类型",hiddenName:"stype",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",emptyText:"-=请选择短彩类型=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择短彩类型=-","-1"],["短信","1"],["彩信","2"],["wap","3"]]})}]}]}]});Js.Center.Business.Product.queryGrid=function(){if(selectPanel.getForm().isValid()){var _productname=Ext.get("prodinfovc2name").getValue();var stype=Ext.get("stype").getValue();var flag='selectbykey';Js.Center.Business.Product.Infostore.baseParams={productname:_productname,adduserid:'',vc2servicetype:stype,flag:flag};Js.Center.Business.Product.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.Business.Product.ProductPanel=new Ext.Panel({frame:true,id:"Js.Center.Business.Product.ProductPanel",bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,productGrid]})};GridMain(node,Js.Center.Business.Product.ProductPanel,"openroomiconinfo","Js.Center.Business.Product.Infostore")};Ext.namespace('Js.Center.Business.ProductPermitsvc');Js.Center.Business.ProductPermitsvc.func=function(row){if(Js.Center.Business.ProductPermitsvc.window==null){var producyPermitsvcStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.ServiceCodeURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:['numsvcid','vc2svcname'],root:'data',id:'numsvcid'}),baseParams:{flag:'selectpermitbypid',columnlist:'numsvcid,vc2svcname'}});var producynoPermitsvcStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.ServiceCodeURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:['numsvcid','vc2svcname'],root:'data',id:'numsvcid'}),baseParams:{flag:'selectnopermitbypid',columnlist:'numsvcid,vc2svcname'}});var permissionTablePanl=new Ext.form.FormPanel({frame:true,autoScroll:true,padding:'10 10 10 10',items:[{xtype:"hidden",name:"numprodid",id:"propermitsvcnumprodid",fieldLabel:"编号"},{xtype:"textfield",name:"vc2name",readOnly:true,fieldLabel:"通道组名称"}]});var mainForm=permissionTablePanl.getForm();var permissionPanel=new Ext.Panel({autoScroll:true,frame:true,padding:'10 10 10 10',items:[{frame:true,html:'<div id="prosvcitemselector" class="demo-ct"></div>'}]});this.window=new WXTL.Widgets.CommonWindows.Window({title:"配置路由",mainForm:mainForm,width:700,height:430,displayStore:Js.Center.Business.Product.Infostore,updateState:true,updateRecord:row,needButtons:false,needLoadDataStore:true,items:[permissionTablePanl,permissionPanel],buttons:[{text:'保存',handler:function(){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,waitConfig:{interval:200},icon:'download',animEl:'saving'});UpdateProcSvcPermission(WXTL.Common.urlDecode(PermissionTree.getForm().getValues(true)).replace('itemselector=',''),Ext.get("propermitsvcnumprodid").getValue())}},{text:"取 消",minWidth:70,handler:function(){Js.Center.Business.ProductPermitsvc.window.hide()}}],listeners:{"show":function(){PermissionTree.doLayout()},"beforeshow":function(){producyPermitsvcStore.reload({params:{productid:Js.Center.Business.ProductPermitsvc.window.updateRecord.get("numprodid"),vc2servicetype:Js.Center.Business.ProductPermitsvc.window.updateRecord.get("vc2servicetype"),columnlist:'numsvcid,vc2svcname'}});producynoPermitsvcStore.reload({params:{productid:Js.Center.Business.ProductPermitsvc.window.updateRecord.get("numprodid"),vc2servicetype:Js.Center.Business.ProductPermitsvc.window.updateRecord.get("vc2servicetype"),columnlist:'numsvcid,vc2svcname'}})}},loadDataStoreFunc:function(){}});CreateTree()}function CreateTree(){document.getElementById('prosvcitemselector').innerHTML='';PermissionTree=new Ext.form.FormPanel({renderTo:'prosvcitemselector',frame:true,bodyStyle:'padding:10px,0px,0px,10px',autoScroll:true,items:[{anchor:',100%',xtype:"itemselector",name:"itemselector",fieldLabel:"通道",dataFields:["numsvcid","vc2svcname"],toData:[""],msWidth:250,autoScroll:true,msHeight:300,valueField:"numsvcid",displayField:"vc2svcname",toLegend:"已选栏",fromLegend:"可选栏",fromStore:producynoPermitsvcStore,toStore:producyPermitsvcStore}]})};function UpdateProcSvcPermission(idlist,numproid){var params={flag:'addsvc',ids:idlist,numproid:numproid};Js.Center.Business.ProductPermitsvc.window.mainFormSubmitFunc('',params,Js.Center.Business.ProductUpdateURL);}};Ext.namespace('Js.Center.Business.productpolicy');Js.Center.Business.productpolicy.func=function(row){if(Js.Center.Business.productpolicy.window==null){var producyPermitsvcStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.ServiceCodeURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:['numsvcid','vc2svcname'],root:'data',id:'numsvcid'}),baseParams:{flag:'selectpermitbypid',servicetype:'',columnlist:'numsvcid,vc2svcname'}});var producynoPermitsvcStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.ServiceCodeURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:['numsvcid','vc2svcname'],root:'data',id:'numsvcid'}),baseParams:{flag:'selectnopermitbypid',servicetype:'',columnlist:'numsvcid,vc2svcname'}});Js.Center.Business.productpolicy.Productspolicy=new Ext.Panel({frame:true,bodyStyle:'padding:10px,0px,0px,10px',autoScroll:true,labelWidth:60,items:[{anchor:',100%',xtype:"itemselector",id:"Js.Center.Business.productpolicy.Productspolicyasproductids",name:"itemselector",fieldLabel:"配置路由",dataFields:["numsvcid","vc2svcname"],toData:[""],msWidth:310,autoScroll:true,enableDD:false,msHeight:270,valueField:'numsvcid',displayField:'vc2svcname',toLegend:"已使用的通道",fromLegend:"待选择的通道",fromStore:producynoPermitsvcStore,toStore:producyPermitsvcStore,fromTo:function(){var selectionsArray=this.fromMultiselect.view.getSelectedIndexes();var records=[];var isValid;if(selectionsArray.length>0){var toItemIds="";var selectItems=this.toStore.data.items;if(selectItems.length>0){for(var i=0;i<selectItems.length;i++){if(i==selectItems.length-1){toItemIds+=selectItems[i].json.numsvcid}else{toItemIds+=selectItems[i].json.numsvcid+","}}}for(var i=0;i<selectionsArray.length;i++){record=this.fromMultiselect.view.store.getAt(selectionsArray[i]);if(toItemIds!=""){returnInfo=ajaxSyncCall(Js.Center.Business.ProductURL,"flag=checkselectnumsvcid&numsvcid="+record.get("numsvcid")+"&selectsvcid="+toItemIds);if(true==returnInfo.success){records.push(record);if(""==toItemIds){toItemIds=record.get("numsvcid")}else{toItemIds=record.get("numsvcid")+","+toItemIds}}else{Ext.Msg.alert("提示信息","'"+record.get("vc2svcname")+"' 与 '"+returnInfo.info+"' 网关运营商及地区相同请确认");return""}}else{records.push(record);if(""==toItemIds){toItemIds=record.get("numsvcid")}else{toItemIds=record.get("numsvcid")+","+toItemIds}}}if(!this.allowDup)selectionsArray=[];for(var i=0;i<records.length;i++){record=records[i];record.commit();if(this.allowDup){var x=new Ext.data.Record();record.id=x.id;delete x;this.toMultiselect.view.store.add(record)}else{this.fromMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);selectionsArray.push((this.toMultiselect.view.store.getCount()-1))}}}this.toMultiselect.view.refresh();this.fromMultiselect.view.refresh();if(this.toSortField)this.toMultiselect.store.sort(this.toSortField,this.toSortDir);if(this.allowDup)this.fromMultiselect.view.select(selectionsArray);else this.toMultiselect.view.select(selectionsArray)},onRowDblClick:function(vw,index,node,e){if(vw.ownerCt.title==this.fromLegend){var record=vw.store.getAt(index);var toItemIds="";var selectItems=this.toStore.data.items;if(selectItems.length>0){for(var i=0;i<selectItems.length;i++){if(i==selectItems.length-1){toItemIds+=selectItems[i].json.numsvcid}else{toItemIds+=selectItems[i].json.numsvcid+","}}}if(selectItems.length>0){returnInfo=ajaxSyncCall(Js.Center.Business.ProductURL,"flag=checkselectnumsvcid&numsvcid="+record.get("numsvcid")+"&selectsvcid="+toItemIds);if(true==returnInfo.success){record.commit();return this.fireEvent('rowdblclick',vw,index,node,e)}else{Ext.Msg.alert("提示信息","'"+record.get("vc2svcname")+"' 与 '"+returnInfo.info+"' 网关运营商及地区相同请确认");return false}}else{record.commit();return this.fireEvent('rowdblclick',vw,index,node,e)}}else{var record=vw.store.getAt(index);record.commit();return this.fireEvent('rowdblclick',vw,index,node,e)}}}]});var _MainBackuppageSize=8;var MainBackupfields=["numstraid","numprodid","vc2name","numsvcid","vc2svcname","numassvcid","vc2assvcname"];Js.Center.Business.productpolicy.MainBackupInfostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.RoutestraURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:MainBackupfields,root:"data",id:"numstraid",totalProperty:"totalCount"}),sortInfo:{field:'numstraid',direction:'DESC'},baseParams:{flag:'selectbyrotestraas'}});var MainBackupsm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numstraid"});var MainBackupcm=new Ext.grid.ColumnModel([MainBackupsm,{header:"主备策略编号",tooltip:"主备策略编号",dataIndex:"numstraid",sortable:true},{header:"通道组id",tooltip:"通道组id",hidden:true,dataIndex:"numprodid",sortable:true},{header:"通道组",tooltip:"通道组",dataIndex:"vc2name",sortable:true},{header:"主通道id",tooltip:"主通道id",dataIndex:"numsvcid",hidden:true,sortable:true},{header:"主通道",tooltip:"主通道",dataIndex:"vc2svcname",sortable:true},{header:"备通道",tooltip:"备通道",dataIndex:"vc2assvcname",sortable:true},{header:"备通道id",tooltip:"备通道id",hidden:true,dataIndex:"numassvcid",sortable:true}]);var MainBackupGrid=new WXTL.Widgets.CommonGrid.GridPanel({title:'主备策略列表',frame:true,anchor:'97% 100%',needPage:false,store:Js.Center.Business.productpolicy.MainBackupInfostore,afterEditURL:Js.Center.Business.RoutestraURL,inertMethod:'Js.Center.Business.Product.ppmainbackupAdd',updateMethod:'Js.Center.Business.Product.ppmainbackupUpdate',deleteMethod:'Js.Center.Business.Product.ppmainbackupDelete.func',sm:MainBackupsm,cm:MainBackupcm});Js.Center.Business.productpolicy.MainBackupqueryPanel=new Ext.Panel({frame:true,bodyBorder:false,border:false,height:300,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[MainBackupGrid]});var _BalancedpageSize=12;var Balancedfields=["numstraid","numprodid","vc2name","numsvcids","vc2svcnames"];Js.Center.Business.productpolicy.BalancedInfostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.RoutestraURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:Balancedfields,root:"data",id:"numstraid",totalProperty:"totalCount"}),sortInfo:{field:'numstraid',direction:'DESC'},baseParams:{flag:'selectbyrotestrabalance'}});var Balancedsm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numstraid"});var Balancedcm=new Ext.grid.ColumnModel([Balancedsm,{header:"均衡策略编号",tooltip:"均衡策略编号",dataIndex:"numstraid",sortable:true},{header:"通道组id",tooltip:"通道组id",dataIndex:"numprodid",sortable:true,hidden:true},{header:"通道组",tooltip:"通道组",dataIndex:"vc2name",sortable:true},{header:"通道集合id",tooltip:"通道集合id",dataIndex:"numsvcids",hidden:true,sortable:true},{header:"通道集合",tooltip:"通道集合",dataIndex:"vc2svcnames",renderer:function(value){return"<font qtip='"+value+"'>"+value+"</font>"},sortable:true}]);var BalancedGrid=new WXTL.Widgets.CommonGrid.GridPanel({title:'均衡策略列表',frame:true,anchor:'97% 100%',needPage:false,store:Js.Center.Business.productpolicy.BalancedInfostore,afterEditURL:Js.Center.Business.RoutestraURL,inertMethod:'Js.Center.Business.Product.ppbalanceAdd',updateMethod:'Js.Center.Business.Product.ppbalanceUpdate',deleteMethod:'Js.Center.Business.Product.ppbalanceDelete.func',sm:Balancedsm,cm:Balancedcm});Js.Center.Business.productpolicy.BalancedqueryPanel=new Ext.Panel({frame:true,height:300,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[BalancedGrid]});var permissionTablePanl=new Ext.form.FormPanel({frame:true,autoScroll:true,padding:'10 10 10 10',items:[{xtype:"hidden",name:"numprodid",id:"Js.Center.Business.productpolicy.propermitsvcnumprodid",fieldLabel:"通道组id"},{xtype:"hidden",name:"oldnumtypeid",id:"Js.Center.Business.productpolicy.numtypeid",fieldLabel:"策略类别编号"},{columnWidth:1,items:[{layout:'column',bodyStyle:"padding:0px 0 0px 10px",items:[{columnWidth:.5,layout:'form',defaults:{anchor:"92%",msgTarget:"side"},buttonAlign:"center",items:[{xtype:"textfield",name:"vc2name",readOnly:true,fieldLabel:"通道组名称"}]},{columnWidth:.5,layout:'form',buttonAlign:"left",items:[{xtype:"radiogroup",id:"Js.Center.Receipt.ReceiptManage.ReceiptManageAdd.ALLBatchcheck",fieldLabel:"<font color=red>策略类型</font>",allowBlank:true,horizontal:true,defaultValue:'true',value:'1',items:[{boxLabel:'基本策略',name:"numtypeid",inputValue:'1',checked:true,listeners:{"check":function(checkbox,checked){if(checked){Js.Center.Business.productpolicy.Productspolicy.show();Js.Center.Business.productpolicy.MainBackupqueryPanel.hide();Js.Center.Business.productpolicy.BalancedqueryPanel.hide();Js.Center.Business.productpolicy.window.buttons[0].show()}}}}]}]}]}]},Js.Center.Business.productpolicy.Productspolicy,Js.Center.Business.productpolicy.MainBackupqueryPanel,Js.Center.Business.productpolicy.BalancedqueryPanel]});var mainForm=permissionTablePanl.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"配置路由",mainForm:mainForm,width:700,height:400,displayStore:Js.Center.Business.Product.Infostore,updateState:true,updateRecord:row,needButtons:false,needLoadDataStore:true,items:[permissionTablePanl],buttons:[{text:'保存',handler:function(){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,waitConfig:{interval:200},icon:'download',animEl:'saving'});var ids="";var tostorelength=Js.Center.Business.productpolicy.Productspolicy.items.items[0].toStore.data.length;var tostroedata=Js.Center.Business.productpolicy.Productspolicy.items.items[0].toStore.data;for(var i=0;i<tostorelength;i++){if(tostorelength==1){ids=tostroedata.items[i].id}else{if(i<(tostorelength-1)){ids=tostroedata.items[i].id+","+ids}if(i==(tostorelength-1)){ids=ids+tostroedata.items[i].id}}};UpdateProcSvcPermission(ids,Js.Center.Business.productpolicy.window.updateRecord.get("numprodid"));}},{text:"取 消",minWidth:70,handler:function(){Js.Center.Business.productpolicy.window.hide()}}],listeners:{"show":function(){Js.Center.Business.productpolicy.window.buttons[0].show();Ext.get("Js.Center.Business.productpolicy.propermitsvcnumprodid").getValue(Js.Center.Business.productpolicy.window.updateRecord.get("numprodid"));producynoPermitsvcStore.baseParams={flag:'selectnopermitbypid',servicetype:Js.Center.Business.productpolicy.window.updateRecord.get("vc2servicetype"),productid:Js.Center.Business.productpolicy.window.updateRecord.get("numprodid")};producynoPermitsvcStore.reload({params:{flag:'selectnopermitbypid',columnlist:'numsvcid,vc2svcname'},callback:function(){if(this.getById('0')!=null){this.remove(this.getById('0'))}}});producyPermitsvcStore.baseParams={flag:'selectpermitbypid',servicetype:Js.Center.Business.productpolicy.window.updateRecord.get("vc2servicetype"),productid:Js.Center.Business.productpolicy.window.updateRecord.get("numprodid")};producyPermitsvcStore.reload({params:{flag:'selectpermitbypid',columnlist:'numsvcid,vc2svcname'},callback:function(){if(this.getById('0')!=null){this.remove(this.getById('0'))}}});Js.Center.Business.productpolicy.BalancedInfostore.baseParams={numprodid:Js.Center.Business.productpolicy.window.updateRecord.get("numprodid"),flag:'selectbyrotestrabalance'};Js.Center.Business.productpolicy.BalancedInfostore.load({params:{start:0,limit:_BalancedpageSize}});Js.Center.Business.productpolicy.MainBackupInfostore.baseParams={numprodid:Js.Center.Business.productpolicy.window.updateRecord.get("numprodid"),flag:'selectbyrotestraas'};Js.Center.Business.productpolicy.MainBackupInfostore.load({params:{start:0,limit:_MainBackuppageSize}});Js.Center.Business.productpolicy.Productspolicy.show();Js.Center.Business.productpolicy.MainBackupqueryPanel.hide();Js.Center.Business.productpolicy.BalancedqueryPanel.hide();Js.Center.Common.ServiceCodeStore.reload()},"beforeshow":function(){}},loadDataStoreFunc:function(){}})}function UpdateProcSvcPermission(idlist,numprodid){var params={flag:'addrotestarbase',ids:idlist,numprodid:numprodid,numtypeid:1};Js.Center.Business.productpolicy.window.mainFormSubmitFunc('',params,Js.Center.Business.RoutestraURL)}};Ext.namespace('Js.Center.Business.ProductUpdate');Js.Center.Business.ProductUpdate.func=function(row){var Updateproductmfp=new Ext.form.FormPanel({frame:true,labelWidth:80,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"hidden",name:"flag",value:"updateall"},{xtype:"hidden",name:"numprodid",fieldLabel:"通道组编号"},{xtype:"textfield",name:"vc2name",fieldLabel:"<font color=red>通道组名称</font>",allowBlank:false,blankText:"通道组名称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:10},{xtype:"combo",name:"vc2servicecode",fieldLabel:"<font color=red>短彩类型</font>",hiddenName:"vc2servicetype",readOnly:true,allowBlank:false,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",selectOnFocus:true,value:"1",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["短信","1"],["彩信","2"],["wap","3"]]})},{height:100,xtype:"textarea",name:"vc2dsc",fieldLabel:"通道组描述",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:100}]});var mainForm=Updateproductmfp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"修改通道组",mainForm:mainForm,updateURL:Js.Center.Business.ProductUpdateURL,displayStore:Js.Center.Business.Product.Infostore,updateState:true,updateRecord:row,items:[Updateproductmfp]});};Ext.namespace('Js.Center.Business');Js.Center.Business.RoutestraURL='URL/system/routestra.ashx';Js.Center.Business.ProductURL='URL/system/product/products.ashx';Js.Center.Business.ProductUpdateURL='URL/system/product/products.ashx';