Ext.namespace('Js.Center.System.ElementAdd');Js.Center.System.ElementAdd.func=function(){var addElementInfofp=new Ext.form.FormPanel({frame:true,labelWidth:80,defaults:{anchor:"100%",msgTarget:"side"},items:[new Ext.form.FieldSet({title:'网元配置基本信息',collapsible:false,autoHeight:true,style:Ext.isIE?'padding:5px 0 0 10px;':'padding:0 0 0 10px;',layout:'column',items:[{columnWidth:.5,layout:'form',defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"hidden",name:"flag",value:"addelement"},{xtype:"numberfield",name:"numnodeid",fieldLabel:"<font color=red>网元ID</font>",allowBlank:false,blankText:"网元ID不允许为空",minValue:1,maxValue:99,minText:"网元ID不能小于1",maxText:"网元ID不能大于99"},{xtype:"textfield",name:"numdistriport",fieldLabel:"<font color=red>分布式端口</font>",allowBlank:false,blankText:"分布式端口不许为空",regex:WXTL.Common.regex.Integer,regexText:"只能输入数字",maxLength:10,maxLengthText:"不能超过10位"},{xtype:"textfield",name:"numtomcatport",fieldLabel:"<font color=red>Tomcat端口</font>",allowBlank:false,blankText:"Tomcat端口不许为空",regex:WXTL.Common.regex.Integer,regexText:"只能输入数字",maxLength:10,maxLengthText:"不能超过10位"},{xtype:"combo",name:"numnodetype",hiddenName:"numnodetype",fieldLabel:"<font color=red>网元类型</font>",allowBlank:false,blankText:"网元为必选",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:"1",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["网关网元","1"],["接口网元","2"],["主控网元","3"]]})},{xtype:"combo",name:"numindustry",hiddenName:"numindustry",fieldLabel:"<font color=red>网元所属业务</font>",allowBlank:false,blankText:"网元所属业务为必选",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:"1",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["行业","1"],["渠道","2"]]})},{xtype:"textfield",name:"strnodename",fieldLabel:"<font color=red>网元项目名称</font>",allowBlank:false,blankText:"网元项目名称不能为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50}]},{columnWidth:.5,layout:'form',defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2nodename",fieldLabel:"<font color=red>网元名称</font>",allowBlank:false,blankText:"网元名称不许为空",maxLength:50,maxLengthText:"网元名称不能超过50"},{xtype:"textfield",name:"numsocketport",fieldLabel:"Socket端口",allowBlank:true,regex:WXTL.Common.regex.Integer,regexText:"只能输入数字",maxLength:10,maxLengthText:"不能超过10"},{xtype:"textfield",name:"vc2nodeip",fieldLabel:"<font color=red>主机IP</font>",allowBlank:false,blankText:"主机IP不许为空",regex:WXTL.Common.regex.IP,regexText:"只能输入IP"},{xtype:"combo",name:"numismain",hiddenName:"numismain",fieldLabel:"<font color=red>是否为主控</font>",allowBlank:false,blankText:"是否主控为必选",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:"0",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["是","1"],["否","0"]]})},{xtype:"combo",name:"numstatus",hiddenName:"numstatus",fieldLabel:"<font color=red>是否启用</font>",allowBlank:false,blankText:"是否启用为必选",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:"0",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["是","1"],["否","0"]]})}]}]}),new Ext.form.FieldSet({title:'网关配置基本信息',collapsible:false,autoHeight:true,style:Ext.isIE?'padding:5px 0 0 10px;':'padding:0 0 0 10px;',layout:'column',items:[{columnWidth:.5,layout:'form',defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0 0 10px 15px",items:[{xtype:"numberfield",name:"numstart",fieldLabel:"<font color=red>起始编号</font>",allowBlank:false,blankText:"起始编号不允许为空",minValue:1,maxValue:99,minText:"起始编号不能小于1",maxText:"起始编号不能大于99"},{xtype:"numberfield",name:"cbip10sms",fieldLabel:"CBIP10短信",allowBlank:true,minValue:1,maxValue:100,minText:"数量不能小于1",maxText:"数量不能大于100"},{xtype:"numberfield",name:"cbip20sms",fieldLabel:"CBIP20短信",allowBlank:true,minValue:1,maxValue:100,minText:"数量不能小于1",maxText:"数量不能大于100"},{xtype:"numberfield",name:"cmpp20",fieldLabel:"CMPP20",allowBlank:true,minValue:1,maxValue:100,minText:"数量不能小于1",maxText:"数量不能大于100"},{xtype:"numberfield",name:"sgip",fieldLabel:"SGIP",allowBlank:true,minValue:1,maxValue:100,minText:"数量不能小于1",maxText:"数量不能大于100"},{xtype:"numberfield",name:"csa",fieldLabel:"CSA",allowBlank:true,minValue:1,maxValue:100,minText:"数量不能小于1",maxText:"数量不能大于100"},{xtype:"numberfield",name:"smgpmms",fieldLabel:"电信彩信网关",allowBlank:true,minValue:1,maxValue:100,minText:"数量不能小于1",maxText:"数量不能大于100"}]},{columnWidth:.5,layout:'form',defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0 0 10px 15px",items:[{xtype:"panel",html:"（网关填入数量，根据起始编号自动增长）",height:22},{xtype:"numberfield",name:"cbip10mms",fieldLabel:"CBIP10彩信",allowBlank:true,minValue:1,maxValue:100,minText:"数量不能小于1",maxText:"数量不能大于100"},{xtype:"numberfield",name:"cbip20mms",fieldLabel:"CBIP20彩信",allowBlank:true,minValue:1,maxValue:100,minText:"数量不能小于1",maxText:"数量不能大于100"},{xtype:"numberfield",name:"cmpp30",fieldLabel:"CMPP30",allowBlank:true,minValue:1,maxValue:100,minText:"数量不能小于1",maxText:"数量不能大于100"},{xtype:"numberfield",name:"smgp",fieldLabel:"SMGP",allowBlank:true,minValue:1,maxValue:100,minText:"数量不能小于1",maxText:"数量不能大于100"},{xtype:"numberfield",name:"mm7",fieldLabel:"MM7彩信",allowBlank:true,minValue:1,maxValue:100,minText:"数量不能小于1",maxText:"数量不能大于100"}]}]})]});var mainForm=addElementInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加网元分布式配置",mainForm:mainForm,updateURL:Js.Center.System.ElementURL,displayStore:Js.Center.System.Element.Infostore,items:[addElementInfofp],needButtons:false,buttons:[new Ext.Button({text:'确定',minWidth:70,handler:function(){if(addElementInfofp.getForm().isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.System.ElementAdd.window.mainFormSubmitFunc()}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){addElementInfofp.getForm().reset()}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){Js.Center.System.ElementAdd.window.hide()}})]})};Ext.namespace('Js.Center.System.Element');Js.Center.System.Element.elementInfo=function(node){if(Ext.get("Js.Center.System.Element.mainpanel")==null){var _pageSize=12;var fields=["numnodeid","vc2nodename","numsocketport","numtomcatport","numdistriport","vc2nodeip","numismain","numstatus","numnodetype","numindustry","vc2projname"];var flag='selectelement';Js.Center.System.Element.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.System.ElementURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numnodeid",totalProperty:"totalCount"}),sortInfo:{field:'numnodeid',direction:'DESC'},baseParams:{numnodeid:'',numindustry:'',flag:flag}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numusergroupid"});var cm=new Ext.grid.ColumnModel([sm,{header:"网元编号",tooltip:"网元编号",dataIndex:"numnodeid",sortable:true},{header:"网元名称",tooltip:"网元名称",dataIndex:"vc2nodename",sortable:true},{header:"是否启用",tooltip:"是否启用",dataIndex:"numstatus",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){return value=="0"?"否":"是"}},{header:"网元注册",tooltip:"网元注册",dataIndex:"numnodeid",renderer:function(value,meta,record,rowIndex,colIndex,store){var ahref="<a href='#' onclick='Js.Center.System.Element.loadConfig(\""+value+"\")'>加载配置</a>&nbsp;";ahref+="<a href='#' onclick='Js.Center.System.Element.viewConfig(\""+value+"\")'>查看配置</a>&nbsp;";ahref+="<a href='#' onclick='Js.Center.System.Element.effectConfig(\""+value+"\")'>生效配置</a>&nbsp;";ahref+="<a href='#' onclick='Js.Center.System.Element.resumeConfig(\""+value+"\")'>恢复配置</a>&nbsp;";return ahref}}]);var usergroup_arrInitLoadFunc=new Array();usergroup_arrInitLoadFunc[0]="Js.Center.System.ElementAdd.func";usergroup_arrInitLoadFunc[1]="Js.Center.System.ElementUpdate.func";var elementGrid=new WXTL.Widgets.CommonGrid.GridPanel({id:"Js.Center.System.Element.elementGridPanel",anchor:'100% 100%',needMenu:false,needRightMenu:false,pageSize:_pageSize,store:Js.Center.System.Element.Infostore,afterEditURL:Js.Center.System.ElementURL,inertMethod:'Js.Center.System.ElementAdd',updateMethod:'Js.Center.System.ElementUpdate',otherInitLoadFunc:usergroup_arrInitLoadFunc,sm:sm,cm:cm,tbar:new Ext.Toolbar({items:[{iconCls:'addicon',text:"添加",handler:function(){elementGrid.doInsert()}},"","-","",{iconCls:'editicon',text:"修改",handler:function(){elementGrid.doEdit()}},"","-","",{iconCls:'editicon',text:"生成配置",handler:function(){var rows=elementGrid.getSelectionModel().getSelections();if(rows.length==0){Ext.Msg.alert("温馨提示","请您选择记录!")}else{Ext.Msg.confirm("温馨提示!","确认要在本地生成所选择的网元配置文件吗？",function(btn){if(btn=="yes"){executeFile(rows)}})}}}]})});function executeFile(rows){var executeSplit="";for(var i=0;i<rows.length;i++){if(rows.length==1){executeSplit=rows[i].data.numnodeid}else{if(i<(rows.length-1)){executeSplit=rows[i].data.numnodeid+","+executeSplit}if(i==(rows.length-1)){executeSplit=executeSplit+rows[i].data.numnodeid}}};var params={nodes:executeSplit,numindustry:selectPanel.getForm().findField("numindustry").getValue(),flag:"executefile"};doAjax(Js.Center.System.ElementURL,params,Js.Center.System.Element.Infostore)}var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"elementSelectPanel",height:150,queryMethod:"Js.Center.System.Element.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},items:[new Ext.form.TextField({fieldLabel:'网元编号',name:'numnodeid',regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:2,maxLengthText:'长度不能超过2'})]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},items:[{xtype:"combo",name:"numindustry",hiddenName:"numindustry",fieldLabel:"<font color=red>网元所属业务</font>",allowBlank:false,blankText:"网元所属业务为必选",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:"1",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["行业","1"],["渠道","2"]]})}]}]}]});Js.Center.System.Element.queryGrid=function(){if(selectPanel.getForm().isValid()){Js.Center.System.Element.Infostore.baseParams={flag:flag,numnodeid:selectPanel.getForm().findField("numnodeid").getValue(),numindustry:selectPanel.getForm().findField("numindustry").getValue()};Js.Center.System.Element.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.System.Element.MainPanel=new Ext.Panel({id:"Js.Center.System.Element.mainpanel",frame:true,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,elementGrid]});};GridMain(node,Js.Center.System.Element.MainPanel,"openroomiconinfo","Js.Center.System.Element.Infostore");var commondOp="";Js.Center.System.Element.viewConfig=function(ID){var OldID=ID;ID=getSpnodeid(ID);commondOp="-U"+OldID+" -F15"+ID+" -Cviewsystemconfig";var commondjson=doSynRequest(Js.Center.System.ElementCmdURL+"?cmd="+commondOp);if(commondjson.success==true){nodeConfigWin.show();nodeConfigWin.setTitle(OldID+"网元SystemConfig配置文件");var data=commondjson.data.replace(new RegExp("<br>","gm"),"\r\n");Ext.getCmp("nodeConfigInfo").setValue(data)}else{Ext.Msg.alert("提示","查看出现问题，可能是未加载配置！")}};Js.Center.System.Element.loadConfig=function(ID){var OldID=ID;ID=getSpnodeid(ID);Ext.Msg.confirm("温馨提示!","确定执行加载吗？将本地配置加载到对应网元数据",function(btn){if(btn=="yes"){commondOp="-U"+OldID+" -F15"+ID+" -Cgetsystemconfig";doNodeCmd(commondOp,true)}})};Js.Center.System.Element.resumeConfig=function(ID){var OldID=ID;ID=getSpnodeid(ID);Ext.Msg.confirm("温馨提示!","确定执行恢复吗？将网元分布式配置恢复到原来的配置",function(btn){if(btn=="yes"){commondOp="-U"+OldID+" -F15"+ID+" -Cresumesystemconfig";doNodeCmd(commondOp,true)}})};Js.Center.System.Element.effectConfig=function(ID){var OldID=ID;ID=getSpnodeid(ID);Ext.Msg.confirm("温馨提示!","确定执行生效配置吗？生效后将使用新配置信息",function(btn){if(btn=="yes"){commondOp="-U"+OldID+" -F15"+ID+" -Ceffectsystemconfig";doNodeCmd(commondOp,true)}})};function doNodeCmd(cmdop,needshowmsg){var commondjson=doSynRequest(Js.Center.System.ElementCmdURL+"?cmd="+cmdop);if(needshowmsg){if(commondjson.success==true){Ext.Msg.alert("提示","命令执行成功！")}else{Ext.Msg.alert("提示","命令执行失败！")}}return commondjson.error}function getSpnodeid(ID){if(ID==35||ID=="35"){ID="54"}if(ID==24||ID=="24"){ID="04"}return ID}var nodeConfigWin=new WXTL.Widgets.CommonWindows.Window({title:"SystemConfig配置文件",width:700,height:500,autoScroll:true,frame:true,updateState:true,needLoadDataStore:false,needButtons:false,items:[{xtype:"textarea",width:"100%",height:"100%",id:"nodeConfigInfo"}],buttons:[{text:"关  闭",minWidth:70,handler:function(){nodeConfigWin.hide()}}]})};Ext.namespace('Js.Center.System.ElementUpdate');Js.Center.System.ElementUpdate.func=function(){var updateElementInfofp=new Ext.form.FormPanel({frame:true,labelWidth:80,defaults:{anchor:"100%",msgTarget:"side"},items:[new Ext.form.FieldSet({title:'网元配置基本信息',collapsible:false,autoHeight:true,style:Ext.isIE?'padding:5px 0 0 10px;':'padding:0 0 0 10px;',layout:'column',items:[{columnWidth:.5,layout:'form',defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"hidden",name:"flag",value:"updateelement"},{xtype:"numberfield",name:"numnodeid",fieldLabel:"<font color=red>网元ID</font>",allowBlank:false,blankText:"网元ID不允许为空",minValue:1,maxValue:99,readOnly:true,minText:"网元ID不能小于1",maxText:"网元ID不能大于99"},{xtype:"textfield",name:"numdistriport",fieldLabel:"<font color=red>分布式端口</font>",allowBlank:false,blankText:"分布式端口不许为空",regex:WXTL.Common.regex.Integer,regexText:"只能输入数字",maxLength:10,maxLengthText:"不能超过10位"},{xtype:"textfield",name:"numtomcatport",fieldLabel:"<font color=red>Tomcat端口</font>",allowBlank:false,blankText:"Tomcat端口不许为空",regex:WXTL.Common.regex.Integer,regexText:"只能输入数字",maxLength:10,maxLengthText:"不能超过10位"},{xtype:"textfield",name:"vc2projname",fieldLabel:"<font color=red>网元项目名称</font>",allowBlank:false,blankText:"网元项目名称不能为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50}]},{columnWidth:.5,layout:'form',defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2nodename",fieldLabel:"<font color=red>网元名称</font>",allowBlank:false,blankText:"网元名称不许为空",maxLength:50,maxLengthText:"网元名称不能超过50"},{xtype:"textfield",name:"vc2nodeip",fieldLabel:"<font color=red>主机IP</font>",allowBlank:false,blankText:"主机IP不许为空",regex:WXTL.Common.regex.IP,regexText:"只能输入IP"},{xtype:"combo",name:"numstatus",hiddenName:"numstatus",fieldLabel:"<font color=red>是否启用</font>",allowBlank:false,blankText:"是否启用为必选",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:"0",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["是","1"],["否","0"]]})}]}]})]});var mainForm=updateElementInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"修改网元分布式配置",mainForm:mainForm,updateURL:Js.Center.System.ElementURL,displayStore:Js.Center.System.Element.Infostore,items:[updateElementInfofp],needButtons:false,buttons:[new Ext.Button({text:'确定',minWidth:70,handler:function(){if(updateElementInfofp.getForm().isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.System.ElementUpdate.window.mainFormSubmitFunc()}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){updateElementInfofp.getForm().reset();if(Js.Center.System.ElementUpdate.window.updateState&&Js.Center.System.ElementUpdate.window.updateRecord!=null){Js.Center.System.ElementUpdate.window.mainForm.loadRecord(Js.Center.System.ElementUpdate.window.updateRecord)}}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){Js.Center.System.ElementUpdate.window.hide()}})]})};Ext.namespace('Js.Center.System.Element');Js.Center.System.ElementURL='URL/business/element/element.ashx';Js.Center.System.ElementCmdURL='cmd.ashx';