Ext.namespace('Js.Center.Business.ProgramAdd');Ext.QuickTips.init();Js.Center.Business.ProgramAdd.func=function(){var ProgramAddInfofp=new Ext.form.FormPanel({width:650,frame:true,labelWidth:80,items:[{layout:'column',items:[{xtype:"hidden",name:"flag",value:"insert"},{xtype:"hidden",name:"numdepartid",fieldLabel:"部门编号",value:1},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2clientname",fieldLabel:"<font color=red>客户端名称</font>",allowBlank:false,blankText:"客户端名称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:'客户端名称不能有非法字符！',maxLength:20},{xtype:"combo",name:"protocoltype",fieldLabel:"<font color=red>协议类型</font>",hiddenName:"protocoltype",allowBlank:false,blankText:"连接协议不允许为空",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["CBIP1.0","1"],["CBIP2.0","2"]]})},{xtype:"textfield",name:"vc2username",fieldLabel:"<font color=red>登录名称</font>",allowBlank:false,blankText:"登录名称不允许为空",regex:/^[A-Za-z0-9]+$/,regexText:'登录名称请使用数字或字母',maxLength:20},{xtype:"textfield",name:"vc2password",fieldLabel:"<font color=red>登录密码</font>",allowBlank:false,blankText:"登录密码不允许为空",regex:/^[A-Za-z0-9]+$/,regexText:'登录密码请使用数字或字母',maxLength:20},{xtype:"textfield",name:"nummaxsendspeed",fieldLabel:"<font color=red>最大下发速度</font>",allowBlank:false,blankText:"最大下发速度不允许为空",regex:WXTL.Common.regex.Integer,regexText:'请输入数字！',maxLength:10,value:100}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2clientip",fieldLabel:"<font color=red>客户端IP</font>",allowBlank:false,blankText:"客户端IP不允许为空",regex:WXTL.Common.regex.IP,regexText:'客户端IP格式不对！',maxLength:20},{xtype:"textfield",name:"vc2sublongcode",fieldLabel:"下行长号码",regex:/[0-9]$/,regexText:'只能输入数字',maxLength:20},{xtype:"textfield",name:"numreturnlevel",fieldLabel:getHelpMsg("透传级别",true," 透传的级别为下列数字的相加值<br>1 透传submitResp <br>2 透传response <br> 4 透传report  <br>8 透传Deliver <br> 如填写 12 将透传 report 和 Deliver （4+8）<br>如填写 4  将只透传 report （4）"),allowBlank:false,blankText:"透传级别不允许为空",regex:WXTL.Common.regex.Integer,regexText:'请输入数字!',maxLength:5,value:12},{xtype:"textfield",name:"numclientlevel",fieldLabel:"<font color=red>客户端等级</font>",allowBlank:false,blankText:"客户端等级不允许为空",regex:WXTL.Common.regex.Integer,regexText:'请输入数字！',maxLength:10,value:0},{xtype:"textfield",name:"moduleid",fieldLabel:"<font color=red>模块编号</font>",allowBlank:false,blankText:"模块编号不允许为空",regex:WXTL.Common.regex.Integer,regexText:'请输入数字！',maxLength:10}]}]}]});var mainForm=ProgramAddInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加客户端",mainForm:mainForm,updateURL:Js.Center.Business.ProgramUpdateURL,displayStore:Js.Center.Business.Program.Infostore,items:[ProgramAddInfofp]});};Ext.namespace('Js.Center.Business.ProgramDelete');Js.Center.Business.ProgramDelete.func=function(row){var deleteSplit="";for(var i=0;i<row.length;i++){if(row.length==1){deleteSplit=row[i].data.numclientid}else{if(i<(row.length-1)){deleteSplit=row[i].data.numclientid+","+deleteSplit}if(i==(row.length-1)){deleteSplit=deleteSplit+row[i].data.numclientid}}};var params={ids:deleteSplit,flag:"delete"};doAjax(Js.Center.Business.ProgramUpdateURL,params,Js.Center.Business.Program.Infostore)};Ext.namespace('Js.Center.Business.Program');Js.Center.Business.Program.ProgramInfo=function(node){if(Ext.get("Js.Center.Business.Program.MainPanel")==null){Js.Center.Common.LinkProtocolStore.reload();var _pageSize=12;var fields=["numclientid","numlinkprotocolid","vc2linkprotocolname","vc2clientname","numdepartid","vc2departname","vc2username","vc2password","vc2clientip","vc2sublongcode","nummaxsendspeed","numclientlevel","numreturnlevel","moduleid","protocoltype"];Js.Center.Business.Program.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.ProgramQueryURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numclientid",totalProperty:"totalCount"}),baseParams:{vc2username:"",flag:'selectbykey'}});Js.Center.Business.Program.Infostore.load({params:{start:0,limit:_pageSize}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numclientid"});var cm=new Ext.grid.ColumnModel([sm,{header:"客户端编号",tooltip:"客户端编号",dataIndex:"numclientid",sortable:true},{header:"客户端名称",tooltip:"客户端名称",dataIndex:"vc2clientname",sortable:true},{header:"协议类型",tooltip:"协议类型",dataIndex:"protocoltype",sortable:true,renderer:function(value){if(value==1){return"CBIP1.0"}else if(value==2){return"CBIP2.0"}}},{header:"登录名称",tooltip:"登录名称",dataIndex:"vc2username",sortable:true},{header:"登录密码",tooltip:"登录密码",dataIndex:"vc2password",sortable:true},{header:"客户端IP",tooltip:"客户端IP",dataIndex:"vc2clientip",sortable:true},{header:"下行长号码",tooltip:"下行长号码",dataIndex:"vc2sublongcode",sortable:true},{header:"下发速度",tooltip:"下发速度",dataIndex:"nummaxsendspeed",sortable:true},{header:"客户端等级",tooltip:"客户端等级",dataIndex:"numclientlevel",sortable:true},{header:"透传级别",tooltip:"透传级别",dataIndex:"numreturnlevel",sortable:true}]);var gridPanel=new WXTL.Widgets.CommonGrid.GridPanel({id:"programGridPanel",anchor:'100% 100%',pageSize:_pageSize,store:Js.Center.Business.Program.Infostore,afterEditURL:Js.Center.Business.ProgramUpdateURL,inertMethod:'Js.Center.Business.ProgramAdd',updateMethod:'Js.Center.Business.ProgramUpdate',deleteMethod:'Js.Center.Business.ProgramDelete.func',sm:sm,cm:cm});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"programSelectPanel",height:100,queryMethod:"Js.Center.Business.Program.queryGrid",items:[{layout:'form',defaults:{anchor:'40%',msgTarget:"side"},items:[new Ext.form.TextField({fieldLabel:'客户端名称',name:'columnname',id:'columnname',regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:20})]}]});Js.Center.Business.Program.queryGrid=function(){if(selectPanel.getForm().isValid()){var columnName=Ext.get("columnname").getValue();var flag='selectbykey';Js.Center.Business.Program.Infostore.baseParams={vc2username:columnName,flag:flag};Js.Center.Business.Program.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.Business.Program.MainPanel=new Ext.Panel({id:"Js.Center.Business.Program.MainPanel",frame:true,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,gridPanel]});};GridMain(node,Js.Center.Business.Program.MainPanel,"openroomiconinfo","Js.Center.Business.Program.Infostore")};Ext.namespace('Js.Center.Business.ProgramUpdate');Js.Center.Business.ProgramUpdate.func=function(row){var updateInfoFormPanel=new Ext.form.FormPanel({frame:true,labelWidth:80,items:[{layout:'column',items:[{xtype:"hidden",name:"flag",value:"update"},{xtype:"hidden",name:"numdepartid",fieldLabel:"部门编号"},{xtype:"hidden",name:"numclientid",fieldLabel:"客户端编号"},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2clientname",fieldLabel:"<font color=red>客户端名称</font>",allowBlank:false,blankText:"客户端名称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:'客户端名称不能有非法字符！',maxLength:20},{xtype:"combo",name:"protocoltype",fieldLabel:"<font color=red>协议类型</font>",hiddenName:"protocoltype",allowBlank:false,blankText:"连接协议不允许为空",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["CBIP1.0","1"],["CBIP2.0","2"]]})},{xtype:"textfield",name:"vc2username",fieldLabel:"<font color=red>登录名称</font>",allowBlank:false,blankText:"登录名称不允许为空",regex:/^[A-Za-z0-9]+$/,regexText:'登录名称请使用数字或字母',maxLength:20},{xtype:"textfield",name:"vc2password",fieldLabel:"<font color=red>登录密码</font>",allowBlank:false,blankText:"登录密码不允许为空",regex:/^[A-Za-z0-9]+$/,regexText:'登录密码请使用数字或字母',maxLength:20},{xtype:"textfield",name:"nummaxsendspeed",fieldLabel:"<font color=red>最大下发速度</font>",allowBlank:false,blankText:"最大下发速度不允许为空",regex:WXTL.Common.regex.Integer,regexText:'请输入数字!',maxLength:10,value:100}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2clientip",fieldLabel:"<font color=red>客户端IP</font>",allowBlank:false,blankText:"客户端IP不允许为空",regex:WXTL.Common.regex.IP,regexText:'客户端IP格式不对！',maxLength:20},{xtype:"textfield",name:"vc2sublongcode",fieldLabel:"下行长号码",regex:/[0-9]$/,regexText:'只能输入数字',maxLength:20},{xtype:"textfield",name:"numreturnlevel",fieldLabel:getHelpMsg("透传级别",true," 透传的级别为下列数字的相加值<br>1 透传submitResp <br>2 透传response <br> 4 透传report  <br>8 透传Deliver <br> 如填写 12 将透传 report 和 Deliver （4+8）<br>如填写 4  将只透传 report （4）"),allowBlank:false,blankText:"透传级别不允许为空",regex:WXTL.Common.regex.Integer,regexText:'请输入数字！',maxLength:5,value:12},{xtype:"textfield",name:"numclientlevel",fieldLabel:"<font color=red>客户端等级</font>",allowBlank:false,blankText:"客户端等级不允许为空",regex:WXTL.Common.regex.Integer,regexText:'请输入数字!',maxLength:10,value:0},{xtype:"textfield",name:"moduleid",fieldLabel:"<font color=red>模块编号</font>",allowBlank:false,blankText:"模块编号不允许为空",regex:WXTL.Common.regex.Integer,regexText:'请输入数字！',maxLength:10}]}]}]});var mainForm=updateInfoFormPanel.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"修改客户端",mainForm:mainForm,updateURL:Js.Center.Business.ProgramUpdateURL,displayStore:Js.Center.Business.Program.Infostore,updateState:true,updateRecord:row,items:[updateInfoFormPanel]})};Ext.namespace('Js.Center.Business');Js.Center.Business.ProgramUpdateURL='URL/business/Program/ProgramUpdate.ashx';Js.Center.Business.ProgramQueryURL='URL/business/Program/ProgramUpdate.ashx';Js.Center.Popedom.DepartmentsQueryURL='URL/Temp_Purview/departments/departmentsquery.ashx';