Ext.namespace('Js.Center.System.Deployment.ModuleConfig');Js.Center.System.Deployment.ModuleConfig.func=function(programId,programName,nodeId){var configData=doSynRequest(Js.Center.System.Deployment.DeploymentQueryURL+"?flag=gettaskitem&taskid="+programId);var moduleConfigItemfp=new Ext.Panel({frame:true,labelWidth:100,items:[{layout:'column',items:[]}]});WXTL.Common.generateConfigFormItem(configData,moduleConfigItemfp,true);Js.Center.System.Deployment.ModuleConfig.ModuleStore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.System.Deployment.DeploymentQueryURL,method:"POST"}),reader:new Ext.data.JsonReader({totalProperty:'totalProperty',root:'data',fields:[{name:'id'},{name:'name'},{name:'boxLabel',mapping:"taskname"},{name:'inputValue',mapping:"programid"},{name:'checked',mapping:'ischecked'}]}),baseParams:{flag:"gettasklist",taskid:programId,programtype:"-1",columnlist:"programId,taskname",nodeid:nodeId}});Js.Center.System.Deployment.ModuleConfig.ModuleStore.reload();var moduleGroup=new WXTL.Widgets.CommonPanel.CheckBoxGroupPanel({store:Js.Center.System.Deployment.ModuleConfig.ModuleStore,defaultItemsName:"programid",defaultItemsboxLable:"没有"+programName+"相关配置模块。",style:"padding:5px 5px 5px 5px",boxLabelText:"  <a href='#' onclick='Js.Center.System.Deployment.ModuleItemConfig.func(\"{inputValue}\",\"{boxLabel}\",\""+nodeId+"\")'>配置</a>",numcolumns:2,blankText:"请选择"+programName+"模块",allowBlank:false,needButton:false});var moduleGroupPanel=new Ext.Panel({style:'padding:0 0 0 5px',autoScroll:true,items:[moduleGroup]});var moduleConfigfp=new Ext.form.FormPanel({layout:"form",labelWidth:100,items:[{xtype:"hidden",name:"flag",value:'updatetasklist'},{xtype:"hidden",name:"taskid",value:programId},moduleConfigItemfp,moduleGroup]});var mainForm=moduleConfigfp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:programName+"配置",height:450,mainForm:mainForm,updateURL:Js.Center.System.Deployment.DeploymentQueryURL,displayStore:Js.Center.System.Deployment.ModuleConfig.ModuleStore,autoScroll:true,items:[moduleConfigfp],listeners:{"hide":function(){Js.Center.System.Deployment.NodeConfig.CommunicateModuleStore.reload();Js.Center.System.Deployment.NodeConfig.TaskModuleStore.reload();Js.Center.System.Deployment.NodeConfig.CommonModuleStore.reload();Js.Center.System.Deployment.NodeConfig.FuncModuleStore.reload()}}});if(configData.data.length>12){this.window.setHeight(400)};Js.Center.System.Deployment.ModuleConfig.window.show()};Ext.namespace('Js.Center.System.Deployment.ModuleItemConfig');Js.Center.System.Deployment.ModuleItemConfig.func=function(programId,programName,nodeId){var configData=doSynRequest(Js.Center.System.Deployment.DeploymentQueryURL+"?flag=gettaskitem&taskid="+programId);var moduleConfigItemfp=new Ext.form.FormPanel({frame:true,labelWidth:100,items:[{layout:'column',items:[{xtype:"hidden",name:"flag",value:'updatetaskitem'},{xtype:"hidden",name:"taskid",value:programId},{xtype:"hidden",name:"nodeid",value:nodeId}]}]});WXTL.Common.generateConfigFormItem(configData,moduleConfigItemfp,true);var mainForm=moduleConfigItemfp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:programName+"配置",mainForm:mainForm,updateURL:Js.Center.System.Deployment.DeploymentQueryURL,displayStore:Js.Center.System.Deployment.Node.Infostore,autoScroll:true,items:[moduleConfigItemfp],listeners:{"hide":function(){Js.Center.System.Deployment.ModuleConfig.ModuleStore.reload()}}});if(configData.data.length>12){this.window.setHeight(400)};Js.Center.System.Deployment.ModuleItemConfig.window.show()};Ext.namespace('Js.Center.System.Deployment.NodeAdd');Ext.QuickTips.init();Js.Center.System.Deployment.NodeAdd.func=function(){if(Js.Center.System.Deployment.NodeAdd.window==null){var AddInfofp=new Ext.form.FormPanel({frame:true,labelWidth:80,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"hidden",name:"flag",value:"insertnode"},{xtype:"textfield",name:"vc2taskname",fieldLabel:"<font color=red>网元名称</font>",allowBlank:false,blankText:"网元名称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50},{xtype:"textfield",name:"vc2taskdesc",fieldLabel:"网元描述",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50}]});var mainForm=AddInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加网元",mainForm:mainForm,updateURL:Js.Center.System.Deployment.DeploymentQueryURL,displayStore:Js.Center.System.Deployment.Node.Infostore,items:[AddInfofp]})}};Ext.namespace('Js.Center.System.Deployment.NodeConfig');Js.Center.System.Deployment.NodeConfig.func=function(row){var configData=doSynRequest(Js.Center.System.Deployment.DeploymentQueryURL+"?flag=gettaskitem&taskid="+row.data.numtaskid);var nodeConfigfp=new Ext.Panel({frame:true,labelWidth:100,items:[{layout:'column',items:[]}]});WXTL.Common.generateConfigFormItem(configData,nodeConfigfp,true);Js.Center.System.Deployment.NodeConfig.CommunicateModuleStore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.System.Deployment.DeploymentQueryURL,method:"POST"}),reader:new Ext.data.JsonReader({totalProperty:'totalProperty',root:'data',fields:[{name:'id'},{name:'name'},{name:'boxLabel',mapping:"taskname"},{name:'inputValue',mapping:"programid"},{name:'checked',mapping:'ischecked'},{name:'parentId',mapping:'parentid'}]}),baseParams:{flag:"gettasklist",taskid:row.data.numtaskid,programtype:"22",columnlist:"programId,taskname"}});Js.Center.System.Deployment.NodeConfig.CommunicateModuleStore.reload();Js.Center.System.Deployment.NodeConfig.communicateGroup=new WXTL.Widgets.CommonPanel.CheckBoxGroupPanel({store:Js.Center.System.Deployment.NodeConfig.CommunicateModuleStore,defaultItemsName:"programid",defaultItemsboxLable:'没有相关通讯模块。',style:"padding:5px 5px 5px 5px",boxLabelText:"  <img src='jspack/product/common/Images/file-add.gif' qtip='添加模块' onclick='Js.Center.System.Deployment.NodeConfig.AddModule(\"{inputValue}\",\"{boxLabel}\",\"add\")'/>  <img src='jspack/product/common/Images/icons/edit.png' qtip='修改模块名称' onclick='Js.Center.System.Deployment.NodeConfig.AddModule(\"{inputValue}\",\"{boxLabel}\",\"update\")'/> <a href='#' onclick='Js.Center.System.Deployment.ModuleConfig.func(\"{inputValue}\",\"{boxLabel}\",\""+row.data.numtaskid+"\") '>配置</a> ",numcolumns:2,blankText:"请选择通讯模块",allowBlank:false,needButton:false});var communicateGroupPanel=new Ext.Panel({style:'padding:0 0 0 5px',title:'通讯模块',height:160,autoScroll:true,items:[Js.Center.System.Deployment.NodeConfig.communicateGroup]});Js.Center.System.Deployment.NodeConfig.TaskModuleStore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.System.Deployment.DeploymentQueryURL,method:"POST"}),reader:new Ext.data.JsonReader({totalProperty:'totalProperty',root:'data',fields:[{name:'id'},{name:'name'},{name:'boxLabel',mapping:"taskname"},{name:'inputValue',mapping:"programid"},{name:'checked',mapping:'ischecked'}]}),baseParams:{flag:"gettasklist",taskid:row.data.numtaskid,programtype:"311",columnlist:"programId,taskname"}});Js.Center.System.Deployment.NodeConfig.TaskModuleStore.reload();var taskGroup=new WXTL.Widgets.CommonPanel.CheckBoxGroupPanel({store:Js.Center.System.Deployment.NodeConfig.TaskModuleStore,defaultItemsName:"programid",defaultItemsboxLable:'没有相关任务模块。',style:"padding:5px 5px 5px 5px",boxLabelText:"  <a href='#' onclick='Js.Center.System.Deployment.ModuleConfig.func(\"{inputValue}\",\"{boxLabel}\",\""+row.data.numtaskid+"\")'>配置</a>",numcolumns:2,blankText:"请选择任务模块",allowBlank:false,needButton:false});var taskGroupPanel=new Ext.Panel({style:'padding:0 0 0 5px',title:'任务模块',height:160,autoScroll:true,items:[taskGroup]});Js.Center.System.Deployment.NodeConfig.CommonModuleStore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.System.Deployment.DeploymentQueryURL,method:"POST"}),reader:new Ext.data.JsonReader({totalProperty:'totalProperty',root:'data',fields:[{name:'id'},{name:'name'},{name:'boxLabel',mapping:"taskname"},{name:'inputValue',mapping:"programid"},{name:'checked',mapping:'ischecked'}]}),baseParams:{flag:"gettasklist",taskid:row.data.numtaskid,programtype:"62",columnlist:"programId,taskname"}});Js.Center.System.Deployment.NodeConfig.CommonModuleStore.reload();var commonGroup=new WXTL.Widgets.CommonPanel.CheckBoxGroupPanel({store:Js.Center.System.Deployment.NodeConfig.CommonModuleStore,defaultItemsName:"programid",defaultItemsboxLable:'没有相关公共模块。',style:"padding:5px 5px 5px 5px",boxLabelText:"  <a href='#' onclick='Js.Center.System.Deployment.ModuleConfig.func(\"{inputValue}\",\"{boxLabel}\",\""+row.data.numtaskid+"\")'>配置</a>",numcolumns:2,blankText:"请选择公共模块",allowBlank:false,needButton:false});var commonGroupPanel=new Ext.Panel({style:'padding:0 0 0 5px',title:'公共模块',height:160,autoScroll:true,items:[commonGroup]});Js.Center.System.Deployment.NodeConfig.FuncModuleStore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.System.Deployment.DeploymentQueryURL,method:"POST"}),reader:new Ext.data.JsonReader({totalProperty:'totalProperty',root:'data',fields:[{name:'id'},{name:'name'},{name:'boxLabel',mapping:"taskname"},{name:'inputValue',mapping:"programid"},{name:'checked',mapping:'ischecked'}]}),baseParams:{flag:"gettasklist",taskid:row.data.numtaskid,programtype:"869",columnlist:"programId,taskname"}});Js.Center.System.Deployment.NodeConfig.FuncModuleStore.reload();var funcGroup=new WXTL.Widgets.CommonPanel.CheckBoxGroupPanel({store:Js.Center.System.Deployment.NodeConfig.FuncModuleStore,defaultItemsName:"programid",defaultItemsboxLable:'没有相关功能模块。',style:"padding:5px 5px 5px 5px",boxLabelText:"  <a href='#' onclick='Js.Center.System.Deployment.ModuleConfig.func(\"{inputValue}\",\"{boxLabel}\",\""+row.data.numtaskid+"\")'>配置</a>",numcolumns:2,blankText:"请选择功能模块",allowBlank:false,needButton:false});var funcGroupPanel=new Ext.Panel({style:'padding:0 0 0 5px',title:'功能模块',border:true,height:160,autoScroll:true,items:[funcGroup]});var moduleConfigfp=new Ext.form.FormPanel({labelWidth:100,items:[{layout:'column',items:[{xtype:"hidden",name:"flag",value:'updatetasklist'},{xtype:"hidden",name:"taskid",value:row.data.numtaskid},{columnWidth:1,layout:'form',defaults:{anchor:"98%",msgTarget:"side"},buttonAlign:"center",items:[nodeConfigfp]},{columnWidth:.5,layout:'form',defaults:{anchor:"97%",msgTarget:"side"},buttonAlign:"center",items:[communicateGroupPanel,taskGroupPanel]},{columnWidth:.5,layout:'form',defaults:{anchor:"97%",msgTarget:"side"},buttonAlign:"center",items:[commonGroupPanel,funcGroupPanel]}]}]});var mainForm=moduleConfigfp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"利信通2.0系统配置",height:450,mainForm:mainForm,updateURL:Js.Center.System.Deployment.DeploymentQueryURL,displayStore:Js.Center.System.Deployment.Node.Infostore,updateState:true,updateRecord:row,autoScroll:true,style:'padding:5px 0 0 5px',items:[moduleConfigfp],listeners:{"hide":function(){Js.Center.System.Deployment.NodeConfig.CommunicateModuleStore.reload()}}});if(configData.data.length>12){this.window.setHeight(400)};Js.Center.System.Deployment.NodeConfig.window.show();Js.Center.System.Deployment.NodeConfig.AddModule=function(itemValue,itemText,flag){var addInfofp=new Ext.form.FormPanel({frame:true,labelWidth:80,layout:'form',defaults:{anchor:"99%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 10px",items:[{xtype:"textfield",fieldLabel:"模块名称",value:itemText}]});var addWindow=new WXTL.Widgets.CommonWindows.Window({title:"",mainForm:addInfofp.getForm(),style:'padding:5px 0 0 5px',items:[addInfofp],needButtons:false,buttons:[new Ext.Button({text:'确定',minWidth:70,handler:function(){var index=Js.Center.System.Deployment.NodeConfig.communicateGroup.store.find("inputValue",itemValue);if(flag=="add"){var communicateRecord=Ext.data.Record.create([{name:'boxLabel'},{name:'inputValue'},{name:'checked'},{name:'parentId'}]);Js.Center.System.Deployment.NodeConfig.communicateGroup.store.insert(index+1,new communicateRecord({inputValue:itemValue.split(":")[0]+"::"+addWindow.items.items[0].items.items[0].getValue()+":"+itemValue.split(":")[0],boxLabel:addWindow.items.items[0].items.items[0].getValue(),parentId:itemValue,checked:true}));Js.Center.System.Deployment.NodeConfig.communicateGroup.onLoad()}else if(flag=="update"){var record=Js.Center.System.Deployment.NodeConfig.communicateGroup.store.getAt(index);record.set("inputValue",itemValue.split(":")[0]+":"+itemValue.split(":")[1]+":"+addWindow.items.items[0].items.items[0].getValue());record.set("boxLabel",addWindow.items.items[0].items.items[0].getValue());record.commit();Js.Center.System.Deployment.NodeConfig.communicateGroup.onLoad()}addWindow.close()}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){addWindow.close()}})]});if(flag=="delete"){var index=Js.Center.System.Deployment.NodeConfig.communicateGroup.store.find("inputValue",itemValue);Js.Center.System.Deployment.NodeConfig.communicateGroup.store.removeAt(index);Js.Center.System.Deployment.NodeConfig.communicateGroup.onLoad()}else{addWindow.show()}}};Ext.namespace('Js.Center.System.Deployment.NodeDelete');Js.Center.System.Deployment.NodeDelete.func=function(row){var deleteSplit="";for(var i=0;i<row.length;i++){if(row.length==1){deleteSplit=row[i].data.numtaskid}else{if(i<(row.length-1)){deleteSplit=row[i].data.numtaskid+","+deleteSplit}if(i==(row.length-1)){deleteSplit=deleteSplit+row[i].data.numtaskid}}};var params={ids:deleteSplit,flag:"delete"};doAjax(Js.Center.System.Deployment.DeploymentQueryURL,params,Js.Center.System.Deployment.Node.Infostore)};Ext.namespace('Js.Center.System.Deployment.Node');Js.Center.System.Deployment.Node.info=function(node){if(Ext.get("Js.Center.System.Deployment.Node.Nodepanel")==null){nodeConfig=function(rowIndex){var row=Js.Center.System.Deployment.Node.Infostore.getAt(rowIndex);Js.Center.System.Deployment.NodeConfig.func(row)};var _pageSize=12;var fields=["numtaskid","vc2taskname","vc2taskdesc"];Js.Center.System.Deployment.Node.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.System.Deployment.DeploymentQueryURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numtaskid",totalProperty:"totalCount"}),sortInfo:{field:'numtaskid',direction:'DESC'},baseParams:{vc2taskname:'',flag:'selectbykey'}});Js.Center.System.Deployment.Node.Infostore.load({params:{start:0,limit:_pageSize,vc2taskname:'',flag:'selectbykey'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numtaskid"});var cm=new Ext.grid.ColumnModel([sm,{header:"网元编号",tooltip:"网元编号",dataIndex:"numtaskid",sortable:true},{header:"网元名称",tooltip:"网元名称",dataIndex:"vc2taskname",sortable:true},{header:"网元描述",tooltip:"网元描述",dataIndex:"vc2taskdesc",sortable:true},{header:"操作",tooltip:"操作",dataIndex:"filename",renderer:function(value,meta,record,rowIndex,colIndex,store){return"<a href='#' onclick='nodeConfig("+rowIndex+")'>配置</a>"}}]);var NodeGrid=new WXTL.Widgets.CommonGrid.GridPanel({anchor:'100% 100%',pageSize:_pageSize,store:Js.Center.System.Deployment.Node.Infostore,afterEditURL:Js.Center.System.Deployment.DeploymentQueryURL,inertMethod:'Js.Center.System.Deployment.NodeAdd',updateMethod:'Js.Center.System.Deployment.NodeUpdate',deleteMethod:'Js.Center.System.Deployment.NodeDelete.func',sm:sm,cm:cm});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({queryMethod:"Js.Center.System.Deployment.Node.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2taskname",id:"Js.Center.System.Deployment.Node.vc2taskname",fieldLabel:"网元名称",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50}]}]}]});Js.Center.System.Deployment.Node.queryGrid=function(){if(selectPanel.getForm().isValid()){var _vc2taskname=Ext.get("Js.Center.System.Deployment.Node.vc2taskname").getValue();var _flag='selectbykey';Js.Center.System.Deployment.Node.Infostore.baseParams={vc2taskname:_vc2taskname,flag:_flag};Js.Center.System.Deployment.Node.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.System.Deployment.Node.NodePanel=new Ext.Panel({frame:true,id:"Js.Center.System.Deployment.Node.Nodepanel",bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,NodeGrid]})};GridMain(node,Js.Center.System.Deployment.Node.NodePanel,"openroomiconinfo","Js.Center.System.Deployment.Node.Infostore")};Ext.namespace('Js.Center.System.Deployment.NodeUpdate');Ext.QuickTips.init();Js.Center.System.Deployment.NodeUpdate.func=function(row){if(Js.Center.System.Deployment.NodeUpdate.window==null){var UpdateInfofp=new Ext.form.FormPanel({frame:true,labelWidth:80,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"hidden",name:"flag",value:"updatenode"},{xtype:"hidden",name:"numtaskid",fieldLabel:"网元编号"},{xtype:"textfield",name:"vc2taskname",fieldLabel:"<font color=red>网元名称</font>",allowBlank:false,blankText:"网元名称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50},{xtype:"textfield",name:"vc2taskdesc",fieldLabel:"网元描述",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50}]});var mainForm=UpdateInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"修改网元",mainForm:mainForm,updateURL:Js.Center.System.Deployment.DeploymentQueryURL,displayStore:Js.Center.System.Deployment.Node.Infostore,updateState:true,updateRecord:row,items:[UpdateInfofp]})}};Ext.namespace('Js.Center.System.Deployment');Js.Center.System.Deployment.DeploymentQueryURL="URL/deployment/node.ashx";Js.Center.System.Deployment.DeploymentQueryURL2="test2.jsp";