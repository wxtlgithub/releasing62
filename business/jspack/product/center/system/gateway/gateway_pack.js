Ext.namespace('Js.Center.Business.GatewayAdd');Ext.QuickTips.init();Js.Center.Business.GatewayAdd.func=function(){Js.Center.Common.GatewayTypeStore.reload();if(Js.Center.Business.GatewayAdd.window==null){var AddgatewayInfofp=new Ext.form.FormPanel({frame:true,labelWidth:80,items:[{layout:'column',items:[{xtype:"hidden",name:"flag",value:"insert"},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"numgwid",fieldLabel:"<font color=red>网关编号</font>",allowBlank:false,blankText:"网关编号不允许为空,且只能输入数字",regex:WXTL.Common.regex.Integer,regexText:"网关编号不允许为空,且只能输入数字",maxLength:10},{xtype:"textfield",name:"vc2gatewayname",fieldLabel:"<font color=red>网关名称</font>",allowBlank:false,blankText:"网关名称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50},{xtype:"textfield",name:"vc2spnum",fieldLabel:"<font color=red>服务号码</font>",allowBlank:false,blankText:"服务号码不允许为空",regex:/^\d+$/,regexText:"长号码必须为20个以内的数字",maxLength:20},{xtype:"textfield",name:"vc2gwip",fieldLabel:"<font color=red>网关地址IP</font>",allowBlank:false,blankText:"网关地址IP不允许为空",regex:WXTL.Common.regex.IP,regexText:'网关地址IP格式不正确',maxLength:50},{xtype:"textfield",name:"vc2moip",fieldLabel:"<font color=red>网关MOIP</font>",allowBlank:false,blankText:"网关MOIP不允许为空",regex:WXTL.Common.regex.IP,regexText:'网关MOIP格式不正确',maxLength:50},{xtype:"textfield",name:"vc2gwusername",fieldLabel:"<font color=red>登录用户</font>",allowBlank:false,blankText:"登录用户不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50},{xtype:"textfield",name:"vc2spid",fieldLabel:"<font color=red>企业编码</font>",allowBlank:false,blankText:"企业编码不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50},{xtype:"textfield",name:"vc2speed",fieldLabel:"<font color=red>流速控制</font>",allowBlank:false,blankText:"流速控制不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"combo",name:"vc2type",fieldLabel:"<font color=red>网关类型</font>",hiddenName:"vc2type",allowBlank:false,blankText:"网关类型不允许为空",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:"1",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["短信","1"],["彩信","2"],["WAP","3"],["短信PV","4"],["彩信PV","5"],["wapPV","6"]]})},{xtype:"combo",name:"numopid",fieldLabel:"<font color=red>运营商</font>",hiddenName:"numopid",allowBlank:false,blankText:"运营商不允许为空",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numopid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.OperatorStore},{xtype:"combo",name:"numinstid",fieldLabel:"<font color=red>网关地区</font>",hiddenName:"numinstid",allowBlank:false,blankText:"网关地区不允许为空",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numinstid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.InstStore},{xtype:"textfield",name:"vc2gwport",fieldLabel:"<font color=red>网关端口</font>",allowBlank:false,blankText:"网关端口不允许为空",maxLength:50},{xtype:"textfield",name:"vc2moport",fieldLabel:"<font color=red>网关MO端口</font>",allowBlank:false,blankText:"网关MO端口不允许为空",maxLength:50},{xtype:"textfield",name:"vc2gwpassword",fieldLabel:"<font color=red>登录密码</font>",inputType:'password',allowBlank:false,blankText:"登录密码不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50},{id:"Js.Center.Business.GatewayAdd.PactType",xtype:"combo",name:"numgwtypeid",fieldLabel:"<font color=red>协议类型</font>",hiddenName:"numgwtypeid",allowBlank:false,blankText:"协议类型不允许为空",readOnly:true,mode:"local",displayField:"vc2gwtypename",valueField:"numgwtypeid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.GatewayTypeStore,listeners:{"select":function(){if(this.getValue()=="1"||this.getValue()=="2"||this.getValue()=="3"||this.getValue()=="4"){Ext.getCmp("Js.Center.Business.GatewayAdd.GroupMemberMax").maxValue=1}else{Ext.getCmp("Js.Center.Business.GatewayAdd.GroupMemberMax").maxValue=1000}}}},{xtype:"numberfield",name:"numgroupmembermax",id:"Js.Center.Business.GatewayAdd.GroupMemberMax",fieldLabel:"<font color=red>批次手机号码数量</font>",allowBlank:false,blankText:"批次手机号码数量",minValue:1,maxValue:1000}]}]}]});var mainForm=AddgatewayInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加网关",mainForm:mainForm,updateURL:Js.Center.Business.GatewayUpdateURL,displayStore:Js.Center.Business.Gateway.Infostore,items:[AddgatewayInfofp],needLoadDataStore:true,loadDataStoreFunc:function(){},needButtons:false,buttons:[new Ext.Button({text:'确定',minWidth:70,handler:function(){if(Js.Center.Business.GatewayAdd.window.mainForm.isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.Business.GatewayAdd.window.mainForm.submit({url:Js.Center.Business.GatewayAdd.window.updateURL,method:"POST",success:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);var falg=objJson.success;if(falg==true){Ext.Msg.alert("温馨提示","操作成功了!");Js.Center.Business.GatewayAdd.window.hide();Js.Center.Business.GatewayAdd.window.displayStore.reload()}else Ext.Msg.alert('温馨提示',objJson.info)},failure:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);Ext.Msg.alert('温馨提示',objJson.info)}})}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){Js.Center.Business.GatewayAdd.window.mainForm.reset()}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){Js.Center.Business.GatewayAdd.window.hide()}})]})}};Ext.namespace('Js.Center.Business.GatewayDelete');Js.Center.Business.GatewayDelete.func=function(row){var deleteSplit="";for(var i=0;i<row.length;i++){if(row.length==1){deleteSplit=row[i].data.numgwid}else{if(i<(row.length-1)){deleteSplit=row[i].data.numgwid+","+deleteSplit}if(i==(row.length-1)){deleteSplit=deleteSplit+row[i].data.numgwid}}};var params={ids:deleteSplit,flag:"delete"};doAjax(Js.Center.Business.GatewayUpdateURL,params,Js.Center.Business.Gateway.Infostore)};Ext.namespace('Js.Center.Business.Gateway');Js.Center.Business.Gateway.gatewayinfo=function(node){Js.Center.Common.GatewayTypeStore.reload();if(Ext.get("Js.Center.Business.Gateway.gatewaypanel")==null){Js.Center.Common.OperatorStore.reload();Js.Center.Common.InstStore.reload();var gwtypestore=new Ext.data.SimpleStore({fields:["vc2name","value"],data:[["短信","1"],["彩信","2"],["WAP","3"],["短信PV","4"],["彩信PV","5"],["wapPV","6"]]});gatewaySet=function(rowIndex){var row=Js.Center.Business.Gateway.Infostore.getAt(rowIndex);Js.Center.Business.GatewaySet.func(row)};var _pageSize=12;var fields=["numgwid","vc2gatewayname","vc2type","numopid","vc2opname","vc2gwip","vc2gwport","vc2moip","vc2moport","vc2spid","vc2spnum","vc2gwusername","vc2gwpassword","numgroupmembermax","vc2speed","numgwtypeid","vc2gwtypename","numinstid","vc2instname"];Js.Center.Business.Gateway.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.GatewayURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numgwid",totalProperty:"totalCount"}),sortInfo:{field:'numinstid',direction:'DESC'},baseParams:{gatewayname:'',numopid:'',flag:'selectbykey'}});Js.Center.Business.Gateway.Infostore.load({params:{start:0,limit:_pageSize,gatewayname:'',numopid:'',flag:'selectbykey'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numgwid"});var cm=new Ext.grid.ColumnModel([sm,{header:"网关编号",tooltip:"网关编号",dataIndex:"numgwid",sortable:true},{header:"网关名称",tooltip:"网关名称",dataIndex:"vc2gatewayname",sortable:true},{header:"运营商",tooltip:"运营商",dataIndex:"vc2opname",sortable:true},{header:"网关地区",tooltip:"网关地区",dataIndex:"vc2instname",sortable:true},{header:"服务号码",tooltip:"服务号码",dataIndex:"vc2spnum",sortable:true},{header:"网关类型",tooltip:"网关类型",dataIndex:"vc2type",sortable:true,renderer:function(value){if(value==1){return"短信"}if(value==2){return"彩信"}if(value==3){return"WAP"}if(value==4){return"短信PV"}if(value==5){return"彩信PV"}else if(value==6){return"wapPV"}}},{header:"协议类型",tooltip:"协议类型",dataIndex:"vc2gwtypename",sortable:true},{header:"网关地址IP",tooltip:"网关地址IP",dataIndex:"vc2gwip",sortable:true},{header:"网关端口",tooltip:"网关端口",dataIndex:"vc2gwport"},{header:"网关MO地址",tooltip:"网关MO地址",dataIndex:"vc2moip"},{header:"MO端口",tooltip:"MO端口",dataIndex:"vc2moport"},{header:"登录用户",tooltip:"登录用户",dataIndex:"vc2gwusername"},{header:"登录密码",tooltip:"登录密码",dataIndex:"vc2gwpassword"},{header:"批次手机号码数量",tooltip:"批次手机号码数量",dataIndex:"numgroupmembermax"},{header:"流速控制",tooltip:"流速控制",dataIndex:"vc2speed"},{header:"操作",tooltip:"操作",dataIndex:"filename",renderer:function(value,meta,record,rowIndex,colIndex,store){return"<a href='#' onclick='gatewaySet("+rowIndex+")'>配置</a>"}}]);var gatewayGrid=new WXTL.Widgets.CommonGrid.GridPanel({id:"gatewayGridPanel",anchor:'100% 100%',pageSize:_pageSize,store:Js.Center.Business.Gateway.Infostore,afterEditURL:Js.Center.Business.GatewayUpdateURL,inertMethod:'Js.Center.Business.GatewayAdd',updateMethod:'Js.Center.Business.GatewayUpdate',deleteMethod:'Js.Center.Business.GatewayDelete.func',sm:sm,cm:cm});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"gatewaySelectPanel",queryMethod:"Js.Center.Business.Gateway.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"xComboBox",name:"vc2name",fieldLabel:"运营商",hiddenName:"gatawayinfonumopid",readOnly:true,mode:"local",displayField:'vc2name',valueField:'numopid',triggerAction:"all",emptyText:'-=请选择=-',store:Js.Center.Common.OperatorStore}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2gatewayname",id:"gatewayinfogwname",fieldLabel:"网关名称",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50}]}]}]});Js.Center.Business.Gateway.queryGrid=function(){if(selectPanel.getForm().isValid()){var _gatewayname=Ext.get("gatewayinfogwname").getValue();var _operatorid=Ext.get("gatawayinfonumopid").getValue();var flag='selectbykey';Js.Center.Business.Gateway.Infostore.baseParams={gatewayname:_gatewayname,numopid:_operatorid,flag:flag};Js.Center.Business.Gateway.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.Business.Gateway.GatewayPanel=new Ext.Panel({frame:true,id:"Js.Center.Business.Gateway.gatewaypanel",bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,gatewayGrid]})};GridMain(node,Js.Center.Business.Gateway.GatewayPanel,"openroomiconinfo","Js.Center.Business.Gateway.Infostore")};Ext.namespace('Js.Center.Business.GatewaySet');Js.Center.Business.GatewaySet.func=function(row){var configData=doSynRequest(Js.Center.Business.GatewayURL+"?flag=getgatewayconfigitembytype&numgwid="+row.data.numgwid+"&typeid="+row.data.numgwtypeid);var updateGatewaymfp=new Ext.form.FormPanel({frame:true,labelWidth:150,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"hidden",name:"flag",value:'updateset'},{xtype:"hidden",name:"numgwtypeid",value:row.data.numgwtypeid},{xtype:"hidden",name:"vc2gwid",value:row.data.numgwid}]});WXTL.Common.generateConfigFormItem(configData,updateGatewaymfp);var mainForm=updateGatewaymfp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"网关配置",mainForm:mainForm,updateURL:Js.Center.Business.GatewayUpdateURL,displayStore:Js.Center.Business.Gateway.Infostore,updateState:true,updateRecord:row,autoScroll:true,items:[updateGatewaymfp]});if(configData.data.length>12){this.window.setHeight(400)};Js.Center.Business.GatewaySet.window.show()};Ext.namespace('Js.Center.Business.GatewayUpdate');Js.Center.Business.GatewayUpdate.func=function(row){var updateGatewaymfp=new Ext.form.FormPanel({frame:true,labelWidth:80,items:[{layout:'column',items:[{xtype:"hidden",name:"flag",value:'updateall'},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"numgwid",fieldLabel:"<font color=red>网关编号</font>",allowBlank:false,readOnly:true,blankText:"网关编号不允许为空",regex:WXTL.Common.regex.Integer,regexText:"网关编号不允许为空,且只能输入数字",maxLength:10},{xtype:"textfield",name:"vc2gatewayname",fieldLabel:"<font color=red>网关名称</font>",allowBlank:false,blankText:"网关名称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50},{xtype:"textfield",name:"vc2spnum",fieldLabel:"<font color=red>服务号码</font>",allowBlank:false,blankText:"服务号码不允许为空",regex:/^\d+$/,regexText:"长号码必须为20个以内的数字",maxLength:20},{xtype:"textfield",name:"vc2gwip",fieldLabel:"<font color=red>网关地址IP</font>",allowBlank:false,blankText:"网关地址IP不允许为空",regex:WXTL.Common.regex.IP,regexText:'网关地址IP格式不正确',maxLength:50},{xtype:"textfield",name:"vc2moip",fieldLabel:"<font color=red>网关MOIP</font>",allowBlank:false,blankText:"网关MOIP不允许为空",regex:WXTL.Common.regex.IP,regexText:'网关MOIP格式不正确',maxLength:50},{xtype:"textfield",name:"vc2gwusername",fieldLabel:"<font color=red>登录用户</font>",allowBlank:false,blankText:"登录用户不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50},{xtype:"textfield",name:"vc2spid",fieldLabel:"<font color=red>企业编码</font>",allowBlank:false,blankText:"企业编码不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50},{xtype:"textfield",name:"vc2speed",fieldLabel:"<font color=red>流速控制</font>",allowBlank:false,blankText:"流速控制不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"combo",name:"vc2type",fieldLabel:"<font color=red>网关类型</font>",hiddenName:"vc2type",allowBlank:false,blankText:"网关类型不允许为空",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:"1",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["短信","1"],["彩信","2"],["WAP","3"],["短信PV","4"],["彩信PV","5"],["wapPV","6"]]})},{xtype:"combo",name:"numopid",fieldLabel:"<font color=red>运营商</font>",hiddenName:"numopid",allowBlank:false,blankText:"运营商不允许为空",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numopid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.OperatorStore},{xtype:"combo",name:"numinstid",fieldLabel:"<font color=red>网关地区</font>",hiddenName:"numinstid",allowBlank:false,blankText:"网关地区不允许为空",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numinstid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.InstStore},{xtype:"textfield",name:"vc2gwport",fieldLabel:"<font color=red>网关端口</font>",allowBlank:false,blankText:"网关端口不允许为空",maxLength:50},{xtype:"textfield",name:"vc2moport",fieldLabel:"<font color=red>网关MO端口</font>",allowBlank:false,blankText:"网关MO端口不允许为空",maxLength:50},{xtype:"textfield",name:"vc2gwpassword",fieldLabel:"<font color=red>登录密码</font>",inputType:'password',allowBlank:false,blankText:"登录密码不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50},{id:"Js.Center.Business.GatewayUpdate.PactType",xtype:"combo",name:"numgwtypeid",fieldLabel:"<font color=red>协议类型</font>",hiddenName:"numgwtypeid",allowBlank:false,blankText:"协议类型不允许为空",readOnly:true,mode:"local",displayField:"vc2gwtypename",valueField:"numgwtypeid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.GatewayTypeStore,listeners:{"select":function(){if(this.getValue()=="1"||this.getValue()=="2"||this.getValue()=="3"||this.getValue()=="4"){Ext.getCmp("Js.Center.Business.GatewayUpdate.GroupMemberMax").maxValue=1}else{Ext.getCmp("Js.Center.Business.GatewayUpdate.GroupMemberMax").maxValue=1000}}}},{xtype:"numberfield",name:"numgroupmembermax",id:"Js.Center.Business.GatewayUpdate.GroupMemberMax",fieldLabel:"<font color=red>批次手机号码数量</font>",allowBlank:false,blankText:"批次手机号码数量",minValue:1,maxValue:1}]}]}]});var mainForm=updateGatewaymfp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"修改网关",mainForm:mainForm,updateURL:Js.Center.Business.GatewayUpdateURL,displayStore:Js.Center.Business.Gateway.Infostore,updateState:true,updateRecord:row,items:[updateGatewaymfp],needLoadDataStore:true,loadDataStoreFunc:function(){var groupMemberMax=Js.Center.Business.GatewayUpdate.window.updateRecord.get("numgwtypeid");if(groupMemberMax=="1"||groupMemberMax=="2"||groupMemberMax=="3"||groupMemberMax=="4"){Ext.getCmp("Js.Center.Business.GatewayUpdate.GroupMemberMax").maxValue=1}else{Ext.getCmp("Js.Center.Business.GatewayUpdate.GroupMemberMax").maxValue=1000}},needButtons:false,buttons:[new Ext.Button({text:'确定',minWidth:70,handler:function(){if(Js.Center.Business.GatewayUpdate.window.mainForm.isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.Business.GatewayUpdate.window.mainFormSubmitFunc()}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){Js.Center.Business.GatewayUpdate.window.mainForm.reset();if(Js.Center.Business.GatewayUpdate.window.updateState&&Js.Center.Business.GatewayUpdate.window.updateRecord!=null){Js.Center.Business.GatewayUpdate.window.mainForm.loadRecord(Js.Center.Business.GatewayUpdate.window.updateRecord)}var groupMemberMax=Js.Center.Business.GatewayUpdate.window.updateRecord.get("numgwtypeid");if(groupMemberMax=="1"||groupMemberMax=="2"||groupMemberMax=="3"||groupMemberMax=="4"){Ext.getCmp("Js.Center.Business.GatewayUpdate.GroupMemberMax").maxValue=1}else{Ext.getCmp("Js.Center.Business.GatewayUpdate.GroupMemberMax").maxValue=1000}}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){if(Js.Center.Business.GatewayUpdate.window.closeAction=='close'){Js.Center.Business.GatewayUpdate.window.close()}else{Js.Center.Business.GatewayUpdate.window.hide()}}})]});};Ext.namespace('Js.Center.Business');Js.Center.Business.GetinstURL='URL/business/inst/instquery.ashx';Js.Center.Business.GetOperatorURL='URL/business/operator/operatorquery.ashx';Js.Center.Business.GatewayURL='URL/system/gateway/gatewayquery.ashx';Js.Center.Business.GatewayUpdateURL='URL/system/gateway/gatewayupdate.ashx';