Ext.namespace('Js.Center.System.DirtyWordAdd');Ext.QuickTips.init();Js.Center.System.DirtyWordAdd.func=function(){var addDirtyWordInfofp=new Ext.form.FormPanel({id:"addDirtyWordInfofp",frame:true,labelWidth:80,items:[{layout:'column',items:[{xtype:"hidden",name:"flag",value:"insert"},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2dirtyword",fieldLabel:"<font color=red>内容</font>",allowBlank:false,blankText:"内容不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:25,maxLengthText:'长度不能超过25！'},new Ext.form.DateField({fieldLabel:'有效时间',name:'dateffectend',readOnly:true,showToday:true,clearDate:true,format:'Y-m-d',validateOnBlur:false,minValue:WXTL.Common.dateTime.getNow(),minText:"有效时间小于今天"})]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"combo",name:"numdirtytype",fieldLabel:"<font color=red>分类</font>",hiddenName:"numdirtytype",allowBlank:false,blankText:"分类不允许为空",readOnly:true,mode:"local",emptyText:"请选择",displayField:"vc2name",valueField:"numdirtytype",triggerAction:"all",store:Js.Center.System.DirtyWord.DirtywordTypeStore}]}]}]});var mainForm=addDirtyWordInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加非法词",mainForm:mainForm,updateURL:Js.Center.System.DirtyWordUpdateURL,displayStore:Js.Center.System.DirtyWord.Infostore,items:[addDirtyWordInfofp]})};Ext.namespace('Js.Center.System.DirtyWordDelete');Js.Center.System.DirtyWordDelete.func=function(row){var deleteSplit="";for(var i=0;i<row.length;i++){if(row.length==1){deleteSplit=row[i].data.numdirtywordid}else{if(i<(row.length-1)){deleteSplit=row[i].data.numdirtywordid+","+deleteSplit}if(i==(row.length-1)){deleteSplit=deleteSplit+row[i].data.numdirtywordid}}};var params={ids:deleteSplit,flag:"delete"};doAjax(Js.Center.System.DirtyWordUpdateURL,params,Js.Center.System.DirtyWord.Infostore)};Ext.namespace('Js.Center.System.DirtyWordImport');Ext.QuickTips.init();Js.Center.System.DirtyWordImport.func=function(){if(Js.Center.System.DirtyWordImport.window==null){var ImportDirtyWordInfofp=new Ext.form.FormPanel({fileUpload:true,frame:true,labelWidth:80,layout:'form',defaults:{anchor:"90%",msgTarget:"side"},items:[{xtype:"hidden",name:"flag",value:"import"},new Ext.form.DateField({fieldLabel:'有效时间',width:300,buttonAlign:"center",name:'dateffectend',readOnly:true,showToday:true,clearDate:true,format:'Y-m-d',validateOnBlur:false,minValue:WXTL.Common.dateTime.getNow(),minText:"有效时间小于今天"}),{xtype:"combo",width:300,fieldLabel:"<font color=red>分类</font>",hiddenName:"numdirtytype",allowBlank:false,blankText:"分类不允许为空",readOnly:true,mode:"local",emptyText:"请选择",displayField:"vc2name",valueField:"numdirtytype",triggerAction:"all",store:Js.Center.System.DirtyWord.DirtywordTypeStore},{xtype:'fileuploadfield',name:'filepath',fieldLabel:getHelpMsg("文件",true,'1、文件格式为txt<br>2、文件大小须小于2M<br>3、行数必须不超过1000行<br>4、内容格式:关键字（换行）。<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;例如：脏字<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;法轮功<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;藏独<br />'),allowBlank:false,blankText:"请选择上传文件",validator:function(){var filePath=this.getValue();if(filePath!=''){ImportDirtyWordInfofp.getForm().items.items[4].el.dom.value=getFileMessage(filePath);if(checkFile(filePath)!=''){this.invalidText=checkFile(filePath);return false}else{return true}}else return false}},{xtype:'textarea',name:'filemessage',fieldLabel:'文件信息',readOnly:true,width:500,height:180}]});var mainForm=ImportDirtyWordInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"导入非法词",mainForm:mainForm,updateURL:Js.Center.System.DirtyWordUpdateURL,displayStore:Js.Center.System.DirtyWord.Infostore,items:[ImportDirtyWordInfofp],needButtons:false,buttons:[new Ext.Button({text:'确定',minWidth:70,qtip:"确定",handler:function(){if(mainForm.isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);mainForm.submit({url:Js.Center.System.DirtyWordUpdateURL,method:"POST",success:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);var falg=objJson.success;if(falg==true){Ext.Msg.alert("温馨提示","操作成功了!");Js.Center.System.DirtyWord.Infostore.reload();Js.Center.System.DirtyWordImport.window.hide()}else{Ext.Msg.alert('温馨提示',objJson.info);Js.Center.System.DirtyWord.Infostore.reload();Js.Center.System.DirtyWordImport.window.hide()}},failure:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);Ext.Msg.alert('温馨提示',objJson.info);Js.Center.System.DirtyWord.Infostore.reload();Js.Center.System.DirtyWordImport.window.hide()}})}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){mainForm.reset()}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){Js.Center.System.DirtyWordImport.window.hide()}})]});}};Ext.namespace('Js.Center.System.DirtyWord');Js.Center.System.DirtyWord.dirtyWordInfo=function(node){if(Ext.get("Js.Center.System.DirtyWord.DirtyWordPanel")==null){Js.Center.System.DirtyWord.DirtywordTypeStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:Js.Center.System.DirtyWordTypeQueryURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:['numdirtytype','vc2name'],root:"data",id:"numdirtytype"}),baseParams:{flag:'selectall',columnlist:'numdirtytype, vc2name'}});Js.Center.System.DirtyWord.DirtywordTypeStore.load();dirtyWordImport=function(){Js.Center.System.DirtyWordImport.window.show()};var _pageSize=12;var fields=["numdirtywordid","vc2dirtyword","numdirtytype","datcreatetime","numcreaterid","vc2username","vc2name","dateffectend"];Js.Center.System.DirtyWord.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.System.DirtyWordURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numdirtywordid",totalProperty:"totalCount"}),baseParams:{dirtywordname:'',datstart:'',datend:'',flag:'selectbykey'}});Js.Center.System.DirtyWord.Infostore.load({params:{start:0,limit:_pageSize,dirtywordname:'',datstart:'',datend:'',flag:'selectbykey'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numdirtywordid"});var cm=new Ext.grid.ColumnModel([sm,{header:"内容",tooltip:"内容",dataIndex:"vc2dirtyword",sortable:true},{header:"类型",tooltip:"类型",dataIndex:"vc2name",sortable:true},{header:"添加日期",tooltip:"添加日期",dataIndex:"datcreatetime",sortable:true},{header:"添加人",tooltip:"添加人",dataIndex:"vc2username",sortable:true},{header:"有效日期",tooltip:"有效日期",dataIndex:"dateffectend",sortable:true}]);var DirtyWordImportarrInitLoadFunc=new Array();DirtyWordImportarrInitLoadFunc[0]="Js.Center.System.DirtyWordImport.func";var dirtyWordGrid=new WXTL.Widgets.CommonGrid.GridPanel({id:"dirtywordGridPanel",anchor:'100% 100%',pageSize:_pageSize,needMenu:false,store:Js.Center.System.DirtyWord.Infostore,afterEditURL:Js.Center.System.DirtyWordUpdateURL,inertMethod:'Js.Center.System.DirtyWordAdd',updateMethod:'Js.Center.System.DirtyWordUpdate',deleteMethod:'Js.Center.System.DirtyWordDelete.func',otherInitLoadFunc:DirtyWordImportarrInitLoadFunc,sm:sm,cm:cm,tbar:new Ext.Toolbar({items:[{iconCls:'addicon',text:"添加",handler:function(){dirtyWordGrid.doInsert()}},"","-","",{text:"导入",iconCls:"importicon",handler:dirtyWordImport},"","-","",{text:"修改",iconCls:"editicon",handler:function(){dirtyWordGrid.doEdit()}},"","-","",{text:"删除",iconCls:"deleteicon",handler:function(){dirtyWordGrid.doDelete()}}]})});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({height:130,queryMethod:"Js.Center.System.DirtyWord.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[new Ext.form.DateField({fieldLabel:'开始时间',name:'datstart',id:'Js.Center.System.DirtyWord.DatStart',readOnly:true,format:'Y-m-d',validateOnBlur:false,showToday:true,clearDate:true,validator:function(){var strat_time=Ext.get("Js.Center.System.DirtyWord.DatStart").dom.value;var end_time=Ext.get("Js.Center.System.DirtyWord.DatEnd").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'}),new Ext.form.TextField({fieldLabel:'非法词名称',name:'vc2dirtyword',id:'Js.Center.System.DirtyWord.dwinfovc2dirtyword',regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:25})]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[new Ext.form.DateField({fieldLabel:'结束时间',name:'datend',id:'Js.Center.System.DirtyWord.DatEnd',readOnly:true,format:'Y-m-d',validateOnBlur:true,showToday:true,clearDate:true,validator:function(){var strat_time=Ext.get("Js.Center.System.DirtyWord.DatStart").dom.value;var end_time=Ext.get("Js.Center.System.DirtyWord.DatEnd").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'})]}]}]});Js.Center.System.DirtyWord.queryGrid=function(){if(selectPanel.getForm().isValid()){var _dirtywordname=Ext.get("Js.Center.System.DirtyWord.dwinfovc2dirtyword").getValue();var flag='selectbykey';Js.Center.System.DirtyWord.Infostore.baseParams={dirtywordname:_dirtywordname,flag:flag,datstart:Ext.get("Js.Center.System.DirtyWord.DatStart").dom.value,datend:Ext.get("Js.Center.System.DirtyWord.DatEnd").dom.value};Js.Center.System.DirtyWord.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.System.DirtyWord.DirtyWordPanel=new Ext.Panel({frame:true,id:"Js.Center.System.DirtyWord.DirtyWordPanel",bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,dirtyWordGrid]})};GridMain(node,Js.Center.System.DirtyWord.DirtyWordPanel,"openroomiconinfo","Js.Center.System.DirtyWord.Infostore")};Ext.namespace('Js.Center.System.DirtyWordUpdate');Js.Center.System.DirtyWordUpdate.func=function(row){var updateDirtywordmfp=new Ext.form.FormPanel({frame:true,labelWidth:80,items:[{layout:'column',items:[{xtype:"hidden",name:"flag",value:"updateall"},{xtype:"hidden",name:"numdirtywordid",fieldLabel:"关键字编号"},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2dirtyword",fieldLabel:"<font color=red>内容</font>",allowBlank:false,blankText:"内容不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:25,maxLengthText:'长度不能超过25！'}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"combo",name:"numdirtytype",fieldLabel:"<font color=red>分类</font>",hiddenName:"numdirtytype",allowBlank:false,blankText:"分类不允许为空",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numdirtytype",triggerAction:"all",value:"1",store:Js.Center.System.DirtyWord.DirtywordTypeStore}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},validateOnBlur:false,buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[new Ext.form.DateField({fieldLabel:'有效时间',name:'dateffectend',readOnly:true,showToday:true,clearDate:true,format:'Y-m-d',validateOnBlur:false,minValue:WXTL.Common.dateTime.getNow(),minText:"有效时间小于今天"})]}]}]});var mainForm=updateDirtywordmfp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"修改非法词",mainForm:mainForm,updateURL:Js.Center.System.DirtyWordUpdateURL,displayStore:Js.Center.System.DirtyWord.Infostore,updateState:true,updateRecord:row,items:[updateDirtywordmfp]})};Ext.namespace('Js.Center.System');Js.Center.System.DirtyWordURL='URL/system/dirtyword/dirtywordquerry.ashx';Js.Center.System.DirtyWordUpdateURL='URL/system/dirtyword/dirtyWordUpdate.ashx';