Ext.namespace('Js.Center.SendSMS.DepartMoQuery');Js.Center.SendSMS.DepartMoQuery.departmoinfo=function(node){if(Ext.get("Js.Center.SendSMS.DepartMoQuery.DepartMoInfoPanel")==null){var _pageSize=12;var fields=["numseqid","vc2srcmobile","vc2content","vc2svc","vc2departname","datrecv","vc2username","vc2spnum","vc2gatewayname"];Js.Center.SendSMS.DepartMoQuery.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.SendSMS.MOqueryURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numseqid",totalProperty:"totalCount"}),baseParams:{datstart:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),datend:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),vc2Content:'',numsvcid:'',vc2mobile:'',flag:'selectbykey'}});Js.Center.SendSMS.DepartMoQuery.Infostore.load({params:{start:0,limit:_pageSize,datstart:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),datend:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),vc2Content:'',numsvcid:'',vc2mobile:'',flag:'selectbykey'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numcustomerid"});var cm=new Ext.grid.ColumnModel([{header:"手机号码",tooltip:"手机号码",dataIndex:"vc2srcmobile",sortable:true},{header:"短信内容",tooltip:"短信内容",dataIndex:"vc2content",sortable:true,width:200,renderer:function(value){return"<font qtip='"+value+"'>"+value+"</font>"},readOnly:true,editor:new Ext.form.TextField({readOnly:true})},{header:"服务号码",tooltip:"服务号码",dataIndex:"vc2spnum",sortable:true},{header:"网关名称",tooltip:"网关名称",dataIndex:"vc2gatewayname",sortable:true},{header:"收到时间",tooltip:"收到时间",dataIndex:"datrecv",sortable:true}]);var departMoInfoGrid=new WXTL.Widgets.CommonGrid.GridPanel({anchor:'100% 100%',pageSize:_pageSize,needMenu:false,store:Js.Center.SendSMS.DepartMoQuery.Infostore,sm:sm,cm:cm,needRightMenu:false});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({height:170,queryMethod:"Js.Center.SendSMS.DepartMoQuery.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[new Ext.form.DateField({fieldLabel:'开始时间',name:'datstart',id:'Js.Center.SendSMS.DepartMoQuery.DatStart',emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),format:'Y-m-d',readOnly:true,validateOnBlur:false,validator:function(){var strat_time=Ext.get("Js.Center.SendSMS.DepartMoQuery.DatStart").dom.value;var end_time=Ext.get("Js.Center.SendSMS.DepartMoQuery.DatEnd").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'}),{xtype:"textfield",name:"vc2content",id:'Js.Center.SendSMS.DepartMoQuery.SMSContent',fieldLabel:"短信内容",maxLength:50,regex:WXTL.Common.regex.IllegalDiy,regexText:WXTL.Common.regexText.IllegalText},{xtype:"textfield",name:"vc2mobile",id:"Js.Center.SendSMS.DepartMoQuery.SMSSendMobile",fieldLabel:"手机号码",regex:WXTL.Common.regex.Mobile,regexText:"手机号码格式不正确"}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[new Ext.form.DateField({fieldLabel:'结束时间',name:'datend',id:'Js.Center.SendSMS.DepartMoQuery.DatEnd',emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),format:'Y-m-d',readOnly:true,validateOnBlur:false,validator:function(){var strat_time=Ext.get("Js.Center.SendSMS.DepartMoQuery.DatStart").dom.value;var end_time=Ext.get("Js.Center.SendSMS.DepartMoQuery.DatEnd").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'}),{xtype:"textfield",name:"vc2svc",id:"Js.Center.SendSMS.DepartMoQuery.SMSSendSvc",fieldLabel:"服务号码",regex:/^\d{1,20}$/,regexText:"只能输入长度20位以内的数字"}]}]}]});Js.Center.SendSMS.DepartMoQuery.queryGrid=function(){if(selectPanel.getForm().isValid()){var datStart=Ext.get("Js.Center.SendSMS.DepartMoQuery.DatStart").getValue();var datEnd=Ext.get("Js.Center.SendSMS.DepartMoQuery.DatEnd").getValue();var vc2Content=Ext.get("Js.Center.SendSMS.DepartMoQuery.SMSContent").getValue();var vc2serviceid=Ext.get("Js.Center.SendSMS.DepartMoQuery.SMSSendSvc").getValue();var vc2Mobile=Ext.get("Js.Center.SendSMS.DepartMoQuery.SMSSendMobile").getValue();var flag='selectbykey';Js.Center.SendSMS.DepartMoQuery.Infostore.baseParams={datstart:datStart,datend:datEnd,vc2Content:vc2Content,numsvcid:vc2serviceid,vc2mobile:vc2Mobile,flag:flag};Js.Center.SendSMS.DepartMoQuery.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.SendSMS.DepartMoQuery.BlackAdd=function(vc2Mobile){Ext.Msg.confirm("提示!","您确定要将此号码加入黑名单吗?",function(btn){if(btn=="yes"){doSynRequest(Js.Center.Business.BlackUpdateURL+"?whitelistaddnumsvcid=1&flag=insertbylist&mobilelist="+vc2Mobile);}else{}})};Js.Center.SendSMS.DepartMoQuery.DepartMoInfoPanel=new Ext.Panel({frame:true,id:"Js.Center.SendSMS.DepartMoQuery.DepartMoInfoPanel",bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,departMoInfoGrid]})};GridMain(node,Js.Center.SendSMS.DepartMoQuery.DepartMoInfoPanel,"openroomiconinfo","Js.Center.SendSMS.DepartMoQuery.Infostore")};Ext.namespace('Js.Center.SendSMS');Js.Center.SendSMS.MOqueryURL='URL/sendSMS/MOQuery/MOQuery.ashx';