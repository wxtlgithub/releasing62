Ext.namespace('Js.Center.Business');Js.Center.Business.UserGroupURL='URL/Customer/UserGroup/UserGroupQuery.ashx';Js.Center.Business.UserGroupUpdateURL='URL/Customer/UserGroup/UserGroupUpdate.ashx';Ext.namespace('Js.Center.Business');Js.Center.Business.UserGroupMemberURL='URL/Customer/UserGroupMember/UserGroupMemberQuery.ashx';Js.Center.Business.UserGroupMemberUpdateURL='URL/Customer/UserGroupMember/UserGroupMemberUpdate.ashx';Ext.namespace('Js.Center.Business.UserGroupAdd');Ext.QuickTips.init();Js.Center.Business.UserGroupAdd.func=function(){var updateInfofp=new Ext.form.FormPanel({frame:true,labelWidth:80,defaults:{anchor:'90%',msgTarget:'side'},items:[{xtype:"hidden",name:"flag",value:"insert"},{xtype:"textfield",name:"vc2usergroupname",fieldLabel:"<font color=red>客户组名称</font>",allowBlank:false,blankText:"客户组名称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:15,maxLengthText:'长度不能超过15'},{xtype:"hidden",name:"numprodid",value:1},{xtype:"textarea",name:"vc2usergroupdesc",fieldLabel:"备注",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,height:100,maxLength:100}]});var mainForm=updateInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加客户组",mainForm:mainForm,updateURL:Js.Center.Business.UserGroupUpdateURL,displayStore:Js.Center.Business.UserGroup.Infostore,items:[updateInfofp]});};Ext.namespace('Js.Center.Business.UserGroupDelete');Js.Center.Business.UserGroupDelete.func=function(row){var deleteSplit="";for(var i=0;i<row.length;i++){if(row.length==1){deleteSplit=row[i].data.numusergroupid}else{if(i<(row.length-1)){deleteSplit=row[i].data.numusergroupid+","+deleteSplit}if(i==(row.length-1)){deleteSplit=deleteSplit+row[i].data.numusergroupid}}};var params={ids:deleteSplit,flag:"delete"};doAjax(Js.Center.Business.UserGroupUpdateURL,params,Js.Center.Business.UserGroup.Infostore)};Ext.namespace('Js.Center.Business.UserGroup');Js.Center.Business.UserGroup.userGroupInfo=function(node){if(Ext.get("Js.Center.Business.UserGroup.mainpanel")==null){var _pageSize=12;Js.Center.Common.ProductStoreByDepartment.reload();var fields=["numusergroupid","numprodid","vc2prodname","vc2usergroupname","vc2usergroupdesc","datcreattime","datmodifytime","numuserid","numdepartid","vc2departname","vc2username","membercount","blackcount","numtype"];Js.Center.Business.UserGroup.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.UserGroupURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numusergroupid",totalProperty:"totalCount"}),sortInfo:{field:'datcreattime',direction:'DESC'},baseParams:{usergroupname:'',numdepartid:'',vc2username:'',flag:'selectownerusergroup'}});Js.Center.Business.UserGroup.Infostore.load({params:{start:0,limit:_pageSize,usergroupname:'',vc2username:'',numdepartid:'',flag:'selectownerusergroup'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numusergroupid"});var cm=new Ext.grid.ColumnModel([sm,{header:"客户组名称",tooltip:"客户组名称",dataIndex:"vc2usergroupname",sortable:true},{header:"成员数量",tooltip:"成员数量",dataIndex:"membercount",sortable:true},{header:"添加成员",tooltip:"添加成员",dataIndex:"numusergroupid",renderer:function(value,meta,record,rowIndex,colIndex,store){if(record.get('numtype')=='0')return"<a href='#' onclick='Js.Center.Business.UserGroup.addMember(\""+value+"\")'>添加</a>"}},{header:"退出成员",tooltip:"退出成员",dataIndex:"numusergroupid",renderer:function(value,meta,record,rowIndex,colIndex,store){if(record.get('numtype')=='0')return"<a href='#' onclick='Js.Center.Business.UserGroup.quitMember(\""+value+"\")'>退出</a>"}},{header:"操作记录",tooltip:"操作记录",dataIndex:"numusergroupid",renderer:function(value,meta,record,rowIndex,colIndex,store){if(record.get('numtype')=='0')return"<a href='#' onclick='Js.Center.Business.UserGroup.viewOperdetails(\""+value+"\")'>查看详情</a>"}},{header:"部门客户",tooltip:"部门客户",dataIndex:"numusergroupid",renderer:function(value,meta,record,rowIndex,colIndex,store){return"<a href='#' onclick='Js.Center.Business.UserGroup.viewCusdetails(\""+value+"\")'>客户明细</a>"}},{header:"创建时间",tooltip:"创建时间",dataIndex:"datcreattime",sortable:true},{header:"创建人",tooltip:"创建人",dataIndex:"vc2username",sortable:true},{header:"部门",tooltip:"部门",dataIndex:"vc2departname",sortable:true},{header:"备注",tooltip:"备注",dataIndex:"vc2usergroupdesc",sortable:true}]);var usergroup_arrInitLoadFunc=new Array();usergroup_arrInitLoadFunc[0]="Js.Center.Business.UserGroupMemberAdd.func";usergroup_arrInitLoadFunc[1]="Js.Center.Business.UserGroupMemberDelete.func";usergroup_arrInitLoadFunc[2]="Js.Center.Business.UserGroupMemberOperatorDetails.func";usergroup_arrInitLoadFunc[3]="Js.Center.Business.UserGroupMemberCusDetails.func";var userGroupGrid=new WXTL.Widgets.CommonGrid.GridPanel({id:"Js.Center.Business.UserGroup.usergroupGridPanel",anchor:'100% 100%',needMenu:false,needRightMenu:false,pageSize:_pageSize,store:Js.Center.Business.UserGroup.Infostore,afterEditURL:Js.Center.Business.UserGroupUpdateURL,inertMethod:'Js.Center.Business.UserGroupAdd',updateMethod:'Js.Center.Business.UserGroupUpdate',deleteMethod:'Js.Center.Business.UserGroupDelete.func',otherInitLoadFunc:usergroup_arrInitLoadFunc,sm:sm,cm:cm,tbar:new Ext.Toolbar({items:[{iconCls:'addicon',text:"添加",handler:function(){userGroupGrid.doInsert()}},"","-","",{iconCls:'editicon',text:"修改",handler:function(){userGroupGrid.doEdit()}},"","-","",{iconCls:'deleteicon',text:"删除",handler:function(){var row=userGroupGrid.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("温馨提示","请您选择记录!")}else{Ext.Msg.confirm("温馨提示!","删除客户组的同时，将删除其所有的客户组成员，您确认要删除么？",function(btn){if(btn=="yes"){Js.Center.Business.UserGroupDelete.func(row)}})}}}]})});var departComboxTree=new WXTL.Widgets.CommonForm.ComboWithTree({name:'numdepartid',hiddenName:'numdepartid',id:'Js.Center.Business.UserGroup.departComboxTree',fieldLabel:"部门名称",valueField:'id',treeRootVisible:true,listHeight:'150',baseParams:{columnlist:"numdepartid,vc2departname",flag:'selectallbycurrentuser'},dataUrl:Js.Center.Popedom.DepartmentsQueryURL});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"usergroupSelectPanel",height:150,queryMethod:"Js.Center.Business.UserGroup.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},items:[departComboxTree,new Ext.form.TextField({fieldLabel:'客户组名称',name:'usergroupname',id:'Js.Center.Business.UserGroup.UserGroupName',regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:15,maxLengthText:'长度不能超过15'})]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},items:[{xtype:"textfield",name:"vc2username",id:"Js.Center.Business.UserGroup.UserGroupCreateName",fieldLabel:"创建人",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:15,maxLengthText:'长度不能超过15'}]}]}]});Js.Center.Business.UserGroup.queryGrid=function(){if(selectPanel.getForm().isValid()){var userGroupName=Ext.get("Js.Center.Business.UserGroup.UserGroupName").getValue();var flag='selectownerusergroup';var numDepartId=departComboxTree.getValue()==null?"":departComboxTree.getValue().replace("s","");var vc2UserName=Ext.get("Js.Center.Business.UserGroup.UserGroupCreateName").getValue();Js.Center.Business.UserGroup.Infostore.baseParams={usergroupname:userGroupName,flag:flag,numdepartid:numDepartId,vc2username:vc2UserName};Js.Center.Business.UserGroup.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.Business.UserGroup.MainPanel=new Ext.Panel({id:"Js.Center.Business.UserGroup.mainpanel",frame:true,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,userGroupGrid]});};GridMain(node,Js.Center.Business.UserGroup.MainPanel,"openroomiconinfo","Js.Center.Business.UserGroup.Infostore");Js.Center.Business.UserGroup.addMember=function(ID){var row=userGroupGrid.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("温馨提示","请您选择一条记录!")}else if(row.length>1){Ext.Msg.alert("温馨提示","对不起，您只能选择一条记录!")}else if(row.length==1){Js.Center.Business.UserGroupMemberAdd.window.updateRecord=row[0];Js.Center.Business.UserGroupMemberAdd.window.mainForm.loadRecord(row[0]);Js.Center.Business.UserGroupMemberAdd.window.show()}};Js.Center.Business.UserGroup.quitMember=function(ID){var row=userGroupGrid.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("温馨提示","请您选择一条记录!")}else if(row.length>1){Ext.Msg.alert("温馨提示","对不起，您只能选择一条记录!")}else if(row.length==1){Js.Center.Business.UserGroupMemberDelete.window.updateRecord=row[0];Js.Center.Business.UserGroupMemberDelete.window.mainForm.loadRecord(row[0]);Js.Center.Business.UserGroupMemberDelete.window.show()}};Js.Center.Business.UserGroup.viewOperdetails=function(ID){var row=userGroupGrid.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("温馨提示","请您选择一条记录!")}else if(row.length>1){Ext.Msg.alert("温馨提示","对不起，您只能选择一条记录!")}else if(row.length==1){Js.Center.Business.UserGroupMemberOperatorDetails.window.updateRecord=row[0];Js.Center.Business.UserGroupMemberOperatorDetails.window.mainForm.loadRecord(row[0]);Js.Center.Business.UserGroupMemberOperatorDetails.window.show()}};Js.Center.Business.UserGroup.viewCusdetails=function(ID){var row=userGroupGrid.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("温馨提示","请您选择一条记录!")}else if(row.length>1){Ext.Msg.alert("温馨提示","对不起，您只能选择一条记录!")}else if(row.length==1){Js.Center.Business.UserGroupMemberCusDetails.window.updateRecord=row[0];Js.Center.Business.UserGroupMemberCusDetails.window.mainForm.loadRecord(row[0]);Js.Center.Business.UserGroupMemberCusDetails.window.show()}}};Ext.namespace('Js.Center.Business.UserGroupMemberAdd');Ext.QuickTips.init();Js.Center.Business.UserGroupMemberAdd.func=function(row){if(Js.Center.Business.UserGroupMemberAdd.window==null){var mainForm;var uploadFilePanel=new WXTL.Widgets.CommonPanel.UploadLargeFilePanel({needLargfile:false,id:"Js.Center.Business.UserGroupMemberAdd.UploadLargeFile"});var addByFilePanel=new Ext.form.FormPanel({title:"文件方式",width:600,border:false,fileUpload:true,frame:true,labelWidth:80,defaults:{msgTarget:"side"},items:[{xtype:"hidden",name:"numusergroupid",fieldLabel:"客户组编号",readOnly:"true"},{xtype:"textfield",name:"vc2usergroupname",fieldLabel:"客户组名称",readOnly:"true",disabled:true,labelStyle:"width:93px",width:500},uploadFilePanel,{xtype:'hidden',name:'flag',value:'insertbyfile'}]});var addByListPanel=new Ext.form.FormPanel({title:"列表方式",width:600,border:false,frame:true,labelWidth:80,defaults:{msgTarget:"side"},items:[{xtype:"hidden",name:"numusergroupid",fieldLabel:"客户组编号",readOnly:"true"},{xtype:"textfield",name:"vc2usergroupname",fieldLabel:"客户组名称",readOnly:"true",disabled:true,width:500},{xtype:'textarea',name:'mobilelist',fieldLabel:WXTL.Common.help.MOBILELIST,width:500,height:200,allowBlank:false,blankText:"请输入手机号码列表",validator:function(value){return checkMobileList(value,1000)}},{xtype:'hidden',name:'flag',value:'insertbylist'}]});mainForm=addByFilePanel.getForm();var tabPanel=new Ext.TabPanel({height:300,border:false,width:650,activeTab:0,animScroll:true,enableTabScroll:true,items:[addByFilePanel,addByListPanel],listeners:{"tabchange":function(TabPanel,Panel){if(Js.Center.Business.UserGroupMemberAdd.window!=null&&Js.Center.Business.UserGroupMemberAdd.window.updateRecord!=null){mainForm=Panel.getForm();Js.Center.Business.UserGroupMemberAdd.window.mainForm=mainForm;Js.Center.Business.UserGroupMemberAdd.window.mainForm.loadRecord(Js.Center.Business.UserGroupMemberAdd.window.updateRecord)}}}});this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加客户组成员",mainForm:mainForm,updateURL:Js.Center.Business.UserGroupMemberUpdateURL,displayStore:Js.Center.Business.UserGroup.Infostore,updateState:true,updateRecord:row,items:[tabPanel],needLoadDataStore:true,loadDataStoreFunc:function(){Js.Center.Business.UserGroupMemberAdd.window.items.items[0].setActiveTab(0)}})}};Ext.namespace('Js.Center.Business.UserGroupMemberCusDetails');Js.Center.Business.UserGroupMemberCusDetails.func=function(row){if(Js.Center.Business.UserGroupMemberCusDetails.window==null){var _pageSize=12;var fields=["numusergroupid","numprodid","vc2prodname","vc2usergroupname","vc2usergroupdesc","datcreattime","datmodifytime","numuserid","numdepartid","vc2departname","vc2username","membercount","blackcount"];Js.Center.Business.UserGroupMemberCusDetails.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.UserGroupURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numusergroupid",totalProperty:"totalCount"}),sortInfo:{field:'vc2usergroupname',direction:'DESC'},baseParams:{flag:'selectownerusergroupbyid'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numusergroupid"});var cm=new Ext.grid.ColumnModel([{header:"客户组名称",tooltip:"客户组名称",dataIndex:"vc2usergroupname",sortable:true},{header:"部门",tooltip:"部门",dataIndex:"vc2departname",sortable:true},{header:"成员数量",tooltip:"成员数量",dataIndex:"membercount",sortable:true},{header:"成员下载",tooltip:"成员下载",dataIndex:"numusergroupid",renderer:function(value,meta,record,rowIndex,colIndex,store){return"<a href='#' onclick='exportData(\""+Js.Center.Business.UserGroupURL+"\",\"id="+value+"&flag=selectmemberbyid\")'>下载</a>"}},{header:"备注",tooltip:"备注",dataIndex:"vc2usergroupdesc",sortable:true}]);var columnMemberCusDetailsGrid=new WXTL.Widgets.CommonGrid.GridPanel({title:"",anchor:'100% 100%',pageSize:_pageSize,store:Js.Center.Business.UserGroupMemberCusDetails.Infostore,needMenu:false,needRightMenu:false,needPage:false,needLoadDataStore:true,sm:sm,cm:cm});var mainPanel=new Ext.form.FormPanel({frame:true,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",width:650,defaults:{collapsible:true},items:[columnMemberCusDetailsGrid]});var mainForm=mainPanel.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"客户明细",mainForm:mainForm,updateURL:Js.Center.Business.UserGroupUpdateURL,displayStore:Js.Center.Business.UserGroupMemberCusDetails.Infostore,updateState:true,updateRecord:row,items:[mainPanel],needButtons:false,needLoadDataStore:true,buttons:[{text:"关  闭",minWidth:70,handler:function(){Js.Center.Business.UserGroupMemberCusDetails.window.hide()}}],loadDataStoreFunc:function(){Js.Center.Business.UserGroupMemberCusDetails.Infostore.load({params:{start:0,limit:_pageSize,id:Js.Center.Business.UserGroupMemberCusDetails.window.updateRecord.get("numusergroupid"),usergroupname:Js.Center.Business.UserGroupMemberCusDetails.window.updateRecord.get("vc2usergroupname")}})}})}};Ext.namespace('Js.Center.Business.UserGroupMemberDelete');Ext.QuickTips.init();Js.Center.Business.UserGroupMemberDelete.func=function(row){if(Js.Center.Business.UserGroupMemberDelete.window==null){var uploadFilePanel=new WXTL.Widgets.CommonPanel.UploadLargeFilePanel({needLargfile:false,id:"Js.Center.Business.UserGroupMemberDelete.UploadLargeFile"});var addByFilePanel=new Ext.form.FormPanel({title:"文件方式",width:600,border:false,fileUpload:true,frame:true,labelWidth:80,defaults:{msgTarget:"side"},items:[{xtype:"hidden",name:"numusergroupid",fieldLabel:"客户组编号",readOnly:"true"},{xtype:"textfield",name:"vc2usergroupname",fieldLabel:"客户组名称",readOnly:"true",disabled:true,labelStyle:"width:93px",width:500},uploadFilePanel,{xtype:'hidden',name:'flag',value:'deletebyfile'}]});var addByListPanel=new Ext.form.FormPanel({title:"列表方式",width:600,border:false,frame:true,labelWidth:80,defaults:{msgTarget:"side"},items:[{xtype:"hidden",name:"numusergroupid",fieldLabel:"客户组编号",readOnly:"true"},{xtype:"textfield",name:"vc2usergroupname",fieldLabel:"客户组名称",readOnly:"true",disabled:true,width:500},{xtype:'textarea',name:'mobilelist',fieldLabel:WXTL.Common.help.MOBILELIST,width:500,height:200,allowBlank:false,blankText:"请输入手机号码列表",validator:function(value){return checkMobileList(value,1000)}},{xtype:'hidden',name:'flag',value:'deletebylist'}]});var mainForm=addByFilePanel.getForm();var tabPanel=new Ext.TabPanel({height:300,border:false,width:650,activeTab:0,animScroll:true,enableTabScroll:true,items:[addByFilePanel,addByListPanel],listeners:{"tabchange":function(TabPanel,Panel){if(Js.Center.Business.UserGroupMemberDelete.window!=null&&Js.Center.Business.UserGroupMemberDelete.window.updateRecord!=null){mainForm=Panel.getForm();Js.Center.Business.UserGroupMemberDelete.window.mainForm=mainForm;Js.Center.Business.UserGroupMemberDelete.window.mainForm.loadRecord(Js.Center.Business.UserGroupMemberDelete.window.updateRecord)}}}});this.window=new WXTL.Widgets.CommonWindows.Window({title:"退出客户组成员",iconCls:'deleteicon',mainForm:mainForm,updateURL:Js.Center.Business.UserGroupMemberUpdateURL,displayStore:Js.Center.Business.UserGroup.Infostore,updateState:true,updateRecord:row,items:[tabPanel],needLoadDataStore:true,loadDataStoreFunc:function(){Js.Center.Business.UserGroupMemberDelete.window.items.items[0].setActiveTab(0)}})}};Ext.namespace('Js.Center.Business.UserGroupMemberOperatorDetails');Js.Center.Business.UserGroupMemberOperatorDetails.func=function(row){if(Js.Center.Business.UserGroupMemberOperatorDetails.window==null){var _pageSize=6;Js.Center.Business.UserGroupMemberOperatorDetails.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.UserGroupMemberURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:["numlogid","numdataid","numstate","vc2departname","numtype","numlogid","vc2columnname","numtotalnum","numsuccessnum","vc2username","datcreattime","numfailed"],root:"data",id:"numlogid",totalProperty:"totalCount"}),sortInfo:{field:'datcreattime',direction:'DESC'},baseParams:{flag:'selectlog',numtypeid:'5,6',datcreattimestart:'',datcreattimeend:'',numdepartid:'',numusergroupid:''}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numcolumnid"});var cm=new Ext.grid.ColumnModel([{header:"客户组名称",tooltip:"客户组名称",dataIndex:"vc2columnname",sortable:true},{header:"部门名称",tooltip:"部门名称",dataIndex:"vc2departname",sortable:true},{header:"处理状态",tooltip:"处理状态",dataIndex:"numstate",sortable:true},{header:"总数",tooltip:"总数",dataIndex:"numtotalnum",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){if(value>0){return"<a href='#' onclick='exportData(\""+Js.Center.Business.UserGroupMemberURL+"\",\"id="+record.data.numlogid+"&flag=selectdesc&successtype=-1\")'>"+value+"</a>"}else{return value}}},{header:"成功数",tooltip:"成功数",dataIndex:"numsuccessnum",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){if(value>0){return"<a href='#' onclick='exportData(\""+Js.Center.Business.UserGroupMemberURL+"\",\"id="+record.data.numlogid+"&flag=selectdesc&successtype=1\")'>"+value+"</a>"}else{return value}}},{header:"失败数",tooltip:"失败数",dataIndex:"numfailed",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){if(value>0){return"<a href='#' onclick='exportData(\""+Js.Center.Business.UserGroupMemberURL+"\",\"id="+record.data.numlogid+"&flag=selectdesc&successtype=0\")'>"+value+"</a>"}else{return value}}},{header:"操作类型",tooltip:"操作类型",dataIndex:"numtype",sortable:true,renderer:function(value){if(value==5){return"添加"}if(value==6){return"退出"}}},{header:"操作人",tooltip:"操作人",dataIndex:"vc2username",sortable:true},{header:"操作时间",tooltip:"操作时间",dataIndex:"datcreattime",sortable:true}]);var userGroupidGrid=new WXTL.Widgets.CommonGrid.GridPanel({id:"usergroupmemberaddGridPanel",anchor:'100% 100%',pageSize:_pageSize,store:Js.Center.Business.UserGroupMemberOperatorDetails.Infostore,needMenu:false,needRightMenu:false,sm:sm,cm:cm});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"usergroupmemberaddSelectPanel",height:130,queryMethod:"Js.Center.Business.UserGroupMemberOperatorDetails.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:5px 0 5px 15px",items:[{xtype:"datefield",fieldLabel:"开始时间",format:'Y-m-d',labelWidth:100,bodyStyle:'padding:5px 5px 0',readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),fieldLabel:"开始时间",name:"datcreattimestart",id:"usergroupmemberadddatcreattimestart",validateOnBlur:false,validator:function(){return Js.Center.Business.UserGroupMemberOperatorDetails.checkTime()},invalidText:'结束时间不能小于开始时间！'},{xtype:"ComboWithTree",name:"numdepartid",fieldLabel:"选择部门",hiddenName:"usergroupmemberaddnumdepartid",treeRootVisible:true,fieldLabel:"部门名称",valueField:'id',listHeight:'150',baseParams:{columnlist:"numdepartid,vc2departname",flag:'selectallbycurrentuser'},dataUrl:Js.Center.Popedom.DepartmentsQueryURL}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:5px 0 5px 15px",items:[{xtype:"datefield",fieldLabel:"结束时间",labelWidth:100,format:'Y-m-d',bodyStyle:'padding:5px 5px 0',readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),name:"datcreattimeend",id:"usergroupmemberadddatcreattimeend",validateOnBlur:false,validator:function(){return Js.Center.Business.UserGroupMemberOperatorDetails.checkTime()},invalidText:'结束时间不能小于开始时间！'},{xtype:"combo",name:"numtype",fieldLabel:"操作类型",hiddenName:"usergroupmemberaddvc2type",blankText:"-=请选择=-",readOnly:true,mode:"local",displayField:"vc2name",valueField:"value",triggerAction:"all",emptyText:'-=请选择=-',value:"5,6",store:new Ext.data.SimpleStore({fields:["vc2name","value"],data:[["-=请选择=-","5,6"],["添加","5"],["退出","6"]]})}]}]}]});Js.Center.Business.UserGroupMemberOperatorDetails.queryGrid=function(){var datCreatTimeStart=Ext.get("usergroupmemberadddatcreattimestart").getValue();var datCreatTimeend=Ext.get("usergroupmemberadddatcreattimeend").getValue();var numDepartId=Ext.get("usergroupmemberaddnumdepartid").getValue()==null?"":Ext.get("usergroupmemberaddnumdepartid").getValue().replace("s","");var numTypeId=Ext.get("usergroupmemberaddvc2type").getValue();var flag='selectlog';Js.Center.Business.UserGroupMemberOperatorDetails.Infostore.baseParams={flag:flag,numtypeid:numTypeId,datcreattimestart:datCreatTimeStart,datcreattimeend:datCreatTimeend,numdepartid:numDepartId,numusergroupid:Js.Center.Business.UserGroupMemberOperatorDetails.window.updateRecord.get("numusergroupid")};Js.Center.Business.UserGroupMemberOperatorDetails.Infostore.load({params:{start:0,limit:_pageSize}})};var mainPanel=new Ext.Panel({width:830,frame:true,bodyBorder:false,border:false,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,userGroupidGrid]});var mainForm=selectPanel.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"操作详细信息",width:"850",height:430,autoScroll:true,frame:true,mainForm:mainForm,updateURL:Js.Center.Business.UserGroupUpdateURL,displayStore:Js.Center.Business.UserGroupMemberOperatorDetails.Infostore,updateState:true,updateRecord:row,needLoadDataStore:true,items:[mainPanel],needButtons:false,buttons:[{text:"关  闭",minWidth:70,handler:function(){Js.Center.Business.UserGroupMemberOperatorDetails.window.hide()}}],loadDataStoreFunc:function(){selectPanel.getForm().reset();Js.Center.Common.DepartmentStore.reload();Js.Center.Business.UserGroupMemberOperatorDetails.Infostore.baseParams={flag:'selectlog',numtypeid:'5,6',datcreattimestart:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),datcreattimeend:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),numdepartid:'',numusergroupid:Js.Center.Business.UserGroupMemberOperatorDetails.window.updateRecord.get("numusergroupid")};Js.Center.Business.UserGroupMemberOperatorDetails.Infostore.load({params:{start:0,limit:_pageSize}})}});Js.Center.Business.UserGroupMemberOperatorDetails.checkTime=function(){var strat_time=Ext.get("usergroupmemberadddatcreattimestart").dom.value;var end_time=Ext.get("usergroupmemberadddatcreattimeend").dom.value;if(strat_time<=end_time){return true}else{return false}}}};Ext.namespace('Js.Center.Business.UserGroupUpdate');Js.Center.Business.UserGroupUpdate.func=function(row){var updateInfofp=new Ext.form.FormPanel({frame:true,labelWidth:80,defaults:{anchor:'90%',msgTarget:'side'},items:[{xtype:"hidden",name:"flag",value:"updateall"},{xtype:"hidden",name:"numusergroupid",fieldLabel:"客户组编号"},{xtype:"textfield",name:"vc2usergroupname",fieldLabel:"<font color=red>客户组名称</font>",allowBlank:false,blankText:"客户组名称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:15,maxLengthText:'长度不能超过15'},{xtype:"hidden",name:"numprodid",value:0},{xtype:"textarea",name:"vc2usergroupdesc",fieldLabel:"备注",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,height:100,maxLength:100}]});var mainForm=updateInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"修改客户组",mainForm:mainForm,updateURL:Js.Center.Business.UserGroupUpdateURL,displayStore:Js.Center.Business.UserGroup.Infostore,updateState:true,updateRecord:row,items:[updateInfofp]});};