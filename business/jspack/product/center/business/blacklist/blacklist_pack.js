Ext.namespace('Js.Center.Business.BlacklistAdd');Ext.QuickTips.init();Js.Center.Business.BlacklistAdd.func=function(){if(Js.Center.Business.BlacklistAdd.window==null){var fileStore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:'Test/UploadTest.aspx',method:"POST"}),reader:new Ext.data.JsonReader({fields:["state","filename",,"filepath","speed","input_element","percentage","starttime","note","uploadedlen"],root:"data",id:"numfile",totalProperty:"totalCount"}),baseParams:{flag:'selectbylist'}});var addByFilePanel=new Ext.form.FormPanel({title:"文件方式",width:600,border:false,fileUpload:true,frame:true,labelWidth:80,defaults:{msgTarget:"side"},items:[{xtype:"hidden",name:"whitelistaddnumsvcid",value:"1"},{xtype:"combo",name:"blacktype",fieldLabel:"<font color=red>黑名单类型</font>",hiddenName:"blacktype",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",allowBlank:false,blankText:"黑名单类型不允许为空",emptyText:"请选择",value:2,store:new Ext.data.SimpleStore({fields:['value','show'],data:[[2,'系统黑名单'],[4,'彩信黑名单']]})},{xtype:'fileuploadfield',name:'mobilefile',fieldLabel:WXTL.Common.help.MOBILEFILE,allowBlank:false,blankText:"请选择上传文件",width:500,validator:function(){var filePath=mainForm.items.items[2].getValue();if(filePath!=''){mainForm.items.items[3].el.dom.value=getFileMessage(filePath);if(checkFile(filePath)!=''){this.invalidText=checkFile(filePath);return false}else{return true}}else return false}},{xtype:'textarea',name:'filemessage',fieldLabel:'文件信息',readOnly:true,width:500,height:180},{xtype:'hidden',name:'flag',value:'insertbyfile'}]});var addByListPanel=new Ext.form.FormPanel({title:"列表方式",width:600,border:false,frame:true,labelWidth:80,defaults:{msgTarget:"side"},items:[{xtype:"hidden",name:"whitelistaddnumsvcid",value:"1"},{xtype:"combo",name:"blacktype",fieldLabel:"<font color=red>黑名单类型</font>",hiddenName:"blacktype",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",allowBlank:false,blankText:"黑名单类型不允许为空",emptyText:"请选择",value:2,store:new Ext.data.SimpleStore({fields:['value','show'],data:[[2,'系统黑名单'],[4,'彩信黑名单']]})},{xtype:'textarea',name:'mobilelist',fieldLabel:WXTL.Common.help.MOBILELIST,width:300,height:200,allowBlank:false,blankText:"请输入手机号码列表",validator:function(value){return checkMobileList(value,1000)}},{xtype:'hidden',name:'flag',value:'insertbylist'}]});var mainForm=addByFilePanel.getForm();var tabPanel=new Ext.TabPanel({height:300,border:false,width:650,activeTab:0,animScroll:true,enableTabScroll:true,items:[addByFilePanel,addByListPanel],listeners:{"tabchange":function(TabPanel,Panel){if(Js.Center.Business.BlacklistAdd.window){mainForm=Panel.getForm();Js.Center.Business.BlacklistAdd.window.mainForm=mainForm}}}});this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加系统黑名单",mainForm:mainForm,updateURL:Js.Center.Business.BlackUpdateURL,displayStore:Js.Center.Business.BlacklistAdd.Infostore,items:[tabPanel],listeners:{"show":function(){Js.Center.Business.BlacklistAdd.window.items.items[0].setActiveTab(0);Js.Center.Business.BlacklistAdd.window.items.items[0].items.items[0].getForm().reset();Js.Center.Business.BlacklistAdd.window.items.items[0].items.items[1].getForm().reset()}}});}};Ext.namespace('Js.Center.Business.BlacklistAdd');Js.Center.Business.BlacklistAdd.info=function(node){if(Ext.get("Js.Center.Business.BlacklistAdd.MainPanel")==null){Js.Center.Common.ServiceCodeStore.reload();var _pageSize=12;Js.Center.Business.BlacklistAdd.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.BlackURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:["numlogid","vc2svcname","numdataid","numstate","vc2departname","numlogid","vc2columnname","numtotalnum","numsuccessnum","numfailed","vc2username","datcreattime","numlisttype"],root:"data",id:"numlogid",totalProperty:"totalCount"}),sortInfo:{field:'datcreattime',direction:'DESC'},baseParams:{flag:'selectlog',datcreattimestart:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),datcreattimeend:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),numsvcid:'',vc2username:'',numtypeid:'2,3,4,5'}});Js.Center.Business.BlacklistAdd.Infostore.load({params:{start:0,limit:_pageSize}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numlogid"});var cm=new Ext.grid.ColumnModel([{header:"业务名称",tooltip:"业务名称",dataIndex:"vc2svcname",hidden:"true",sortable:true},{header:"操作部门",tooltip:"操作部门",dataIndex:"vc2departname",sortable:true},{header:"总数",tooltip:"总数",dataIndex:"numtotalnum",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){if(value>0){return"<a href='#' onclick='exportData(\""+Js.Center.Business.BlackURL+"\",\"id="+record.data.numlogid+"&flag=selectdesc&successtype=-1\")'>"+value+"</a>"}else{return value}}},{header:"成功数",tooltip:"成功数",dataIndex:"numsuccessnum",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){if(value>0){return"<a href='#' onclick='exportData(\""+Js.Center.Business.BlackURL+"\",\"id="+record.data.numlogid+"&flag=selectdesc&successtype=1\")'>"+value+"</a>"}else{return value}}},{header:"失败数",tooltip:"失败数",dataIndex:"numfailed",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){if(value>0){return"<a href='#' onclick='exportData(\""+Js.Center.Business.BlackURL+"\",\"id="+record.data.numlogid+"&flag=selectdesc&successtype=0\")'>"+value+"</a>"}else{return value}}},{header:"处理状态",tooltip:"处理状态",dataIndex:"numstate",sortable:true},{header:"操作类型",tooltip:"操作类型",dataIndex:"numlisttype",sortable:true,renderer:function(value){if(value==2){return"添加系统黑名单"}if(value==3){return"退出系统黑名单"}if(value==4){return"添加彩信黑名单"}if(value==5){return"退出彩信黑名单"}}},{header:"操作人",tooltip:"操作人",dataIndex:"vc2username",sortable:true},{header:"操作时间",tooltip:"操作时间",dataIndex:"datcreattime",sortable:true}]);var AddBlackListArrInitLoadFunc=new Array();AddBlackListArrInitLoadFunc[0]="Js.Center.Business.BlacklistAdd.func";AddBlackListArrInitLoadFunc[1]="Js.Center.Business.BlacklistDelete.func";var userGroupGrid=new WXTL.Widgets.CommonGrid.GridPanel({id:"blacklistaddGridPanel",anchor:'100% 100%',pageSize:_pageSize,store:Js.Center.Business.BlacklistAdd.Infostore,otherInitLoadFunc:AddBlackListArrInitLoadFunc,needMenu:false,needRightMenu:false,sm:sm,cm:cm,tbar:new Ext.Toolbar({items:[{iconCls:'addicon',text:"添加",handler:function(){Js.Center.Business.BlacklistAdd.window.show()}},{iconCls:'deleteicon',text:"退出",handler:function(){Js.Center.Business.BlacklistDelete.window.show()}}]})});Js.Center.Common.UserGroupStore.reload();var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"blacklistaddSelectPanel",queryMethod:"Js.Center.Business.BlacklistAdd.queryGrid",bodyStyle:"padding:10px 0 10px 15px",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",items:[{xtype:"datefield",fieldLabel:"开始时间",format:'Y-m-d',labelWidth:100,readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),fieldLabel:"开始时间",name:"datcreattimestart",id:"blacklistadddatcreattimestart",validateOnBlur:false,validator:function(){var strat_time=Ext.get("blacklistadddatcreattimestart").dom.value;var end_time=Ext.get("blacklistadddatcreattimeend").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'},{xtype:"combo",name:"numtype",fieldLabel:"操作类型",hiddenName:"blacklistaddinfovc2type",blankText:"-=请选择=-",readOnly:true,mode:"local",displayField:"vc2name",valueField:"value",triggerAction:"all",emptyText:'-=请选择=-',value:"2,3,4,5",store:new Ext.data.SimpleStore({fields:["vc2name","value"],data:[["-=请选择=-","2,3,4,5"],["添加系统黑名单","2"],["退出系统黑名单","3"],["添加彩信黑名单","4"],["退出彩信黑名单","5"]]})},{xtype:"hidden",name:"numsvcid",fieldLabel:"运营商业务",hiddenName:"blacklistaddnumsvcid",readOnly:true,mode:"local",displayField:"vc2svcname",valueField:"numsvcid",triggerAction:"all",store:Js.Center.Common.ServiceCodeStore}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",items:[{xtype:"datefield",fieldLabel:"结束时间",labelWidth:100,format:'Y-m-d',readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),name:"datcreattimeend",id:"blacklistadddatcreattimeend",validateOnBlur:false,validator:function(){var strat_time=Ext.get("blacklistadddatcreattimestart").dom.value;var end_time=Ext.get("blacklistadddatcreattimeend").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'}]}]}]});Js.Center.Business.BlacklistAdd.queryGrid=function(){if(selectPanel.getForm().isValid()){var datCreatTimeStart=Ext.get("blacklistadddatcreattimestart").getValue();var datCreatTimeend=Ext.get("blacklistadddatcreattimeend").getValue();var _numsvcid='';var numTypeId=Ext.get("blacklistaddinfovc2type").getValue();var flag='selectlog';Js.Center.Business.BlacklistAdd.Infostore.baseParams={flag:flag,numtypeid:numTypeId,datcreattimestart:datCreatTimeStart,datcreattimeend:datCreatTimeend,numsvcid:_numsvcid};Js.Center.Business.BlacklistAdd.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.Business.BlacklistAdd.MainPanel=new Ext.Panel({id:"Js.Center.Business.BlacklistAdd.MainPanel",frame:true,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,userGroupGrid]})};GridMain(node,Js.Center.Business.BlacklistAdd.MainPanel,"openroomiconinfo","Js.Center.Business.BlacklistAdd.Infostore")};Ext.namespace('Js.Center.Business.BlacklistDelete');Ext.QuickTips.init();Js.Center.Business.BlacklistDelete.func=function(){if(Js.Center.Business.BlacklistDelete.window==null){var addByFilePanel=new Ext.form.FormPanel({title:"文件方式",width:600,border:false,fileUpload:true,frame:true,labelWidth:80,defaults:{msgTarget:"side"},items:[{xtype:"hidden",name:"whitelistaddnumsvcid",value:"1"},{xtype:"combo",name:"blacktype",fieldLabel:"<font color=red>黑名单类型</font>",hiddenName:"blacktype",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",allowBlank:false,blankText:"黑名单类型不允许为空",emptyText:"请选择",value:3,store:new Ext.data.SimpleStore({fields:['value','show'],data:[[3,'系统黑名单'],[5,'彩信黑名单']]})},{xtype:'fileuploadfield',name:'mobilefile',fieldLabel:WXTL.Common.help.MOBILEFILE,allowBlank:false,blankText:"请选择上传文件",width:500,validator:function(){var filePath=mainForm.items.items[2].getValue();if(filePath!=''){mainForm.items.items[3].el.dom.value=getFileMessage(filePath);if(checkFile(filePath)!=''){this.invalidText=checkFile(filePath);return false}else{return true}}else return false}},{xtype:'textarea',name:'filemessage',fieldLabel:'文件信息',readOnly:true,width:500,height:180},{xtype:'hidden',name:'flag',value:'deletebyfile'}]});var addByListPanel=new Ext.form.FormPanel({title:"列表方式",width:600,border:false,frame:true,labelWidth:80,defaults:{msgTarget:"side"},items:[{xtype:"hidden",name:"whitelistaddnumsvcid",value:"1"},{xtype:"combo",name:"blacktype",fieldLabel:"<font color=red>黑名单类型</font>",hiddenName:"blacktype",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",allowBlank:false,blankText:"黑名单类型不允许为空",emptyText:"请选择",value:3,store:new Ext.data.SimpleStore({fields:['value','show'],data:[[3,'系统黑名单'],[5,'彩信黑名单']]})},{xtype:'textarea',name:'mobilelist',fieldLabel:WXTL.Common.help.MOBILELIST,width:300,height:200,allowBlank:false,blankText:"请输入手机号码列表",validator:function(value){return checkMobileList(value,1000)}},{xtype:'hidden',name:'flag',value:'deletebylist'}]});var mainForm=addByFilePanel.getForm();var tabPanel=new Ext.TabPanel({height:300,border:false,width:650,activeTab:0,animScroll:true,enableTabScroll:true,items:[addByFilePanel,addByListPanel],listeners:{"tabchange":function(TabPanel,Panel){if(Js.Center.Business.BlacklistDelete.window){mainForm=Panel.getForm();Js.Center.Business.BlacklistDelete.window.mainForm=mainForm}}}});this.window=new WXTL.Widgets.CommonWindows.Window({title:"退出系统黑名单",iconCls:'deleteicon',mainForm:mainForm,updateURL:Js.Center.Business.BlackUpdateURL,displayStore:Js.Center.Business.BlacklistAdd.Infostore,items:[tabPanel],listeners:{"show":function(){Js.Center.Business.BlacklistDelete.window.items.items[0].setActiveTab(0);Js.Center.Business.BlacklistDelete.window.items.items[0].items.items[0].getForm().reset();Js.Center.Business.BlacklistDelete.window.items.items[0].items.items[1].getForm().reset()}}});}};Ext.namespace('Js.Center.Business');Js.Center.Business.BlackURL='URL/BlackWhilteList/BlackQuery.ashx';Js.Center.Business.BlackUpdateURL='URL/BlackWhilteList/BlackUpdate.ashx';