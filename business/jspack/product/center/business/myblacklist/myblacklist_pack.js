Ext.namespace('Js.Center.Business.Myblacklist');Js.Center.Business.Myblacklist.info=function(node){if(Ext.get("Js.Center.Business.Myblacklist.MainPanel")==null){var _pageSize=12;Js.Center.Business.Myblacklist.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.MyBlackURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:["numlogid","numtotalnum","numsuccessnum","numstate","statetext","opationtype","vc2username","datcreattime"],root:"data",id:"numlogid",totalProperty:"totalCount"}),sortInfo:{field:'datcreattime',direction:'DESC'},baseParams:{flag:'selectlog',datcreattimestart:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),datcreattimeend:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d')}});Js.Center.Business.Myblacklist.Infostore.load({params:{start:0,limit:_pageSize}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numlogid"});var cm=new Ext.grid.ColumnModel([{header:'总数',tooltip:'总数',dataIndex:'numtotalnum',sortable:true},{header:"成功数",tooltip:"成功数",dataIndex:"numsuccessnum",sortable:true},{header:"处理状态",tooltip:"处理状态",dataIndex:"statetext",sortable:true},{header:"操作类型",tooltip:"操作类型",dataIndex:"opationtype",sortable:true},{header:"操作人",tooltip:"操作人",dataIndex:"vc2username",sortable:true},{header:"操作时间",tooltip:"操作时间",dataIndex:"datcreattime",sortable:true},{header:"操作",tooltip:"操作",dataIndex:"numlogid",width:50,renderer:function(value,meta,record,rowIndex,colIndex,store){return"<a href='#' onclick='doLoad(\""+Js.Center.Business.MyBlackURL+"\",\""+record.data.numlogid+"\")'>详情下载</a>"}}]);var myBlackListAdd=new Array();myBlackListAdd[0]="Js.Center.Business.Myblacklist.func";myBlackListAdd[1]="Js.Center.Business.MyBlacklistDelete.func";var MyblackUserGrid=new WXTL.Widgets.CommonGrid.GridPanel({id:"MyblacklistaddGridPanel",anchor:'100% 100%',pageSize:_pageSize,store:Js.Center.Business.Myblacklist.Infostore,needMenu:false,needRightMenu:false,otherInitLoadFunc:myBlackListAdd,sm:sm,cm:cm,tbar:new Ext.Toolbar({items:[{iconCls:'addicon',text:"添加",handler:function(){Js.Center.Business.Myblacklist.window.show()}},{iconCls:'deleteicon',text:"退出",handler:function(){Js.Center.Business.MyBlacklistDelete.window.show()}}]})});var MyblackselectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"MyblacklistaddSelectPanel",queryMethod:"Js.Center.Business.Myblacklist.queryGrid",bodyStyle:"padding:10px 0 10px 15px",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",items:[{xtype:"datefield",fieldLabel:"开始时间",format:'Y-m-d',labelWidth:100,readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),fieldLabel:"开始时间",name:"datcreattimestart",id:"Myblacklistadddatcreattimestart",validateOnBlur:false,validator:function(){var strat_time=Ext.get("Myblacklistadddatcreattimestart").dom.value;var end_time=Ext.get("Myblacklistadddatcreattimeend").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",items:[{xtype:"datefield",fieldLabel:"结束时间",labelWidth:100,format:'Y-m-d',readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),name:"datcreattimeend",id:"Myblacklistadddatcreattimeend",validateOnBlur:false,validator:function(){var strat_time=Ext.get("Myblacklistadddatcreattimestart").dom.value;var end_time=Ext.get("Myblacklistadddatcreattimeend").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'}]}]}]});Js.Center.Business.Myblacklist.queryGrid=function(){if(MyblackselectPanel.getForm().isValid()){var datCreatTimeStart=Ext.get("Myblacklistadddatcreattimestart").getValue();var datCreatTimeend=Ext.get("Myblacklistadddatcreattimeend").getValue();var flag='selectlog';Js.Center.Business.Myblacklist.Infostore.baseParams={flag:flag,datcreattimestart:datCreatTimeStart,datcreattimeend:datCreatTimeend};Js.Center.Business.Myblacklist.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.Business.Myblacklist.MainPanel=new Ext.Panel({id:"Js.Center.Business.MyBlacklistAdd.MainPanel",frame:true,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[MyblackselectPanel,MyblackUserGrid]})};GridMain(node,Js.Center.Business.Myblacklist.MainPanel,"openroomiconinfo","Js.Center.Business.Myblacklist.Infostore")};Ext.namespace('Js.Center.Business.Myblacklist');Ext.QuickTips.init();Js.Center.Business.Myblacklist.func=function(){if(Js.Center.Business.Myblacklist.window==null){var MyblackaddByFilePanel=new Ext.form.FormPanel({title:"文件方式",width:600,border:false,fileUpload:true,frame:true,labelWidth:80,defaults:{msgTarget:"side"},items:[{xtype:'fileuploadfield',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'mobilefile',fieldLabel:WXTL.Common.help.MOBILEFILE,allowBlank:false,blankText:"请选择上传文件",width:500,validator:function(){var filePath=mainForm.items.items[0].getValue();if(filePath!=''){mainForm.items.items[1].el.dom.value=getFileMessage(filePath);if(checkFile(filePath)!=''){this.invalidText=checkFile(filePath);return false}else{return true}}else return false}},{xtype:'textarea',name:'filemessage',fieldLabel:'文件信息',readOnly:true,width:500,height:180},{xtype:'hidden',name:'flag',value:'insertbyfile'}]});var MyblacaddByListPanel=new Ext.form.FormPanel({title:"列表方式",width:600,border:false,frame:true,labelWidth:80,defaults:{msgTarget:"side"},items:[{xtype:'textarea',name:'mobilelist',fieldLabel:WXTL.Common.help.MOBILELIST,width:300,height:200,allowBlank:false,blankText:"请输入手机号码列表",validator:function(value){return checkMobileList(value,1000)}},{xtype:'hidden',name:'flag',value:'insertbylist'}]});var mainForm=MyblackaddByFilePanel.getForm();var tabPanel=new Ext.TabPanel({height:300,border:false,width:650,activeTab:0,animScroll:true,enableTabScroll:true,items:[MyblackaddByFilePanel,MyblacaddByListPanel],listeners:{"tabchange":function(TabPanel,Panel){if(Js.Center.Business.Myblacklist.window){mainForm=Panel.getForm();Js.Center.Business.Myblacklist.window.mainForm=mainForm}}}});this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加用户黑名单",mainForm:mainForm,updateURL:Js.Center.Business.MyBlackUpdateURL,displayStore:Js.Center.Business.Myblacklist.Infostore,items:[tabPanel],listeners:{"show":function(){Js.Center.Business.Myblacklist.window.items.items[0].setActiveTab(0);Js.Center.Business.Myblacklist.window.items.items[0].items.items[0].getForm().reset();Js.Center.Business.Myblacklist.window.items.items[0].items.items[1].getForm().reset()}}});}};Ext.namespace('Js.Center.Business.MyBlacklistDelete');Ext.QuickTips.init();Js.Center.Business.MyBlacklistDelete.func=function(){if(Js.Center.Business.MyBlacklistDelete.window==null){Js.Center.Common.ProductStore.reload();var MyDeleteByFilePanel=new Ext.form.FormPanel({title:"文件方式",width:600,border:false,fileUpload:true,frame:true,labelWidth:80,defaults:{msgTarget:"side"},items:[{xtype:'fileuploadfield',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'mobilefile',fieldLabel:WXTL.Common.help.MOBILEFILE,allowBlank:false,blankText:"请选择上传文件",width:500,validator:function(){var filePath=mainForm.items.items[0].getValue();if(filePath!=''){mainForm.items.items[1].el.dom.value=getFileMessage(filePath);if(checkFile(filePath)!=''){this.invalidText=checkFile(filePath);return false}else{return true}}else return false}},{xtype:'textarea',name:'filemessage',fieldLabel:'文件信息',readOnly:true,width:500,height:180},{xtype:'hidden',name:'flag',value:'deletebyfile'}]});var MyDeleteByListPanel=new Ext.form.FormPanel({title:"列表方式",width:600,border:false,frame:true,labelWidth:80,defaults:{msgTarget:"side"},items:[{xtype:'textarea',name:'mobilelist',fieldLabel:WXTL.Common.help.MOBILELIST,width:300,height:200,allowBlank:false,blankText:"请输入手机号码列表",validator:function(value){return checkMobileList(value,1000)}},{xtype:'hidden',name:'flag',value:'deletebylist'}]});var mainForm=MyDeleteByFilePanel.getForm();var tabPanel=new Ext.TabPanel({height:300,border:false,width:650,activeTab:0,animScroll:true,enableTabScroll:true,items:[MyDeleteByFilePanel,MyDeleteByListPanel],listeners:{"tabchange":function(TabPanel,Panel){if(Js.Center.Business.MyBlacklistDelete.window){mainForm=Panel.getForm();Js.Center.Business.MyBlacklistDelete.window.mainForm=mainForm}}}});this.window=new WXTL.Widgets.CommonWindows.Window({title:"退出客户黑名单",iconCls:'deleteicon',mainForm:mainForm,updateURL:Js.Center.Business.MyBlackUpdateURL,displayStore:Js.Center.Business.Myblacklist.Infostore,items:[tabPanel],listeners:{"show":function(){Js.Center.Business.MyBlacklistDelete.window.items.items[0].setActiveTab(0);Js.Center.Business.MyBlacklistDelete.window.items.items[0].items.items[0].getForm().reset();Js.Center.Business.MyBlacklistDelete.window.items.items[0].items.items[1].getForm().reset()}}});}};Ext.namespace('Js.Center.Business');Js.Center.Business.MyBlackURL='URL/BlackWhilteList/MyBlackQuery.ashx';Js.Center.Business.MyBlackUpdateURL='URL/BlackWhilteList/MyBlackUpdate.ashx';