Ext.namespace('Js.Center.SendMMS.MMSAdd');Ext.QuickTips.init();Js.Center.SendMMS.MMSAdd.func=function(){if(Ext.get("Js.Center.SendMMS.MMSAdd.FormPanel")==null){var formPanel=new Ext.FormPanel({id:"Js.Center.SendMMS.MMSAdd.FormPanel",bodyStyle:"padding:10px 10px 10px 15px",region:'center',margins:'3 3 0 3',cmargins:'3 3 3 3',labelWidth:80,layout:'form',bodyBorder:false,defaults:{msgTarget:"side"},items:[{xtype:'textfield',id:'Js.Center.SendMMS.MMSAdd.initMMSnameChick',name:'initMMSname',fieldLabel:getHelpMsg("彩信标题",true,"此项必填，用于在目标手机上显示的彩信标题，长度小于等于20！"),regex:WXTL.Common.regex.IllegalDiy,regexText:WXTL.Common.regexText.IllegalText,allowBlank:false,blankText:'此项必填，长度小于等于20！',maxLength:20,maxLengthText:'长度应小于等于20',width:250},{xtype:'textfield',id:'Js.Center.SendMMS.MMSAdd.vc2Desc',name:'vc2desc',style:'word-wrap:break-word;word-break:break-all;',fieldLabel:getHelpMsg("彩信名称",false,"此项非必填项，用于区分相同标题的彩信，如果为空，默认为以上所填彩信标题，长度小于等于100！"),regex:WXTL.Common.regex.IllegalDiy,regexText:WXTL.Common.regexText.IllegalText,maxLength:100,maxLengthText:'长度不能超过100！',width:250},{xtype:'numberfield',name:'initMMScount',fieldLabel:getHelpMsg("帧数",true,"此项必填，范围在1～16！"),allowBlank:false,blankText:'此项必填，范围在1～16！',maxValue:16,maxText:'最大不能超过16',minValue:1,minText:'最小不能小于1',allowDecimals:false,width:30,value:10},{xtype:"xComboBox",name:"initMMStype",fieldLabel:"彩信类型",triggerAction:'all',mode:"local",width:250,displayField:"vc2type",valueField:"numtype",value:1,store:new Ext.data.SimpleStore({fields:['numtype','vc2type'],data:[[1,'普通彩信'],[2,'个性化彩信']]})},{xtype:'hidden',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'mmsid',fieldLabel:"彩信编号",width:350,value:''}]});formPanel.items.get(0).focus(true,600);this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加彩信",width:400,needButtons:false,closeAction:'hide',updateState:false,displayStore:Js.Center.SendMMS.MMS.Infostore,items:[formPanel],mainForm:formPanel.getForm(),buttons:[new Ext.Button({text:'继续',minWidth:70,qtip:"编辑彩信",handler:function(){var falg;var params={flag:"check",content:Ext.get("Js.Center.SendMMS.MMSAdd.initMMSnameChick").dom.value+Ext.get("Js.Center.SendMMS.MMSAdd.vc2Desc").getValue()};if(formPanel.getForm().isValid()){var _mmsDesc=Ext.get("Js.Center.SendMMS.MMSAdd.vc2Desc").getValue();if(_mmsDesc==""){_mmsDesc=formPanel.items.items[0].el.dom.value}var newMMSParmas={mmsName:formPanel.items.items[0].el.dom.value,frameCount:formPanel.items.items[2].el.dom.value,mmsDesc:_mmsDesc,mmsType:formPanel.items.items[3].getValue(),id:doSynRequest(Js.Center.SendMMS.GetRandomMMSIDURL).info};Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.updateRecord=newMMSParmas;Js.Center.SendMMS.MMSAdd.window.mainFormSubmitFunc('Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.show()',params,Js.Center.System.DirtyWordURL);}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){formPanel.getForm().reset()}}),new Ext.Button({text:'关闭',qtip:"关闭",minWidth:70,handler:function(){Js.Center.SendMMS.MMSAdd.window.hide()}})]})};};Js.Center.SendMMS.MMSAdd.func_edit=function(){if(Js.Center.SendMMS.MMSAdd.AddMMSInfoWin==null){if(typeof(mmsConfigInfo)=="undefined"){mmsConfigInfo=ajaxSyncCall(Js.Center.SendMMS.MMSConfigInfo,"flag=mmsconfiginfo")}var previewMMSPanel;var editPanel=new Ext.FormPanel({id:"Js.Center.SendMMS.MMSAdd.editPanel",bodyStyle:"padding:10px 0 10px 15px",title:'编辑',region:'center',margins:'3 3 0 3',cmargins:'3 3 3 3',labelWidth:90,layout:'form',fileUpload:true,defaults:{msgTarget:"side"},items:[{xtype:'textfield',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'MMSname',fieldLabel:"彩信标题",disabled:true,width:350},{xtype:'numberfield',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'datframetime',fieldLabel:getHelpMsg("帧播放时间",true,"此项必填，范围在1-120，以秒为单位！"),allowBlank:false,blankText:'此项必填，范围在1-120，以秒为单位！',maxValue:120,maxText:'最大不能超过120秒',minValue:1,minText:'最小不能小于1秒',allowDecimals:false,value:"5",width:30},{xtype:'FileUpload',id:'Js.Center.SendMMS.MMSAdd.vc2Image',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2image',fieldLabel:getHelpMsg("帧图片",false,"此项非必选项，上传图片格式为："+MMSIMAGEFILETYPEDESC+"，尺寸最大限制为"+mmsConfigInfo.imagewidth+" x "+mmsConfigInfo.imageheight+"（宽x高），大小不能超过"+mmsConfigInfo.imagesize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的图片！"),width:350},{xtype:'FileUpload',id:'Js.Center.SendMMS.MMSAdd.vc2Music',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2music',fieldLabel:getHelpMsg("帧背景音乐",false,"此项非必选项，上传音乐格式为："+MMSMUSICFILETYPEDESC+"，大小不能超过"+mmsConfigInfo.musicsize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的音乐！"),width:350},{xtype:'textarea',id:'Js.Center.SendMMS.MMSAdd.mmsEditWord',name:'vc2word',style:'word-wrap:break-word;word-break:break-all;',fieldLabel:getHelpMsg("帧文字",false,"此项非必填项，长度不能超过2000！"),maxLength:2000,maxLengthText:'长度不能超过2000',regex:WXTL.Common.regex.IllegalDiy,regexText:WXTL.Common.regexText.IllegalDiyText,width:350,height:150,validator:function(){var word=Ext.get("Js.Center.SendMMS.MMSAdd.mmsEditWord").dom.value;if(isExistsHtmlLable(word)){return false}else{return true}},invalidText:'帧文字不能包含HTML标签'},{xtype:'hidden',name:'numframeorder',fieldLabel:"帧序号",width:"90%",height:150},{xtype:'hidden',name:'currframejson',fieldLabel:"帧Json",width:"90%",height:150},{xtype:'hidden',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'flag',fieldLabel:"标识",width:350},{xtype:'hidden',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'mmsid',fieldLabel:"彩信编号",width:350}],buttons:[new Ext.Button({text:'修改帧',minWidth:70,handler:function(){if(editPanel.getForm().isValid()){if(checkMMSFrame(editPanel.items.items[2].getCheckValue(),previewMMSPanel.contentJson.frame[previewMMSPanel.currFrame].vc2image.vc2rescurl,editPanel.items.items[4].getValue(),editPanel.items.items[2].getValue())){if(editPanel.items.items[2].getValue()!=""&&!checkMMSFrameImageType(editPanel.items.items[2].getCheckValue(),editPanel.items.items[2].getValue())){return false}if(editPanel.items.items[3].getValue()!=""&&!checkMMSFrameMusicType(editPanel.items.items[3].getCheckValue(),editPanel.items.items[3].getValue())){return false}Ext.MessageBox.show({msg:'正在处理，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});editPanel.getForm().submit({url:Js.Center.SendMMS.MMSFrameUpdateURL,method:"POST",success:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);var falg=objJson.success;var frameJson=objJson.data;if(falg==true){if(!editPanel.items.items[2].getCheckValue()){if(editPanel.items.items[2].getValue()==""){if(previewMMSPanel.contentJson.frame[previewMMSPanel.currFrame].vc2image.vc2rescurl!=""){frameJson.vc2image=previewMMSPanel.contentJson.frame[previewMMSPanel.currFrame].vc2image}}}previewMMSPanel.contentJson.frame[previewMMSPanel.currFrame]=frameJson;previewMMSPanel.refreshAll();previewMMSPanel.render();previewMMSPanel.refreshBrotherPanel();Ext.Msg.alert("温馨提示","操作成功了!");if(document.getElementById("Js.Center.SendMMS.MMSAdd.vc2Image")!=null){editPanel.remove("Js.Center.SendMMS.MMSAdd.vc2Image");var fileUp=new WXTL.Widgets.CommonForm.FileUpload({id:'Js.Center.SendMMS.MMSAdd.vc2Image',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2image',fieldLabel:getHelpMsg("帧图片",false,"此项非必选项，上传图片格式为："+MMSIMAGEFILETYPEDESC+"，尺寸最大限制为"+mmsConfigInfo.imagewidth+" x "+mmsConfigInfo.imageheight+"（宽x高），大小不能超过"+mmsConfigInfo.imagesize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的图片！"),width:350});editPanel.insert(2,fileUp);editPanel.doLayout()}if(document.getElementById("Js.Center.SendMMS.MMSAdd.vc2Music")!=null){editPanel.remove("Js.Center.SendMMS.MMSAdd.vc2Music");var fileUpMusic=new WXTL.Widgets.CommonForm.FileUpload({id:'Js.Center.SendMMS.MMSAdd.vc2Music',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2music',fieldLabel:getHelpMsg("帧背景音乐",false,"此项非必选项，上传音乐格式为："+MMSMUSICFILETYPEDESC+"，大小不能超过"+mmsConfigInfo.musicsize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的音乐！"),width:350});editPanel.insert(3,fileUpMusic);editPanel.doLayout()}}else Ext.Msg.alert('温馨提示',objJson.info)},failure:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);Ext.Msg.alert('温馨提示',objJson.info)}})}}}})]});var framePanel=new WXTL.Widgets.CommonPanel.MMSFramePanel({id:"Js.Center.SendMMS.MMSAdd.framePanel",title:'帧',currFrame:0,region:'south',autoScroll:false,margins:'3 3 3 3',cmargins:'3 3 3 3',height:189,width:778,contentJson:Js.Center.SendMMS.MMS.InitMMSInfo,frame:false,listeners:{afterRefresh:function(obj,json,currFrame){editPanel.items.items[1].setValue(currFrame.numframetime);editPanel.items.items[2].setValue(currFrame.vc2image.vc2resurl);editPanel.items.items[3].setValue(currFrame.vc2backmusic.vc2resurl);editPanel.items.items[4].setValue(currFrame.vc2word.vc2rescdesc1);editPanel.items.items[5].setValue(currFrame.numframeorder);editPanel.items.items[7].setValue("mmscuroption");}}});previewMMSPanel=new WXTL.Widgets.CommonPanel.MMSpanel({id:"Js.Center.SendMMS.MMSAdd.previewMMSPanel",title:'预览：第1帧',region:'west',brotherPanel:framePanel,width:244,height:374,collapsible:true,margins:'3 0 0 3',cmargins:'3 3 3 3',frame:false});framePanel.brotherPanel=previewMMSPanel;var mainPanel=new Ext.Panel({width:778,height:573,frame:false,layout:'border',border:true,items:[previewMMSPanel,editPanel,framePanel]});Js.Center.SendMMS.MMSAdd.AddMMSInfoWin=new WXTL.Widgets.CommonWindows.Window({title:"彩信内容编辑",width:814,height:530,layout:'form',autoScroll:true,displayStore:Js.Center.SendMMS.MMS.Infostore,needButtons:false,updateState:false,items:[mainPanel],mainForm:editPanel.getForm(),needLoadDataStore:true,loadDataStoreFunc:function(){var mmsJson=newMMS(Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.updateRecord.mmsName,Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.updateRecord.mmsDesc,Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.updateRecord.frameCount,Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.updateRecord.mmsType);Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.items.items[0].items.items[0].contentJson=mmsJson;Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.items.items[0].items.items[2].contentJson=mmsJson;Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.items.items[0].items.items[0].currFrame=0;Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.items.items[0].items.items[0].refreshAll();Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.items.items[0].items.items[2].refreshAll();Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.items.items[0].items.items[0].refreshBrotherPanel(0);editPanel.items.items[0].setValue(Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.updateRecord.mmsName);editPanel.items.items[8].setValue(Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.updateRecord.id)},buttons:[new Ext.Button({text:'保存彩信',minWidth:70,qtip:"保存彩信",handler:function(){if(checkMMS(previewMMSPanel.contentJson)){Ext.MessageBox.show({msg:'正在处理，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});var params={mmsjson:Ext.encode(previewMMSPanel.contentJson),mmsid:Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.updateRecord.id};Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.mainFormSubmitFunc('',params,Js.Center.SendMMS.MMSAddURL)}}}),new Ext.Button({text:'关闭',qtip:"关闭",minWidth:70,handler:function(){Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.hide()}})],listeners:{"hide":function(){if(Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.items.items[0].items.items[0].bottomToolbar.items.items[0].text!="播放"){previewMMS(Js.Center.SendMMS.MMSAdd.AddMMSInfoWin.items.items[0].items.items[0].contentJson.frame.length);window.clearInterval(playTime)}}}})}};Ext.namespace("Js.Center.SendMMS.CopyMMS");Ext.QuickTips.init();Js.Center.SendMMS.CopyMMS.init=function(row){if(Js.Center.SendMMS.CopyMMS.window==null){var formPanel=new Ext.FormPanel({id:"Js.Center.SendMMS.CopyMMS.FormPanel",bodyStyle:"padding:10px 10px 10px 15px",region:'center',margins:'3 3 0 3',cmargins:'3 3 3 3',labelWidth:80,layout:'form',bodyBorder:false,defaults:{msgTarget:"side"},items:[{xtype:'textfield',id:'Js.Center.SendMMS.CopyMMS.initMMSname',name:'vc2name',fieldLabel:getHelpMsg("彩信标题",true,"此项必填，用于在目标手机上显示的彩信标题，长度小于等于20！"),regex:WXTL.Common.regex.IllegalDiy,regexText:WXTL.Common.regexText.IllegalText,allowBlank:false,blankText:'此项必填，长度小于等于20！',maxLength:20,maxLengthText:'长度应小于等于20',width:250},{xtype:'textfield',id:'Js.Center.SendMMS.CopyMMS.initvc2desc',name:'vc2desc',style:'word-wrap:break-word;word-break:break-all;',fieldLabel:getHelpMsg("彩信名称",false,"此项非必填项，用于区分相同标题的彩信，如果为空，默认为以上所填彩信标题，长度小于等于100！"),maxLength:100,maxLengthText:'长度不能超过100！',regex:WXTL.Common.regex.IllegalDiy,regexText:WXTL.Common.regexText.IllegalText,width:250},{xtype:"xComboBox",name:"nummmstype",fieldLabel:"彩信类型",triggerAction:'all',mode:"local",width:250,displayField:"vc2type",valueField:"numtype",store:new Ext.data.SimpleStore({fields:['numtype','vc2type'],data:[[1,'普通彩信'],[2,'个性化彩信']]})},{xtype:'hidden',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'mmsid',id:'mmsid',fieldLabel:"彩信编号",width:350}]});this.window=new WXTL.Widgets.CommonWindows.Window({title:"编辑彩信",width:400,mainForm:formPanel.getForm(),needButtons:false,displayStore:Js.Center.SendMMS.MMSCopyInfo.Infostore,updateState:true,updateRecord:row,items:[formPanel],buttons:[new Ext.Button({text:'继续',minWidth:70,qtip:"编辑彩信",handler:function(){if(formPanel.getForm().isValid()){var falg;var params={flag:"check",content:Ext.get("Js.Center.SendMMS.CopyMMS.initMMSname").dom.value};var _mmsDesc=Ext.get("Js.Center.SendMMS.CopyMMS.initvc2desc").getValue();if(_mmsDesc==""){_mmsDesc=formPanel.items.items[0].el.dom.value}var newMMSParmas={mmsName:formPanel.items.items[0].el.dom.value,mmsDesc:_mmsDesc,mmsType:formPanel.items.items[2].getValue(),nummmsid:Js.Center.SendMMS.CopyMMS.window.updateRecord.data.nummmsid,id:doSynRequest(Js.Center.SendMMS.GetRandomMMSIDCopyURL+"?resourcemmsid="+Js.Center.SendMMS.CopyMMS.window.updateRecord.data.nummmsid).info};Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.updateRecord=newMMSParmas;Js.Center.SendMMS.CopyMMS.window.mainFormSubmitFunc('Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.show()',params,Js.Center.System.DirtyWordURL);}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){formPanel.getForm().loadRecord(Js.Center.SendMMS.CopyMMS.window.updateRecord)}}),new Ext.Button({text:'关闭',qtip:"关闭",minWidth:70,handler:function(){Js.Center.SendMMS.CopyMMS.window.hide()}})]})}};Js.Center.SendMMS.CopyMMS.func=function(mmsName,mmsDesc,mmsType,id,_mmsid){if(Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin==null){if(typeof(mmsConfigInfo)=="undefined"){mmsConfigInfo=ajaxSyncCall(Js.Center.SendMMS.MMSConfigInfo,"flag=mmsconfiginfo")}var previewMMSPanel;var editPanel=new Ext.FormPanel({id:"Js.Center.SendMMS.CopyMMS.editPanel",bodyStyle:"padding:10px 0 10px 15px",title:'编辑',region:'center',margins:'3 3 0 3',cmargins:'3 3 3 3',labelWidth:90,layout:'form',fileUpload:true,defaults:{msgTarget:"side"},items:[{xtype:'textfield',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'MMSname',fieldLabel:"彩信标题",disabled:true,width:350},{xtype:'numberfield',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'datframetime',fieldLabel:getHelpMsg("帧播放时间",true,"此项必填，范围在1-120，以秒为单位！"),allowBlank:false,blankText:'此项必填，范围在1-120，以秒为单位！',maxValue:120,maxText:'最大不能超过120秒',minValue:1,minText:'最小不能小于1秒',allowDecimals:false,value:"5",width:30},{xtype:'FileUpload',id:'Js.Center.SendMMS.CopyMMS.funcvc2image',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2image',fieldLabel:getHelpMsg("帧图片",false,"此项非必选项，上传图片格式为："+MMSIMAGEFILETYPEDESC+"，尺寸最大限制为"+mmsConfigInfo.imagewidth+" x "+mmsConfigInfo.imageheight+"（宽x高），大小不能超过"+mmsConfigInfo.imagesize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的图片！"),width:350},{xtype:'FileUpload',id:'Js.Center.SendMMS.CopyMMS.vc2Music',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2music',fieldLabel:getHelpMsg("帧背景音乐",false,"此项非必选项，上传音乐格式为："+MMSMUSICFILETYPEDESC+"，大小不能超过"+mmsConfigInfo.musicsize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的音乐！"),width:350},{xtype:'textarea',id:'Js.Center.SendMMS.CopyMMS.funcvc2word',name:'vc2word',style:'word-wrap:break-word;word-break:break-all;',fieldLabel:getHelpMsg("帧文字",false,"此项非必填项，长度不能超过2000！"),maxLength:2000,maxLengthText:'长度不能超过2000',regex:WXTL.Common.regex.IllegalDiy,regexText:WXTL.Common.regexText.IllegalDiyText,width:350,height:150,validator:function(){var word=Ext.get("Js.Center.SendMMS.CopyMMS.funcvc2word").dom.value;if(isExistsHtmlLable(word)){return false}else{return true}},invalidText:'帧文字不能包含HTML标签'},{xtype:'hidden',name:'numframeorder',fieldLabel:"帧序号",width:"90%",height:150},{xtype:'hidden',name:'currframejson',fieldLabel:"帧Json",width:"90%",height:150},{xtype:'hidden',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'flag',fieldLabel:"标识",width:350},{xtype:'hidden',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'mmsid',fieldLabel:"彩信编号",width:350}],buttons:[new Ext.Button({text:'修改帧',minWidth:70,handler:function(){if(editPanel.getForm().isValid()){if(checkMMSFrame(editPanel.items.items[2].getCheckValue(),previewMMSPanel.contentJson.frame[previewMMSPanel.currFrame].vc2image.vc2rescurl,editPanel.items.items[4].getValue(),editPanel.items.items[2].getValue())){if(editPanel.items.items[2].getValue()!=""&&!checkMMSFrameImageType(editPanel.items.items[2].getCheckValue(),editPanel.items.items[2].getValue())){return false}if(editPanel.items.items[3].getValue()!=""&&!checkMMSFrameMusicType(editPanel.items.items[3].getCheckValue(),editPanel.items.items[3].getValue())){return false}Ext.MessageBox.show({msg:'正在处理，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});editPanel.getForm().submit({url:Js.Center.SendMMS.MMSFrameUpdateURL,method:"POST",success:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);var falg=objJson.success;var frameJson=objJson.data;if(falg==true){if(!editPanel.items.items[2].getCheckValue()){if(editPanel.items.items[2].getValue()==""){if(previewMMSPanel.contentJson.frame[previewMMSPanel.currFrame].vc2image.vc2rescurl!=""){frameJson.vc2image=previewMMSPanel.contentJson.frame[previewMMSPanel.currFrame].vc2image}}}previewMMSPanel.contentJson.frame[previewMMSPanel.currFrame]=frameJson;previewMMSPanel.refreshAll();previewMMSPanel.render();previewMMSPanel.refreshBrotherPanel();Ext.Msg.alert("温馨提示","操作成功了!");if(document.getElementById("Js.Center.SendMMS.CopyMMS.funcvc2imagetf")!=null){editPanel.remove("Js.Center.SendMMS.CopyMMS.funcvc2image");var fileUp=new WXTL.Widgets.CommonForm.FileUpload({id:'Js.Center.SendMMS.CopyMMS.funcvc2image',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2image',fieldLabel:getHelpMsg("帧图片",false,"此项非必选项，上传图片格式为："+MMSIMAGEFILETYPEDESC+"，尺寸最大限制为"+mmsConfigInfo.imagewidth+" x "+mmsConfigInfo.imageheight+"（宽x高），大小不能超过"+mmsConfigInfo.imagesize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的图片！"),width:350});editPanel.insert(2,fileUp);editPanel.doLayout()}if(document.getElementById("Js.Center.SendMMS.CopyMMS.vc2Music")!=null){editPanel.remove("Js.Center.SendMMS.CopyMMS.vc2Music");var fileUp=new WXTL.Widgets.CommonForm.FileUpload({id:'Js.Center.SendMMS.CopyMMS.vc2Music',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2music',fieldLabel:getHelpMsg("帧背景音乐",false,"此项非必选项，上传音乐格式为："+MMSMUSICFILETYPEDESC+"，大小不能超过"+mmsConfigInfo.musicsize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的音乐！"),width:350});editPanel.insert(3,fileUp);editPanel.doLayout()}}else Ext.Msg.alert('温馨提示',objJson.info)},failure:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);Ext.Msg.alert('温馨提示',objJson.info)}})}}}})]});var framePanel=new WXTL.Widgets.CommonPanel.MMSFramePanel({id:"Js.Center.SendMMS.CopyMMS.framePanel",title:'帧',currFrame:0,region:'south',autoScroll:false,margins:'3 3 3 3',cmargins:'3 3 3 3',height:189,width:778,contentJson:Js.Center.SendMMS.MMS.InitMMSInfo,frame:false,listeners:{afterRefresh:function(obj,json,currFrame){editPanel.items.items[1].setValue(currFrame.numframetime);editPanel.items.items[2].setValue(currFrame.vc2image.vc2resurl);editPanel.items.items[3].setValue(currFrame.vc2backmusic.vc2resurl);editPanel.items.items[4].setValue(currFrame.vc2word.vc2rescdesc1);editPanel.items.items[5].setValue(currFrame.numframeorder);editPanel.items.items[7].setValue("mmscuroption")}}});previewMMSPanel=new WXTL.Widgets.CommonPanel.MMSpanel({id:"Js.Center.SendMMS.CopyMMS.previewMMSPanel",title:'预览：第1帧',region:'west',brotherPanel:framePanel,width:244,height:374,collapsible:true,margins:'3 0 0 3',cmargins:'3 3 3 3',frame:false});framePanel.brotherPanel=previewMMSPanel;var mainPanel=new Ext.Panel({width:778,height:573,frame:false,layout:'border',border:true,items:[previewMMSPanel,editPanel,framePanel]});Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin=new WXTL.Widgets.CommonWindows.Window({title:"编辑彩信",width:814,height:580,layout:'form',mainForm:editPanel.getForm(),autoScroll:true,displayStore:Js.Center.SendMMS.MMS.Infostore,needButtons:false,updateState:false,items:[mainPanel],needLoadDataStore:true,loadDataStoreFunc:function(){var mmsCopyJson=eval(doSynRequest(Js.Center.SendMMS.MMSQueryDescURL+"?flag=selectmms&nummmsseqid="+Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.updateRecord.nummmsid));Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.items.items[0].items.items[0].contentJson=mmsCopyJson;Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.items.items[0].items.items[2].contentJson=mmsCopyJson;Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.items.items[0].items.items[0].currFrame=0;Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.items.items[0].items.items[0].refreshAll();Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.items.items[0].items.items[2].refreshAll();Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.items.items[0].items.items[0].refreshBrotherPanel(0);editPanel.items.items[0].setValue(Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.updateRecord.mmsName);editPanel.items.items[8].setValue(Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.updateRecord.id)},buttons:[new Ext.Button({text:'保存彩信',minWidth:70,qtip:"保存彩信",handler:function(){if(checkMMS(previewMMSPanel.contentJson)){Ext.MessageBox.show({msg:'正在处理，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});previewMMSPanel.contentJson.vc2name=Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.updateRecord.mmsName;previewMMSPanel.contentJson.nummmstype=Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.updateRecord.mmsType;previewMMSPanel.contentJson.vc2desc=Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.updateRecord.mmsDesc;var url=Js.Center.SendMMS.MMSAddURL;var params={mmsjson:Ext.encode(previewMMSPanel.contentJson),mmsid:Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.updateRecord.id};Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.mainFormSubmitFunc('',params,Js.Center.SendMMS.MMSAddURL)}}}),new Ext.Button({text:'测试发送',qtip:"测试发送",minWidth:70,hidden:true,handler:function(){Js.Center.SendMMS.SendTest.func(previewMMSPanel.contentJson)}}),new Ext.Button({text:'关闭',qtip:"关闭",minWidth:70,handler:function(){Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.hide()}})],listeners:{"hide":function(){if(Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.items.items[0].items.items[0].bottomToolbar.items.items[0].text!="播放"){previewMMS(Js.Center.SendMMS.CopyMMS.CopyMMSInfoWin.items.items[0].items.items[0].contentJson.frame.length);window.clearInterval(playTime)}}}});}};Ext.namespace('Js.Center.SendMMS.MMSCopyInfo');Ext.QuickTips.init();Js.Center.SendMMS.MMSCopyInfo.info=function(show){if(Js.Center.SendMMS.MMSCopyInfo.window==null){var _pageSize=10;var fields=["nummmsid","vc2name","vc2centerid","datcreatetime","numuserid","vc2username","datmodifytime","numcheckuserid","datchecktime","vc2smilurl","numstate","nummmstype","datcreattime","nummoduserid","vc2modusername","vc2desc"];Js.Center.SendMMS.MMSCopyInfo.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.SendMMS.MMSQueryListURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"nummmsid",totalProperty:"totalCount"}),sortInfo:{field:'datcreattime',direction:'DESC'},baseParams:{datcreattimestart:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),datcreattimeend:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),mmsname:'',numcreater:'',numstate:'',flag:'selectall'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"nummmsid"});var cm=new Ext.grid.ColumnModel([{hidden:true,header:"彩信编号",tooltip:"彩信编号",dataIndex:"nummmsid",sortable:true},{header:"彩信标题",tooltip:"彩信标题",dataIndex:"vc2name",sortable:true},{header:"彩信名称",tooltip:"彩信名称",dataIndex:"vc2desc",sortable:true},{header:"彩信类型",tooltip:"彩信类型",dataIndex:"nummmstype",sortable:true,renderer:function(value){if(value==1){return"普通彩信"}else if(value==2){return"个性化彩信"}else{return""}}},{header:"创建人",tooltip:"创建人",dataIndex:"vc2username",sortable:true},{header:"创建时间",tooltip:"创建时间",dataIndex:"datcreatetime",sortable:true},{header:"修改人",tooltip:"最后修改人",dataIndex:"vc2modusername",sortable:true},{header:"修改时间",tooltip:"最后修改时间",dataIndex:"datmodifytime",sortable:true},{header:"测试预览",tooltip:"测试预览",dataIndex:"nummmsid",width:60,renderer:function(value,meta,record,rowIndex,colIndex,store){if(record.get('nummmstype')==2){return"<a href='#' onclick='Js.Center.SendMMS.MMSsendPreview.func(\"selectmms\","+value+",\"0\",\"Js.Center.SendMMS.MMSsendUpdate.sendtestcurdiy\")'>测试预览</a>"}return"<a href='#' onclick='Js.Center.SendMMS.MMSsendPreview.func(\"selectmms\","+value+",\"0\",\"Js.Center.SendMMS.MMSsendUpdate.sendtestcur\")'>测试预览</a>"}},{header:"复制彩信",tooltip:"复制彩信",dataIndex:"nummmsid",width:60,renderer:function(value,meta,record,rowIndex,colIndex,store){return"<a href='#' onclick='showMMSCopy("+rowIndex+")'>复制彩信</a>"}}]);var mmsGrid=new WXTL.Widgets.CommonGrid.GridPanel({width:782,pageSize:_pageSize,store:Js.Center.SendMMS.MMSCopyInfo.Infostore,needMenu:false,needRightMenu:false,sm:sm,cm:cm});showMMSCopy=function(rowIndex){var row=mmsGrid.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("温馨提示","请您选择一条记录!")}else if(row.length>1){Ext.Msg.alert("温馨提示","对不起，您只能选择一条记录!")}else if(row.length==1){Js.Center.SendMMS.CopyMMS.window.updateRecord=row[0];Js.Center.SendMMS.CopyMMS.window.mainForm.loadRecord(row[0]);Js.Center.SendMMS.CopyMMS.window.show()}if(Ext.getCmp("Js.Center.SendMMS.CopyMMS.editPanel")&&Ext.getCmp("Js.Center.SendMMS.CopyMMS.editPanel").getForm()){var editPanel=Ext.getCmp("Js.Center.SendMMS.CopyMMS.editPanel");if(document.getElementById("Js.Center.SendMMS.CopyMMS.funcvc2imagetf")!=null){editPanel.remove("Js.Center.SendMMS.CopyMMS.funcvc2image");var fileUp=new WXTL.Widgets.CommonForm.FileUpload({id:'Js.Center.SendMMS.CopyMMS.funcvc2image',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2image',fieldLabel:getHelpMsg("帧图片",false,"此项非必选项，上传图片格式为："+MMSIMAGEFILETYPEDESC+"，尺寸最大限制为"+mmsConfigInfo.imagewidth+" x "+mmsConfigInfo.imageheight+"（宽x高），大小不能超过"+mmsConfigInfo.imagesize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的图片！"),width:350});editPanel.insert(2,fileUp);editPanel.doLayout()}if(document.getElementById("Js.Center.SendMMS.CopyMMS.vc2Music")!=null){editPanel.remove("Js.Center.SendMMS.CopyMMS.vc2Music");var fileUp=new WXTL.Widgets.CommonForm.FileUpload({id:'Js.Center.SendMMS.CopyMMS.vc2Music',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2music',fieldLabel:getHelpMsg("帧背景音乐",false,"此项非必选项，上传音乐格式为："+MMSMUSICFILETYPEDESC+"，大小不能超过"+mmsConfigInfo.musicsize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的音乐！"),width:350});editPanel.insert(3,fileUp);editPanel.doLayout()}}Js.Center.SendMMS.MMSCopyInfo.window.hide()};var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"Js.Center.SendMMS.MMSCopyInfo.selectPanel",layout:'fit',queryMethod:"Js.Center.SendMMS.MMSCopyInfo.queryGrid",height:130,defaults:{msgTarget:"side"},items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0px 0 10px 15px",items:[new Ext.form.DateField({fieldLabel:"开始时间",format:'Y-m-d',labelWidth:100,bodyStyle:'padding:5px 5px 0',readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),fieldLabel:"开始时间",name:"datcreattimestart",id:"MMScopyinfodatcreattimestart",validateOnBlur:false,validator:function(){var strat_time=Ext.get("MMScopyinfodatcreattimestart").dom.value;var end_time=Ext.get("MMScopyinfodatcreattimeend").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'}),new Ext.form.TextField({fieldLabel:'彩信标题',name:'mmsname',id:'MMScopyinfoname',regex:WXTL.Common.regex.IllegalDiy,regexText:WXTL.Common.regexText.IllegalText,maxLength:20})]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0px 0 10px 15px",items:[new Ext.form.DateField({fieldLabel:"结束时间",labelWidth:100,format:'Y-m-d',bodyStyle:'padding:5px 5px 0',readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),name:"datcreattimeend",id:"MMScopyinfodatcreattimeend",validateOnBlur:false,validator:function(){var strat_time=Ext.get("MMScopyinfodatcreattimestart").dom.value;var end_time=Ext.get("MMScopyinfodatcreattimeend").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'}),{xtype:"xComboBox",name:"numuserid",fieldLabel:"创建人",emptyText:'-=请选择=-',hiddenName:"MMScopyinfoCreateuserid",readOnly:true,mode:"local",displayField:"vc2username",valueField:"numuserid",triggerAction:"all",store:Js.Center.Common.DepartUserStore}]}]}]});Js.Center.SendMMS.MMSCopyInfo.queryGrid=function(){if(selectPanel.getForm().isValid()){var datCreatTimeStart=Ext.get("MMScopyinfodatcreattimestart").getValue();var datCreatTimeend=Ext.get("MMScopyinfodatcreattimeend").getValue();var mmsName=Ext.get("MMScopyinfoname").getValue();var _numcreater=Ext.get("MMScopyinfoCreateuserid").getValue();var flag='selectall';Js.Center.SendMMS.MMSCopyInfo.Infostore.baseParams={datcreattimestart:datCreatTimeStart,datcreattimeend:datCreatTimeend,mmsname:mmsName,numcreater:_numcreater,numstate:'',flag:flag};Js.Center.SendMMS.MMSCopyInfo.Infostore.load({params:{start:0,limit:_pageSize}})}};this.window=new WXTL.Widgets.CommonWindows.Window({title:"复制彩信",autoScroll:true,width:800,height:505,mainForm:selectPanel.getForm(),needButtons:false,updateState:false,closeAction:'hide',items:[selectPanel,mmsGrid],buttons:[new Ext.Button({text:'关闭',minWidth:70,qtip:"关闭",handler:function(){Js.Center.SendMMS.MMSCopyInfo.window.hide()}})],listeners:{"show":function(){Js.Center.Common.DepartUserStore.reload();Js.Center.SendMMS.MMSCopyInfo.Infostore.load({params:{start:0,limit:_pageSize}})},"beforehide":function(){selectPanel.getForm().reset();Js.Center.SendMMS.MMSCopyInfo.queryGrid()}}})}};Ext.namespace('Js.Center.SendMMS.MMSdelete');Js.Center.SendMMS.MMSdelete.func=function(row){var deleteSplit="";for(var i=0;i<row.length;i++){if(row.length==1){deleteSplit=row[i].data.nummmsid}else{if(i<(row.length-1)){deleteSplit=row[i].data.nummmsid+","+deleteSplit}if(i==(row.length-1)){deleteSplit=deleteSplit+row[i].data.nummmsid}}};var params={ids:deleteSplit};doAjax(Js.Center.SendMMS.MMSDeleteURL,params,Js.Center.SendMMS.MMS.Infostore)};Ext.namespace('Js.Center.SendMMS.MMS');Js.Center.SendMMS.MMS.MMSinfo=function(node){Js.Center.SendMMS.MMS.InitMMSInfo=newMMS('','',1,1);if(Ext.get("Js.Center.SendMMS.MMS.mainpanel")==null){mmscopy=function(){Js.Center.SendMMS.MMSCopyInfo.window.show();};var _pageSize=12;var fields=["nummmsid","vc2name","vc2centerid","datcreatetime","numuserid","vc2username","datmodifytime","numcheckuserid","datchecktime","vc2smilurl","numstate","nummmstype","datcreattime","nummoduserid","vc2modusername","vc2desc"];Js.Center.SendMMS.MMS.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.SendMMS.MMSQueryListURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"nummmsid",totalProperty:"totalCount"}),sortInfo:{field:'datcreattime',direction:'DESC'},baseParams:{datcreattimestart:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),datcreattimeend:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),mmsname:'',numcreater:'',flag:'selectself'}});Js.Center.SendMMS.MMS.Infostore.load({params:{start:0,limit:_pageSize}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"nummmsid"});var cm=new Ext.grid.ColumnModel([sm,{hidden:true,header:"彩信编号",tooltip:"彩信编号",dataIndex:"nummmsid",sortable:true},{header:"彩信标题",tooltip:"彩信标题",dataIndex:"vc2name",sortable:true},{header:"彩信名称",tooltip:"彩信名称",dataIndex:"vc2desc",sortable:true},{header:"彩信类型",tooltip:"彩信类型",dataIndex:"nummmstype",sortable:true,renderer:function(value){if(value==1){return"普通彩信"}else if(value==2){return"个性化彩信"}else{return""}}},{header:"创建人",tooltip:"创建人",dataIndex:"vc2username",sortable:true},{header:"创建时间",tooltip:"创建时间",dataIndex:"datcreatetime",sortable:true},{header:"修改人",tooltip:"最后修改人",dataIndex:"vc2modusername",sortable:true},{header:"修改时间",tooltip:"最后修改时间",dataIndex:"datmodifytime",sortable:true},{header:"资源中心ID",tooltip:"资源中心ID",dataIndex:"vc2centerid",sortable:true},{header:"测试预览",tooltip:"测试预览",dataIndex:"nummmsid",width:60,renderer:function(value,meta,record,rowIndex,colIndex,store){if(record.get('nummmstype')==2){return"<a href='#' onclick='Js.Center.SendMMS.MMSsendPreview.func(\"selectmms\","+value+",\"0\",\"Js.Center.SendMMS.MMSsendUpdate.sendtestcurdiy\")'>测试预览</a>"}return"<a href='#' onclick='Js.Center.SendMMS.MMSsendPreview.func(\"selectmms\","+value+",\"0\",\"Js.Center.SendMMS.MMSsendUpdate.sendtestcur\")'>测试预览</a>"}},{header:"上传资源",tooltip:"上传资源",dataIndex:"nummmsid",width:60,renderer:function(value,meta,record,rowIndex,colIndex,store){return"<a href='#' onclick='Js.Center.SendMMS.MMSresourceUpload.func("+value+")'>上传资源</a>"}}]);var MMSarrInitLoadFunc=new Array();MMSarrInitLoadFunc[0]="Js.Center.SendMMS.MMSCopyInfo.info";MMSarrInitLoadFunc[1]="Js.Center.SendMMS.MMSAdd.func_edit";MMSarrInitLoadFunc[2]="Js.Center.SendMMS.MMSUpdate.func_Update";MMSarrInitLoadFunc[3]="Js.Center.SendMMS.CopyMMS.init";MMSarrInitLoadFunc[4]="Js.Center.SendMMS.CopyMMS.func";var mmsGrid=new WXTL.Widgets.CommonGrid.GridPanel({id:"mmsgridPanel",anchor:'100% 100%',pageSize:_pageSize,store:Js.Center.SendMMS.MMS.Infostore,needMenu:false,needRightMenu:false,afterEditURL:Js.Center.SendMMS.MMSUpdateURL,inertMethod:'Js.Center.SendMMS.MMSAdd',updateMethod:'Js.Center.SendMMS.MMSUpdate',deleteMethod:'Js.Center.SendMMS.MMSdelete.func',otherInitLoadFunc:MMSarrInitLoadFunc,tbar:new Ext.Toolbar({items:[{iconCls:'addicon',text:"添加",handler:function(){mmsGrid.doInsert()}},"","-","",{text:"修改",iconCls:"editicon",handler:function(){if(Ext.getCmp("Js.Center.SendMMS.MMSUpdate.updateEditPanel")&&Ext.getCmp("Js.Center.SendMMS.MMSUpdate.updateEditPanel").getForm()){var updateEditPanel=Ext.getCmp("Js.Center.SendMMS.MMSUpdate.updateEditPanel");if(document.getElementById("Js.Center.SendMMS.MMSUpdate.funcvc2imagetf")!=null){updateEditPanel.remove("Js.Center.SendMMS.MMSUpdate.funcvc2image");var fileUp=new WXTL.Widgets.CommonForm.FileUpload({id:'Js.Center.SendMMS.MMSUpdate.funcvc2image',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2image',fieldLabel:getHelpMsg("帧图片",false,"此项非必选项，上传图片格式为："+MMSIMAGEFILETYPEDESC+"，尺寸最大限制为"+mmsConfigInfo.imagewidth+" x "+mmsConfigInfo.imageheight+"（宽x高），大小不能超过"+mmsConfigInfo.imagesize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的图片！"),width:350});updateEditPanel.insert(2,fileUp);updateEditPanel.doLayout()}if(document.getElementById("Js.Center.SendMMS.MMSUpdate.vc2Music")!=null){updateEditPanel.remove("Js.Center.SendMMS.MMSUpdate.vc2Music");var fileUpMusic=new WXTL.Widgets.CommonForm.FileUpload({id:'Js.Center.SendMMS.MMSUpdate.vc2Music',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2music',fieldLabel:getHelpMsg("帧背景音乐",false,"此项非必选项，上传音乐格式为："+MMSMUSICFILETYPEDESC+"，大小不能超过"+mmsConfigInfo.musicsize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的音乐！"),width:350});updateEditPanel.insert(3,fileUpMusic);updateEditPanel.doLayout()}}mmsGrid.doEdit()}},"","-","",{text:"删除",iconCls:"deleteicon",handler:function(){mmsGrid.doDelete()}},"","-","",{text:"复制",iconCls:"copyicon",handler:mmscopy}]}),sm:sm,cm:cm});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"columnSelectPanel",layout:'fit',bodyStyle:"padding:10px 0 10px 15px",queryMethod:"Js.Center.SendMMS.MMS.queryGrid",height:160,defaults:{msgTarget:"side"},items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[new Ext.form.DateField({fieldLabel:"开始时间",format:'Y-m-d',labelWidth:100,bodyStyle:'padding:5px 5px 0',readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),fieldLabel:"开始时间",name:"datcreattimestart",id:"MMSinfodatcreattimestart",validateOnBlur:false,validator:function(){var strat_time=Ext.get("MMSinfodatcreattimestart").dom.value;var end_time=Ext.get("MMSinfodatcreattimeend").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'}),new Ext.form.TextField({fieldLabel:'彩信标题',name:'mmsname',id:'mmsname',regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:20})]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[new Ext.form.DateField({fieldLabel:"结束时间",labelWidth:100,format:'Y-m-d',bodyStyle:'padding:5px 5px 0',readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),name:"datcreattimeend",id:"MMSinfodatcreattimeend",validateOnBlur:false,validator:function(){var strat_time=Ext.get("MMSinfodatcreattimestart").dom.value;var end_time=Ext.get("MMSinfodatcreattimeend").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'})]}]}]});Js.Center.SendMMS.MMS.queryGrid=function(){if(selectPanel.getForm().isValid()){var datCreatTimeStart=Ext.get("MMSinfodatcreattimestart").getValue();var datCreatTimeend=Ext.get("MMSinfodatcreattimeend").getValue();var mmsName=Ext.get("mmsname").getValue();var flag='selectself';Js.Center.SendMMS.MMS.Infostore.baseParams={datcreattimestart:datCreatTimeStart,datcreattimeend:datCreatTimeend,mmsname:mmsName,numcreater:'',flag:flag};Js.Center.SendMMS.MMS.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.SendMMS.MMS.mainpanel=new Ext.Panel({id:"Js.Center.SendMMS.MMS.mainpanel",frame:true,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,mmsGrid]});};GridMain(node,Js.Center.SendMMS.MMS.mainpanel,"openroomiconinfo","Js.Center.SendMMS.MMS.Infostore");};Ext.namespace("Js.Center.SendMMS.MMSresourceUpload");Js.Center.SendMMS.MMSresourceUpload.func=function(MMSID){var mainPanel=new Ext.form.FormPanel({id:"Js.Center.SendMMS.MMSresourceUpload.MainPanel",bodyStyle:"padding:0px 0 0px 15px",defaults:{anchor:"90%",msgTarget:"side"},border:false,labelWidth:60,layout:'form',frame:true,items:[{xtype:'datefield',fieldLabel:"保存到",format:'Y-m-d',labelWidth:100,bodyStyle:'padding:5px 5px 0',readOnly:true,value:WXTL.Common.dateTime.addDay(new Date(),7),emptyText:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),name:"datcreattimestart",id:"Js.Center.SendMMS.MMSresourceUpload.UploadTime"},{xtype:"hidden",name:"flag",value:"mmsresourceup"},{xtype:"hidden",name:"nummmsid",value:MMSID}]});var mainForm=mainPanel.getForm();Js.Center.SendMMS.MMSresourceUpload.UploadWindow=new WXTL.Widgets.CommonWindows.Window({title:"彩信资源上传",width:259,height:100,layout:'form',mainForm:mainForm,autoScroll:false,collapsible:false,closeAction:'close',updateURL:Js.Center.SendMMS.MMSUpLoadingResourcesURL,displayStore:Js.Center.SendMMS.MMS.Infostore,needButtons:true,items:[mainPanel]});Js.Center.SendMMS.MMSresourceUpload.UploadWindow.show()};Ext.namespace('Js.Center.SendMMS.MMSUpdate');Ext.QuickTips.init();Js.Center.SendMMS.MMSUpdate.func=function(row){if(Ext.get("Js.Center.SendMMS.MMSUpdate.FormPanel")==null){var formPanel=new Ext.FormPanel({id:"Js.Center.SendMMS.MMSUpdate.FormPanel",bodyStyle:"padding:10px 10px 10px 15px",region:'center',margins:'3 3 0 3',cmargins:'3 3 3 3',labelWidth:80,layout:'form',bodyBorder:false,defaults:{msgTarget:"side"},items:[{xtype:'textfield',id:'Js.Center.SendMMS.MMSUpdate.initMMSnameUpdate',name:'vc2name',fieldLabel:getHelpMsg("彩信标题",true,"此项必填，用于在目标手机上显示的彩信标题，长度小于等于20！"),regex:WXTL.Common.regex.IllegalDiy,regexText:WXTL.Common.regexText.IllegalText,allowBlank:false,blankText:'此项必填，长度小于等于20！',maxLength:20,maxLengthText:'长度应小于等于20',width:250},{xtype:'textfield',id:'Js.Center.SendMMS.MMSUpdate.initvc2desc',name:'vc2desc',style:'word-wrap:break-word;word-break:break-all;',fieldLabel:getHelpMsg("彩信名称",false,"此项非必填项，用于区分相同标题的彩信，如果为空，默认为以上所填彩信标题，长度小于等于100！"),regex:WXTL.Common.regex.IllegalDiy,regexText:WXTL.Common.regexText.IllegalText,maxLength:100,maxLengthText:'长度不能超过100！',width:250},{xtype:"xComboBox",name:"nummmstype",fieldLabel:"彩信类型",triggerAction:'all',mode:"local",width:250,displayField:"vc2type",valueField:"numtype",store:new Ext.data.SimpleStore({fields:['numtype','vc2type'],data:[[1,'普通彩信'],[2,'个性化彩信']]})}]});this.window=new WXTL.Widgets.CommonWindows.Window({title:"编辑彩信",width:400,closeAction:'hide',mainForm:formPanel.getForm(),needButtons:false,displayStore:Js.Center.SendMMS.MMS.Infostore,updateState:true,updateRecord:row,items:[formPanel],buttons:[new Ext.Button({text:'继续',minWidth:70,qtip:"编辑彩信",handler:function(){if(formPanel.getForm().isValid()){var falg;var params={flag:"check",content:Ext.get("Js.Center.SendMMS.MMSUpdate.initMMSnameUpdate").dom.value};var _mmsDesc=Ext.get("Js.Center.SendMMS.MMSUpdate.initvc2desc").getValue();if(_mmsDesc==""){_mmsDesc=formPanel.items.items[0].el.dom.value}var newMMSParmas={mmsName:formPanel.items.items[0].el.dom.value,mmsDesc:_mmsDesc,mmsType:formPanel.items.items[2].getValue(),id:Js.Center.SendMMS.MMSUpdate.window.updateRecord.get("nummmsid")};Js.Center.SendMMS.MMSUpdate.EditMMSWin.updateRecord=newMMSParmas;Js.Center.SendMMS.MMSUpdate.window.mainFormSubmitFunc('Js.Center.SendMMS.MMSUpdate.EditMMSWin.show()',params,Js.Center.System.DirtyWordURL);}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){formPanel.getForm().loadRecord(Js.Center.SendMMS.MMSUpdate.window.updateRecord)}}),new Ext.Button({text:'关闭',qtip:"关闭",minWidth:70,handler:function(){Js.Center.SendMMS.MMSUpdate.window.hide()}})]})}else{Js.Center.SendMMS.MMSUpdate.window.updateRecord=row}};Js.Center.SendMMS.MMSUpdate.func_Update=function(){if(Js.Center.SendMMS.MMSUpdate.EditMMSWin==null){if(typeof(mmsConfigInfo)=="undefined"){mmsConfigInfo=ajaxSyncCall(Js.Center.SendMMS.MMSConfigInfo,"flag=mmsconfiginfo")}var updatePreviewMMSPanel;var fileUp=new WXTL.Widgets.CommonForm.FileUpload({xtype:'FileUpload',id:'Js.Center.SendMMS.MMSUpdate.funcvc2image',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2image',fieldLabel:getHelpMsg("帧图片",false,"此项非必选项，上传图片格式为："+MMSIMAGEFILETYPEDESC+"，尺寸最大限制为"+mmsConfigInfo.imagewidth+" x "+mmsConfigInfo.imageheight+"（宽x高），大小不能超过"+mmsConfigInfo.imagesize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的图片！"),width:350});var updateEditPanel=new Ext.FormPanel({id:"Js.Center.SendMMS.MMSUpdate.updateEditPanel",bodyStyle:"padding:10px 0 10px 15px",title:'编辑',region:'center',margins:'3 3 0 3',cmargins:'3 3 3 3',labelWidth:90,layout:'form',fileUpload:true,defaults:{msgTarget:"side"},items:[{xtype:'textfield',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'MMSname',fieldLabel:"彩信标题",disabled:true,width:350},{xtype:'numberfield',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'datframetime',fieldLabel:getHelpMsg("帧播放时间",true,"此项必填，范围在1-120，以秒为单位！"),allowBlank:false,blankText:'此项必填，范围在1-120，以秒为单位！',maxValue:120,maxText:'最大不能超过120秒',minValue:1,minText:'最小不能小于1秒',allowDecimals:false,value:"5",width:30},fileUp,{xtype:'FileUpload',id:'Js.Center.SendMMS.MMSUpdate.vc2Music',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2music',fieldLabel:getHelpMsg("帧背景音乐",false,"此项非必选项，上传音乐格式为："+MMSMUSICFILETYPEDESC+"，大小不能超过"+mmsConfigInfo.musicsize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的音乐！"),width:350},{xtype:'textarea',id:'Js.Center.SendMMS.MMSUpdate.mmseditvc2word',name:'vc2word',style:'word-wrap:break-word;word-break:break-all;',fieldLabel:getHelpMsg("帧文字",false,"此项非必填项，长度不能超过2000！"),maxLength:2000,maxLengthText:'长度不能超过2000',regex:WXTL.Common.regex.IllegalDiy,regexText:WXTL.Common.regexText.IllegalDiyText,width:350,height:150,validator:function(){var word=Ext.get("Js.Center.SendMMS.MMSUpdate.mmseditvc2word").dom.value;if(isExistsHtmlLable(word)){return false}else{return true}},invalidText:'帧文字不能包含HTML标签'},{xtype:'hidden',name:'numframeorder',fieldLabel:"帧序号",width:"90%",height:150},{xtype:'hidden',name:'currframejson',fieldLabel:"帧Json",width:"90%",height:150},{xtype:'hidden',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'flag',fieldLabel:"标识",width:350},{xtype:'hidden',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'mmsid',fieldLabel:"彩信编号",width:350}],buttons:[new Ext.Button({text:'修改帧',minWidth:70,handler:function(){if(updateEditPanel.getForm().isValid()){if(checkMMSFrame(updateEditPanel.items.items[2].getCheckValue(),updatePreviewMMSPanel.contentJson.frame[updatePreviewMMSPanel.currFrame].vc2image.vc2rescurl,updateEditPanel.items.items[4].getValue(),updateEditPanel.items.items[2].getValue())){if(updateEditPanel.items.items[2].getValue()!=""&&!checkMMSFrameImageType(updateEditPanel.items.items[2].getCheckValue(),updateEditPanel.items.items[2].getValue())){return false}if(updateEditPanel.items.items[3].getValue()!=""&&!checkMMSFrameMusicType(updateEditPanel.items.items[3].getCheckValue(),updateEditPanel.items.items[3].getValue())){return false}Ext.MessageBox.show({msg:'正在处理，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});updateEditPanel.getForm().submit({url:Js.Center.SendMMS.MMSFrameUpdateURL,method:"POST",success:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);var falg=objJson.success;var frameJson=objJson.data;if(falg==true){if(!updateEditPanel.items.items[2].getCheckValue()){if(updateEditPanel.items.items[2].getValue()==""){if(updatePreviewMMSPanel.contentJson.frame[updatePreviewMMSPanel.currFrame].vc2image.vc2rescurl!=""){frameJson.vc2image=updatePreviewMMSPanel.contentJson.frame[updatePreviewMMSPanel.currFrame].vc2image}}}updatePreviewMMSPanel.contentJson.frame[updatePreviewMMSPanel.currFrame]=frameJson;updatePreviewMMSPanel.refreshAll();updatePreviewMMSPanel.render();updatePreviewMMSPanel.refreshBrotherPanel();Ext.Msg.alert("温馨提示","操作成功了!");if(document.getElementById("Js.Center.SendMMS.MMSUpdate.funcvc2imagetf")!=null){updateEditPanel.remove("Js.Center.SendMMS.MMSUpdate.funcvc2image");fileUp=new WXTL.Widgets.CommonForm.FileUpload({id:'Js.Center.SendMMS.MMSUpdate.funcvc2image',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2image',fieldLabel:getHelpMsg("帧图片",false,"此项非必选项，上传图片格式为："+MMSIMAGEFILETYPEDESC+"，尺寸最大限制为"+mmsConfigInfo.imagewidth+" x "+mmsConfigInfo.imageheight+"（宽x高），大小不能超过"+mmsConfigInfo.imagesize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的图片！"),width:350});updateEditPanel.insert(2,fileUp);updateEditPanel.doLayout()}if(document.getElementById("Js.Center.SendMMS.MMSUpdate.vc2Music")!=null){updateEditPanel.remove("Js.Center.SendMMS.MMSUpdate.vc2Music");var fileUpMusic=new WXTL.Widgets.CommonForm.FileUpload({id:'Js.Center.SendMMS.MMSUpdate.vc2Music',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2music',fieldLabel:getHelpMsg("帧背景音乐",false,"此项非必选项，上传音乐格式为："+MMSMUSICFILETYPEDESC+"，大小不能超过"+mmsConfigInfo.musicsize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的音乐！"),width:350});updateEditPanel.insert(3,fileUpMusic);updateEditPanel.doLayout()}}else Ext.Msg.alert('温馨提示',objJson.info)},failure:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);Ext.Msg.alert('温馨提示',objJson.info)}})}}}})]});var updateFramePanel=new WXTL.Widgets.CommonPanel.MMSFramePanel({id:"Js.Center.SendMMS.MMSUpdate.updateFramePanel",title:'帧',currFrame:0,region:'south',autoScroll:false,margins:'3 3 3 3',cmargins:'3 3 3 3',height:189,width:778,contentJson:Js.Center.SendMMS.MMS.InitMMSInfo,frame:false,listeners:{afterRefresh:function(obj,json,currFrame){updateEditPanel.items.items[1].setValue(currFrame.numframetime);updateEditPanel.items.items[2].setValue(currFrame.vc2image.vc2resurl);updateEditPanel.items.items[3].setValue(currFrame.vc2backmusic.vc2resurl);updateEditPanel.items.items[4].setValue(currFrame.vc2word.vc2rescdesc1);updateEditPanel.items.items[5].setValue(currFrame.numframeorder);updateEditPanel.items.items[7].setValue("mmscuroption");}}});updatePreviewMMSPanel=new WXTL.Widgets.CommonPanel.MMSpanel({id:"Js.Center.SendMMS.MMSUpdate.updatePreviewMMSPanel",title:'预览：第1帧',region:'west',brotherPanel:updateFramePanel,width:244,height:374,collapsible:true,margins:'3 0 0 3',cmargins:'3 3 3 3',frame:false});updateFramePanel.brotherPanel=updatePreviewMMSPanel;var updateMainPanel=new Ext.Panel({width:778,height:573,frame:false,layout:'border',border:true,items:[updatePreviewMMSPanel,updateEditPanel,updateFramePanel]});Js.Center.SendMMS.MMSUpdate.EditMMSWin=new WXTL.Widgets.CommonWindows.Window({title:"编辑彩信",width:814,height:530,mainForm:updateEditPanel.getForm(),layout:'form',autoScroll:true,displayStore:Js.Center.SendMMS.MMS.Infostore,needButtons:false,updateState:false,items:[updateMainPanel],needLoadDataStore:true,loadDataStoreFunc:function(){var mmsUpdateJson=eval(doSynRequest(Js.Center.SendMMS.MMSQueryDescURL+"?flag=selectmms&nummmsseqid="+Js.Center.SendMMS.MMSUpdate.EditMMSWin.updateRecord.id));Js.Center.SendMMS.MMSUpdate.EditMMSWin.items.items[0].items.items[0].contentJson=mmsUpdateJson;Js.Center.SendMMS.MMSUpdate.EditMMSWin.items.items[0].items.items[2].contentJson=mmsUpdateJson;Js.Center.SendMMS.MMSUpdate.EditMMSWin.items.items[0].items.items[0].currFrame=0;Js.Center.SendMMS.MMSUpdate.EditMMSWin.items.items[0].items.items[0].refreshAll();Js.Center.SendMMS.MMSUpdate.EditMMSWin.items.items[0].items.items[2].refreshAll();Js.Center.SendMMS.MMSUpdate.EditMMSWin.items.items[0].items.items[0].refreshBrotherPanel(0);updateEditPanel.items.items[0].setValue(Js.Center.SendMMS.MMSUpdate.EditMMSWin.updateRecord.mmsName);updateEditPanel.items.items[8].setValue(Js.Center.SendMMS.MMSUpdate.EditMMSWin.updateRecord.id);},buttons:[new Ext.Button({text:'保存彩信',minWidth:70,qtip:"保存彩信",handler:function(){if(checkMMS(updatePreviewMMSPanel.contentJson)){Ext.MessageBox.show({msg:'正在处理，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});updatePreviewMMSPanel.contentJson.vc2name=Js.Center.SendMMS.MMSUpdate.EditMMSWin.updateRecord.mmsName;updatePreviewMMSPanel.contentJson.nummmstype=Js.Center.SendMMS.MMSUpdate.EditMMSWin.updateRecord.mmsType;updatePreviewMMSPanel.contentJson.vc2desc=Js.Center.SendMMS.MMSUpdate.EditMMSWin.updateRecord.mmsDesc;var url=Js.Center.SendMMS.MMSUpdateURL;var params={mmsjson:Ext.encode(updatePreviewMMSPanel.contentJson)};Ext.Ajax.request({url:url,method:"POST",params:params,success:function(form,action){var obj=Ext.util.JSON.decode(form.responseText);var falg=obj.success;if(falg==true){Ext.Msg.alert("温馨提示","操作已成功!");Js.Center.SendMMS.MMSUpdate.EditMMSWin.hide();if(Js.Center.SendMMS.MMS.Infostore!=null)Js.Center.SendMMS.MMS.Infostore.reload()}else Ext.Msg.alert('温馨提示',obj.info)},failure:function(form,action){Ext.Msg.alert('温馨提示','系统忙，请稍候...')}})}}}),new Ext.Button({hidden:true,text:'测试发送',qtip:"测试发送",minWidth:70,handler:function(){Js.Center.SendMMS.SendTest.func(updatePreviewMMSPanel.contentJson)}}),new Ext.Button({text:'关闭',qtip:"关闭",minWidth:70,handler:function(){Js.Center.SendMMS.MMSUpdate.EditMMSWin.hide()}})],listeners:{"hide":function(){if(Js.Center.SendMMS.MMSUpdate.EditMMSWin.items.items[0].items.items[0].bottomToolbar.items.items[0].text!="播放"){previewMMS(Js.Center.SendMMS.MMSUpdate.EditMMSWin.items.items[0].items.items[0].contentJson.frame.length);window.clearInterval(playTime)}}}});}};Ext.namespace('Js.Center.SendMMS');Js.Center.SendMMS.MMSQueryListURL="URL/sendMMS/MMS/mmsquerylist.ashx";Js.Center.SendMMS.MMSQueryDescURL='URL/sendMMS/MMS/mmsquerydesc.ashx';Js.Center.SendMMS.MMSAddURL='URL/sendMMS/MMS/mmsadd.ashx';Js.Center.SendMMS.GetRandomMMSIDURL='URL/sendMMS/MMS/getrandommmsid.ashx';Js.Center.SendMMS.GetRandomMMSIDCopyURL='URL/sendMMS/MMS/getrandommmsidbycopy.ashx';Js.Center.SendMMS.MMSUpdateURL='URL/sendMMS/MMS/mmsupdate.ashx';Js.Center.SendMMS.MMSSaveURL='URL/sendMMS/MMS/mmssave.ashx';Js.Center.SendMMS.MMSDeleteURL='URL/sendMMS/MMS/mmsdelete.ashx';Js.Center.SendMMS.MMSFrameUpdateURL='URL/sendMMS/MMS/mmsframeupdate.ashx';Js.Center.SendMMS.MMSFrameAddURL='URL/sendMMS/MMS/mmsframeadd.ashx';Js.Center.SendMMS.MMSFrameDeleteURL='URL/sendMMS/MMS/mmsframedelete.ashx';Js.Center.SendMMS.MMSUpLoadingResourcesURL="URL/SendMMS/MMS/MMSResourceUp.ashx";Js.Center.SendMMS.MMSConfigInfo="URL/sendMMS/MMS/mmsconfiginfo.ashx";