Ext.namespace('Js.Center.SendMMS.MMSSend');Js.Center.SendMMS.MMSSend.MMSinfo=function(){if(Ext.get("Js.Center.SendMMS.MMSSend.MainPanel")==null){var _pageSize=5;var fields=["nummmsid","vc2name","vc2centerid","datcreatetime","numuserid","vc2username","datmodifytime","numcheckuserid","datchecktime","vc2smilurl","numstate","nummmstype","datcreattime","nummoduserid","vc2modusername","vc2desc"];Js.Center.SendMMS.MMSSend.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.SendMMS.MMSQueryListURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"nummmsid",totalProperty:"totalCount"}),sortInfo:{field:'datcreattime',direction:'DESC'},baseParams:{datcreattimestart:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),datcreattimeend:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),mmsname:'',numcreater:'',numMMSType:1,flag:'selectByMMSType'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"nummmsid"});var cm=new Ext.grid.ColumnModel([{hidden:true,header:"彩信编号",tooltip:"彩信编号",dataIndex:"nummmsid",sortable:true},{header:"彩信标题",tooltip:"彩信标题",dataIndex:"vc2name",sortable:true},{header:"彩信名称",tooltip:"彩信名称",dataIndex:"vc2desc",sortable:true},{header:"创建人",tooltip:"创建人",dataIndex:"vc2username",sortable:true},{header:"创建时间",tooltip:"创建时间",dataIndex:"datcreatetime",sortable:true},{header:"修改人",tooltip:"最后修改人",dataIndex:"vc2modusername",sortable:true},{header:"修改时间",tooltip:"最后修改时间",dataIndex:"datmodifytime",sortable:true},{header:"测试预览",tooltip:"测试预览",dataIndex:"nummmsid",width:60,renderer:function(value,meta,record,rowIndex,colIndex,store){return"<a href='#' onclick='Js.Center.SendMMS.MMSsendPreview.func(\"selectmms\","+value+",0,\"Js.Center.SendMMS.MMSsendUpdate.sendtestcur\")'>测试预览</a>"}}]);var gridPanel=new WXTL.Widgets.CommonGrid.GridPanel({title:"",id:"Js.Center.SendMMS.MMSSend.gridPanel",anchor:'100% 100%',pageSize:_pageSize,needMenu:false,needRightMenu:false,width:400,store:Js.Center.SendMMS.MMSSend.Infostore,sm:sm,cm:cm,listeners:{"rowclick":function(grid,rowindex,e){Js.Center.SendMMS.MMSSend.MMSSendPanel.items.items[2].items.items[0].items.items[2].setValue(grid.store.data.items[rowindex].data.nummmsid);Js.Center.SendMMS.MMSSend.MMSSendPanel.items.items[2].items.items[0].items.items[3].setValue(grid.store.data.items[rowindex].data.vc2name)}}});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"Js.Center.SendMMS.MMSsend.SelectPanel",title:"",labelWidth:55,queryMethod:"Js.Center.SendMMS.MMSSend.queryGrid",height:55,frame:false,defaults:{msgTarget:"side"},items:[{layout:'column',items:[{columnWidth:.33,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0 0 0 15px",items:[new Ext.form.DateField({fieldLabel:"开始时间",format:'Y-m-d',labelWidth:100,bodyStyle:'padding:5px 5px 0',readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),fieldLabel:"开始时间",name:"datcreattimestart",id:"Js.Center.SendMMS.MMSsend.DatCreatTimeStart",validateOnBlur:false,validator:function(){var strat_time=Ext.get("Js.Center.SendMMS.MMSsend.DatCreatTimeStart").dom.value;var end_time=Ext.get("Js.Center.SendMMS.MMSsend.DatCreatTimeEnd").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'})]},{columnWidth:.33,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0 0 0 15px",items:[new Ext.form.DateField({fieldLabel:"结束时间",labelWidth:100,format:'Y-m-d',bodyStyle:'padding:5px 5px 0',readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),name:"datcreattimeend",id:"Js.Center.SendMMS.MMSsend.DatCreatTimeEnd",validateOnBlur:false,validator:function(){var strat_time=Ext.get("Js.Center.SendMMS.MMSsend.DatCreatTimeStart").dom.value;var end_time=Ext.get("Js.Center.SendMMS.MMSsend.DatCreatTimeEnd").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'})]},{columnWidth:.33,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0 0 0 15px",items:[new Ext.form.TextField({fieldLabel:'彩信标题',name:'mmsname',id:'Js.Center.SendMMS.MMSsendsend.mmsname',regex:WXTL.Common.regex.IllegalDiy,regexText:WXTL.Common.regexText.IllegalText,maxLength:100})]}]}]});Js.Center.SendMMS.MMSSend.queryGrid=function(){if(selectPanel.getForm().isValid()){var datCreatTimeStart=Ext.get("Js.Center.SendMMS.MMSsend.DatCreatTimeStart").getValue();var datCreatTimeend=Ext.get("Js.Center.SendMMS.MMSsend.DatCreatTimeEnd").getValue();var mmsName=Ext.get("Js.Center.SendMMS.MMSsendsend.mmsname").getValue();var flag='selectByMMSType';Js.Center.SendMMS.MMSSend.Infostore.baseParams={datcreattimestart:datCreatTimeStart,datcreattimeend:datCreatTimeend,mmsname:mmsName,numcreater:'',numMMSType:'1',flag:flag};Js.Center.SendMMS.MMSSend.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.SendMMS.MMSSend.MainPanel=new Ext.Panel({title:"选择彩信",id:"Js.Center.SendMMS.MMSSend.MainPanel",margins:'3 3 3 3',cmargins:'3 3 3 3',frame:true,bodyWidth:0,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,gridPanel]});}};Ext.namespace('Js.Center.SendMMS.MMSSendDiy');Js.Center.SendMMS.MMSSendDiy.MMSinfo=function(){if(Ext.get("Js.Center.SendMMS.MMSSendDiy.MainPanel")==null){var _pageSize=5;var fields=["nummmsid","vc2name","vc2centerid","datcreatetime","numuserid","vc2username","datmodifytime","numcheckuserid","datchecktime","vc2smilurl","numstate","nummmstype","datcreattime","nummoduserid","vc2modusername","vc2desc"];Js.Center.SendMMS.MMSSendDiy.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.SendMMS.MMSQueryListURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"nummmsid",totalProperty:"totalCount"}),sortInfo:{field:'datcreattime',direction:'DESC'},baseParams:{datcreattimestart:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),datcreattimeend:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),mmsname:'',numcreater:'',numMMSType:'2',flag:'selectByMMSType'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"nummmsid"});var cm=new Ext.grid.ColumnModel([{hidden:true,header:"彩信编号",tooltip:"彩信编号",dataIndex:"nummmsid",sortable:true},{header:"彩信标题",tooltip:"彩信标题",dataIndex:"vc2name",sortable:true},{header:"彩信名称",tooltip:"彩信名称",dataIndex:"vc2desc",sortable:true},{header:"创建人",tooltip:"创建人",dataIndex:"vc2username",sortable:true},{header:"创建时间",tooltip:"创建时间",dataIndex:"datcreatetime",sortable:true},{header:"修改人",tooltip:"最后修改人",dataIndex:"vc2modusername",sortable:true},{header:"修改时间",tooltip:"最后修改时间",dataIndex:"datmodifytime",sortable:true},{header:"测试预览",tooltip:"测试预览",dataIndex:"nummmsid",width:60,renderer:function(value,meta,record,rowIndex,colIndex,store){if(record.get('nummmstype')==2){return"<a href='#' onclick='Js.Center.SendMMS.MMSsendPreview.func(\"selectmms\","+value+",\"0\",\"Js.Center.SendMMS.MMSsendUpdate.sendtestcurdiy\")'>测试预览</a>"}return"<a href='#' onclick='Js.Center.SendMMS.MMSsendPreview.func(\"selectmms\","+value+",\"0\",\"Js.Center.SendMMS.MMSsendUpdate.sendtestcur\")'>测试预览</a>"}}]);var MMSSendDiyGrid=new WXTL.Widgets.CommonGrid.GridPanel({title:"",id:"Js.Center.SendMMS.MMSSendDiy.GridPanel",anchor:'100% 100%',pageSize:_pageSize,needMenu:false,needRightMenu:false,width:400,store:Js.Center.SendMMS.MMSSendDiy.Infostore,sm:sm,cm:cm,listeners:{"rowclick":function(grid,rowindex,e){Js.Center.SendMMS.MMSSendDiy.MMSSendPanel.items.items[0].items.items[0].items.items[3].setValue(grid.store.data.items[rowindex].data.nummmsid)}}});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"Js.Center.SendMMS.MMSsenddiysend.columnSelectPanel",title:"",labelWidth:55,queryMethod:"Js.Center.SendMMS.MMSSendDiy.queryGrid",height:55,width:400,frame:false,defaults:{msgTarget:"side"},items:[{layout:'column',items:[{columnWidth:.33,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0 0 0 15px",items:[new Ext.form.DateField({fieldLabel:"开始时间",format:'Y-m-d',labelWidth:100,bodyStyle:'padding:5px 5px 0',readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),fieldLabel:"开始时间",name:"datcreattimestart",id:"Js.Center.SendMMS.MMSsendDiy.DatCreatTimeStart",validateOnBlur:false,validator:function(){var strat_time=Ext.get("Js.Center.SendMMS.MMSsendDiy.DatCreatTimeStart").dom.value;var end_time=Ext.get("Js.Center.SendMMS.MMSSendDiy.DatCreatTimeEnd").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'})]},{columnWidth:.33,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0 0 0 15px",items:[new Ext.form.DateField({fieldLabel:"结束时间",labelWidth:100,format:'Y-m-d',bodyStyle:'padding:5px 5px 0',readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),name:"datcreattimeend",id:"Js.Center.SendMMS.MMSSendDiy.DatCreatTimeEnd",validateOnBlur:false,validator:function(){var strat_time=Ext.get("Js.Center.SendMMS.MMSsendDiy.DatCreatTimeStart").dom.value;var end_time=Ext.get("Js.Center.SendMMS.MMSSendDiy.DatCreatTimeEnd").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'})]},{columnWidth:.33,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0 0 0 15px",items:[new Ext.form.TextField({fieldLabel:'彩信标题',name:'mmsname',id:'Js.Center.SendMMS.MMSSendDiy.mmsName',regex:WXTL.Common.regex.IllegalDiy,regexText:WXTL.Common.regexText.IllegalText,maxLength:100})]}]}]});Js.Center.SendMMS.MMSSendDiy.queryGrid=function(){if(selectPanel.getForm().isValid()){var datCreatTimeStart=Ext.get("Js.Center.SendMMS.MMSsendDiy.DatCreatTimeStart").getValue();var datCreatTimeend=Ext.get("Js.Center.SendMMS.MMSSendDiy.DatCreatTimeEnd").getValue();var mmsName=Ext.get("Js.Center.SendMMS.MMSSendDiy.mmsName").getValue();var flag='selectByMMSType';Js.Center.SendMMS.MMSSendDiy.Infostore.baseParams={datcreattimestart:datCreatTimeStart,datcreattimeend:datCreatTimeend,mmsname:mmsName,numcreater:'',numMMSType:'2',flag:flag};Js.Center.SendMMS.MMSSendDiy.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.SendMMS.MMSSendDiy.MainPanel=new Ext.Panel({title:"选择彩信",id:"Js.Center.SendMMS.MMSSendDiy.MainPanel",margins:'3 3 3 3',cmargins:'3 3 3 3',frame:true,bodyWidth:0,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,MMSSendDiyGrid]});}};Ext.namespace('Js.Center.SendMMS.MMSSend');Js.Center.SendMMS.MMSSend.func=function(show,row){if(Ext.get("Js.Center.SendMMS.MMSSend.MMSSendPanel")==null){var activeTabPanel;Js.Center.SendMMS.MMSSend.UserGroupStore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.UserGroupURL,method:"POST"}),reader:new Ext.data.JsonReader({totalProperty:'totalProperty',root:'data',fields:[{name:'id'},{name:'name'},{name:'boxLabel',mapping:"vc2usergroupname"},{name:'inputValue',mapping:"numusergroupid"},{name:'checked'}]}),baseParams:{flag:"selectallbyuserid",columnlist:"numusergroupid,vc2usergroupname"}});var groupPanel=new WXTL.Widgets.CommonPanel.CheckBoxGroupPanel({store:Js.Center.SendMMS.MMSSend.UserGroupStore,defaultItemsName:'numusergroupid',defaultItemsboxLable:'对不起，没有相关客户组信息。',style:"padding:5px 5px 5px 5px",id:"Js.Center.SendMMS.MMSSend.remoteCheckboxGroup",numcolumns:3,blankText:"请选择客户组",allowBlank:false,name:"客户组："});var productCombox=new Ext.form.ComboBox({xtype:"combo",name:"numproductid",hiddenName:"numproductid",id:'Js.Center.SendMMS.MMSSend.numproductid',emptyText:"-=请选择=-",allowBlank:false,balakText:'通道组不能为空！',fieldLabel:"<font color=red>选择通道组</font>",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numprodid",triggerAction:"all",store:Js.Center.Common.ProductStore});Js.Center.SendMMS.MMSSend.smsFieldSet=new Ext.Panel({layout:'column',labelWidth:60,items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 0 0px",items:[{xtype:'hidden',fieldLabel:"发送方式 1、栏目 2、客户组 3、持仓股票 4、文件  5、手机号码",name:'numsendtype',id:'Js.Center.SendMMS.MMSSend.sendnumsendtype',value:'Js.Center.SendMMS.MMSSend.sendbyusergroup'},{xtype:'xDateTime',fieldLabel:'发送时间',layout:'form',name:"datstarttime",id:"Js.Center.SendMMS.MMSSend.datstarttime",timeFormat:'H:i:s',value:WXTL.Common.dateTime.getNow(),timeConfig:{altFormats:'H:i:s',allowBlank:true,invalidText:'{0} 是无效的时间-必须符合格式为：H:i:s'},dateFormat:'Y-m-d',dateConfig:{altFormats:'Y-m-d',allowBlank:true}},{xtype:'hidden',fieldLabel:'要发送的彩信',id:"Js.Center.SendMMS.MMSSend.nummmsid",name:"nummmsid"},{xtype:'hidden',fieldLabel:'发送彩信标题',id:"Js.Center.SendMMS.MMSSend.vc2name",name:"vc2name"}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 0 0px",items:[{xtype:'xDateTime',fieldLabel:'结束时间',layout:'form',name:"datendtime",addDays:1,id:"Js.Center.SendMMS.MMSSend.datendtime",timeFormat:'H:i:s',value:WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),1),timeConfig:{altFormats:'H:i:s',allowBlank:true,invalidText:'{0} 是无效的时间-必须符合格式为：H:i:s'},dateFormat:'Y-m-d',dateConfig:{altFormats:'Y-m-d',allowBlank:true}}]}]});Js.Center.SendMMS.MMSSend.MMSinfo();Js.Center.SendMMS.MMSSend.MMSSendPanel=new Ext.FormPanel({id:"Js.Center.SendMMS.MMSSend.MMSSendPanel",fileUpload:true,labelAlign:'left',frame:true,labelWidth:80,style:"background-color:#e7e8f0",bodyStyle:'padding:5px 0 0 5px;',defaults:{msgTarget:"side"},items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",items:[productCombox]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",items:[{xtype:"combo",name:"numpriority",fieldLabel:"<font color=red>优先级</font>",hiddenName:"numpriority",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",allowBlank:false,blankText:"优先级类型不允许为空",emptyText:"请选择",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["正常","0"],["及时","1"],["紧急","2"]]}),value:0}]}]},{xtype:'tabpanel',layoutOnTabChange:true,defaults:{bodyStyle:'padding:0px 0 0 0px;'},plain:true,activeTab:0,height:130,items:[{title:'按客户组发送',autoScroll:true,layout:'form',defaultType:'textfield',id:"Js.Center.SendMMS.MMSSend.sendbyusergroup",items:[groupPanel]},{title:'按文件发送',layout:'form',id:"Js.Center.SendMMS.MMSSend.sendbyfile",defaultType:'textfield',items:[{xtype:'UploadLargeFilePanel',id:'Js.Center.SendMMS.MMSSend.UploadLargeFile',fieldlableFile:getHelpMsg("文件",true,"1、文件格式为txt<br>2、客户端文件请选择小于4M的文件，大文件请选择服务器端文件；<br>3、内容格式:　<img src=jspack/product/common/Images/help/mobilefile.jpg align=top/>"),txtMsgHeight:60,needLargfile:false}]},{title:'按输入号码发送',id:"Js.Center.SendMMS.MMSSend.sendbylist",layout:'form',bodyStyle:"padding:10px 0 0 0px",autoScroll:true,items:[{xtype:'textarea',name:'mobilelist',id:'Js.Center.SendMMS.MMSSend.mobilelist',allowBlank:false,blankText:"请输入手机号码列表",fieldLabel:WXTL.Common.help.MOBILELIST,width:300,height:66,maxLength:13000,maxLengthText:"请将输入内容控制在1000行以内！",validator:function(value){return checkMobileList(value,1000)}}]}],listeners:{"tabchange":function(TabPanel,Panel){activeTabPanel=TabPanel.getActiveTab();Js.Center.SendMMS.MMSSend.sendtypename=Panel.title;if(Ext.get("Js.Center.SendMMS.MMSSend.sendnumsendtype")!=null){Ext.get("Js.Center.SendMMS.MMSSend.sendnumsendtype").dom.value=Panel.id}}}},Js.Center.SendMMS.MMSSend.smsFieldSet]});var mainForm=Js.Center.SendMMS.MMSSend.MMSSendPanel.getForm();Js.Center.SendMMS.MMSSend.MMSSendInfoWin=new WXTL.Widgets.CommonWindows.Window({title:"发送普通彩信",mainForm:Js.Center.SendMMS.MMSSend.MMSSendPanel.getForm(),needButtons:false,closeAction:'hide',updateURL:Js.Center.SendMMS.mmscontentaddURL,displayStore:Js.Center.SendMMS.MMSSend.Infostore,updateState:true,updateRecord:row,items:[Js.Center.SendMMS.MMSSend.MMSSendPanel,Js.Center.SendMMS.MMSSend.MainPanel],buttons:[new Ext.Button({text:'提交',minWidth:70,handler:function(){Ext.getCmp("Js.Center.SendMMS.MMSSend.datstarttime").updateDate();Ext.getCmp("Js.Center.SendMMS.MMSSend.datendtime").updateDate();Ext.getCmp("Js.Center.SendMMS.MMSSend.datstarttime").updateTime();Ext.getCmp("Js.Center.SendMMS.MMSSend.datendtime").updateTime();var datStart_date=Js.Center.SendMMS.MMSSend.smsFieldSet.items.items[0].items.items[1].getValue();var datend_date=Js.Center.SendMMS.MMSSend.smsFieldSet.items.items[1].items.items[0].getValue();if(Date.parse(WXTL.Common.dateTime.getNowDate())-Date.parse(datStart_date)>0){Ext.Msg.alert("温馨提示：","发送时间不能早于当前时间");return false}if(Date.parse(datStart_date)-Date.parse(datend_date)>0){Ext.Msg.alert("温馨提示：","结束时间不能早于发送时间");return false}if(Date.parse(datend_date)-Date.parse(WXTL.Common.dateTime.getNow())<0){Ext.Msg.alert("温馨提示：","结束时间不能早于当前时间");return false}Js.Center.SendMMS.MMSSend.saveSMS("submit")}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){Js.Center.SendMMS.MMSSend.MMSSendInfoWin.hide()}})],listeners:{"show":function(){Js.Center.Common.ProductStore.reload({params:{vc2servicetype:'2'}});Js.Center.SendMMS.MMSSend.UserGroupStore.reload();Js.Center.SendMMS.MMSSend.queryGrid();Js.Center.SendMMS.MMSSend.MainPanel.items.items[1].getSelectionModel().clearSelections()},"beforehide":function(){Js.Center.SendMMS.MMSSend.MMSSendInfoWin.mainForm.reset();groupPanel.reset();Ext.getCmp("Js.Center.SendMMS.MMSsend.SelectPanel").getForm().reset();Js.Center.SendMMS.MMSSend.MMSSendPanel.items.items[1].setActiveTab(0)}}})}else{Js.Center.SendMMS.MMSSend.MMSSendInfoWin.mainForm.items.each(function(f){if(f.xtype!=null)f.reset();else{f.df.reset()}});Js.Center.SendMMS.MMSSend.MMSSendInfoWin.updateRecord=row};var isSelfValid=function(){var valid=true;var panel=Js.Center.SendMMS.MMSSend.MMSSendInfoWin.items.items[0].items.items[1].getActiveTab();if(!Js.Center.SendMMS.MMSSend.MMSSendInfoWin.mainForm.items.items[0].validate()){valid=false}panel.items.each(function(f){if(panel.id!="Js.Center.SendMMS.MMSSend.sendbyusergroup"){if(f.xtype=="UploadLargeFilePanel"){if(!f.items.items[0].items.items[2].items.items[0].validate()){valid=false}if(!f.items.items[0].items.items[0].items.items[2].validate()){valid=false}}else{if(!f.validate()){valid=false}}}else{if(f.xtype!="hidden"){if(!f.items.items[1].validate()){valid=false}}}});if(Js.Center.SendMMS.MMSSend.smsFieldSet.items.items[0].items.items[2].getValue()==""){Ext.Msg.alert("温馨提示","对不起,请先选择一条彩信!");valid=false}return valid};Js.Center.SendMMS.MMSSend.saveSMS=function(method){if(Ext.get("sendflag")!=null)Ext.get("sendflag").dom.value=method;Js.Center.SendMMS.MMSSend.MMSSendInfoWin.mainForm.valid=true;if(isSelfValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.SendMMS.MMSSend.MMSSendInfoWin.mainFormSubmitFunc()}};if(show){Js.Center.SendMMS.MMSSend.MMSSendInfoWin.show()}};Ext.namespace('Js.Center.SendMMS.MMSsendUpdate');Js.Center.SendMMS.MMSsendUpdate.MMSSendContent=function(mmsName,id){var json=newMMS('','',1,1);var _mmsid=id;if(Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin==null){if(typeof(mmsConfigInfo)=="undefined"){mmsConfigInfo=ajaxSyncCall(Js.Center.SendMMS.MMSConfigInfo,"flag=mmsconfiginfo")}Js.Center.SendMMS.MMSsendUpdate.EditPanel=new Ext.FormPanel({bodyStyle:"padding:10px 0 10px 15px",title:'编辑',region:'center',labelWidth:90,layout:'form',fileUpload:true,defaults:{msgTarget:"side"},items:[{xtype:'textfield',id:'Js.Center.SendMMS.MMSsendUpdate.ContentMMSName',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'MMSname',fieldLabel:"彩信标题",disabled:true,width:350},{xtype:'numberfield',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'datframetime',fieldLabel:getHelpMsg("帧播放时间",true,"此项必填，范围在1-120，以秒为单位！"),allowBlank:false,blankText:'此项必填，范围在1-120，以秒为单位！',maxValue:120,maxText:'最大不能超过120秒',minValue:1,minText:'最小不能小于1秒',allowDecimals:false,value:"5",width:30},{xtype:'FileUpload',id:'Js.Center.SendMMS.MMSsendUpdate.vc2Image',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2image',fieldLabel:getHelpMsg("帧图片",false,"此项非必选项，上传图片格式为："+MMSIMAGEFILETYPEDESC+"，尺寸最大限制为"+mmsConfigInfo.imagewidth+" x "+mmsConfigInfo.imageheight+"（宽x高），大小不能超过"+mmsConfigInfo.imagesize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的图片！"),width:200},{xtype:'FileUpload',id:'Js.Center.SendMMS.MMSsendUpdate.vc2Music',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2music',fieldLabel:getHelpMsg("帧背景音乐",false,"此项非必选项，上传音乐格式为："+MMSMUSICFILETYPEDESC+"，大小不能超过"+mmsConfigInfo.musicsize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的音乐！"),width:350},{xtype:'textarea',id:'Js.Center.SendMMS.MMSsendUpdate.vc2Word',name:'vc2word',style:'word-wrap:break-word;word-break:break-all;',fieldLabel:getHelpMsg("帧文字",false,"此项非必填项，长度不能超过2000！"),maxLength:2000,maxLengthText:'长度不能超过2000',regex:WXTL.Common.regex.IllegalDiyDiy,regexText:WXTL.Common.regexText.IllegalDiyText,width:350,height:150,validator:function(){var word=Ext.get("Js.Center.SendMMS.MMSsendUpdate.vc2Word").dom.value;if(isExistsHtmlLable(word)){return false}else{return true}},invalidText:'帧文字不能包含HTML标签'},{xtype:'hidden',id:'Js.Center.SendMMS.MMSsendUpdate.CurrFrameOrder',name:'numframeorder',fieldLabel:"帧序号",width:"90%",height:150},{xtype:'hidden',id:'Js.Center.SendMMS.MMSsendUpdate.CurrFrameJson',name:'currframejson',fieldLabel:"帧Json",width:"90%",height:150},{xtype:'hidden',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'flag',fieldLabel:"标识",width:350},{xtype:'hidden',id:'Js.Center.SendMMS.MMSsendUpdate.Contentmmsid',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'mmsid',fieldLabel:"彩信编号",width:350}],buttons:[new Ext.Button({text:'修改帧',minWidth:70,handler:function(){if(Js.Center.SendMMS.MMSsendUpdate.EditPanel.getForm().isValid()){if(checkMMSFrame(Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[2].getCheckValue(),Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.contentJson.frame[Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.currFrame].vc2image.vc2rescurl,Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[4].getValue(),Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[2].getValue())){if(Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[2].getValue()!=""&&!checkMMSFrameImageType(Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[2].getCheckValue(),Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[2].getValue())){return false}if(Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[3].getValue()!=""&&!checkMMSFrameMusicType(Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[3].getCheckValue(),Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[3].getValue())){return false}Ext.MessageBox.show({msg:'正在处理，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});Js.Center.SendMMS.MMSsendUpdate.EditPanel.getForm().submit({url:Js.Center.SendMMS.MMSFrameUpdateURL,method:"POST",success:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);var falg=objJson.success;var frameJson=objJson.data;if(falg==true){if(!Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[2].getCheckValue()){if(Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[2].getValue()==""){if(Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.contentJson.frame[Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.currFrame].vc2image.vc2rescurl!=""){frameJson.vc2image=Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.contentJson.frame[Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.currFrame].vc2image}}}Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.contentJson.frame[Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.currFrame]=frameJson;Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.refreshAll();Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.render();Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.refreshBrotherPanel();Ext.Msg.alert("温馨提示","操作成功了!");if(document.getElementById("Js.Center.SendMMS.MMSsendUpdate.vc2Image")!=null){Js.Center.SendMMS.MMSsendUpdate.EditPanel.remove("Js.Center.SendMMS.MMSsendUpdate.vc2Image");var fileUp=new WXTL.Widgets.CommonForm.FileUpload({id:'Js.Center.SendMMS.MMSsendUpdate.vc2Image',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2image',fieldLabel:getHelpMsg("帧图片",false,"此项非必选项，上传图片格式为："+MMSIMAGEFILETYPEDESC+"，尺寸最大限制为"+mmsConfigInfo.imagewidth+" x "+mmsConfigInfo.imageheight+"（宽x高），大小不能超过"+mmsConfigInfo.imagesize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的图片！"),width:350});Js.Center.SendMMS.MMSsendUpdate.EditPanel.insert(2,fileUp);Js.Center.SendMMS.MMSsendUpdate.EditPanel.doLayout()}if(document.getElementById("Js.Center.SendMMS.MMSsendUpdate.vc2Music")!=null){Js.Center.SendMMS.MMSsendUpdate.EditPanel.remove("Js.Center.SendMMS.MMSsendUpdate.vc2Music");var fileUpMusic=new WXTL.Widgets.CommonForm.FileUpload({id:'Js.Center.SendMMS.MMSsendUpdate.vc2Music',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2music',fieldLabel:getHelpMsg("帧背景音乐",false,"此项非必选项，上传音乐格式为："+MMSMUSICFILETYPEDESC+"，大小不能超过"+mmsConfigInfo.musicsize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的音乐！"),width:350});Js.Center.SendMMS.MMSsendUpdate.EditPanel.insert(3,fileUpMusic);Js.Center.SendMMS.MMSsendUpdate.EditPanel.doLayout()}}else Ext.Msg.alert('温馨提示',objJson.info)},failure:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);Ext.Msg.alert('温馨提示',objJson.info)}})}}}})]});Js.Center.SendMMS.MMSsendUpdate.FramePanel=new WXTL.Widgets.CommonPanel.MMSFramePanel({title:'帧',currFrame:0,region:'south',margins:'3 3 3 3',cmargins:'3 3 3 3',height:189,width:778,contentJson:json,frame:false,listeners:{afterRefresh:function(obj,json,currFrame){Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[1].setValue(currFrame.numframetime);Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[2].setValue(currFrame.vc2image.vc2resurl);Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[3].setValue(currFrame.vc2backmusic.vc2resurl);Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[4].setValue(currFrame.vc2word.vc2rescdesc1);Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[5].setValue(currFrame.numframeorder);Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[7].setValue("mmshisoption");Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[8].setValue(Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[8].getValue())}}});Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel=new WXTL.Widgets.CommonPanel.MMSpanel({title:'预览：第1帧',region:'west',brotherPanel:Js.Center.SendMMS.MMSsendUpdate.FramePanel,width:244,height:340,collapsible:true,frame:false});Js.Center.SendMMS.MMSsendUpdate.FramePanel.brotherPanel=Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel;Js.Center.SendMMS.MMSsendUpdate.ShowPanel=new Ext.Panel({width:778,height:590,frame:false,layout:'border',border:true,items:[Js.Center.SendMMS.MMSsendUpdate.EditPanel,Js.Center.SendMMS.MMSsendUpdate.FramePanel,Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel]})}};Ext.namespace('Js.Center.SendMMS.SendMMSDelete');Js.Center.SendMMS.SendMMSDelete.func=function(row){var deleteSplit="";if(row!=null){deleteSplit=row}var params={ids:deleteSplit,flag:"delete"};doAjax(Js.Center.SendMMS.MMSContentDeleteURL,params,Js.Center.SendMMS.Send.DisplayStore)};Ext.namespace('Js.Center.SendMMS.MMSSendDiy');Js.Center.SendMMS.MMSSendDiy.func=function(show,row){if(Ext.get("Js.Center.SendMMS.MMSSendDiy.MMSSendPanel")==null){var productCombox=new Ext.form.ComboBox({xtype:"combo",name:"numproductid",hiddenName:"numproductid",id:'Js.Center.SendMMS.MMSSend.sendbylist.numproductid',emptyText:"-=请选择=-",allowBlank:false,blankText:"请选择通道组",fieldLabel:"<font color=red>选择通道组</font>",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numprodid",triggerAction:"all",store:Js.Center.Common.ProductStore});Js.Center.SendMMS.MMSSendDiy.MMSFieldSet=new Ext.Panel({layout:'column',bodyStyle:"padding:5px 0 0px 10px",items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",items:[productCombox,{xtype:'xDateTime',fieldLabel:'发送时间',layout:'form',name:"datstarttime",id:"Js.Center.SendMMS.MMSSendDiy.DatStartTime",timeFormat:'H:i:s',value:WXTL.Common.dateTime.getNow(),timeConfig:{altFormats:'H:i:s',allowBlank:true,invalidText:'{0} 是无效的时间-必须符合格式为：H:i:s'},dateFormat:'Y-m-d',dateConfig:{altFormats:'Y-m-d',allowBlank:true}},{xtype:'hidden',name:"numopid",value:0},{xtype:'hidden',fieldLabel:'要发送的彩信',id:"Js.Center.SendMMS.MMSSendDiy.numMMSID",name:"nummmsid"}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",items:[{xtype:"combo",name:"numpriority",fieldLabel:"<font color=red>优先级</font>",hiddenName:"numpriority",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",allowBlank:false,blankText:"优先级类型不允许为空",emptyText:"请选择",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["正常","0"],["及时","1"],["紧急","2"]]}),value:0},{xtype:'xDateTime',fieldLabel:'结束时间',layout:'form',name:"datendtime",id:"Js.Center.SendMMS.MMSSendDiy.DatEndTime",timeFormat:'H:i:s',addDays:1,value:WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),1),timeConfig:{altFormats:'H:i:s',allowBlank:true,invalidText:'{0} 是无效的时间-必须符合格式为：H:i:s'},dateFormat:'Y-m-d',dateConfig:{altFormats:'Y-m-d',allowBlank:true}},{xtype:'hidden',fieldLabel:"发送方式 1、栏目 2、客户组 3、持仓股票 4、文件  5、手机号码",name:'numsendtype',id:'Js.Center.SendMMS.MMSSendDiy.SendNumSendType',value:'Js.Center.SendMMS.MMSSend.sendbydiy'}]},{columnWidth:1,layout:'form',defaults:{anchor:"95%",msgTarget:"side"},buttonAlign:"center",items:[{xtype:'UploadLargeFilePanel',id:'Js.Center.SendMMS.MMSSendDiy.UploadLargeFile',txtMsgHeight:'75',needLargfile:false,fieldlableFile:getHelpMsg("文件",true,"1.上传的文件扩展名必须是txt<br>2.支持客户端文件,客户端文件大小最大限制为4M<br>3.支持服务端文件,允许断点续传大文件,上传完后选择使用<br>4.个性化内容的格式是:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13888776655|[&quot李先生&quot,&quot富国天益&quot,&quot 1.003&quot]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13888776655|[&quot刘先生&quot,&quot华夏成长&quot,&quot 1.173&quot]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13888776655|[&quot赵先生&quot,&quot富国天益&quot,&quot 1.003&quot]")},{xtype:'textarea',fieldLabel:getHelpMsg("文件描述",false,"此项非必填，长度小于等于100。"),id:"Js.Center.SendMMS.MMSSendDiy.vc2Desc",maxLength:100,maxLengthText:'长度不能大于100',name:"vc2desc"}]}]});Js.Center.SendMMS.MMSSendDiy.MMSinfo();Js.Center.SendMMS.MMSSendDiy.MMSSendPanel=new Ext.FormPanel({id:"Js.Center.SendMMS.MMSSendDiy.MMSSendPanel",fileUpload:true,labelAlign:'left',frame:true,labelWidth:75,style:"background-color:#DFE8F6",bodyStyle:'padding:5px 0 0 5px;',defaults:{msgTarget:"side"},items:[Js.Center.SendMMS.MMSSendDiy.MMSFieldSet]});var mainForm=Js.Center.SendMMS.MMSSendDiy.MMSSendPanel.getForm();Js.Center.SendMMS.MMSSendDiy.MMSSendInfoWin=new WXTL.Widgets.CommonWindows.Window({title:"发送个性化彩信",width:750,mainForm:Js.Center.SendMMS.MMSSendDiy.MMSSendPanel.getForm(),needButtons:false,closeAction:'hide',updateURL:Js.Center.SendMMS.mmscontentaddURL,displayStore:Js.Center.SendMMS.MMSSendDiy.Infostore,updateState:true,updateRecord:row,items:[Js.Center.SendMMS.MMSSendDiy.MMSSendPanel,Js.Center.SendMMS.MMSSendDiy.MainPanel],buttons:[new Ext.Button({text:'提交',minWidth:70,handler:function(){Ext.getCmp("Js.Center.SendMMS.MMSSendDiy.DatStartTime").updateDate();Ext.getCmp("Js.Center.SendMMS.MMSSendDiy.DatEndTime").updateDate();Ext.getCmp("Js.Center.SendMMS.MMSSendDiy.DatStartTime").updateTime();Ext.getCmp("Js.Center.SendMMS.MMSSendDiy.DatEndTime").updateTime();var datStart_date=Js.Center.SendMMS.MMSSendDiy.MMSFieldSet.findById("Js.Center.SendMMS.MMSSendDiy.DatStartTime").getValue();var datend_date=Js.Center.SendMMS.MMSSendDiy.MMSFieldSet.findById("Js.Center.SendMMS.MMSSendDiy.DatEndTime").getValue();if(Date.parse(WXTL.Common.dateTime.getNowDate())-Date.parse(datStart_date)>0){Ext.Msg.alert("温馨提示：","发送时间不能晚于当前时间");return false}if(Date.parse(datStart_date)-Date.parse(datend_date)>0){Ext.Msg.alert("温馨提示：","结束时间不能早于发送时间");return false}if(Date.parse(datend_date)-Date.parse(WXTL.Common.dateTime.getNow())<0){Ext.Msg.alert("温馨提示：","结束时间不能早于当前时间");return false}Js.Center.SendMMS.MMSSendDiy.saveSMS("submit")}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){Js.Center.SendMMS.MMSSendDiy.MMSSendInfoWin.hide()}})],listeners:{"show":function(){Js.Center.Common.ProductStore.load({params:{vc2servicetype:'2'}});Js.Center.SendMMS.MMSSendDiy.queryGrid();Js.Center.SendMMS.MMSSendDiy.MainPanel.items.items[1].getSelectionModel().clearSelections()},"beforehide":function(){Js.Center.SendMMS.MMSSendDiy.MMSSendInfoWin.mainForm.reset();Ext.getCmp("Js.Center.SendMMS.MMSsenddiysend.columnSelectPanel").getForm().reset()}}})}var isSelfValid=function(){var valid=true;if(!Js.Center.SendMMS.MMSSendDiy.MMSSendPanel.getForm().isValid()){valid=false}if(Js.Center.SendMMS.MMSSendDiy.MMSFieldSet.items.items[0].items.items[3].getValue()==""){Ext.Msg.alert("温馨提示","对不起,请先选择一条彩信!");valid=false}return valid};Js.Center.SendMMS.MMSSendDiy.saveSMS=function(method){if(Ext.get("sendflag")!=null)Ext.get("sendflag").dom.value=method;if(isSelfValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.SendMMS.MMSSendDiy.MMSSendInfoWin.mainFormSubmitFunc()}};if(show){Js.Center.SendMMS.MMSSendDiy.MMSSendInfoWin.show()}};function checkedAll(){};Ext.namespace('Js.Center.SendMMS.Send');Js.Center.SendMMS.Send.info=function(node){if(Ext.get("Js.Center.SendMMS.Send.MainPanel")==null){var _pageSize=12;Js.Center.SendMMS.Send.DisplayStore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.SendMMS.MMScheckQueryURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:["numcontentid","nummmsid","datreject","numcheck1id","datcheck1","numcheck2id","datcheck2","numstate","datsend","datendtime","numchecktype","vc2name","numuserid","numcreattime","datsendsubmit","nummmsstate","nummmstype","vc2desc","vc2username"],root:"data",id:"numcontentid",totalProperty:"totalCount"}),sortInfo:{field:'numcreattime',direction:'DESC'},baseParams:{datstart:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),datend:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),mmsname:'',creatorid:'',flag:'selectrejectbykey'}});Js.Center.SendMMS.Send.DisplayStore.load({params:{start:0,limit:_pageSize}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numcontentid"});var cm=new Ext.grid.ColumnModel([{header:"彩信标题",tooltip:"彩信标题",dataIndex:"vc2name",sortable:true},{header:"彩信名称",tooltip:"彩信名称",dataIndex:"vc2desc",sortable:true},{header:"彩信类型",tooltip:"彩信类型",dataIndex:"nummmstype",sortable:true,renderer:function(value){if(value==1){return"普通彩信"}if(value==2){return"个性化彩信"}}},{header:"彩信状态",tooltip:"彩信状态",dataIndex:"numstate",sortable:true,renderer:function(value){return"审核驳回"}},{header:"驳回类型",tooltip:"驳回类型",dataIndex:"numchecktype",sortable:true,renderer:function(value){if(value==1){return"内容错误"}else if(value==2){return"发送目标错误"}else if(value==3){return"内容发送目标均错误"}}},{header:"创建人",tooltip:"创建人",dataIndex:"vc2username",sortable:true},{header:"创建时间",tooltip:"创建时间",dataIndex:"numcreattime",sortable:true},{header:"发送提交时间",tooltip:"发送提交时间",dataIndex:"datsendsubmit",sortable:true},{header:"审核驳回时间",tooltip:"审核驳回时间",dataIndex:"datreject",sortable:true},{header:"测试预览",tooltip:"测试预览",dataIndex:"nummmsid",width:60,renderer:function(value,meta,record,rowIndex,colIndex,store){if(record.get('nummmstype')==2){return"<a href='#' onclick='Js.Center.SendMMS.MMSsendPreview.func(\"selecthismms\","+value+",\"0\",\"Js.Center.SendMMS.MMSsendUpdate.sendtesthisdiy\")'>测试预览</a>"}return"<a href='#' onclick='Js.Center.SendMMS.MMSsendPreview.func(\"selecthismms\","+value+",\"0\",\"Js.Center.SendMMS.MMSsendUpdate.sendtesthis\")'>测试预览</a>"}},{header:"操作",tooltip:"操作",dataIndex:"nummmsid",width:80,renderer:function(value,meta,record,rowIndex,colIndex,store){return"<a href='#' onclick='doEditMMS(\""+rowIndex+"\")'>编辑</a>　<a href='#' onclick='sendMMSDelete(\""+record.data.numcontentid+"\")'>删除</a>"}}]);var arrMMSSendInitLoadFunc=new Array();arrMMSSendInitLoadFunc[0]="Js.Center.SendMMS.MMSSend.func";arrMMSSendInitLoadFunc[1]="Js.Center.SendMMS.MMSSendDiy.func";arrMMSSendInitLoadFunc[2]="Js.Center.SendMMS.MMSsendUpdate.MMSSendContent";arrMMSSendInitLoadFunc[3]="Js.Center.SendMMS.MMSsendUpdateDiy.MMSSendContent";arrMMSSendInitLoadFunc[4]="Js.Center.SendMMS.MMSsendUpdateDiy.func";arrMMSSendInitLoadFunc[5]="Js.Center.SendMMS.MMSsendUpdate.func";var gridPanel=new WXTL.Widgets.CommonGrid.GridPanel({title:"信息列表",anchor:'100% 100%',pageSize:_pageSize,store:Js.Center.SendMMS.Send.DisplayStore,needMenu:false,needRightMenu:false,sm:sm,cm:cm,otherInitLoadFunc:arrMMSSendInitLoadFunc,tbar:new Ext.Toolbar({items:[{iconCls:'generalicon',text:"普通彩信发送",handler:function(){Js.Center.SendMMS.Send.gridRecord=null;Js.Center.SendMMS.MMSSend.MMSSendInfoWin.show()}},{iconCls:'personalizedicon',text:"个性化彩信发送",handler:function(){Js.Center.SendMMS.Send.gridRecord=null;Js.Center.SendMMS.MMSSendDiy.MMSSendInfoWin.show()}}]})});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({title:'按条件搜索被驳回彩信信息',layout:'fit',queryMethod:"Js.Center.SendMMS.Send.queryGrid",items:[{layout:'column',items:[{xtype:"hidden",name:"flag",value:"insert"},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"datefield",fieldLabel:"开始时间",format:'Y-m-d',labelWidth:100,bodyStyle:'padding:5px 5px 0',readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),-7),'Y-m-d'),fieldLabel:"开始时间",name:"datcreattimestart",id:"sendinfoCreateTimeStart",validateOnBlur:false,validator:function(){var strat_time=Ext.get("sendinfoCreateTimeStart").dom.value;var end_time=Ext.get("sendinfoCreateTimeEnd").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'},{xtype:"textfield",id:"sendinfoMMSName",name:"vc2name",fieldLabel:"彩信标题",maxLength:100,maxLengthText:'长度应小于等于100',regex:WXTL.Common.regex.IllegalDiy,regexText:WXTL.Common.regexText.IllegalText}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"datefield",fieldLabel:"结束时间",labelWidth:100,format:'Y-m-d',bodyStyle:'padding:5px 5px 0',readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),name:"datcreattimeend",id:"sendinfoCreateTimeEnd",validateOnBlur:false,validator:function(){var strat_time=Ext.get("sendinfoCreateTimeStart").dom.value;var end_time=Ext.get("sendinfoCreateTimeEnd").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'}]}]}]});Js.Center.SendMMS.Send.queryGrid=function(){if(selectPanel.getForm().isValid()){var datCreatStart=Ext.get("sendinfoCreateTimeStart").getValue();var datCreatEnd=Ext.get("sendinfoCreateTimeEnd").getValue();var vc2MMSName=Ext.get("sendinfoMMSName").getValue();var flag='selectrejectbykey';Js.Center.SendMMS.Send.DisplayStore.baseParams={datstart:datCreatStart,datend:datCreatEnd,mmsname:vc2MMSName,creatorid:'',flag:flag};Js.Center.SendMMS.Send.DisplayStore.load({params:{start:0,limit:_pageSize}})}};Js.Center.SendMMS.Send.MainPanel=new Ext.Panel({id:"Js.Center.SendMMS.Send.MainPanel",frame:true,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,gridPanel]})};GridMain(node,Js.Center.SendMMS.Send.MainPanel,"openroomiconinfo","Js.Center.SendMMS.Send.DisplayStore")};function doEditMMS(id){var row=Js.Center.SendMMS.Send.DisplayStore.getAt(id);if(row.get("nummmstype")==1){Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin.updateRecord=row;Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin.show();}else if(row.get("nummmstype")==2){Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin.updateRecord=row;Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin.show()}};function sendMMSDelete(row){Ext.Msg.confirm("提示!","您确定要删除信息吗?",function(btn){if(btn=="yes"){Js.Center.SendMMS.SendMMSDelete.func(row)}else{}})};Ext.namespace('Js.Center.SendMMS.MMSsendUpdate');Js.Center.SendMMS.MMSsendUpdate.MMSSendListinfo=function(){if(Ext.get("Js.Center.SendMMS.MMSsendUpdate.MMSSendListPanel")==null){Js.Center.Common.UserGroupStore.reload();var remoteCheckboxGroup;var activeTabPanel;function setUserGroupList(recordNumProdID){if(recordNumProdID!=""){remoteCheckboxGroup=new WXTL.Widgets.CommonForm.CheckboxGroup.RemoteCheckboxGroup({url:Js.Center.Business.UserGroupURL,queryparams:'flag=selectallbyprodid&columnlist=numusergroupid,vc2usergroupname&prodid='+recordNumProdID,requestname:'numusergroupid',defaultsItemsName:'numusergroupid',defaultsItemsboxLable:'对不起！没有该通道组的客户组信息',id:"Js.Center.SendMMS.MMSsendUpdate.remoteCheckboxGroup",blankText:"请选择客户组",allowBlank:false,fieldLabel:'<font color=red>客户组</font>',messageID:recordNumProdID,reader:new Ext.data.JsonReader({totalProperty:'totalProperty',root:'data',fields:[{name:'id'},{name:'name'},{name:'boxLabel',mapping:"vc2usergroupname"},{name:'inputValue',mapping:"numusergroupid"},{name:'checked'}]})});var remoteCheckboxGroupPanel=new Ext.form.FieldSet({title:'<a href=#  onclick="javascript:remoteCheckboxGroup.setAll(true);">全选</a>　<a href=#  onclick="javascript:remoteCheckboxGroup.setAll(false);">全不选</a>　<a href=#  onclick="javascript:remoteCheckboxGroup.invert();">反选</a>',bodyStyle:'width:530',defaults:{width:'80%'},style:Ext.isIE?'padding:0px 0 0 10px;':'padding:0px 0 0 10px;',autoHeight:true,id:"Js.Center.SendMMS.MMSsendUpdate.SMSremoteCheckboxGroup",items:[remoteCheckboxGroup]});remoteCheckboxGroupPanel.doLayout(true);activeTabPanel.remove("Js.Center.SendMMS.MMSsendUpdate.SMSremoteCheckboxGroup");activeTabPanel.add(remoteCheckboxGroupPanel)}else{activeTabPanel.remove("Js.Center.SendMMS.MMSsendUpdate.SMSremoteCheckboxGroup")}activeTabPanel.doLayout(true)};var productCombox=new Ext.form.ComboBox({xtype:"combo",name:"numproductid",hiddenName:"numproductid",id:'SMSnumproductid',emptyText:"-=请选择=-",allowBlank:false,blankText:"请选择通道组",fieldLabel:"<font color=red>选择通道组</font>",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numprodid",triggerAction:"all",store:Js.Center.Common.ProductStoreByUser,listeners:{'select':function(combox,record,numidex){setUserGroupList(record.data.numprodid)}}});Js.Center.Common.ProductStoreByUser.reload({callback:function(records,options,success){productCombox.setValue('1');setUserGroupList('1')}});Js.Center.SendMMS.MMSsendUpdate.MMSFieldSet=new Ext.Panel({layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:'xDateTime',fieldLabel:'发送时间',layout:'form',name:"datsend",timeFormat:'H:i:s',value:WXTL.Common.dateTime.getNow(),timeConfig:{altFormats:'H:i:s',allowBlank:true,invalidText:'{0} 是无效的时间-必须符合格式为：H:i:s'},dateFormat:'Y-m-d',dateConfig:{altFormats:'Y-m-d',allowBlank:true}}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:'xDateTime',fieldLabel:'结束时间',layout:'form',name:"datsend",timeFormat:'H:i:s',value:WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),1),timeConfig:{altFormats:'H:i:s',allowBlank:true,invalidText:'{0} 是无效的时间-必须符合格式为：H:i:s'},dateFormat:'Y-m-d',dateConfig:{altFormats:'Y-m-d',allowBlank:true}}]}]});Js.Center.SendMMS.MMSsendUpdate.MMSSendListPanel=new Ext.Panel({id:"Js.Center.SendMMS.MMSsendUpdate.MMSSendListPanel",fileUpload:true,labelAlign:'left',frame:true,labelWidth:80,height:'100%',style:"background-color:#DFE8F6",bodyStyle:'padding:0px 0 0 0px;',defaults:{msgTarget:"side"},items:[{xtype:'tabpanel',layoutOnTabChange:true,defaults:{bodyStyle:'padding:5px 0 0 10px;'},plain:true,activeTab:0,height:240,items:[{title:'按客户组发送',autoScroll:true,layout:'form',defaultType:'textfield',id:"Js.Center.SendMMS.MMSsendUpdate.sendbyusergroup",items:[productCombox]},{title:'按栏目发送',autoScroll:true,layout:'form',defaultType:'textfield',id:"Js.Center.SendMMS.MMSsendUpdate.sendbycolumn",items:[{xtype:'hidden',fieldLabel:"发送方式 1、栏目 2、客户组 3、持仓股票 4、文件  5、手机号码",name:'numsendtype',id:'sendnumsendtype',value:'sendbyusergroup'},{xtype:"combo",name:"numcolumnid",hiddenName:"numcolumnid",fieldLabel:"<font color=red>选择栏目</font>",emptyText:"-=请选择=-",readOnly:true,mode:"local",displayField:"vc2columnname",allowBlank:false,valueField:"numcolumnid",triggerAction:"all",store:Js.Center.Common.ColumnStore,blankText:"请选择栏目"}]},{title:'按文件发送',layout:'form',id:"Js.Center.SendMMS.MMSsendUpdate.sendbyfile",defaultType:'textfield',items:[{xtype:'fileuploadfield',id:'SMSmobilefile',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'mobilefile',fieldLabel:WXTL.Common.help.MOBILEFILE,allowBlank:false,blankText:"请选择上传文件",width:300,validator:function(){var filePath=mainForm.items.items[2].getValue();if(filePath!=''){if(checkFile(filePath)!=''){this.invalidText=checkFile(filePath);return false}else{return true}}else return false}}]},{title:'按输入号码发送',id:"Js.Center.SendMMS.MMSsendUpdate.sendbylist",layout:'form',items:[{xtype:'textarea',name:'mobilelist',id:'SMSmobilelist',allowBlank:false,fieldLabel:WXTL.Common.help.MOBILELIST,width:300,height:103,blankText:"请输入手机号码列表"}]}],listeners:{"tabchange":function(TabPanel,Panel){activeTabPanel=TabPanel.getActiveTab();Js.Center.SendMMS.MMSsendUpdate.sendtypename=Panel.title;if(Ext.get("Js.Center.SendMMS.MMSsendUpdate.sendnumsendtype")!=null){Ext.get("Js.Center.SendMMS.MMSsendUpdate.sendnumsendtype").dom.value=Panel.id}}}},Js.Center.SendMMS.MMSsendUpdate.MMSFieldSet]});var isSelfValid=function(panel){var valid=true;panel.items.each(function(f){if(f.id!="Js.Center.SendMMS.MMSsendUpdate.SMSremoteCheckboxGroup"&&!f.validate()){valid=false}if(activeTabPanel.id=="Js.Center.SendMMS.MMSsendUpdate.sendbyusergroup"&&!remoteCheckboxGroup.validate()){valid=false}});smsFieldSet.items.each(function(f){if(f.id!="Js.Center.SendMMS.MMSsendUpdate.btnsendtest"){if(!f.validate()){valid=false}}});return valid}}};Ext.namespace('Js.Center.SendMMS.MMSsendUpdate');Js.Center.SendMMS.MMSsendUpdate.func=function(show,row){var firstShow=true;if(Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin==null){var activeTabPanel;Js.Center.SendMMS.MMSsendUpdate.UserGroupStore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.UserGroupURL,method:"POST"}),reader:new Ext.data.JsonReader({totalProperty:'totalProperty',root:'data',fields:[{name:'id'},{name:'name'},{name:'boxLabel',mapping:"vc2usergroupname"},{name:'inputValue',mapping:"numusergroupid"},{name:'checked'}]}),baseParams:{flag:"selectallbyuserid",columnlist:"numusergroupid,vc2usergroupname"}});var groupPanel=new WXTL.Widgets.CommonPanel.CheckBoxGroupPanel({store:Js.Center.SendMMS.MMSsendUpdate.UserGroupStore,defaultItemsName:'numusergroupid',defaultItemsboxLable:'对不起，没有相关客户组信息。',style:"padding:5px 5px 5px 5px",id:"Js.Center.SendMMS.MMSsendUpdate.remoteCheckboxGroup",numcolumns:3,blankText:"请选择客户组",allowBlank:false,name:"客户组："});var productCombox=new Ext.form.ComboBox({xtype:"combo",name:"numproductid",hiddenName:"numproductid",id:'Js.Center.SendMMS.MMSsendUpdate.SMSnumproductid',emptyText:"-=请选择=-",allowBlank:false,blankText:"请选择通道组",fieldLabel:"<font color=red>选择通道组</font>",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numprodid",triggerAction:"all",store:Js.Center.Common.ProductStore});Js.Center.SendMMS.MMSsendUpdate.MMSFieldSet=new Ext.Panel({layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:'xDateTime',fieldLabel:'发送时间',layout:'form',name:"datstarttime",id:"Js.Center.SendMMS.MMSsendUpdate.datStartTime",timeFormat:'H:i:s',value:WXTL.Common.dateTime.getNow(),timeConfig:{altFormats:'H:i:s',allowBlank:true,invalidText:'{0} 是无效的时间-必须符合格式为：H:i:s'},dateFormat:'Y-m-d',dateConfig:{altFormats:'Y-m-d',allowBlank:true}},{xtype:'hidden',fieldLabel:'要发送的彩信',id:"Js.Center.SendMMS.MMSsendUpdate.nummmsid",name:"nummmsid"}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:'xDateTime',fieldLabel:'结束时间',layout:'form',name:"datendtime",addDays:1,id:"Js.Center.SendMMS.MMSsendUpdate.datEndTime",timeFormat:'H:i:s',value:WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),1),timeConfig:{altFormats:'H:i:s',allowBlank:true,invalidText:'{0} 是无效的时间-必须符合格式为：H:i:s'},dateFormat:'Y-m-d',dateConfig:{altFormats:'Y-m-d',allowBlank:true}}]}]});Js.Center.SendMMS.MMSsendUpdate.MMSSendListPanel=new Ext.FormPanel({id:"Js.Center.SendMMS.MMSsendUpdate.MMSSendListPanel",fileUpload:true,labelAlign:'left',frame:true,labelWidth:80,defaults:{msgTarget:"side"},items:[{xtype:'hidden',fieldLabel:"发送方式 1、栏目 2、客户组 3、持仓股票 4、文件  5、手机号码",name:'numsendtype',id:'Js.Center.SendMMS.MMSsendUpdate.sendnumsendtype',value:'Js.Center.SendMMS.MMSsendUpdate.sendbyusergroup'},{xtype:'hidden',fieldLabel:"内容ID",name:'numcontentid',id:"Js.Center.SendMMS.MMSsendUpdate.numcontentid"},{xtype:'hidden',fieldLabel:"彩信内容Json",name:'vc2contentJson',id:"Js.Center.SendMMS.MMSsendUpdate.vc2contentJson",value:''},{items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",items:[productCombox]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",items:[{xtype:"combo",name:"numpriority",fieldLabel:"<font color=red>优先级</font>",hiddenName:"numpriority",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",allowBlank:false,blankText:"优先级类型不允许为空",emptyText:"请选择",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["正常","0"],["及时","1"],["紧急","2"]]}),value:0}]}]}]},{xtype:'tabpanel',layoutOnTabChange:true,defaults:{},plain:true,activeTab:0,height:220,items:[{title:'按客户组发送',autoScroll:true,layout:'form',defaultType:'textfield',id:"Js.Center.SendMMS.MMSsendUpdate.sendbyusergroup",items:[groupPanel]},{title:'按文件发送',layout:'form',id:"Js.Center.SendMMS.MMSsendUpdate.sendbyfile",defaultType:'textfield',items:[{xtype:'UploadLargeFilePanel',id:'Js.Center.SendMMS.MMSsendUpdate.UploadLargeFile',fieldlableFile:getHelpMsg("文件",true,"1、文件格式为txt<br>2、客户端文件请选择小于4M的文件；<br>3、内容格式:　<img src=jspack/product/common/Images/help/mobilefile.jpg align=top/>"),needLargfile:false}]},{title:'按输入号码发送',id:"Js.Center.SendMMS.MMSsendUpdate.sendbylist",layout:'form',bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:'textarea',name:'mobilelist',id:'Js.Center.SendMMS.MMSsendUpdate.SMSmobilelist',allowBlank:false,fieldLabel:WXTL.Common.help.MOBILELIST,width:300,height:103,blankText:"请输入手机号码列表",maxLength:13000,maxLengthText:"请将输入内容控制在1000行以内！",validator:function(value){return checkMobileList(value,1000)}}]}],listeners:{"tabchange":function(TabPanel,Panel){activeTabPanel=TabPanel.getActiveTab();Js.Center.SendMMS.MMSsendUpdate.sendtypename=Panel.title;if(Ext.get("Js.Center.SendMMS.MMSsendUpdate.sendnumsendtype")!=null){Ext.get("Js.Center.SendMMS.MMSsendUpdate.sendnumsendtype").dom.value=Panel.id}}}},Js.Center.SendMMS.MMSsendUpdate.MMSFieldSet]});var MMSSendUpdateTabpanel=new Ext.Panel({id:"Js.Center.SendMMS.MMSSend.SMSSendUpdatePanel",labelAlign:'left',frame:true,labelWidth:60,style:"background-color:#DFE8F6",defaults:{msgTarget:"side"},items:[{xtype:'tabpanel',layoutOnTabChange:true,plain:true,activeTab:0,height:620,width:774,border:true,items:[{title:'彩信内容',layout:'form',style:"background-color:#DFE8F6",id:"Js.Center.SendMMS.MMSSend.MMSsendUpdateContent",border:true,frame:false,items:[Js.Center.SendMMS.MMSsendUpdate.ShowPanel]},{title:'发送号码',layout:'form',style:"background-color:#DFE8F6",defaultType:'textfield',id:"Js.Center.SendMMS.MMSSend.MMSsendUpdateList",items:[Js.Center.SendMMS.MMSsendUpdate.MMSSendListPanel]}],listeners:{'tabchange':function(TabPanel,Panel){if(Panel.id=="Js.Center.SendMMS.MMSSend.MMSsendUpdateList"){Js.Center.SendMMS.MMSsendUpdate.MMSSendListPanel.items.items[4].setActiveTab(0);if(firstShow){Js.Center.SendMMS.MMSsendUpdate.UserGroupStore.reload();firstShow=false}if(Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin.updateRecord!=null){Ext.get('Js.Center.SendMMS.MMSsendUpdate.nummmsid').dom.value=Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin.updateRecord.get("nummmsid");Ext.get('Js.Center.SendMMS.MMSsendUpdate.numcontentid').dom.value=Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin.updateRecord.get("numcontentid");Ext.get('Js.Center.SendMMS.MMSsendUpdate.vc2contentJson').dom.value=Ext.encode(Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.contentJson)}}}}}]});Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin=new WXTL.Widgets.CommonWindows.Window({title:"普通彩信编辑",width:819,height:522,autoScroll:true,closeAction:'hide',layout:'form',mainForm:Js.Center.SendMMS.MMSsendUpdate.MMSSendListPanel.getForm(),updateURL:Js.Center.SendMMS.MMSContentUpdateURL,displayStore:Js.Center.SendMMS.Send.DisplayStore,needButtons:false,updateState:false,items:[MMSSendUpdateTabpanel],buttons:[new Ext.Button({text:'提交',minWidth:70,qtip:"提交",handler:function(){Ext.getCmp("Js.Center.SendMMS.MMSsendUpdate.datStartTime").updateDate();Ext.getCmp("Js.Center.SendMMS.MMSsendUpdate.datStartTime").updateTime();Ext.getCmp("Js.Center.SendMMS.MMSsendUpdate.datEndTime").updateDate();Ext.getCmp("Js.Center.SendMMS.MMSsendUpdate.datEndTime").updateTime();var datStart_date=Js.Center.SendMMS.MMSsendUpdate.MMSFieldSet.findById("Js.Center.SendMMS.MMSsendUpdate.datStartTime").getValue();var datend_date=Js.Center.SendMMS.MMSsendUpdate.MMSFieldSet.findById("Js.Center.SendMMS.MMSsendUpdate.datEndTime").getValue();if(Date.parse(WXTL.Common.dateTime.getNowDate())-Date.parse(datStart_date)>0){Ext.Msg.alert("温馨提示：","发送时间不能晚于当前时间");return false}if(Date.parse(datStart_date)-Date.parse(datend_date)>0){Ext.Msg.alert("温馨提示：","结束时间不能早于发送时间");return false}if(Date.parse(datend_date)-Date.parse(WXTL.Common.dateTime.getNow())<0){Ext.Msg.alert("温馨提示：","结束时间不能早于当前时间");return false}if(checkMMS(Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.contentJson)){if(firstShow){MMSSendUpdateTabpanel.items.items[0].setActiveTab(1);Js.Center.SendMMS.MMSsendUpdate.UserGroupStore.reload({callback:function(records,options,success){Ext.get("Js.Center.SendMMS.MMSsendUpdate.vc2contentJson").dom.value=Ext.encode(Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.contentJson);Js.Center.SendMMS.MMSsendUpdate.saveSMS()}});firstShow=false}else{MMSSendUpdateTabpanel.items.items[0].setActiveTab(1);Ext.get("Js.Center.SendMMS.MMSsendUpdate.vc2contentJson").dom.value=Ext.encode(Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.contentJson);Js.Center.SendMMS.MMSsendUpdate.saveSMS()}}}}),new Ext.Button({hidden:true,text:'测试发送',qtip:"测试发送",minWidth:70,handler:function(){Js.Center.SendMMS.SendTest.func(Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.contentJson)}}),new Ext.Button({text:'取消',qtip:"取消",minWidth:70,handler:function(){Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin.hide();Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin.items.items[0].items.items[0].setActiveTab(0);}})],listeners:{"show":function(){Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin.items.items[0].items.items[0].setActiveTab(0);if(Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin.updateRecord!=null){var jsonUpdateMMS=eval(doSynRequest(Js.Center.SendMMS.MMSQueryDescURL+"?flag=selecthismms&nummmsseqid="+Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin.updateRecord.get("nummmsid")));Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.contentJson=jsonUpdateMMS;Js.Center.SendMMS.MMSsendUpdate.FramePanel.contentJson=jsonUpdateMMS;Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.currFrame=0;Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.refreshAll();Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.refreshBrotherPanel(0);Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[0].setValue(Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin.updateRecord.get("vc2name"));Js.Center.SendMMS.MMSsendUpdate.EditPanel.items.items[8].setValue(Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin.updateRecord.get("nummmsid"));}Js.Center.Common.ProductStore.load({params:{vc2servicetype:'2'}});Js.Center.SendMMS.MMSsendUpdate.UserGroupStore.reload();Js.Center.SendMMS.MMSsendUpdate.MMSFieldSet.findById("Js.Center.SendMMS.MMSsendUpdate.datEndTime").setValue(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),1));},"hide":function(){if(Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.bottomToolbar.items.items[0].text!="播放"){previewMMS(Js.Center.SendMMS.MMSsendUpdate.PreviewMMSPanel.contentJson.frame.length);window.clearInterval(playTime)}Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin.items.items[0].items.items[0].setActiveTab(0)}}})};var isSelfValid=function(){var valid=true;var panel=Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin.items.items[0].items.items[0].items.items[1].items.items[0].items.items[4].getActiveTab();if(!Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin.mainForm.items.items[3].validate()){valid=false}panel.items.each(function(f){if(panel.id!="Js.Center.SendMMS.MMSsendUpdate.sendbyusergroup"){if(f.xtype=="UploadLargeFilePanel"){if(!f.items.items[0].items.items[2].items.items[0].validate()){valid=false}}else{if(!f.validate()){valid=false}}}else{if(f.xtype!="hidden"){if(!f.items.items[1].validate()){valid=false}}}});return valid};Js.Center.SendMMS.MMSsendUpdate.saveSMS=function(){if(isSelfValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.SendMMS.MMSsendUpdate.MMSSendUpdateWin.mainFormSubmitFunc()}}};Ext.namespace('Js.Center.SendMMS.MMSsendUpdateDiy');Js.Center.SendMMS.MMSsendUpdateDiy.func=function(show,row){if(Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin==null){var productCombox=new Ext.form.ComboBox({xtype:"combo",name:"numproductid",hiddenName:"numproductid",emptyText:"-=请选择=-",allowBlank:false,blankText:"请选择通道组",fieldLabel:"<font color=red>选择通道组</font>",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numprodid",triggerAction:"all",store:Js.Center.Common.ProductStore});var SendMMSUpdateDiyListFieldSet=new Ext.FormPanel({layout:'column',fileUpload:true,labelAlign:'left',frame:true,items:[{columnWidth:1,layout:'form',defaultType:"textfield",defaults:{anchor:"45%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:5px 0 0px 10px",items:[productCombox]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[productCombox,{xtype:'xDateTime',fieldLabel:'发送时间',layout:'form',name:"datstarttime",id:'Js.Center.SendMMS.MMSsendUpdateDiy.DatStartTime',timeFormat:'H:i:s',value:WXTL.Common.dateTime.getNow(),timeConfig:{altFormats:'H:i:s',allowBlank:true,invalidText:'{0} 是无效的时间-必须符合格式为：H:i:s'},dateFormat:'Y-m-d',dateConfig:{altFormats:'Y-m-d',allowBlank:true}},{xtype:'hidden',fieldLabel:'要发送的彩信',id:"Js.Center.SendMMS.MMSsendUpdateDiy.numMMSId",name:"nummmsid"},{xtype:'hidden',name:"numopid",value:1}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"combo",name:"numpriority",fieldLabel:"<font color=red>优先级</font>",hiddenName:"numpriority",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",allowBlank:false,blankText:"优先级类型不允许为空",emptyText:"请选择",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["正常","0"],["及时","1"],["紧急","2"]]}),value:0},{xtype:'xDateTime',fieldLabel:'结束时间',layout:'form',name:"datendtime",addDays:1,id:'Js.Center.SendMMS.MMSsendUpdateDiy.DatEndTime',timeFormat:'H:i:s',value:WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),1),timeConfig:{altFormats:'H:i:s',allowBlank:true,invalidText:'{0} 是无效的时间-必须符合格式为：H:i:s'},dateFormat:'Y-m-d',dateConfig:{altFormats:'Y-m-d',allowBlank:true}},{xtype:'hidden',fieldLabel:"发送方式 1、栏目 2、客户组 3、持仓股票 4、文件  5、手机号码",name:'numsendtype',id:'Js.Center.SendMMS.MMSsendUpdateDiy.sendnumsendtype',value:'Js.Center.SendMMS.MMSsendUpdateDiy.sendbydiy'},{xtype:'hidden',fieldLabel:"内容ID",name:'numcontentid',id:"Js.Center.SendMMS.MMSsendUpdateDiy.numcontentid"},{xtype:'hidden',fieldLabel:"彩信内容Json",name:'vc2contentJson',id:"Js.Center.SendMMS.MMSsendUpdateDiy.vc2contentJson",value:''}]},{columnWidth:1,layout:'form',defaults:{anchor:"95%",msgTarget:"side"},buttonAlign:"center",items:[{xtype:'UploadLargeFilePanel',id:'Js.Center.SendMMS.MMSsendUpdateDiy.UploadLargeFile',txtMsgHeight:'75',needLargfile:false,fieldlableFile:getHelpMsg("文件",true,"1.上传的文件扩展名必须是txt<br>2.支持客户端文件,客户端文件大小最大限制为4M<br>4.个性化内容的格式是:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13888776655|[&quot李先生&quot,&quot富国天益&quot,&quot 1.003&quot]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13888776655|[&quot刘先生&quot,&quot华夏成长&quot,&quot 1.173&quot]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13888776655|[&quot赵先生&quot,&quot富国天益&quot,&quot 1.003&quot]")},{xtype:'textarea',fieldLabel:'文件描述',id:"Js.Center.SendMMS.MMSsendUpdateDiy.vc2Desc",maxLength:50,maxLengthText:'长度不能超过50！',name:"vc2desc"}]}]});var sendMMSUpdateDiyTabpanel=new Ext.Panel({id:"Js.Center.SendMMS.MMSsendUpdateDiy.MMSSendUpdatePanel",fileUpload:true,labelAlign:'left',frame:true,labelWidth:60,style:"background-color:#DFE8F6",defaults:{msgTarget:"side"},items:[{xtype:'tabpanel',layoutOnTabChange:true,plain:true,activeTab:0,height:622,width:774,border:true,items:[{title:'彩信内容',layout:'form',style:"background-color:#DFE8F6",id:"Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyContent",border:true,items:[Js.Center.SendMMS.MMSsendUpdateDiy.ShowPanel]},{title:'发送号码',layout:'form',style:"background-color:#DFE8F6",defaultType:'textfield',id:"Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyList",items:[SendMMSUpdateDiyListFieldSet]}],listeners:{'tabchange':function(TabPanel,Panel){if(Panel.id=="Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyList"){if(Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin.updateRecord!=null){var rowRecord=Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin.updateRecord;Ext.get('Js.Center.SendMMS.MMSsendUpdateDiy.numMMSId').dom.value=rowRecord.get("nummmsid");Ext.get('Js.Center.SendMMS.MMSsendUpdateDiy.numcontentid').dom.value=rowRecord.get("numcontentid");Ext.get('Js.Center.SendMMS.MMSsendUpdateDiy.vc2contentJson').dom.value=Ext.encode(Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.contentJson)}}}}}]});var mainForm=SendMMSUpdateDiyListFieldSet.getForm();Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin=new WXTL.Widgets.CommonWindows.Window({title:"个性化彩信编辑",width:819,height:522,autoScroll:true,layout:'form',closeAction:'hide',mainForm:mainForm,displayStore:Js.Center.SendMMS.Send.DisplayStore,updateURL:Js.Center.SendMMS.MMSContentUpdateURL,needButtons:false,updateState:false,items:[sendMMSUpdateDiyTabpanel],buttons:[new Ext.Button({text:'提交',minWidth:70,qtip:"提交",handler:function(){Ext.getCmp("Js.Center.SendMMS.MMSsendUpdateDiy.DatStartTime").updateDate();Ext.getCmp("Js.Center.SendMMS.MMSsendUpdateDiy.DatEndTime").updateDate();Ext.getCmp("Js.Center.SendMMS.MMSsendUpdateDiy.DatStartTime").updateTime();Ext.getCmp("Js.Center.SendMMS.MMSsendUpdateDiy.DatEndTime").updateTime();var datStart_date=SendMMSUpdateDiyListFieldSet.findById("Js.Center.SendMMS.MMSsendUpdateDiy.DatStartTime").getValue();var datend_date=SendMMSUpdateDiyListFieldSet.findById("Js.Center.SendMMS.MMSsendUpdateDiy.DatEndTime").getValue();if(Date.parse(WXTL.Common.dateTime.getNowDate())-Date.parse(datStart_date)>0){Ext.Msg.alert("温馨提示：","发送时间不能晚于当前时间");return false}if(Date.parse(datStart_date)-Date.parse(datend_date)>0){Ext.Msg.alert("温馨提示：","结束时间不能早于发送时间");return false}if(Date.parse(datend_date)-Date.parse(WXTL.Common.dateTime.getNow())<0){Ext.Msg.alert("温馨提示：","结束时间不能早于当前时间");return false}if(checkMMS(Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.contentJson)){sendMMSUpdateDiyTabpanel.items.items[0].setActiveTab(1);Ext.get("Js.Center.SendMMS.MMSsendUpdateDiy.vc2contentJson").dom.value=Ext.encode(Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.contentJson);Js.Center.SendMMS.MMSsendUpdateDiy.saveSMS()}}}),new Ext.Button({hidden:true,text:'测试发送',qtip:"测试发送",minWidth:70,handler:function(){Js.Center.SendMMS.SendTest.func(Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.contentJson)}}),new Ext.Button({text:'取消',qtip:"取消",minWidth:70,handler:function(){Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin.hide();Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin.items.items[0].items.items[0].setActiveTab(0)}})],listeners:{"show":function(){Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin.items.items[0].items.items[0].setActiveTab(0);if(Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin.updateRecord!=null){var rowRecord=Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin.updateRecord;var jsonUpdateMMS=eval(doSynRequest(Js.Center.SendMMS.MMSQueryDescURL+"?flag=selecthismms&nummmsseqid="+Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin.updateRecord.get("nummmsid")));Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.contentJson=jsonUpdateMMS;Js.Center.SendMMS.MMSsendUpdateDiy.FramePanel.contentJson=jsonUpdateMMS;Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.currFrame=0;Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.refreshAll();Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.refreshBrotherPanel(0);Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[0].setValue(Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin.updateRecord.get("vc2name"));Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[8].setValue(Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin.updateRecord.get("nummmsid"));window.clearInterval(playTime)}Js.Center.Common.ProductStore.load({params:{vc2servicetype:'2'}});SendMMSUpdateDiyListFieldSet.findById("Js.Center.SendMMS.MMSsendUpdateDiy.DatEndTime").setValue(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),1));},"hide":function(){if(Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.bottomToolbar.items.items[0].text!="播放"){previewMMS(Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.contentJson.frame.length);window.clearInterval(playTime)}Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin.items.items[0].items.items[0].setActiveTab(0)}}})}if(show){}Js.Center.SendMMS.MMSsendUpdateDiy.saveSMS=function(){if(Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin.mainForm.isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.SendMMS.MMSsendUpdateDiy.MMSsendUpdatediyWin.mainFormSubmitFunc();}}};Js.Center.SendMMS.MMSsendUpdateDiy.MMSSendContent=function(mmsName,id){var json=newMMS('','',1,1);var _mmsid=id;if(Js.Center.SendMMS.MMSsendUpdateDiy.MMSSendUpdateWin==null){if(typeof(mmsConfigInfo)=="undefined"){mmsConfigInfo=ajaxSyncCall(Js.Center.SendMMS.MMSConfigInfo,"flag=mmsconfiginfo")}Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel=new Ext.FormPanel({bodyStyle:"padding:10px 0 10px 15px",title:'编辑',region:'center',labelWidth:90,layout:'form',fileUpload:true,defaults:{msgTarget:"side"},items:[{xtype:'textfield',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'MMSname',fieldLabel:"彩信标题",disabled:true,width:350},{xtype:'numberfield',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'datframetime',fieldLabel:getHelpMsg("帧播放时间",true,"此项必填，范围在1-120，以秒为单位！"),allowBlank:false,blankText:'此项必填，范围在1-120，以秒为单位！',maxValue:120,maxText:'最大不能超过120秒',minValue:1,minText:'最小不能小于1秒',allowDecimals:false,value:"5",width:30},{xtype:'FileUpload',id:'Js.Center.SendMMS.MMSsendUpdateDiy.vc2Image',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2image',fieldLabel:getHelpMsg("帧图片",false,"此项非必选项，上传图片格式为："+MMSIMAGEFILETYPEDESC+"，尺寸最大限制为"+mmsConfigInfo.imagewidth+" x "+mmsConfigInfo.imageheight+"（宽x高），大小不能超过"+mmsConfigInfo.imagesize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的图片！"),width:200},{xtype:'FileUpload',id:'Js.Center.SendMMS.MMSsendUpdateDiy.vc2Music',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2music',fieldLabel:getHelpMsg("帧背景音乐",false,"此项非必选项，上传音乐格式为："+MMSMUSICFILETYPEDESC+"，大小不能超过"+mmsConfigInfo.musicsize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的音乐！"),width:350},{xtype:'textarea',id:'Js.Center.SendMMS.MMSsendUpdateDiy.vc2Word',name:'vc2word',style:'word-wrap:break-word;word-break:break-all;',fieldLabel:getHelpMsg("帧文字",false,"此项非必填项，长度不能超过2000！"),maxLength:2000,maxLengthText:'长度不能超过2000',regex:WXTL.Common.regex.IllegalDiyDiy,regexText:WXTL.Common.regexText.IllegalDiyText,width:350,height:150,validator:function(){var word=Ext.get("Js.Center.SendMMS.MMSsendUpdateDiy.vc2Word").dom.value;if(isExistsHtmlLable(word)){return false}else{return true}},invalidText:'帧文字不能包含HTML标签'},{xtype:'hidden',id:'Js.Center.SendMMS.MMSsendUpdateDiy.CurrFrameOrder',name:'numframeorder',fieldLabel:"帧序号",width:"90%",height:150},{xtype:'hidden',id:'Js.Center.SendMMS.MMSsendUpdateDiy.CurrFrameJson',name:'currframejson',fieldLabel:"帧Json",width:"90%",height:150},{xtype:'hidden',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'flag',fieldLabel:"标识",width:350},{xtype:'hidden',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'mmsid',fieldLabel:"彩信编号",width:350}],buttons:[new Ext.Button({text:'修改帧',minWidth:70,handler:function(){if(Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.getForm().isValid()){if(checkMMSFrame(Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[2].getCheckValue(),Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.contentJson.frame[Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.currFrame].vc2image.vc2rescurl,Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[4].getValue(),Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[2].getValue())){if(Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[2].getValue()!=""&&!checkMMSFrameImageType(Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[2].getCheckValue(),Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[2].getValue())){return false}if(Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[3].getValue()!=""&&!checkMMSFrameMusicType(Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[3].getCheckValue(),Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[3].getValue())){return false}Ext.MessageBox.show({msg:'正在处理，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.getForm().submit({url:Js.Center.SendMMS.MMSFrameUpdateURL,method:"POST",success:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);var falg=objJson.success;var frameJson=objJson.data;if(falg==true){if(!Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[2].getCheckValue()){if(Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[2].getValue()==""){if(Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.contentJson.frame[Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.currFrame].vc2image.vc2rescurl!=""){frameJson.vc2image=Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.contentJson.frame[Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.currFrame].vc2image}}}Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.contentJson.frame[Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.currFrame]=frameJson;Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.refreshAll();Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.render();Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel.refreshBrotherPanel();Ext.Msg.alert("温馨提示","操作成功了!");if(document.getElementById("Js.Center.SendMMS.MMSsendUpdateDiy.vc2Image")!=null){Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.remove("Js.Center.SendMMS.MMSsendUpdateDiy.vc2Image");var fileUp=new WXTL.Widgets.CommonForm.FileUpload({id:'Js.Center.SendMMS.MMSsendUpdateDiy.vc2Image',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2image',fieldLabel:getHelpMsg("帧图片",false,"此项非必选项，上传图片格式为："+MMSIMAGEFILETYPEDESC+"，尺寸最大限制为"+mmsConfigInfo.imagewidth+" x "+mmsConfigInfo.imageheight+"（宽x高），大小不能超过"+mmsConfigInfo.imagesize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的图片！"),width:350});Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.insert(2,fileUp);Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.doLayout()}if(document.getElementById("Js.Center.SendMMS.MMSsendUpdateDiy.vc2Music")!=null){Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.remove("Js.Center.SendMMS.MMSsendUpdateDiy.vc2Music");var fileUpMusic=new WXTL.Widgets.CommonForm.FileUpload({id:'Js.Center.SendMMS.MMSsendUpdateDiy.vc2Music',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',name:'vc2music',fieldLabel:getHelpMsg("帧背景音乐",false,"此项非必选项，上传音乐格式为："+MMSMUSICFILETYPEDESC+"，大小不能超过"+mmsConfigInfo.musicsize/1024+"K；选中右侧“不需要”项，则删除当前帧已上传的音乐！"),width:350});Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.insert(3,fileUpMusic);Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.doLayout()}}else Ext.Msg.alert('温馨提示',objJson.info)},failure:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);Ext.Msg.alert('温馨提示',objJson.info)}})}}}})]});Js.Center.SendMMS.MMSsendUpdateDiy.FramePanel=new WXTL.Widgets.CommonPanel.MMSFramePanel({title:'帧',currFrame:0,region:'south',margins:'3 3 3 3',cmargins:'3 3 3 3',height:189,width:778,contentJson:json,frame:false,listeners:{afterRefresh:function(obj,json,currFrame){Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[1].setValue(currFrame.numframetime);Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[2].setValue(currFrame.vc2image.vc2resurl);Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[3].setValue(currFrame.vc2backmusic.vc2resurl);Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[4].setValue(currFrame.vc2word.vc2rescdesc1);Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[5].setValue(currFrame.numframeorder);Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[7].setValue("mmshisoption");Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[8].setValue(Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel.items.items[8].getValue())}}});Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel=new WXTL.Widgets.CommonPanel.MMSpanel({title:'预览：第1帧',region:'west',brotherPanel:Js.Center.SendMMS.MMSsendUpdateDiy.FramePanel,width:244,height:340,collapsible:true,frame:false});Js.Center.SendMMS.MMSsendUpdateDiy.FramePanel.brotherPanel=Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel;Js.Center.SendMMS.MMSsendUpdateDiy.ShowPanel=new Ext.Panel({width:778,height:590,frame:false,layout:'border',border:true,items:[Js.Center.SendMMS.MMSsendUpdateDiy.EditPanel,Js.Center.SendMMS.MMSsendUpdateDiy.FramePanel,Js.Center.SendMMS.MMSsendUpdateDiy.PreviewMMSPanel]})}};Ext.namespace('Js.Center.SendMMS');Js.Center.SendMMS.mmscontentURL='URL/sendMMS/send/mmscontentquery.ashx';Js.Center.SendMMS.mmscontentaddURL='URL/sendMMS/send/mmscontentadd.ashx';Js.Center.SendMMS.MMSContentUpdateURL='URL/sendMMS/send/mmscontentupdate.ashx';Js.Center.SendMMS.MMSFrameUpdateURL='URL/sendMMS/MMS/mmsframeupdate.ashx';Js.Center.SendMMS.MMSContentDeleteURL='URL/sendMMS/send/mmscontentdelete.ashx';Js.Center.SendMMS.smscontentaddtestURL='URL/sendMMS/send/smscontentupdate.ashx';Js.Center.SendMMS.MMSConfigInfo="URL/sendMMS/MMS/mmsconfiginfo.ashx";