Ext.namespace("Js.Center.SendMMS");Js.Center.SendMMS.MMSQueryURL='URL/sendMMS/Query/MMSquery.ashx';Js.Center.SendMMS.MMSMTQueryURL="URL/sendMMS/Query/MMSMTQuery.ashx";Js.Center.SendMMS.MMSMOQueryURL="URL/sendMMS/Query/MMSMOQuery.ashx";Ext.namespace('Js.Center.SendMMS.MMSdepartmoinfo');Js.Center.SendMMS.MMSdepartmoinfo.departmoinfo=function(node){if(Ext.get("Js.Center.SendMMS.MMSdepartmoinfo.MMSDepartMoInfoPanel")==null){var _pageSize=12;var fields=["vc2srcmobile","vc2content","numsvcid","datrecv","vc2username"];Js.Center.SendMMS.MMSdepartmoinfo.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.SendMMS.MMSMOQueryURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numcustomerid",totalProperty:"totalCount"}),baseParams:{datstart:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),datend:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),vc2mmstitle:'',vc2mobile:'',numsvcid:'',flag:'selectbykey'}});Js.Center.SendMMS.MMSdepartmoinfo.Infostore.load({params:{start:0,limit:_pageSize,datstart:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),datend:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),vc2mmstitle:'',vc2mobile:'',numsvcid:'',flag:'selectbykey'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numcustomerid"});var cm=new Ext.grid.ColumnModel([{header:"手机号码",tooltip:"手机号码",dataIndex:"vc2srcmobile",sortable:true},{header:"彩信标题",tooltip:"彩信标题",dataIndex:"vc2content",sortable:true},{header:"服务号码",tooltip:"服务号码",dataIndex:"numsvcid",sortable:true},{header:"收到时间",tooltip:"收到时间",dataIndex:"datrecv",sortable:true}]);var MMSdepartMoInfoGrid=new WXTL.Widgets.CommonGrid.GridPanel({anchor:'100% 100%',pageSize:_pageSize,needMenu:false,store:Js.Center.SendMMS.MMSdepartmoinfo.Infostore,sm:sm,cm:cm,needRightMenu:false});var MMSdepartMOinfoselectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({height:170,queryMethod:"Js.Center.SendMMS.MMSdepartmoinfo.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[new Ext.form.DateField({fieldLabel:'开始时间',name:'datstart',id:'Js.Center.SendMMS.MMSdepartmoinfo.DatStart',emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),format:'Y-m-d',readOnly:true,SvalidateOnBlur:false,validator:function(){var strat_time=Ext.get("Js.Center.SendMMS.MMSdepartmoinfo.DatStart").dom.value;var end_time=Ext.get("Js.Center.SendMMS.MMSdepartmoinfo.DatEnd").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'}),{xtype:"textfield",name:"vc2mmstitle",id:'Js.Center.SendMMS.MMSdepartmoinfo.MMSTitle',fieldLabel:"彩信标题",regex:WXTL.Common.regex.IllegalDiy,regexText:WXTL.Common.regexText.IllegalText,maxLength:20,maxLengthText:'长度应小于等于20'},{xtype:"textfield",name:"vc2mobile",id:"Js.Center.SendMMS.MMSdepartmoinfo.MMSSendMobile",fieldLabel:"手机号码",regex:WXTL.Common.regex.Mobile,regexText:"手机号码格式不正确"}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[new Ext.form.DateField({fieldLabel:'结束时间',name:'datend',id:'Js.Center.SendMMS.MMSdepartmoinfo.DatEnd',emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),format:'Y-m-d',readOnly:true,validateOnBlur:false,validator:function(){var strat_time=Ext.get("Js.Center.SendMMS.MMSdepartmoinfo.DatStart").dom.value;var end_time=Ext.get("Js.Center.SendMMS.MMSdepartmoinfo.DatEnd").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'}),{xtype:"textfield",name:"vc2serviceid",id:"Js.Center.SendMMS.MMSdepartmoinfo.MMSSendServiceID",fieldLabel:"服务号码",regex:/^\d{1,20}$/,regexText:"只能输入长度20位以内的数字"}]}]}]});Js.Center.SendMMS.MMSdepartmoinfo.queryGrid=function(){if(MMSdepartMOinfoselectPanel.getForm().isValid()){var datStart=Ext.get("Js.Center.SendMMS.MMSdepartmoinfo.DatStart").getValue();var datEnd=Ext.get("Js.Center.SendMMS.MMSdepartmoinfo.DatEnd").getValue();var vc2mmstitle=Ext.get("Js.Center.SendMMS.MMSdepartmoinfo.MMSTitle").getValue();var vc2mobile=Ext.get("Js.Center.SendMMS.MMSdepartmoinfo.MMSSendMobile").getValue();var numsvcid=Ext.get("Js.Center.SendMMS.MMSdepartmoinfo.MMSSendServiceID").getValue();var flag='selectbykey';Js.Center.SendMMS.MMSdepartmoinfo.Infostore.baseParams={datstart:datStart,datend:datEnd,vc2mmstitle:vc2mmstitle,vc2mobile:vc2mobile,numsvcid:numsvcid,flag:flag};Js.Center.SendMMS.MMSdepartmoinfo.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.SendMMS.MMSdepartmoinfo.MMSDepartMoInfoPanel=new Ext.Panel({frame:true,id:"Js.Center.SendMMS.MMSdepartmoinfo.MMSDepartMoInfoPanel",bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[MMSdepartMOinfoselectPanel,MMSdepartMoInfoGrid]})};Js.Center.SendMMS.MMSdepartmoinfo.BlackAdd=function(vc2Mobile){Ext.Msg.confirm("提示!","您确定要将此号码加入黑名单吗?",function(btn){if(btn=="yes"){doSynRequest(Js.Center.Business.BlackUpdateURL+"?whitelistaddnumsvcid=1&flag=insertbylist&mobilelist="+vc2srcmobile)}else{}Js.Center.SendMMS.MMSdepartmoinfo.Infostore.reload()})};GridMain(node,Js.Center.SendMMS.MMSdepartmoinfo.MMSDepartMoInfoPanel,"openroomiconinfo","Js.Center.SendMMS.MMSdepartmoinfo.Infostore")};