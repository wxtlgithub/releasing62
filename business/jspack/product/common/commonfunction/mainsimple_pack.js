Ext.form.Field.prototype.msgTarget='side';Ext.namespace('Js.Center.Common');Ext.MessageBox.minWidth=150;Ext.QuickTips.init();if(!Ext.grid.GridView.prototype.templates){Ext.grid.GridView.prototype.templates={}}Ext.grid.GridView.prototype.templates.cell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} x-selectable {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" {attr}>{value}</div>','</td>');Ext.data.Store.prototype.applySort=function(){if(this.sortInfo&&!this.remoteSort){var s=this.sortInfo,f=s.field;var st=this.fields.get(f).sortType;var fn=function(r1,r2){var v1=st(r1.data[f]),v2=st(r2.data[f]);if(typeof(v1)=="string"){return v1.localeCompare(v2);}return v1>v2?1:(v1<v2?-1:0)};this.data.sort(s.direction,fn);if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(s.direction,fn)}}};var rootsid="-1";var root=new Ext.tree.AsyncTreeNode({id:rootsid,text:"短信发送平台",loader:new Ext.tree.TreeLoader({url:treeData,listeners:{"beforeload":function(treeloader,node){treeloader.baseParams={parentid:node.id,method:'POST'}}}})});var index=-1;var tree=new Ext.tree.TreePanel({border:false,applyTo:document.body,root:root,rootVisible:false,listeners:{"click":function(node,event){if(node.isLeaf()){eval(node.attributes['url']+'(node)')}else{event.stopEvent();node.toggle()}return false}}});tree.expand();var west=new Ext.Panel({collapsible:true,border:false,autoScroll:true,width:195,layout:"accordion",extraCls:"roomtypegridbbar",layoutConfig:{activeOnTop:false,fill:true,hiddencollapseTool:true,titlecollapse:false,animate:false},region:"west",title:'<div style="height:44px; padding: 7px 0px 0px 60px; width:100%; *background:url(jspack/product/common/Images/menu_bg.gif) repeat-x scroll 0 0 transparent;">菜单导航</div>'});function menuClick(nodeId,nodeText,url){if(nodeText.length>1){nodeText=nodeText.substring(1,nodeText.length)}var node=eval({"id":nodeId,"text":nodeText,"url":url});var tab=center.getItem("tab"+node.id);if(!tab){loadflag=false;tab=center.add({id:"tab"+node.id,iconCls:'openroomiconinfo',xtype:"panel",title:node.text,closable:true,layout:"fit"}).show();WXTL.Common.showWaitLoading(true);eval(url+'(node)');}center.setActiveTab(tab)}function viewLeftMenu(jsonObject,parentPanel){if(jsonObject!=null){if(jsonObject.data!=null){if(jsonObject.data.length>0){for(var i=0;i<jsonObject.data.length;i++){var menuPanel=new Ext.Panel({ctCls:"x-panel-body-bg",collapsed:true,autoHeight:true,title:'<div style="font-size:12px; padding:1px 0px 0px 15px;"><img src="jspack/product/common/Images/icons/'+jsonObject.data[i].id+'.png" onerror=\'this.src="jspack/product/common/Images/icons/s342.png"\'>&nbsp;<b>'+jsonObject.data[i].text+'</b></div>'});if(jsonObject.data[i].leaf){menuPanel=new Ext.Panel({border:false,items:[{xtype:'ClickLabel',id:jsonObject.data[i].id,ctCls:"x-panel-body-noheader-left",overCls:"x-panel-body-noheader-left-mouseover",style:'font-size:12px;padding:5px 0px 0px 25px;height:23px;cursor:pointer;overflow:hidden;width:100%;display:block;',text:'• '+jsonObject.data[i].text,url:jsonObject.data[i].url,listeners:{"click":function(){menuClick(this.getId(),this.text,this.url)}}}]})}viewLeftMenu(jsonObject.data[i],menuPanel);parentPanel.add(menuPanel)}}}}}function getLeftMenu(){var jsonLeftMenuObject=eval(doSynRequest(treeData+"?flag=selectall"));viewLeftMenu(jsonLeftMenuObject,west)}getLeftMenu();var SetWinHeight=function(obj){var win=obj;if(document.getElementById){if(win&&!window.opera){if(win.contentDocument&&win.contentDocument.body.offsetHeight){win.height=win.contentDocument.body.offsetHeight;win.width=win.contentDocument.body.offsetWidth}else if(win.Document&&win.Document.body.scrollHeight){win.height=win.Document.body.scrollHeight;win.width=win.Document.body.scrollWidth}}}}var loadflag=false;function loadWelcome(){loadCurrentUserinfo();if(Js.Center.Common.userData!=null){var userData=Js.Center.Common.userData;var javaStr='';var userType="";javaStr=javaStr+'<div class="bg"></div>';javaStr=javaStr+'<div class="content">';if(userData.data.length>0){if(userData.data[0].numtype==-1){userType="系统管理员"}if(userData.data[0].numtype==1){userType="管理员"}if(userData.data[0].numtype==2){userType="普通用户"}javaStr=javaStr+'<dl>';javaStr=javaStr+'	<dt><span>账户信息</span></dt>';javaStr=javaStr+'    <dd><span>账户名：</span><label id="userAccountId"></label>'+userData.data[0].vc2uaccount+'</dd>';javaStr=javaStr+'    <dd><span>用户名：</span>'+userData.data[0].vc2username+'</dd>';javaStr=javaStr+'    <dd><span>部门：</span>'+userData.data[0].vc2departname+'</dd>';javaStr=javaStr+'    <dd><span>账户类型：</span>'+userType+'</dd>';javaStr=javaStr+'    <dd><a href="#" onClick="menuClick(\'s49\',\' 个人信息管理\',\'js.loadjs.loadsystemupdatepwd\')">个人信息修改</a></dd>';javaStr=javaStr+'</dl>'}javaStr=javaStr+'</div>';return javaStr}};setTimeout(function(){},100);var welcomepanel=new Ext.Panel({autoScroll:true,id:"index",iconCls:"indexicon",title:"平台首页",items:[{html:loadWelcome()}]});Js.Center.Common.timeInterval=null;var center=new Ext.TabPanel({style:"padding:0 0px 0 5px",region:"center",activeItem:0,enableTabScroll:true,layoutOnTabChange:true,listeners:{tabchange:function(TabPanel,Panel,EventObject){if(Panel.name!=null&&Panel.name!=""&&loadflag){if(Panel.id=='ProductMonitorNode'){LoadMoniytttttorInfo(Panel.id,Js.Center.System.ProductMonitor.ProductMonitorFormPanel)}else{if(Panel.name.indexOf("(")>0){eval(Panel.name)}else{eval(Panel.name+'.reload()')}}}if(Panel.title!=" 网关监控"){if(Js.Center.Common.timeInterval!="undefined"&&Js.Center.Common.timeInterval!=null){window.clearInterval(Js.Center.Common.timeInterval);Js.Center.Common.timeInterval=null}}else if(Js.Center.Common.timeInterval==null)if(!Ext.isEmpty(Js.Center.Monitor))Js.Center.Common.timeInterval=setInterval("Js.Center.Monitor.GatewayMonitorManage.monitorRoloadWithoutAmount()",3000);loadflag=true}},items:[welcomepanel],plugins:new Ext.ux.TabCloseMenu()});function doExit(){Ext.Ajax.request({url:"URL/Exit.ashx?flag=exit",method:"POST",success:function(form,action){var obj=Ext.util.JSON.decode(form.responseText);var falg=obj.success;if(falg==true){window.location.href="login.htm"}else Ext.Msg.alert('提 示',obj.info)},failure:function(form,action){Ext.Msg.alert('提 示','系统忙，请稍候...')}})}function LoadMonitorInfo(nodeID,panel){if(center.getActiveTab().id==nodeID){panel.reload();setTimeout(function(){LoadMonitorInfo(nodeID,panel)},5000)}else{return}}function loadCurrentUserinfo(){Js.Center.Common.userData=doSynRequest(getUserURL+"?flag=selectcuruserall");Js.Center.Common.getUserRecord=function(){if(Js.Center.Common.userData!=null){var reader=new Ext.data.JsonReader({totalProperty:'totalProperty',root:'data',fields:["numuserid","vc2username","vc2uaccount","vc2upassword","vc2mobile","vc2email","numdepartid","vc2departname","vc2phone","numroleid","vc2rolename","numdroleid","vc2drolename","numcreator","datcreatetime","vc2extendcode","vc2ordercode","numtype","vc2signature","vc2mobilelist"]});if(Js.Center.Common.userData.info==null){if(Js.Center.Common.userData.totalCount==0){window.location.href="login.htm"}else{var responses=reader.readRecords(Js.Center.Common.userData);var userRecord=responses.records["0"];return userRecord}}else{window.location.href="login.htm"}}}if(Js.Center.Common.getUserRecord()!=null){Js.Center.Common.userName=Js.Center.Common.getUserRecord().data.vc2username;Js.Center.Common.userMobile=Js.Center.Common.getUserRecord().data.vc2mobile;Js.Center.Common.userSignature=Js.Center.Common.getUserRecord().data.vc2signature;Js.Center.Common.userDepartId=Js.Center.Common.getUserRecord().data.numdepartid;Js.Center.Common.userDepartName=Js.Center.Common.getUserRecord().data.vc2departname;if(Js.Center.Common.getUserRecord().data.vc2mobilelist!=""){Js.Center.Common.userMobile=Js.Center.Common.getUserRecord().data.vc2mobile+';'+Js.Center.Common.getUserRecord().data.vc2mobilelist}}else{Js.Center.Common.userName=null;Js.Center.Common.userMobile=null;Js.Center.Common.userSignature=null;Js.Center.Common.userDepartId=null;Js.Center.Common.userDepartName=null}}function ChangeTheme(){WXTL.Common.Theme.winStyle.show();}function MessagePop(){var jsonMessageObject=eval(doSynRequest(Js.Center.Message.MessageQueryURL+"?flag=getmessagebywhere&status=0&start=0&ruserid=1"));var javastr='';if(jsonMessageObject.data.length>0){javastr=javastr+'  <div class="title">';javastr=javastr+'  		<span class="close" onclick="popMsgWin()">X</span></div>';javastr=javastr+'			<div class="con">';javastr=javastr+'				<h1>';javastr=javastr+'					您有'+jsonMessageObject.data.length+'条消息，请及时查看！</h1>';javastr=javastr+'<ul>';for(var i=0;i<jsonMessageObject.data.length;i++){javastr=javastr+'<li><a href="#" onclick="menuClick(\'s252\',\'消息系统管理\',\'js.loadjs.loadmessage\')">'+jsonMessageObject.data[i].vc2title+'</a></li>'}javastr=javastr+'</ul>';javastr=javastr+'</div>';}return javastr;}function popMsgWin(){var msgContent=MessagePop();if(msgContent!=''){var MsgPop=document.getElementById("winpop");MsgPop.innerHTML='';MsgPop.innerHTML=msgContent;var popH=parseInt(MsgPop.style.height);if(popH==0){MsgPop.style.display="block";show=setInterval("changeH('up')",2);}else{hide=setInterval("changeH('down')",2);}}setTimeout("popMsgWin()",300000);}function changeH(str){var MsgPop=document.getElementById("winpop");var popH=parseInt(MsgPop.style.height);if(str=="up"){if(popH<=176){MsgPop.style.height=(popH+4).toString()+"px";}else{clearInterval(show);}}if(str=="down"){if(popH>=4){MsgPop.style.height=(popH-4).toString()+"px";}else{clearInterval(hide);MsgPop.style.display="none";}}}window.onload=function(){}Ext.onReady(function(){Ext.BLANK_IMAGE_URL='extjs2.2/resources/images/default/s.gif';new Ext.Viewport({title:'整体布局',loadMask:{msg:'正在加载数据...'},layout:'border',items:[{border:false,region:'north',height:55,items:[{xtype:'toolbar',border:false,cls:"x-toolbar-top",items:[new Ext.Toolbar.TextItem({text:'<img id="imgLogo" src="jspack/product/common/Images/icon-slate-theme.gif" />'}),'->',new Ext.Toolbar.TextItem({text:'<img id="imgLogo" src="jspack/product/common/Images/right_btn.png" /><font class="x-btn-text-toplefticon">'+Js.Center.Common.userName+'欢迎使用!</font>'}),'->',new Ext.Toolbar.Button({icon:"jspack/product/common/Images/exit_btn.png",iconCls:"x-btn-text-toprighticon",height:20,text:'退出系统',handler:doExit})]}]},west,center,{bodyStyle:"background-image: url(jspack/product/common/Images/bg_pgd n.gif);",border:false,region:'south',height:25,items:[{xtype:'toolbar',height:'25',border:false,items:['->',new Ext.Toolbar.TextItem({text:'<font class="x-btn-text-bottomrighticon">版权所有©北京无线天利移动信息技术有限公司</font>'})]}]}]});Ext.get('loading').remove();Ext.get('loading-mask').fadeOut({remove:true})});