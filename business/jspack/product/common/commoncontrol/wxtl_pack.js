Ext.namespace("WXTL.Widgets.CommonWindows");WXTL.Widgets.CommonWindows.Window=Ext.extend(Ext.Window,{title:"添加栏目成员",width:650,iconCls:"addicon",resizable:false,collapsible:true,closeAction:'hide',closable:true,plain:true,modal:'true',needButtons:"true",buttonAlign:"center",structure:'1',mainForm:'',updateURL:'',displayStore:'',updateState:true,updateRecord:'',needLoadDataStore:false,loadDataStoreFunc:'',initComponent:function(){if(this.structure!=''){this.initStructure()}WXTL.Widgets.CommonWindows.Window.superclass.initComponent.call(this);if(!this.rendered){this.render(Ext.getBody())}},onRender:function(ct,position){WXTL.Widgets.CommonWindows.Window.superclass.onRender.call(this,ct,position)},initStructure:function(){var obj=this;this.addListener("show",function(){if(obj.mainForm){obj.mainForm.reset();obj.center();if(obj.updateState&&obj.updateRecord!=null){if(obj.mainForm.loadRecord)obj.mainForm.loadRecord(obj.updateRecord)}if(obj.needLoadDataStore){this.loadDataStoreFunc();}}});if(this.needButtons){this.buttons=[new Ext.Button({text:'确定',minWidth:70,handler:function(){if(obj.mainForm.isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);obj.mainFormSubmitFunc()}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){obj.mainForm.reset();if(obj.updateState&&obj.updateRecord!=null){obj.mainForm.loadRecord(obj.updateRecord)}}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){if(obj.closeAction=='close'){obj.close()}else{obj.hide()}}})]}},mainFormSubmitFunc:function(sucessFuncs,parms,url){var sucessFunc="";if(sucessFuncs!=null&&sucessFuncs!=''&&sucessFuncs!="undefined"){if(Ext.isIE==true){sucessFunc=sucessFuncs.replace(/\r\n/ig,"\\r\\n")}else{sucessFunc=sucessFuncs.replace(/\n/ig,"\\n")}}var obj=this;if(parms!=null){Ext.Ajax.request({url:url,method:"POST",params:parms,success:function(form,action){var objJson=Ext.util.JSON.decode(form.responseText);var falg=objJson.success;if(falg==true){if(sucessFunc==null||sucessFunc==''){Ext.Msg.alert("温馨提示","操作成功了!")}else{eval(sucessFunc)}if(obj.closeAction=='close'){obj.close()}else{obj.hide()}if(obj.displayStore!=null){obj.displayStore.reload()}}else{if(objJson.info!=null&&objJson.info=="对不起，您没有登录！"){Ext.Msg.alert("温馨提示","对不起，您的信息已过期请重新登录!",function(){window.location.href="login.htm"})}else{Ext.Msg.alert('温馨提示',objJson.info)}}},failure:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);if(!objJson.success&&objJson.info=="对不起，您没有登录！"){Ext.Msg.alert("温馨提示","对不起，您的信息已过期请重新登录!",function(){window.location.href="login.htm"})}else{Ext.Msg.alert('温馨提示',objJson.info)}}})}else{obj.mainForm.submit({url:obj.updateURL,method:"POST",success:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);var falg=objJson.success;if(falg==true){if(sucessFunc==null||sucessFunc==''){Ext.Msg.alert("温馨提示","操作成功了!")}else{eval(sucessFunc)}if(obj.closeAction=='close'){obj.close()}else{obj.hide()}if(obj.displayStore!=null){obj.displayStore.reload()}}else{if(objJson.info!=null&&objJson.info=="对不起，您没有登录！"){Ext.Msg.alert("温馨提示","对不起，您的信息已过期请重新登录!",function(){window.location.href="login.htm"})}else{Ext.Msg.alert('温馨提示',objJson.info)}}},failure:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);if(!objJson.success&&objJson.info=="对不起，您没有登录！"){Ext.Msg.alert("温馨提示","对不起，您的信息已过期请重新登录!",function(){window.location.href="login.htm"})}else{Ext.Msg.alert('温馨提示',objJson.info)}}})}}});Ext.reg('CommonWindows',WXTL.Widgets.CommonWindows.Window);WXTL.Widgets.CommonWindows.WindowOriginal=Ext.extend(Ext.Window,{title:"添加栏目成员",width:650,iconCls:"addicon",resizable:false,collapsible:true,closeAction:'close',closable:true,plain:true,modal:'true',needButtons:"true",buttonAlign:"center",structure:'1',mainForm:'',updateURL:'',displayStore:'',updateState:true,updateRecord:'',initComponent:function(){if(this.structure!=''){this.initStructure()}WXTL.Widgets.CommonWindows.Window.superclass.initComponent.call(this)},onRender:function(ct,position){WXTL.Widgets.CommonWindows.Window.superclass.onRender.call(this,ct,position)},initStructure:function(){var obj=this;this.addListener("show",function(){obj.center();if(obj.updateState&&obj.updateRecord!=null){obj.mainForm.loadRecord(obj.updateRecord)}});if(this.needButtons){this.buttons=[new Ext.Button({text:'确定',minWidth:70,handler:function(){if(obj.mainForm.isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);obj.mainFormSubmitFunc()}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){obj.mainForm.reset();if(obj.updateState&&obj.updateRecord!=null){obj.mainForm.loadRecord(obj.updateRecord)}}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){obj.close()}})]}},mainFormSubmitFunc:function(sucessFuncs,parms,url){var sucessFunc="";if(sucessFuncs!=null&&sucessFuncs!=''&&sucessFuncs!="undefined"){if(Ext.isIE==true){sucessFunc=sucessFuncs.replace(/\r\n/ig,"\\r\\n")}else{sucessFunc=sucessFuncs.replace(/\n/ig,"\\n")}}var obj=this;if(parms!=null){Ext.Ajax.request({url:url,method:"POST",params:parms,success:function(form,action){var objJson=Ext.util.JSON.decode(form.responseText);var falg=objJson.success;if(falg==true){if(sucessFunc==null||sucessFunc==''){Ext.Msg.alert("温馨提示","操作成功了!")}else{eval(sucessFunc)}if(obj.closeAction=='close'){obj.close()}else{obj.hide()}if(obj.displayStore!=''){obj.displayStore.reload()}}else{if(obj.info=="对不起，您没有登录！"){Ext.Msg.alert("温馨提示","对不起，您的信息已过期请重新登录!",function(){window.location.href="login.htm"})}else{Ext.Msg.alert('温馨提示',objJson.info)}}},failure:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);if(!objJson.success&&objJson.info=="对不起，您没有登录！"){Ext.Msg.alert("温馨提示","对不起，您的信息已过期请重新登录!",function(){window.location.href="login.htm"})}else{Ext.Msg.alert('温馨提示',objJson.info)}}})}else{obj.mainForm.submit({url:obj.updateURL,method:"POST",success:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);var falg=objJson.success;if(falg==true){if(sucessFunc==null||sucessFunc==''){Ext.Msg.alert("温馨提示","操作成功了!")}else{eval(sucessFunc)}if(obj.closeAction=='close'){obj.close()}else{obj.hide()}if(obj.displayStore!=''){obj.displayStore.reload()}}else{if(obj.info=="对不起，您没有登录！"){Ext.Msg.alert("温馨提示","对不起，您的信息已过期请重新登录!",function(){window.location.href="login.htm"})}else{Ext.Msg.alert('温馨提示',objJson.info)}}},failure:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);if(!objJson.success&&objJson.info=="对不起，您没有登录！"){Ext.Msg.alert("温馨提示","对不起，您的信息已过期请重新登录!",function(){window.location.href="login.htm"})}else{Ext.Msg.alert('温馨提示',objJson.info)}}})}},listeners:{"show":function(){this.center()}}});Ext.reg('CommonWindowsOriginal',WXTL.Widgets.CommonWindows.WindowOriginal);Ext.namespace("WXTL.Widgets.CommonPanel");WXTL.Widgets.CommonPanel.CheckBoxGroupPanel=Ext.extend(Ext.Panel,{store:null,defaultItemsName:'',defaultItemsboxLable:'',loadingText:'Loading...',layout:'form',title:'',loadingMask:null,needButton:true,boxLabelText:'',initComponent:function(){WXTL.Widgets.CommonPanel.CheckBoxGroupPanel.superclass.initComponent.call(this)},onRender:function(H,F){var obj=this;if(this.store){this.store.on('load',this.onLoad,this)};if(this.needButton){this.add(new Ext.Panel({layout:'column',items:[{columnWidth:.15,items:[new Ext.form.Label({style:"color:red;font-weight:normal",text:this.name})]},{columnWidth:.08,items:[new Ext.Button({text:" 全选 ",listeners:{"click":function(){obj.setAll(true)}}})]},{columnWidth:.1,items:[new Ext.Button({text:" 全不选 ",listeners:{"click":function(){obj.setAll(false)}}})]},{columnWidth:.1,items:[new Ext.Button({text:" 反选 ",listeners:{"click":function(){obj.invert()}}})]}]}))}WXTL.Widgets.CommonPanel.CheckBoxGroupPanel.superclass.onRender.call(this,H,F)},initEvents:function(){WXTL.Widgets.CommonPanel.CheckBoxGroupPanel.superclass.initEvents.call(this);},onLoad:function(){var count=this.store.getCount();var myCheckboxItems=[];var columsTemp=this.numcolumns;if(count<this.numcolumns){columsTemp=count}if(count==0){columsTemp=1;myCheckboxItems.push({boxLabel:this.defaultItemsboxLable,name:this.defaultItemsName,disabled:true})}else{if(count>500){Ext.Msg.alert("温馨提示","CheckBoxGroup控件最多显示500个数据项，请谅解!")}else{for(var i=0;i<count;i++){if(i<501){var boxLabel=this.store.getAt(i).data.boxLabel;var inputValue=this.store.getAt(i).data.inputValue;var checked=this.store.getAt(i).data.checked;var parentId=this.store.getAt(i).data.parentId==null?"":this.store.getAt(i).data.parentId;if(parentId!=""){if(parentId=="-1"){myCheckboxItems.push({boxLabel:boxLabel,name:this.defaultItemsName,inputValue:inputValue,checked:checked});if(this.boxLabelText!=""){var objGroup=this;myCheckboxItems.push({xtype:'label',height:25,html:this.boxLabelText.replace(/{inputValue}/g,inputValue).replace(/{boxLabel}/g,boxLabel)})}}else{var boxLableTextChild=this.boxLabelText.replace("添加","删除").replace("file-add.gif","file-remove.gif").replace("add","delete");myCheckboxItems.push({boxLabel:boxLabel,name:this.defaultItemsName,inputValue:inputValue,style:"padding:2px 0 0 20px",checked:true});if(this.boxLabelText!=""){var objGroup=this;myCheckboxItems.push({xtype:'label',height:25,html:boxLableTextChild.replace(/{inputValue}/g,inputValue).replace(/{boxLabel}/g,boxLabel)})}}}else{myCheckboxItems.push({boxLabel:boxLabel,name:this.defaultItemsName,inputValue:inputValue,checked:checked});if(this.boxLabelText!=""){myCheckboxItems.push({xtype:'label',height:25,html:this.boxLabelText.replace(/{inputValue}/g,inputValue).replace(/{boxLabel}/g,boxLabel)})}}}}}}if(Ext.isIE){this.remove(this.id+"CheckboxGroup");this.remove("x-form-el-"+this.id+"CheckboxGroup")}else{this.remove(this.id+"CheckboxGroup")}this.add(new Ext.form.CheckboxGroup({id:this.id+"CheckboxGroup",columns:columsTemp,hideLabel:true,style:"padding:0px 5px 5px 5px",anchor:'95%',msgTarget:"side",allowBlank:this.allowBlank,blankText:this.blankText,items:myCheckboxItems}));this.doLayout()},invert:function(){this.items.items[1].items.each(function(c){if(!c.disabled){c.setValue(!c.checked)}},this)},setAll:function(v){this.items.items[1].items.each(function(c){if(c.setValue&&!c.disabled){c.setValue(v)}},this)},reset:function(){this.setAll(false);this.items.items[1].reset()}});Ext.reg('CheckBoxGroupPanel',WXTL.Widgets.CommonPanel.CheckBoxGroupPanel);WXTL.Widgets.CommonPanel.QueryFormPanel=Ext.extend(Ext.FormPanel,{title:'查询条件',anchor:'100%',labelWidth:80,collapsed:false,frame:true,labelSeparator:'：',height:150,layout:'fit',queryMethod:"",needButtons:true,buttonAlign:"center",initComponent:function(){this.initStructure();WXTL.Widgets.CommonPanel.QueryFormPanel.superclass.initComponent.call(this)},onRender:function(ct,position){WXTL.Widgets.CommonPanel.QueryFormPanel.superclass.onRender.call(this,ct,position)},initStructure:function(){var obj=this;if(obj.needButtons){this.buttons=[new Ext.Button({text:'查询',handler:function(){obj.doQuery()}}),new Ext.Button({text:'重置',handler:function(){obj.getForm().reset()}})]}},doQuery:function(){eval(this.queryMethod+"()")}});Ext.reg('queryFormPanel',WXTL.Widgets.CommonPanel.QueryFormPanel);WXTL.Widgets.CommonPanel.UploadLargeFilePanel=Ext.extend(Ext.Panel,{title:'',id:'',anchor:'100%',labelWidth:80,frame:true,autoScroll:true,buttonClientText:'客户端文件',buttonServerText:'服务器端文件',url:'/url/upload.ashx',gridStore:'',cmGrid:'',txtMsgHeight:150,fieldlableFile:WXTL.Common.help.MOBILEFILE,items:null,filedialog:null,needLargfile:true,permittedFileExtensions:['txt'],initComponent:function(){var obj=this;this.initStructure(obj);WXTL.Widgets.CommonPanel.UploadLargeFilePanel.superclass.initComponent.call(this)},onRender:function(ct,position){WXTL.Widgets.CommonPanel.UploadLargeFilePanel.superclass.onRender.call(this,ct,position)},initStructure:function(obj){if(obj.needLargfile){obj.items=[{layout:'column',defaults:{anchor:'100%',bodyStyle:'padding:2px 0 0 5px;'},items:[{columnWidth:.8,layout:'form',border:false,defaults:{anchor:'100%'},items:[{xtype:'hidden',name:'filebyservice',id:obj.id+"FileByService",value:'0'},{xtype:'hidden',name:'vc2loadfilename',id:obj.id+"LoadFileName",value:''},{xtype:'fileuploadfield',id:obj.id+'ClientFile',name:'mobilefile',buttonText:obj.buttonClientText,fieldLabel:obj.fieldlableFile,buttonClickFunc:function(){document.getElementById(obj.id+"FileByService").value=0},msgTarget:'qtip',validator:function(){var filePath=document.getElementById(obj.id+"ClientFile").value;document.getElementById(obj.id+"ClientFileName").value=escape(filePath);if(filePath!=''){document.getElementById(obj.id+"FileMessage").value=getFileMessage(filePath);if(checkFile(filePath)!=''){this.invalidText=checkFile(filePath);return false}else{return true}}else return false}}]},{columnWidth:.2,layout:'form',border:false,items:[{xtype:'button',text:obj.buttonServerText,handler:function(){document.getElementById(obj.id+"FileByService").value=1;obj.items.items[0].items.items[0].items.items[2].reset();document.getElementById(obj.id+"FileMessage").value="";document.getElementById(obj.id+"ClientFileName").value="";if(WXTL.Widgets.CommonWindows.dialog==null){WXTL.Widgets.CommonWindows.dialog=new Ext.ux.UploadDialog.Dialog({title:"服务器端文件",modal:true,url:'/URL/upload.ashx',tfFileName:obj.id,permitted_extensions:obj.permittedFileExtensions,reset_on_hide:false,allow_close_on_upload:true,upload_autostart:true})}obj.filedialog=WXTL.Widgets.CommonWindows.dialog;obj.filedialog.tfFileName=obj.id;if(!obj.filedialog.is_uploading){if(obj.filedialog.gridStore!=""){obj.filedialog.gridStore.reload()}}obj.filedialog.show();obj.filedialog.updateToolbar();}}]},{columnWidth:1,layout:'form',border:false,defaults:{anchor:'95%'},items:[{xtype:'textarea',name:'filemessage',id:obj.id+"FileMessage",fieldLabel:'文件信息',readOnly:true,allowBlank:false,blankText:'请选择文件！',height:obj.txtMsgHeight},{xtype:'hidden',name:'vc2clientfilename',id:obj.id+"ClientFileName"}]}]}]}else{obj.items=[{layout:'column',defaults:{anchor:'100%',bodyStyle:'padding:2px 0 0 5px;'},items:[{columnWidth:.8,layout:'form',border:false,defaults:{anchor:'100%'},items:[{xtype:'hidden',name:'filebyservice',id:obj.id+"FileByService",value:'0'},{xtype:'hidden',name:'vc2loadfilename',id:obj.id+"LoadFileName",value:''},{xtype:'fileuploadfield',id:obj.id+'ClientFile',name:'mobilefile',buttonText:obj.buttonClientText,fieldLabel:obj.fieldlableFile,buttonClickFunc:function(){document.getElementById(obj.id+"FileByService").value=0},msgTarget:'qtip',validator:function(){var filePath=document.getElementById(obj.id+"ClientFile").value;document.getElementById(obj.id+"ClientFileName").value=escape(filePath);if(filePath!=''){document.getElementById(obj.id+"FileMessage").value=getFileMessage(filePath);if(checkFile(filePath)!=''){this.invalidText=checkFile(filePath);return false}else{return true}}else return false}}]},{columnWidth:.2,layout:'form',border:false,items:[{xtype:'hidden',fieldLabel:"隐藏大文件"}]},{columnWidth:1,layout:'form',border:false,defaults:{anchor:'95%'},items:[{xtype:'textarea',name:'filemessage',id:obj.id+"FileMessage",fieldLabel:'文件信息',readOnly:true,allowBlank:false,blankText:'请选择文件！',height:obj.txtMsgHeight},{xtype:'hidden',name:'vc2clientfilename',id:obj.id+"ClientFileName"}]}]}]}}});Ext.reg('UploadLargeFilePanel',WXTL.Widgets.CommonPanel.UploadLargeFilePanel);Ext.namespace("wxtl.widgets.panel");WXTL.Widgets.CommonPanel.MainPanel=Ext.extend(Ext.Panel,{refreshlist:"",frame:true,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},initComponent:function(){WXTL.Widgets.CommonPanel.MainPanel.superclass.initComponent.call(this);this.addListener("activate",function(){if(refreshlist!=""){eval(refreshlist+".reload()")}})}});Ext.reg('mainpanel',WXTL.Widgets.CommonPanel.MainPanel);WXTL.Widgets.CommonPanel.MMSpanel=Ext.extend(Ext.Panel,{frame:true,autoScroll:true,layout:"anchor",currFrame:0,brotherPanel:null,contentJson:null,mmsSpace:0,currFrameSpace:0,initComponent:function(){this.initStructure();WXTL.Widgets.CommonPanel.MMSpanel.superclass.initComponent.call(this)},onRender:function(ct,position){WXTL.Widgets.CommonPanel.MMSpanel.superclass.onRender.call(this,ct,position)},refreshAll:function(){var obj=this;obj.getResourceSpace();obj.setTitle(formatString("预览：第{0}帧{1},共{2}",new Array(obj.currFrame+1,Ext.util.Format.fileSize(obj.currFrameSpace),Ext.util.Format.fileSize(obj.mmsSpace))));if(obj.contentJson.frame[obj.currFrame].vc2image.vc2rescurl==""){obj.body.update(formatString(MMSNoImageFrameString,new Array(obj.contentJson.frame[obj.currFrame].vc2word.vc2rescdesc1.replace(/\r\n/ig,"<br/>"))))}else{obj.body.update(formatString(MMSFrameString,new Array(obj.contentJson.frame[obj.currFrame].vc2image.vc2rescurl,obj.contentJson.frame[obj.currFrame].vc2word.vc2rescdesc1.replace(/\r\n/ig,"<br/>"))))}if(obj.mmsSpace>5340400){Ext.Msg.alert("温馨提示","彩信不能大于50K!")}},refreshBrotherPanel:function(i){var obj=this;if(obj.brotherPanel!=null){if(i!=null){obj.brotherPanel.currFrame=i}else{obj.brotherPanel.currFrame=obj.currFrame}obj.brotherPanel.refreshAll();obj.brotherPanel.doLayout()}},getResourceSpace:function(){var obj=this;var frameNum=obj.contentJson.frame.length;obj.mmsSpace=0;for(var i=0;i<frameNum;i++){var temObj=obj.contentJson.frame[i];if(i==obj.currFrame){obj.currFrameSpace=(temObj.vc2word.numrescspace==""?0:parseInt(temObj.vc2word.numrescspace))+(temObj.vc2image.numrescspace==""?0:parseInt(temObj.vc2image.numrescspace))+(temObj.vc2backmusic.numrescspace==""?0:parseInt(temObj.vc2backmusic.numrescspace))};obj.mmsSpace=parseInt(obj.mmsSpace)+(temObj.vc2word.numrescspace==""?0:parseInt(temObj.vc2word.numrescspace))+(temObj.vc2image.numrescspace==""?0:parseInt(temObj.vc2image.numrescspace))+(temObj.vc2backmusic.numrescspace==""?0:parseInt(temObj.vc2backmusic.numrescspace))}},stopCurrFrame:function(){var obj=this;currMMSPanel=obj;obj.getBottomToolbar().items.items[0].setText("播放");obj.getBottomToolbar().items.items[4].disable();obj.getBottomToolbar().items.items[8].disable();if(obj.brotherPanel!=null){obj.brotherPanel.enable()}window.clearInterval(playTime);currMMSPanel.refreshBrotherPanel();if(currMMSPanel.contentJson.frame[currMMSPanel.currFrame].vc2image.vc2rescurl==""){currMMSPanelRender(formatString(MMSNoImageFrameString,new Array(currMMSPanel.contentJson.frame[currMMSPanel.currFrame].vc2word.vc2rescdesc1.replace(/\r\n/ig,"<br/>"))),formatString("预览：第{0}帧{1}, 共{2}",new Array(currMMSPanel.currFrame+1,Ext.util.Format.fileSize(currMMSPanel.currFrameSpace),Ext.util.Format.fileSize(currMMSPanel.mmsSpace))))}else{currMMSPanelRender(formatString(MMSFrameString,new Array(currMMSPanel.contentJson.frame[currMMSPanel.currFrame].vc2image.vc2rescurl,currMMSPanel.contentJson.frame[currMMSPanel.currFrame].vc2word.vc2rescdesc1.replace(/\r\n/ig,"<br/>"))),formatString("预览：第{0}帧{1}, 共{2}",new Array(currMMSPanel.currFrame+1,Ext.util.Format.fileSize(currMMSPanel.currFrameSpace),Ext.util.Format.fileSize(currMMSPanel.mmsSpace))))}},initStructure:function(){var obj=this;if(obj.brotherPanel!=null){obj.contentJson=obj.brotherPanel.contentJson}currMMSPanel=obj;obj.getResourceSpace();if(obj.contentJson.frame[obj.currFrame].vc2image.vc2rescurl==""){obj.html=formatString(MMSNoImageFrameString,new Array(obj.contentJson.frame[obj.currFrame].vc2word.vc2rescdesc1.replace(/\r\n/ig,"<br/>")))}else{obj.html=formatString(MMSFrameString,new Array(obj.contentJson.frame[obj.currFrame].vc2image.vc2rescurl,obj.contentJson.frame[obj.currFrame].vc2word.vc2rescdesc1.replace(/\r\n/ig,"<br/>")))}obj.title=formatString("预览：第{0}帧{1},共{2}",new Array(obj.currFrame+1,Ext.util.Format.fileSize(obj.currFrameSpace),Ext.util.Format.fileSize(obj.mmsSpace)));obj.bbar=[{iconCls:"playicon",text:'播放',handler:function(){if(this.text=="播放"){currMMSPanel=obj;this.setText("停止");obj.getBottomToolbar().items.items[4].enable();obj.getBottomToolbar().items.items[8].enable();if(obj.brotherPanel!=null){obj.brotherPanel.disable()}previewMMS(-1)}else{this.setText("播放");obj.getBottomToolbar().items.items[4].disable();obj.getBottomToolbar().items.items[8].disable();if(obj.brotherPanel!=null){obj.brotherPanel.enable()}window.clearInterval(playTime);currMMSPanel.refreshBrotherPanel();if(currMMSPanel.contentJson.frame[currMMSPanel.currFrame].vc2image.vc2rescurl==""){currMMSPanelRender(formatString(MMSNoImageFrameString,new Array(currMMSPanel.contentJson.frame[currMMSPanel.currFrame].vc2word.vc2rescdesc1.replace(/\r\n/ig,"<br/>"))),formatString("预览：第{0}帧{1}, 共{2}",new Array(currMMSPanel.currFrame+1,Ext.util.Format.fileSize(currMMSPanel.currFrameSpace),Ext.util.Format.fileSize(currMMSPanel.mmsSpace))))}else{currMMSPanelRender(formatString(MMSFrameString,new Array(currMMSPanel.contentJson.frame[currMMSPanel.currFrame].vc2image.vc2rescurl,currMMSPanel.contentJson.frame[currMMSPanel.currFrame].vc2word.vc2rescdesc1.replace(/\r\n/ig,"<br/>"))),formatString("预览：第{0}帧{1}, 共{2}",new Array(currMMSPanel.currFrame+1,Ext.util.Format.fileSize(currMMSPanel.currFrameSpace),Ext.util.Format.fileSize(currMMSPanel.mmsSpace))))}}}},"","-","",{iconCls:"x-tbar-page-prev",text:'上一帧',disabled:true,handler:function(){if(playCurrFrameNum>0){playCurrFrameNum=playCurrFrameNum-1;obj.currFrame=playCurrFrameNum;window.clearInterval(playTime);previewMMS(playCurrFrameNum-1);obj.refreshAll();obj.render();obj.refreshBrotherPanel()}else{Ext.Msg.alert("温馨提示","已经是第一帧!")}}},"","-","",{iconCls:"x-tbar-page-next",text:'下一帧',disabled:true,handler:function(){if(playCurrFrameNum+1<obj.contentJson.frame.length){playCurrFrameNum=playCurrFrameNum+1;obj.currFrame=playCurrFrameNum;window.clearInterval(playTime);previewMMS(playCurrFrameNum-1);obj.refreshAll();obj.render();obj.refreshBrotherPanel()}else{Ext.Msg.alert("温馨提示","已经是最后一帧!")}}}]}});Ext.reg('MMSpanel',WXTL.Widgets.CommonPanel.MMSpanel);WXTL.Widgets.CommonPanel.MMSFramePanel=Ext.extend(Ext.Panel,{frame:true,layout:'absolute',currFrame:0,frameWidth:104,frameHeight:127,increment:5,itemStartX:5,itemStartY:5,store:null,bodyWidth:0,brotherPanel:null,contentJson:null,newFrame:{numframeid:1,numframeorder:1,numframetime:5,vc2framename:"",vc2framedesc:"",vc2word:{numrescid:1,numframeid:1,vc2rescurl:'',vc2rescname:'',numtype:'3',numrescspace:0,vc2rescdesc1:'',numrescdesc2:''},vc2image:{numrescid:1,numframeid:1,vc2rescurl:'',vc2rescname:'',numtype:'1',numrescspace:0,vc2rescdesc1:'',numrescdesc2:''},vc2backmusic:{numrescid:1,numframeid:1,vc2rescurl:'',vc2rescname:'',numtype:'2',numrescspace:0,vc2rescdesc1:'',numrescdesc2:''}},initComponent:function(){this.initStructure();WXTL.Widgets.CommonPanel.MMSFramePanel.superclass.initComponent.call(this);this.addEvents('afterRefresh')},initEvents:function(){WXTL.Widgets.CommonPanel.MMSFramePanel.superclass.initEvents.call(this);this.dd=new WXTL.Widgets.CommonPanel.MMSFramePanel.DropZone(this,this.dropConfig)},beforeDestroy:function(){if(this.dd){this.dd.unreg()}WXTL.Widgets.CommonPanel.MMSFramePanel.superclass.beforeDestroy.call(this)},onRender:function(ct,position){this.refreshAll();WXTL.Widgets.CommonPanel.MMSFramePanel.superclass.onRender.call(this,ct,position)},refreshAll:function(flag,json){var obj=this;if(json==null){json=obj.contentJson}obj.setTitle(formatString("帧列表(第{0}帧,共{1}帧)",new Array(obj.currFrame+1,json.frame.length)));var frameNum=json.frame.length;if(flag==null){if(obj.currFrame>2&&obj.currFrame+3<frameNum){obj.itemStartX=5-(obj.currFrame-3)*(obj.frameWidth+obj.increment)}else{if(obj.currFrame<2||frameNum<=7){obj.itemStartX=5}else{if(obj.currFrame+3>=frameNum){obj.itemStartX=5-(frameNum-7)*(obj.frameWidth+obj.increment)}}}}obj.bodyWidth=(obj.frameWidth+obj.increment)*frameNum;obj.removeAll();for(var i=0;i<frameNum;i++){var htmlFrame=MMSFrameSimpleStrNoImage;if(i==0){var xNum=obj.itemStartX}else{xNum=obj.itemStartX+i*(obj.frameWidth+5)}if(obj.currFrame==i){var titleStr=formatString("第{0}帧({1}秒)<img src='jspack/product/common/Images/drop-yes.gif' align=AbsMiddle width=15 />",new Array((i+1),json.frame[i].numframetime))}else{titleStr=formatString("第{0}帧({1}秒)",new Array((i+1),json.frame[i].numframetime))}if(json.frame[i].vc2image.vc2rescurl!=""){htmlFrame=formatString(MMSFrameSimpleStr,new Array(json.frame[i].vc2image.vc2rescurl,1))}else{htmlFrame=MMSFrameSimpleStrNoImage}obj.add(new Ext.Panel({width:obj.frameWidth,height:obj.frameHeight,x:xNum,y:obj.itemStartY,frame:true,itemIndex:i,margins:'3 3 3 3',title:titleStr,draggable:{insertProxy:false},html:htmlFrame,listeners:{render:function(c){c.el.on('mouseover',function(){c.setPosition(c.x-obj.increment/ 2, c.y - obj.increment /2);c.setSize(obj.frameWidth+obj.increment,obj.frameHeight+obj.increment);});c.el.on('mouseout',function(){c.setPosition(c.x+obj.increment/ 2, c.y + obj.increment /2);c.setSize(obj.frameWidth,obj.frameHeight);});c.el.on('click',function(){obj.currFrame=c.itemIndex;obj.refreshAll();obj.doLayout();obj.refreshBrotherPanel()})}}}))};if(obj.contentJson.frame[obj.currFrame]==undefined){this.fireEvent('afterRefresh',obj,obj.contentJson,obj.contentJson.frame[0])}else{this.fireEvent('afterRefresh',obj,obj.contentJson,obj.contentJson.frame[obj.currFrame])}},refreshBrotherPanel:function(i){var obj=this;if(this.brotherPanel!=null){if(i!=null){this.brotherPanel.currFrame=i}else{this.brotherPanel.currFrame=obj.currFrame}this.brotherPanel.contentJson=obj.contentJson;this.brotherPanel.refreshAll();this.brotherPanel.render()}},initStructure:function(){var obj=this;obj.setTitle(formatString("帧列表(第{0}帧,共{1}帧)",new Array(obj.currFrame+1,obj.contentJson.frame.length)));obj.items=new Array();obj.bbar=[{iconCls:"x-tbar-page-prev",text:'向前',handler:function(){if(obj.itemStartX<0){obj.itemStartX=obj.itemStartX+1*(obj.frameWidth+obj.increment);obj.refreshAll(false);obj.doLayout()}else{Ext.Msg.alert("温馨提示","已经到头了!")}}},"","-","　　　　　　　　　　　　　　　　　　",{iconCls:'addicon',text:'添加帧',buttonAlign:"center",handler:function(){if(obj.contentJson.frame.length==16){Ext.Msg.alert("温馨提示","添加失败，最多只可有16帧!")}else{obj.currFrame=obj.contentJson.frame.length;obj.contentJson.frame.push(obj.newFrame);obj.refreshAll();obj.doLayout();obj.refreshBrotherPanel()}}},"","-","",{iconCls:'addicon',text:'插入帧',handler:function(){if(obj.contentJson.frame.length==16){Ext.Msg.alert("温馨提示","添加失败，彩信最多可有16帧!")}else{obj.contentJson.frame.splice(obj.currFrame,0,obj.newFrame);obj.refreshAll();obj.doLayout();obj.refreshBrotherPanel()}}},"","-","",{iconCls:'deleteicon',text:'删除帧',handler:function(){if(obj.contentJson.frame.length==1){Ext.Msg.alert("温馨提示","删除失败，彩信至少要有1帧!")}else{Ext.Msg.confirm("温馨提示!","您确定要删除帧信息吗?",function(btn){if(btn=="yes"){obj.contentJson.frame.splice(obj.currFrame,1);if(obj.currFrame>=obj.contentJson.frame.length){obj.currFrame=obj.currFrame-1}obj.refreshAll();obj.doLayout();obj.refreshBrotherPanel()}})}}},'->',"","-","",{iconCls:"x-tbar-page-next",text:'向后',handler:function(){if(obj.itemStartX+obj.bodyWidth>obj.width){obj.itemStartX=obj.itemStartX-1*(obj.frameWidth+obj.increment);obj.refreshAll(false);obj.doLayout()}else{Ext.Msg.alert("温馨提示","已经到尾了!")}}}]},doFrameOver:function(fromPos,toPos){var obj=this;if(fromPos>=0&&toPos>=0&&toPos<=obj.contentJson.frame.length&&fromPos<=obj.contentJson.frame.length){var json=obj.contentJson;if(fromPos<toPos){var temValue=json.frame.slice(fromPos,fromPos+1);json.frame.splice(toPos+1,0,temValue[0]);json.frame.splice(fromPos,1);obj.currFrame=toPos;obj.refreshAll(false,json);obj.doLayout();obj.refreshBrotherPanel()}else{if(fromPos>toPos){var temValue=json.frame.slice(fromPos,fromPos+1);json.frame.splice(toPos,0,temValue[0]);json.frame.splice(fromPos+1,1);obj.currFrame=toPos;obj.refreshAll(false,json);obj.doLayout();obj.refreshBrotherPanel()}}}},moveFrame:function(fromPos,toPos){var obj=this;if(fromPos>=0&&toPos>=0&&toPos<=obj.contentJson.frame.length&&fromPos<=obj.contentJson.frame.length){if(fromPos<toPos){var temValue=obj.contentJson.frame.slice(fromPos,fromPos+1);obj.contentJson.frame.splice(toPos+1,0,temValue[0]);obj.contentJson.frame.splice(fromPos,1);obj.currFrame=toPos;obj.refreshAll(false);obj.doLayout();obj.refreshBrotherPanel()}else{if(fromPos>toPos){var temValue=obj.contentJson.frame.slice(fromPos,fromPos+1);obj.contentJson.frame.splice(toPos,0,temValue[0]);obj.contentJson.frame.splice(fromPos+1,1);obj.currFrame=toPos;obj.refreshAll(false);obj.doLayout();obj.refreshBrotherPanel()}}}}});Ext.reg('MMSFramePanel',WXTL.Widgets.CommonPanel.MMSFramePanel);WXTL.Widgets.CommonPanel.MMSFramePanel.DropZone=function(portal,cfg){this.portal=portal;Ext.dd.ScrollManager.register(portal.body);WXTL.Widgets.CommonPanel.MMSFramePanel.DropZone.superclass.constructor.call(this,portal.bwrap.dom,cfg);portal.body.ddScrollConfig=this.ddScrollConfig};Ext.extend(WXTL.Widgets.CommonPanel.MMSFramePanel.DropZone,Ext.dd.DropTarget,{ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(dd,e,data,col,c,pos){return{portal:this.portal,panel:data.panel,columnIndex:col,column:c,position:pos,data:data,source:dd,rawEvent:e,status:this.dropAllowed}},notifyOver:function(dd,e,data){var xy=e.getXY(),portal=this.portal,px=dd.proxy;if(!this.grid){this.grid=this.getGrid()}var cw=portal.body.dom.clientWidth;if(!this.lastCW){this.lastCW=cw}else{if(this.lastCW!=cw){this.lastCW=cw;portal.doLayout();this.grid=this.getGrid()}}var col=0,p,match=false,pos=0,c=portal,items=c.items,overSelf=false;for(var len=items.length;pos<len;pos++){p=items.items[pos];var h=p.el.getWidth();if(h===0){overSelf=true}else{if((p.el.getX()+(h/2))>xy[0]){match=true;break}}}pos=(match&&p?pos:c.items.getCount())+(overSelf?-1:0);var overEvent=this.createEvent(dd,e,data,col,c,pos);if(portal.fireEvent('validatedrop',overEvent)!==false&&portal.fireEvent('beforedragover',overEvent)!==false){this.lastPos={c:c,col:col,p:overSelf||(match&&p)?pos:false};this.currP=c.items.indexOf(dd.panel);this.lastP=this.lastPos.p;this.scrollPos=portal.body.getScroll();portal.fireEvent('dragover',overEvent);return overEvent.status}else{return overEvent.status}},notifyOut:function(){delete this.grid},notifyDrop:function(dd,e,data){delete this.grid;if(!this.lastPos){return}var c=this.lastPos.c,col=this.lastPos.col,pos=this.lastPos.p;var dropEvent=this.createEvent(dd,e,data,col,c,pos!==false?pos:c.items.getCount());if(this.portal.fireEvent('validatedrop',dropEvent)!==false&&this.portal.fireEvent('beforedrop',dropEvent)!==false){this.portal.moveFrame(this.currP,this.lastP);this.portal.fireEvent('drop',dropEvent);var st=this.scrollPos.top;if(st){var d=this.portal.body.dom;setTimeout(function(){d.scrollTop=st},10)}}delete this.lastPos;return true},getGrid:function(){var box=this.portal.bwrap.getBox();box.columnX=[];this.portal.items.each(function(c){box.columnX.push({x:c.el.getX(),w:c.el.getWidth(),y:c.el.getY(),h:c.el.getHeight()})});return box},unreg:function(){WXTL.Widgets.CommonPanel.MMSFramePanel.DropZone.superclass.unreg.call(this)}});Ext.namespace("WXTL.Widgets.CommonGrid");WXTL.Widgets.CommonGrid.GridTreePanel=Ext.extend(Ext.grid.EditorGridPanel,{title:"查询结果",style:'padding:5px 0px 0px 0px',frame:true,pageSize:12,needPage:true,needMenu:true,needRightMenu:false,structure:'1',loadMask:true,autoExpandColumn:7,autoScroll:true,autoHeight:true,inertMethod:'',updateMethod:'',deleteMethod:'',afterEditURL:'',initComponent:function(){if(this.structure!=''){this.initStructure()}WXTL.Widgets.CommonGrid.GridPanel.superclass.initComponent.call(this);var obj=this;for(var i=1;i<=10;i++){if(obj.colModel.lookup[i]!=null&&obj.colModel.lookup[i].editor!=null){obj.colModel.lookup[i].editor.addListener("complete",function(){obj.getStore().reload()})}}},onRender:function(ct,position){if(ogrid.getColumnModel().getColumnId(0)!="checker"){ogrid.getSelectionModel().singleSelect=true}WXTL.Widgets.CommonGrid.GridPanel.superclass.onRender.call(this,ct,position)},initStructure:function(){var ogrid=this;this.view=new Ext.grid.GroupingView({enableGroupingMenu:false,forceFit:true,sortAscText:'正序排列',sortDescText:'倒序排列',columnsText:'列显示/隐藏',groupByText:'根据本列分组',showGroupsText:'是否采用分组显示'});if(this.needPage){var pagingToolbar=new Ext.PagingToolbar({displayInfo:true,store:this.store,emptyMsg:'没有符合条件的记录',displayInfo:true,displayMsg:'当前记录 {0} -- {1} 条 共 {2} 条记录',prevText:"上一页",nextText:"下一页",refreshText:"刷新",lastText:"最后页",firstText:"第一页",beforePageText:"当前页",afterPageText:"共{0}页"});pagingToolbar.pageSize=this.pageSize;this.bbar=pagingToolbar;this.bottomToolbar=this.bbar;var oSearch=new Ext.form.TextField({id:'search',xtype:'textfield',align:'right'})};if(this.needMenu){var keyField=this.keyField;var topToolbar=new Ext.Toolbar({items:[{iconCls:'addicon',text:"新增",handler:function(){ogrid.doInsert()}},"","-","",{iconCls:'editicon',text:"修改",handler:function(){ogrid.doEdit()}},"","-","",{iconCls:'deleteicon',text:"删除",handler:function(){ogrid.doDelete()}}]});this.tbar=topToolbar;this.topToolbar=this.tbar};if(this.needRightMenu){var ServiceCodeClick=new Ext.menu.Menu({items:[{text:'新增',iconCls:'addicon',handler:function(){ogrid.doInsert();ogrid.getStore().reload()}},{text:'修改',iconCls:'editicon',handler:function(){ogrid.doEdit()}},{text:'删除',iconCls:'deleteicon',handler:function(){ogrid.doDelete()}},{text:'刷新',iconCls:'refreshicon',handler:function(){ogrid.getStore().reload()}}]});this.addListener("rowcontextmenu",function(grid,rowIndex,e){e.stopEvent();ServiceCodeClick.showAt(e.getXY())});this.addListener("afteredit",function(e){ogrid.afterEdit(e)})}},doInsert:function(){eval(this.inertMethod+"()")},doEdit:function(id){var row=this.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("温馨提示","请您选择一条记录!")}else{if(row.length>1){Ext.Msg.alert("温馨提示","对不起，您只能选择一条记录!")}else{if(row.length==1){eval(this.updateMethod+"(row[0])")}}}},doDelete:function(){var ogrid=this;var row=this.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("温馨提示","请您选择记录!")}else{Ext.Msg.confirm("温馨提示!","您确定要删除信息吗?",function(btn){if(btn=="yes"){eval(ogrid.deleteMethod+"(row)");}else{}})}},afterEdit:function(e){var ogrid=this;var r=e.record;var f=e.field;var v=e.value;Ext.Ajax.request({url:this.afterEditURL,method:"POST",params:{flag:"update",field:f,value:v,id:r.id},success:function(response,option){ogrid.getStore().reload()},failure:function(){Ext.Msg.alert("不好意思","修改失败了!")}})}});WXTL.Widgets.CommonGrid.GridPanel=Ext.extend(Ext.grid.EditorGridPanel,{title:"查询结果",style:'padding:5px 0px 0px 0px',bodyStyle:'width:100%',frame:true,pageSize:12,needPage:true,needMenu:true,needRightMenu:false,needLoadFunc:true,structure:'1',loadMask:true,autoExpandColumn:7,autoScroll:true,autoHeight:true,inertMethod:'',updateMethod:'',deleteMethod:'',afterEditURL:'',initComponent:function(){if(this.structure!=''){this.initStructure()}WXTL.Widgets.CommonGrid.GridPanel.superclass.initComponent.call(this);var obj=this;for(var i=1;i<=10;i++){if(obj.colModel.lookup[i]!=null&&obj.colModel.lookup[i].editor!=null){obj.colModel.lookup[i].editor.addListener("complete",function(){obj.getStore().reload()})}}if(this.needLoadFunc){this.initLoadFunc()}},onRender:function(ct,position){if(this.getColumnModel().getColumnId(0)!="checker"){this.getSelectionModel().singleSelect=true}else{this.getSelectionModel().singleSelect=false}WXTL.Widgets.CommonGrid.GridPanel.superclass.onRender.call(this,ct,position)},initStructure:function(){var ogrid=this;this.view=new Ext.grid.GroupingView({enableGroupingMenu:false,forceFit:true,sortAscText:'正序排列',sortDescText:'倒序排列',columnsText:'列显示/隐藏',groupByText:'根据本列分组',showGroupsText:'是否采用分组显示'});if(this.needPage){var pagingToolbar=new Ext.PagingToolbar({displayInfo:true,store:this.store,emptyMsg:'没有符合条件的记录',displayInfo:true,displayMsg:'当前记录 {0} -- {1} 条 共 {2} 条记录',prevText:"上一页",nextText:"下一页",refreshText:"刷新",lastText:"最后页",firstText:"第一页",beforePageText:"当前页",afterPageText:"共{0}页"});pagingToolbar.pageSize=this.pageSize;this.bbar=pagingToolbar;this.bottomToolbar=this.bbar;var oSearch=new Ext.form.TextField({id:'search',xtype:'textfield',align:'right'})};if(this.needMenu){var keyField=this.keyField;var topToolbar=new Ext.Toolbar({items:[{iconCls:'addicon',text:"新增",handler:function(){ogrid.doInsert()}},"","-","",{iconCls:'editicon',text:"修改",handler:function(){ogrid.doEdit()}},"","-","",{iconCls:'deleteicon',text:"删除",handler:function(){ogrid.doDelete()}}]});this.tbar=topToolbar;this.topToolbar=this.tbar};if(this.needRightMenu){var ServiceCodeClick=new Ext.menu.Menu({items:[{text:'新增',iconCls:'addicon',handler:function(){ogrid.doInsert();ogrid.getStore().reload()}},{text:'修改',iconCls:'editicon',handler:function(){ogrid.doEdit()}},{text:'删除',iconCls:'deleteicon',handler:function(){ogrid.doDelete()}},{text:'刷新',iconCls:'refreshicon',handler:function(){ogrid.getStore().reload()}}]});this.addListener("rowcontextmenu",function(grid,rowIndex,e){e.stopEvent();ServiceCodeClick.showAt(e.getXY())});this.addListener("afteredit",function(e){ogrid.afterEdit(e)})}},initLoadFunc:function(){if(this.inertMethod!=""){if(eval(this.inertMethod+".window")==null){eval(this.inertMethod+".func()")}}if(this.updateMethod!=""){if(eval(this.updateMethod+".window")==null){eval(this.updateMethod+".func()")}}if(this.otherInitLoadFunc!=null&&this.otherInitLoadFunc.length>0){for(var i=0;i<this.otherInitLoadFunc.length;i++){eval(this.otherInitLoadFunc[i]+"()")}}},doInsert:function(){eval(this.inertMethod+".window.show()")},doEdit:function(id){var row=this.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("温馨提示","请您选择一条记录!")}else{if(row.length>1){Ext.Msg.alert("温馨提示","对不起，您只能选择一条记录!")}else{if(row.length==1){eval(this.updateMethod+".window.updateRecord=row[0];");eval(this.updateMethod+".window.mainForm.loadRecord(row[0]);");eval(this.updateMethod+".window.show();")}}}},doDelete:function(){var ogrid=this;var row=this.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("温馨提示","请您选择记录!")}else{Ext.Msg.confirm("温馨提示!","您确定要删除信息吗?",function(btn){if(btn=="yes"){eval(ogrid.deleteMethod+"(row)");}else{}})}},afterEdit:function(e){var ogrid=this;var g=e.grid;var r=e.record;var f=e.field;var v=e.value;var orgin=e.originalValue;var row=e.row;var col=e.column;Ext.Ajax.request({url:this.afterEditURL,method:"POST",params:{flag:"update",field:f,value:v,id:r.id},success:function(response,option){ogrid.getStore().reload()},failure:function(){Ext.Msg.alert("不好意思","修改失败了!")}})}});Ext.namespace("WXTL.Widgets.CommonForm");Ext.namespace("WXTL.Widgets.CommonForm.CheckboxGroup");WXTL.Widgets.CommonForm.CheckboxGroup.RemoteCheckboxGroup=Ext.extend(Ext.form.CheckboxGroup,{url:'',queryparams:'',numcolumns:3,requestname:'',defaultsItemsName:'',defaultsItemsboxLable:'',reader:new Ext.data.JsonReader({totalProperty:'totalProperty',root:'data',fields:[{name:'id'},{name:'name'},{name:'boxLabel',mapping:"vc2usergroupname"},{name:'inputValue',mapping:"numusergroupid"},{name:'checked'}]}),initComponent:function(){WXTL.Widgets.CommonForm.CheckboxGroup.RemoteCheckboxGroup.superclass.initComponent.call(this)},onRender:function(H,F){this.defaultItems=[{name:this.requestname,boxLabel:this.defaultsItemsboxLable,disabled:true}];this.items=this.defaultItems;if(this.url!=''){var conn=Ext.lib.Ajax.getConnectionObject().conn;conn.open("POST",this.url+"?"+this.queryparams,false);conn.send("");var response=Ext.decode(conn.responseText);var responses=this.reader.readRecords(Ext.decode(conn.responseText));if(response.success){var records=responses.records;if(records.length>this.numcolumns)this.columns=this.numcolumns;for(var i=0;i<records.length;i++){this.items[i]=records[i].data}for(var i=0;i<this.items.length;i++){this.items[i].name=this.requestname}}}WXTL.Widgets.CommonForm.CheckboxGroup.RemoteCheckboxGroup.superclass.onRender.call(this,H,F)},invert:function(){this.items.each(function(c){if(!c.disabled){c.setValue(!c.checked)}},this)},setAll:function(v){this.items.each(function(c){if(c.setValue&&!c.disabled){c.setValue(v)}},this)}});Ext.reg("RemoteCheckboxGroup",WXTL.Widgets.CommonForm.CheckboxGroup.RemoteCheckboxGroup);WXTL.Widgets.CommonForm.ComboBox=Ext.extend(Ext.form.ComboBox,{emptyText:'-=请选择=-',mode:'local',shadow:false,triggerAction:'all',valueField:'id',displayField:'name',selectOnFocus:true,enableKeyEvents:true,editable:true,allowBlank:true,typeAhead:true,forceSelection:true,resizable:false,readOnly:false,valueNotFoundText:'-=请选择=-',isNeedDefaultChoose:true,initCancleText:function(o){var obj=this;o.on("blur",function(){var count=o.store.getCount();if(count>0){return true}else{o.setValue('');return false}});o.on("select",function(){});o.on('beforequery',function(e){var combo=e.combo;if(!e.forceAll){var input=combo.getRawValue();var regExp=new RegExp(".*"+input+".*");combo.store.filterBy(function(record,id){var text=record.get(combo.displayField);return regExp.test(text)});combo.expand();return false}});this.store.on("load",function(a){if(obj.isNeedDefaultChoose){if(a.getAt(0)!=null&&a.getAt(0).data[obj.valueField]!=''){var r=new Ext.data.Record({});r.set(o.valueField,'');r.set(o.displayField,'-=请选择=-');a.insert(0,r)}}})},initEvents:function(){Ext.form.ComboBox.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,{"up":function(e){this.inKeyMode=true;this.selectPrev()},"down":function(e){if(!this.isExpanded()){this.onTriggerClick()}else{this.inKeyMode=true;this.selectNext()}},"enter":function(e){this.onViewClick();},"esc":function(e){this.collapse()},"tab":function(e){this.onViewClick(false);return true},scope:this,doRelay:function(foo,bar,hname){if(hname=='down'||this.scope.isExpanded()){return Ext.KeyNav.prototype.doRelay.apply(this,arguments)}return true},forceKeyDown:true});this.queryDelay=Math.max(this.queryDelay||10,this.mode=='local'?10:250);this.dqTask=new Ext.util.DelayedTask(this.initQuery,this);if(this.typeAhead){this.taTask=new Ext.util.DelayedTask(this.onTypeAhead,this)}if(this.editable!==false){this.el.on("keyup",this.onKeyUp,this)}if(this.forceSelection){this.on('blur',this.doForce,this)}},onKeyUp:function(e){if(this.editable!==false&&!e.isSpecialKey()){this.lastKey=e.getKey();this.dqTask.delay(this.queryDelay)}Ext.form.ComboBox.superclass.onKeyUp.call(this,e)},initComponent:function(){this.addEvents('select','expand','collapse','beforeselect');this.initCancleText(this);WXTL.Widgets.CommonForm.ComboBox.superclass.initComponent.call(this);this.on("keyup",function(f,e){this.doQuery()})}});Ext.reg('xComboBox',WXTL.Widgets.CommonForm.ComboBox);WXTL.Widgets.CommonForm.DateTime=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:'input',type:'hidden'},timeWidth:100,dtSeparator:' ',hiddenFormat:'Y-m-d H:i:s',otherToNow:true,timePosition:'right',dateFormat:'m/d/y',timeFormat:'g:i A',initComponent:function(){WXTL.Widgets.CommonForm.DateTime.superclass.initComponent.call(this);var dateConfig=Ext.apply({},{id:this.id+'-date',format:this.dateFormat||Ext.form.DateField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.dateConfig);this.df=new Ext.form.DateField(dateConfig);this.df.ownerCt=this;delete(this.dateFormat);var timeConfig=Ext.apply({},{id:this.id+'-time',format:this.timeFormat||Ext.form.TimeField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.timeConfig);this.tf=new Ext.form.TimeField(timeConfig);this.tf.ownerCt=this;delete(this.timeFormat);this.relayEvents(this.df,['focus','specialkey','invalid','valid']);this.relayEvents(this.tf,['focus','specialkey','invalid','valid'])},onRender:function(ct,position){if(this.isRendered){return}WXTL.Widgets.CommonForm.DateTime.superclass.onRender.call(this,ct,position);var t;if('below'===this.timePosition||'bellow'===this.timePosition){t=Ext.DomHelper.append(ct,{tag:'table',style:'border-collapse:collapse',children:[{tag:'tr',children:[{tag:'td',style:'padding-bottom:1px',cls:'ux-datetime-date'}]},{tag:'tr',children:[{tag:'td',cls:'ux-datetime-time'}]}]},true)}else{t=Ext.DomHelper.append(ct,{tag:'table',style:'border-collapse:collapse',children:[{tag:'tr',children:[{tag:'td',style:'padding-right:4px',cls:'ux-datetime-date'},{tag:'td',cls:'ux-datetime-time'}]}]},true)}this.tableEl=t;this.wrap=t.wrap({cls:'x-form-field-wrap'});this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});this.df.render(t.child('td.ux-datetime-date'));this.tf.render(t.child('td.ux-datetime-time'));if(Ext.isIE&&Ext.isStrict){t.select('input').applyStyles({top:0})}this.on('specialkey',this.onSpecialKey,this);this.df.el.swallowEvent(['keydown','keypress']);this.tf.el.swallowEvent(['keydown','keypress']);if('side'===this.msgTarget){var elp=this.el.findParent('.x-form-element',10,true);this.errorIcon=elp.createChild({cls:'x-form-invalid-icon'});this.df.errorIcon=this.errorIcon;this.tf.errorIcon=this.errorIcon}this.el.dom.name=this.hiddenName||this.name||this.id;this.df.el.dom.removeAttribute("name");this.tf.el.dom.removeAttribute("name");this.isRendered=true;this.updateHidden()},adjustSize:Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,'tl-tr',[2,0])},initDateValue:function(){this.dateValue=this.otherToNow?new Date():new Date(1970,0,1,0,0,0)},clearInvalid:function(){this.df.clearInvalid();this.tf.clearInvalid()},markInvalid:function(msg){this.df.markInvalid(msg);this.tf.markInvalid(msg)},beforeDestroy:function(){if(this.isRendered){this.wrap.removeAllListeners();this.wrap.remove();this.tableEl.remove();this.df.destroy();this.tf.destroy()}},disable:function(){if(this.isRendered){this.df.disabled=this.disabled;this.df.onDisable();this.tf.onDisable()}this.disabled=true;this.df.disabled=true;this.tf.disabled=true;this.fireEvent("disable",this);return this},enable:function(){if(this.rendered){this.df.onEnable();this.tf.onEnable()}this.disabled=false;this.df.disabled=false;this.tf.disabled=false;this.fireEvent("enable",this);return this},focus:function(){this.df.focus()},getPositionEl:function(){return this.wrap},getResizeEl:function(){return this.wrap},getValue:function(){return this.dateValue?new Date(this.dateValue):''},isValid:function(){return this.df.isValid()&&this.tf.isValid()},isVisible:function(){return this.df.rendered&&this.df.getActionEl().isVisible()},onBlur:function(f){if(this.wrapClick){f.focus();this.wrapClick=false}if(f===this.df){this.updateDate()}else{this.updateTime()}this.updateHidden();(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){var v=this.getValue();if(String(v)!==String(this.startValue)){this.fireEvent("change",this,v,this.startValue)}this.hasFocus=false;this.fireEvent('blur',this)}}).defer(100,this)},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();this.fireEvent("focus",this)}},onMouseDown:function(e){if(!this.disabled){this.wrapClick='td'===e.target.nodeName.toLowerCase()}},onSpecialKey:function(t,e){var key=e.getKey();if(key===e.TAB){if(t===this.df&&!e.shiftKey){e.stopEvent();this.tf.focus()}if(t===this.tf&&e.shiftKey){e.stopEvent();this.df.focus()}}if(key===e.ENTER){this.updateValue()}},setDate:function(date){this.df.setValue(date)},setTime:function(date){this.tf.setValue(date)},setSize:function(w,h){if(!w){return}if('below'===this.timePosition){this.df.setSize(w,h);this.tf.setSize(w,h);if(Ext.isIE){this.df.el.up('td').setWidth(w);this.tf.el.up('td').setWidth(w)}}else{this.df.setSize(w-this.timeWidth-4,h);this.tf.setSize(this.timeWidth,h);if(Ext.isIE){this.df.el.up('td').setWidth(w-this.timeWidth-4);this.tf.el.up('td').setWidth(this.timeWidth)}}},setValue:function(val){if(!val&&true===this.emptyToNow){this.setValue(new Date());return}else{if(!val){this.setDate('');this.setTime('');this.updateValue();return}}if('number'===typeof val){val=new Date(val)}else{if('string'===typeof val&&this.hiddenFormat){val=Date.parseDate(val,this.hiddenFormat)}}val=val?val:WXTL.Common.dateTime.getNow();var da,time;if(val instanceof Date){this.setDate(val);this.setTime(val);this.dateValue=new Date(val)}else{da=val.split(this.dtSeparator);this.setDate(da[0]);if(da[1]){if(da[2]){da[1]+=da[2]}this.setTime(da[1])}}this.updateValue()},setVisible:function(visible){if(visible){this.df.show();this.tf.show()}else{this.df.hide();this.tf.hide()}return this},show:function(){return this.setVisible(true)},hide:function(){return this.setVisible(false)},updateDate:function(){var d=this.df.getValue();if(d){if(!(this.dateValue instanceof Date)){this.initDateValue();if(!this.tf.getValue()){this.setTime(this.dateValue)}}this.dateValue.setMonth(0);this.dateValue.setFullYear(d.getFullYear());this.dateValue.setMonth(d.getMonth(),d.getDate());}else{this.dateValue='';this.setTime('')}},updateTime:function(){var t=this.tf.getValue();if(t&&!(t instanceof Date)){t=Date.parseDate(t,this.tf.format)}if(t&&!this.df.getValue()){this.initDateValue();this.setDate(this.dateValue)}if(this.dateValue instanceof Date){if(t){this.dateValue.setHours(t.getHours());this.dateValue.setMinutes(t.getMinutes());this.dateValue.setSeconds(t.getSeconds())}else{this.dateValue.setHours(0);this.dateValue.setMinutes(0);this.dateValue.setSeconds(0)}}},updateHidden:function(){if(this.isRendered){var value=this.dateValue instanceof Date?this.dateValue.format(this.hiddenFormat):'';this.el.dom.value=value}},updateValue:function(){this.updateDate();this.updateTime();this.updateHidden();return},validate:function(){return this.df.validate()&&this.tf.validate()},renderer:function(field){var format=field.editor.dateFormat||Ext.ux.form.DateTime.prototype.dateFormat;format+=' '+(field.editor.timeFormat||Ext.ux.form.DateTime.prototype.timeFormat);var renderer=function(val){var retval=Ext.util.Format.date(val,format);return retval};return renderer},reset:function(){if(this.addDays){this.setValue(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(),this.addDays))}else{this.setValue(new Date())}}});Ext.reg('xDateTime',WXTL.Widgets.CommonForm.DateTime);WXTL.Widgets.CommonForm.MonthPicker=Ext.extend(Ext.Component,{format:"M-y",okText:Ext.DatePicker.prototype.okText,cancelText:Ext.DatePicker.prototype.cancelText,constrainToViewport:true,monthNames:Date.monthNames,startDay:0,value:0,noPastYears:false,initComponent:function(){WXTL.Widgets.CommonForm.MonthPicker.superclass.initComponent.call(this);this.value=this.value?this.value.clearTime():new Date().clearTime();this.addEvents('select');if(this.handler){this.on("select",this.handler,this.scope||this)}},focus:function(){if(this.el){this.update(this.activeDate)}},onRender:function(container,position){var m=['<div style="width: 200px; height:175px;"></div>'];m[m.length]='<div class="x-date-mp"></div>';var el=document.createElement("div");el.className="x-date-picker";el.innerHTML=m.join("");container.dom.insertBefore(el,position);this.el=Ext.get(el);this.monthPicker=this.el.down('div.x-date-mp');this.monthPicker.enableDisplayMode('block');this.el.unselectable();this.showMonthPicker();if(Ext.isIE){this.el.repaint()}this.update(this.value)},createMonthPicker:function(){if(!this.monthPicker.dom.firstChild){var buf=['<table border="0" cellspacing="0">'];for(var i=0;i<6;i++){buf.push('<tr><td class="x-date-mp-month"><a href="#">',this.monthNames[i].substr(0,3),'</a></td>','<td class="x-date-mp-month x-date-mp-sep"><a href="#">',this.monthNames[i+6].substr(0,3),'</a></td>',i==0?'<td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-prev"></a></td><td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-next"></a></td></tr>':'<td class="x-date-mp-year"><a href="#"></a></td><td class="x-date-mp-year"><a href="#"></a></td></tr>')}buf.push('<tr class="x-date-mp-btns"><td colspan="4"><button type="button" class="x-date-mp-ok">',this.okText,'</button><button type="button" class="x-date-mp-cancel">',this.cancelText,'</button></td></tr>','</table>');this.monthPicker.update(buf.join(''));this.monthPicker.on('click',this.onMonthClick,this);this.monthPicker.on('dblclick',this.onMonthDblClick,this);this.mpMonths=this.monthPicker.select('td.x-date-mp-month');this.mpYears=this.monthPicker.select('td.x-date-mp-year');this.mpMonths.each(function(m,a,i){i+=1;if((i%2)==0){m.dom.xmonth=5+Math.round(i*.5)}else{m.dom.xmonth=Math.round((i-1)*.5)}})}},showMonthPicker:function(){this.createMonthPicker();var size=this.el.getSize();this.monthPicker.setSize(size);this.monthPicker.child('table').setSize(size);this.mpSelMonth=(this.activeDate||this.value).getMonth();this.updateMPMonth(this.mpSelMonth);this.mpSelYear=(this.activeDate||this.value).getFullYear();this.updateMPYear(this.mpSelYear);this.monthPicker.show();},updateMPYear:function(y){if(this.noPastYears){var minYear=new Date().getFullYear();if(y<(minYear+4)){y=minYear+4}}this.mpyear=y;var ys=this.mpYears.elements;for(var i=1;i<=10;i++){var td=ys[i-1],y2;if((i%2)==0){y2=y+Math.round(i*.5);td.firstChild.innerHTML=y2;td.xyear=y2}else{y2=y-(5-Math.round(i*.5));td.firstChild.innerHTML=y2;td.xyear=y2}this.mpYears.item(i-1)[y2==this.mpSelYear?'addClass':'removeClass']('x-date-mp-sel')}},updateMPMonth:function(sm){this.mpMonths.each(function(m,a,i){m[m.dom.xmonth==sm?'addClass':'removeClass']('x-date-mp-sel')})},selectMPMonth:function(m){},onMonthClick:function(e,t){e.stopEvent();var el=new Ext.Element(t),pn;if(el.is('button.x-date-mp-cancel')){this.hideMonthPicker();}else{if(el.is('button.x-date-mp-ok')){this.update(new Date(this.mpSelYear,this.mpSelMonth,(this.activeDate||this.value).getDate()));this.fireEvent("select",this,this.value)}else{if(pn=el.up('td.x-date-mp-month',2)){this.mpMonths.removeClass('x-date-mp-sel');pn.addClass('x-date-mp-sel');this.mpSelMonth=pn.dom.xmonth}else{if(pn=el.up('td.x-date-mp-year',2)){this.mpYears.removeClass('x-date-mp-sel');pn.addClass('x-date-mp-sel');this.mpSelYear=pn.dom.xyear}else{if(el.is('a.x-date-mp-prev')){this.updateMPYear(this.mpyear-10)}else{if(el.is('a.x-date-mp-next')){this.updateMPYear(this.mpyear+10)}}}}}}},onMonthDblClick:function(e,t){e.stopEvent();var el=new Ext.Element(t),pn;if(pn=el.up('td.x-date-mp-month',2)){this.update(new Date(this.mpSelYear,pn.dom.xmonth,(this.activeDate||this.value).getDate()));this.fireEvent("select",this,this.value)}else{if(pn=el.up('td.x-date-mp-year',2)){this.update(new Date(pn.dom.xyear,this.mpSelMonth,(this.activeDate||this.value).getDate()));this.fireEvent("select",this,this.value)}}},hideMonthPicker:function(disableAnim){Ext.menu.MenuMgr.hideAll()},showPrevMonth:function(e){this.update(this.activeDate.add("mo",-1))},showNextMonth:function(e){this.update(this.activeDate.add("mo",1))},showPrevYear:function(){this.update(this.activeDate.add("y",-1))},showNextYear:function(){this.update(this.activeDate.add("y",1))},update:function(date){this.activeDate=date;this.value=date;if(!this.internalRender){var main=this.el.dom.firstChild;var w=main.offsetWidth;this.el.setWidth(w+this.el.getBorderWidth("lr"));Ext.fly(main).setWidth(w);this.internalRender=true;if(Ext.isOpera&&!this.secondPass){main.rows[0].cells[1].style.width=(w-(main.rows[0].cells[0].offsetWidth+main.rows[0].cells[2].offsetWidth))+"px";this.secondPass=true;this.update.defer(10,this,[date])}}}});Ext.reg('monthpicker',WXTL.Widgets.CommonForm.MonthPicker);WXTL.Widgets.CommonForm.MonthItem=function(config){WXTL.Widgets.CommonForm.MonthItem.superclass.constructor.call(this,new WXTL.Widgets.CommonForm.MonthPicker(config),config);this.picker=this.component;this.addEvents('select');this.picker.on("render",function(picker){picker.getEl().swallowEvent("click");picker.container.addClass("x-menu-date-item")});this.picker.on("select",this.onSelect,this)};Ext.extend(WXTL.Widgets.CommonForm.MonthItem,Ext.menu.Adapter,{onSelect:function(picker,date){this.fireEvent("select",this,date,picker);WXTL.Widgets.CommonForm.MonthItem.superclass.handleClick.call(this)}});WXTL.Widgets.CommonForm.MonthMenu=function(config){WXTL.Widgets.CommonForm.MonthMenu.superclass.constructor.call(this,config);this.plain=true;var mi=new WXTL.Widgets.CommonForm.MonthItem(config);this.add(mi);this.picker=mi.picker;this.relayEvents(mi,["select"])};Ext.extend(WXTL.Widgets.CommonForm.MonthMenu,Ext.menu.Menu,{cls:'x-date-menu'});WXTL.Widgets.CommonForm.MonthField=function(cfg){WXTL.Widgets.CommonForm.MonthField.superclass.constructor.call(this,Ext.apply({},cfg||{}))};Ext.extend(WXTL.Widgets.CommonForm.MonthField,Ext.form.DateField,{format:"Y-m",triggerClass:"x-form-date-trigger",menuListeners:{select:function(m,d){this.setValue(d.format(this.format))},show:function(){this.onFocus()},hide:function(){this.focus.defer(10,this);var ml=this.menuListeners;this.menu.un("select",ml.select,this);this.menu.un("show",ml.show,this);this.menu.un("hide",ml.hide,this)}},onTriggerClick:function(){if(this.disabled){return}if(this.menu==null){this.menu=new WXTL.Widgets.CommonForm.MonthMenu()}Ext.apply(this.menu.picker,{});this.menu.on(Ext.apply({},this.menuListeners,{scope:this}));this.menu.show(this.el,"tl-bl?")}});Ext.reg("monthfield",WXTL.Widgets.CommonForm.MonthField);WXTL.Widgets.CommonForm.Textarea=Ext.extend(Ext.form.Field,{labelText:"平台签名："+IDIOGRAPH,timePosition:'below',defaultAutoCreate:{tag:'input',type:'hidden'},initComponent:function(){var obj=this;WXTL.Widgets.CommonForm.Textarea.superclass.initComponent.call(this);var labelConfig=Ext.apply({},{width:450,height:20,html:"<div style='height:20px;font-size:12px;color:gray;width:200px;float:left'>"+this.labelText+"</div><div style='height:20px;font-size:12px;color:gray;width:200px;float:right;text-align:right' id='"+this.id+"fontsize'></div>"},this.labelConfig);this.tf=new Ext.Panel(labelConfig);this.tf.ownerCt=this;var textareaConfig=Ext.apply({},{width:450,height:70,enableKeyEvents:true,listeners:{"keyup":function(tl){Ext.get(obj.id+"fontsize").dom.innerHTML="字数:"+obj.getSize()}},validator:function(){if(obj.getSize()>obj.contentMaxLength){this.invalidText='输入长度不能大于'+obj.contentMaxLength+'个字';return false};return true}},this.textareaConfig);this.df=new Ext.form.TextArea(textareaConfig);this.df.ownerCt=this;this.relayEvents(this.df,['focus','specialkey','invalid','valid']);this.relayEvents(this.tf,['focus','specialkey','invalid','valid'])},onRender:function(ct,position){if(this.isRendered){return}WXTL.Widgets.CommonForm.Textarea.superclass.onRender.call(this,ct,position);var t;if('below'===this.timePosition||'bellow'===this.timePosition){t=Ext.DomHelper.append(ct,{tag:'table',style:'border-collapse:collapse',children:[{tag:'tr',children:[{tag:'td',style:'padding-bottom:1px',cls:'ux-datetime-date'}]},{tag:'tr',children:[{tag:'td',cls:'ux-datetime-time'}]}]},true)}else{t=Ext.DomHelper.append(ct,{tag:'table',style:'border-collapse:collapse',children:[{tag:'tr',children:[{tag:'td',style:'padding-right:4px',cls:'ux-datetime-date'},{tag:'td',cls:'ux-datetime-time'}]}]},true)}this.tableEl=t;this.wrap=t.wrap({cls:'x-form-field-wrap'});this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});this.df.render(t.child('td.ux-datetime-date'));this.tf.render(t.child('td.ux-datetime-time'));if(Ext.isIE&&Ext.isStrict){t.select('input').applyStyles({top:0})}this.on('specialkey',this.onSpecialKey,this);if('side'===this.msgTarget){var elp=this.el.findParent('.x-form-element',10,true);this.errorIcon=elp.createChild({cls:'x-form-invalid-icon'});this.df.errorIcon=this.errorIcon;this.tf.errorIcon=this.errorIcon}this.el.dom.name=this.hiddenName||this.name||this.id;this.df.el.dom.removeAttribute("name");this.tf.el.dom.removeAttribute("name");this.isRendered=true},getSize:function(){return this.df.getValue().length},onSpecialKey:function(t,e){},adjustSize:Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,'tl-tr',[2,0])},clearInvalid:function(){this.df.clearInvalid();Ext.get(this.id+"fontsize").dom.innerHTML='';},markInvalid:function(msg){this.df.markInvalid(msg);this.tf.markInvalid(msg)},beforeDestroy:function(){if(this.isRendered){this.wrap.removeAllListeners();this.wrap.remove();this.tableEl.remove();this.df.destroy();this.tf.destroy()}},disable:function(){if(this.isRendered){this.df.disabled=this.disabled;this.df.onDisable();this.tf.onDisable()}this.disabled=true;this.df.disabled=true;this.tf.disabled=true;this.fireEvent("disable",this);return this},enable:function(){if(this.rendered){this.df.onEnable();this.tf.onEnable()}this.disabled=false;this.df.disabled=false;this.tf.disabled=false;this.fireEvent("enable",this);return this},focus:function(){this.df.focus()},getPositionEl:function(){return this.wrap},getResizeEl:function(){return this.wrap},setValue:function(v){if(this.emptyText&&this.el&&v!==undefined&&v!==null&&v!==''){this.el.removeClass(this.emptyClass)}if(this.isRendered){this.df.setValue(v);this.el.dom.value=v}},getValue:function(){return this.df.getValue()},setLableText:function(v){if(this.emptyText&&this.el&&v!==undefined&&v!==null&&v!==''){this.el.removeClass(this.emptyClass)}if(this.isRendered){this.tf.el.dom.innerHTML="<div style='height:20px;font-size:12px;color:gray;width:200px;float:left'>"+v+"</div><div style='height:20px;font-size:12px;color:gray;width:200px;float:right;text-align:right' id='"+this.id+"fontsize'></div>";}},isValid:function(){return this.df.isValid()},isVisible:function(){return this.df.rendered&&this.df.getActionEl().isVisible()},onBlur:function(f){if(this.wrapClick){f.focus();this.wrapClick=false}if(f===this.df){this.updateDate()}else{this.updateTime()}this.updateHidden();(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){var v=this.getValue();if(String(v)!==String(this.startValue)){this.fireEvent("change",this,v,this.startValue)}this.hasFocus=false;this.fireEvent('blur',this)}}).defer(100,this)},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();this.fireEvent("focus",this)}},onMouseDown:function(e){if(!this.disabled){this.wrapClick='td'===e.target.nodeName.toLowerCase()}},setSize:function(w,h){if(!w){return}if('below'===this.timePosition){this.df.setSize(w,h);this.tf.setSize(w,h);if(Ext.isIE){this.df.el.up('td').setWidth(w);this.tf.el.up('td').setWidth(w)}}else{this.df.setSize(w-this.timeWidth-4,h);this.tf.setSize(this.timeWidth,h);if(Ext.isIE){this.df.el.up('td').setWidth(w-this.timeWidth-4);this.tf.el.up('td').setWidth(this.timeWidth)}}},setVisible:function(visible){if(visible){this.df.show();this.tf.show()}else{this.df.hide();this.tf.hide()}return this},show:function(){return this.setVisible(true)},hide:function(){return this.setVisible(false)},validate:function(){this.el.dom.value=this.df.getValue();return this.df.validate()}});Ext.reg('xTextarea',WXTL.Widgets.CommonForm.Textarea);WXTL.Widgets.CommonForm.FileUpload=Ext.extend(Ext.form.Field,{timePosition:'',cbText:"不需要",defaultAutoCreate:{tag:'input',type:'hidden'},initComponent:function(){var obj=this;WXTL.Widgets.CommonForm.FileUpload.superclass.initComponent.call(this);var checkBoxConfig=Ext.apply({},{id:obj.id+"cb",name:obj.name+"cb",boxLabel:obj.cbText,hideLabel:true,listeners:{check:function(c,flag){if(flag){obj.tf.setDisabled(true)}else obj.tf.setDisabled(false)}}},obj.checkBoxConfig);obj.cb=new Ext.form.Checkbox(checkBoxConfig);obj.cb.ownerCt=obj;var textFieldConfig=Ext.apply({},{id:obj.id+"tf",name:obj.name+"tf",style:'border: 1px solid #C0C0C0;height:22;cursor:hand',hideLabel:true,inputType:'file',width:285,initEvents:function(){var stopEvent=function(e){e.stopEvent()};obj.tf.el.on("keypress",stopEvent,obj.tf);obj.tf.el.on("keydown",stopEvent,obj.tf);obj.tf.el.on("contextmenu",stopEvent,obj.tf);obj.tf.el.on("onpaste",stopEvent,obj.tf);obj.tf.el.on("onkeydown",stopEvent,obj.tf)}},obj.textFieldConfig);obj.tf=new Ext.form.TextField(textFieldConfig);obj.tf.ownerCt=obj;obj.relayEvents(obj.cb,['focus','specialkey','invalid','valid']);obj.relayEvents(obj.tf,['focus','specialkey','invalid','valid'])},onRender:function(ct,position){if(this.isRendered){return}WXTL.Widgets.CommonForm.FileUpload.superclass.onRender.call(this,ct,position);var t;if('below'===this.timePosition||'bellow'===this.timePosition){t=Ext.DomHelper.append(ct,{tag:'table',style:'border-collapse:collapse',children:[{tag:'tr',children:[{tag:'td',style:'padding-bottom:1px',cls:'ux-datetime-date'}]},{tag:'tr',children:[{tag:'td',cls:'ux-datetime-time'}]}]},true)}else{t=Ext.DomHelper.append(ct,{tag:'table',style:'border-collapse:collapse',children:[{tag:'tr',children:[{tag:'td',style:'padding-right:10px',cls:'ux-datetime-time'},{tag:'td',cls:'ux-datetime-date'}]}]},true)}this.tableEl=t;this.wrap=t.wrap({cls:'x-form-field-wrap'});this.cb.render(t.child('td.ux-datetime-date'));this.tf.render(t.child('td.ux-datetime-time'));if('side'===this.msgTarget){var elp=this.el.findParent('.x-form-element',10,true);this.errorIcon=elp.createChild({cls:'x-form-invalid-icon'});this.cb.errorIcon=this.errorIcon;this.tf.errorIcon=this.errorIcon}this.el.dom.name=this.hiddenName||this.name||this.id;this.isRendered=true},getSize:function(){},onSpecialKey:function(t,e){},adjustSize:Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,'tl-tr',[2,0])},clearInvalid:function(){this.cb.clearInvalid();this.tf.clearInvalid();},markInvalid:function(msg){this.cb.markInvalid(msg);this.tf.markInvalid(msg)},beforeDestroy:function(){if(this.isRendered){this.wrap.removeAllListeners();this.wrap.remove();this.tableEl.remove();this.cb.destroy();this.tf.destroy()}},disable:function(){if(this.isRendered){this.df.disabled=this.disabled;this.df.onDisable();this.tf.onDisable()}this.disabled=true;this.cb.disabled=true;this.tf.disabled=true;this.fireEvent("disable",this);return this},enable:function(){if(this.rendered){this.df.onEnable();this.tf.onEnable()}this.disabled=false;this.cb.disabled=false;this.tf.disabled=false;this.fireEvent("enable",this);return this},setValue:function(filePath){this.tf.setValue(filePath);},getValue:function(){return this.tf.getValue()},getCheckValue:function(){return this.cb.getValue()}});Ext.reg('FileUpload',WXTL.Widgets.CommonForm.FileUpload);Ext.ux.TreeCheckNodeUI=function(){this.checkModel='multiple';this.onlyLeafCheckable=false;Ext.ux.TreeCheckNodeUI.superclass.constructor.apply(this,arguments)};Ext.extend(Ext.ux.TreeCheckNodeUI,Ext.tree.TreeNodeUI,{renderElements:function(n,a,targetNode,bulkRender){var tree=n.getOwnerTree();this.checkModel=tree.checkModel||this.checkModel;this.onlyLeafCheckable=tree.onlyLeafCheckable||false;this.indentMarkup=n.parentNode?n.parentNode.ui.getChildIndent():'';var cb=(!this.onlyLeafCheckable||a.leaf);var href=a.href?a.href:Ext.isGecko?"":"#";var buf=['<li class="x-tree-node"><div ext:tree-node-id="',n.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',a.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',a.icon||this.emptyIcon,'" class="x-tree-node-icon',(a.icon?" x-tree-node-inline-icon":""),(a.iconCls?" "+a.iconCls:""),'" unselectable="on" />',cb?('<input class="x-tree-node-cb" type="checkbox" '+(a.checked?'checked="checked" />':'/>')):'','<a hidefocus="on" class="x-tree-node-anchor" href="',href,'" tabIndex="1" ',a.hrefTarget?' target="'+a.hrefTarget+'"':"",'><span unselectable="on">',n.text,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join('');var nel;if(bulkRender!==true&&n.nextSibling&&(nel=n.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",nel,buf)}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",targetNode,buf)}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var cs=this.elNode.childNodes;this.indentNode=cs[0];this.ecNode=cs[1];this.iconNode=cs[2];var index=3;if(cb){this.checkbox=cs[3];Ext.fly(this.checkbox).on('click',this.check.createDelegate(this,[null]));index++}this.anchor=cs[index];this.textNode=cs[index].firstChild},check:function(checked){var n=this.node;var tree=n.getOwnerTree();this.checkModel=tree.checkModel||this.checkModel;if(checked===null){checked=this.checkbox.checked}else{this.checkbox.checked=checked}n.attributes.checked=checked;tree.fireEvent('check',n,checked);if(this.checkModel=='single'){var checkedNodes=tree.getChecked();for(var i=0;i<checkedNodes.length;i++){var node=checkedNodes[i];if(node.id!=n.id){node.getUI().checkbox.checked=false;node.attributes.checked=false;tree.fireEvent('check',node,false)}}}else{if(!this.onlyLeafCheckable){if(this.checkModel=='cascade'||this.checkModel=='parentCascade'){var parentNode=n.parentNode;if(parentNode!==null){this.parentCheck(parentNode,checked)}}if(this.checkModel=='cascade'||this.checkModel=='childCascade'){if(!n.expanded&&!n.childrenRendered){n.expand(false,false,this.childCheck)}else{this.childCheck(n)}}}}},childCheck:function(node){var a=node.attributes;if(!a.leaf){var cs=node.childNodes;var csui;for(var i=0;i<cs.length;i++){csui=cs[i].getUI();if(csui.checkbox.checked^a.checked){csui.check(a.checked)}}}},parentCheck:function(node,checked){var checkbox=node.getUI().checkbox;if(typeof checkbox=='undefined'){return}if(!(checked^checkbox.checked)){return}if(!checked&&this.childHasChecked(node)){return}checkbox.checked=checked;node.attributes.checked=checked;node.getOwnerTree().fireEvent('check',node,checked);var parentNode=node.parentNode;if(parentNode!==null){this.parentCheck(parentNode,checked)}},childHasChecked:function(node){var childNodes=node.childNodes;if(childNodes||childNodes.length>0){for(var i=0;i<childNodes.length;i++){if(childNodes[i].getUI().checkbox.checked){return true}}}return false},toggleCheck:function(value){var cb=this.checkbox;if(cb){var checked=(value===undefined?!cb.checked:value);this.check(checked)}}});WXTL.Widgets.CommonForm.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:'选择文件',buttonClickFunc:null,buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){WXTL.Widgets.CommonForm.FileUploadField.superclass.initComponent.call(this);this.addEvents('fileselected')},onRender:function(ct,position){WXTL.Widgets.CommonForm.FileUploadField.superclass.onRender.call(this,ct,position);this.wrap=this.el.wrap({cls:'x-form-field-wrap x-form-file-wrap'});this.el.addClass('x-form-file-text');this.el.dom.removeAttribute('name');this.createFileInput();var btnCfg=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(btnCfg,{renderTo:this.wrap,cls:'x-form-file-btn'+(btnCfg.iconCls?' x-btn-icon':'')}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth())}this.bindListeners();this.resizeEl=this.positionEl=this.wrap;Ext.fly(this.el).on('btnClick',function(){this.fireEvent('btnClick',this)},this)},bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.button.addClass(['x-btn-over','x-btn-focus'])},mouseleave:function(){this.button.removeClass(['x-btn-over','x-btn-focus','x-btn-click'])},mousedown:function(){this.button.addClass('x-btn-click')},mouseup:function(){this.button.removeClass(['x-btn-over','x-btn-focus','x-btn-click'])},change:function(){var v=this.fileInput.dom.value;if(Ext.isIE){v=v.substring(v.lastIndexOf("\\")+1)}this.setValue(v);this.fireEvent('fileselected',this,v);if(this.buttonClickFunc!=null){this.buttonClickFunc()}}})},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:'x-form-file',tag:'input',type:'file',size:1})},reset:function(){if(this.fileInput){this.fileInput.remove();this.createFileInput();this.bindListeners()}WXTL.Widgets.CommonForm.FileUploadField.superclass.reset.call(this)},getFileInputId:function(){return this.id+'-file'},onResize:function(w,h){WXTL.Widgets.CommonForm.FileUploadField.superclass.onResize.call(this,w,h);this.wrap.setWidth(w);if(!this.buttonOnly){var w=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(w)}},onDestroy:function(){WXTL.Widgets.CommonForm.FileUploadField.superclass.onDestroy.call(this);Ext.destroy(this.fileInput,this.button,this.wrap)},onDisable:function(){WXTL.Widgets.CommonForm.FileUploadField.superclass.onDisable.call(this);this.doDisable(true)},onEnable:function(){WXTL.Widgets.CommonForm.FileUploadField.superclass.onEnable.call(this);this.doDisable(false)},doDisable:function(disabled){this.fileInput.dom.disabled=disabled;this.button.setDisabled(disabled)},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,'tl-tr',[2,0])}});Ext.reg('fileuploadfield',WXTL.Widgets.CommonForm.FileUploadField);Ext.form.FileUploadField=WXTL.Widgets.CommonForm.FileUploadField;Ext.namespace("WXTL.Widgets.CommonData");WXTL.Widgets.CommonData.GroupingStore=Ext.extend(Ext.data.GroupingStore,{listeners:{loadexception:function(s){if(!this.reader.jsonData.success&&this.reader.jsonData.info!=null&&this.reader.jsonData.info=="对不起，您没有登录！"){Ext.Msg.alert("温馨提示","对不起，您的信息已过期请重新登录!",function(){window.location.href="login.htm"})}},load:function(a,b,c){if(!a.reader.jsonData.success){if(a.reader.jsonData.info!=null&&a.reader.jsonData.info=="对不起，您没有登录！"){Ext.Msg.alert("温馨提示","对不起，您的信息已过期请重新登录!",function(){window.location.href="login.htm"})}else{}if(a.reader.jsonData.data=="false"){this.removeAll()}}}}});Ext.reg('GroupingStore',WXTL.Widgets.CommonData.GroupingStore);WXTL.Widgets.CommonForm.ComboWithTree=Ext.extend(Ext.form.TriggerField,{readOnly:false,enableKeyEvent:true,displayField:'text',valueField:null,hiddenName:null,listWidth:null,minListWidth:50,listHeight:null,minListHeight:50,dataUrl:null,tree:null,value:null,displayValue:null,hiddenPkgs:[],filterPkgs:[],baseParams:{},treeRootVisible:false,treeRootConfig:{id:'-1',text:'-=请选择=-',draggable:false},defaultAutoCreate:{tag:"input",type:"text",size:"24",autocomplete:"off"},initComponent:function(){WXTL.Widgets.CommonForm.ComboWithTree.superclass.initComponent.call(this);this.addEvents('select','expand','collapse','beforeselect');this.on("keyup",function(){if(!this.isExpanded()){this.tree.expandAll();this.onTriggerClick()}this.filterTree(this,this.tree)});this.on("blur",function(){if(this.filterPkgs.length==0){if(this.getValue()==null){var node={id:'',text:'',draggable:false};this.setValue(node);return false}else{var node=this.tree.getNodeById(this.getValue());this.onSelect(node);return true}}})},initEvents:function(){Ext.form.ComboBox.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,{"up":function(e){this.inKeyMode=true;this.selectPrev()},"down":function(e){if(!this.isExpanded()){this.onTriggerClick()}else{this.inKeyMode=true;this.selectNext()}},"enter":function(e){this.onViewClick();},"esc":function(e){this.collapse()},"tab":function(e){this.onViewClick(false);return true},scope:this,doRelay:function(foo,bar,hname){if(hname=='down'||this.scope.isExpanded()){return Ext.KeyNav.prototype.doRelay.apply(this,arguments)}return true},forceKeyDown:true});this.queryDelay=Math.max(this.queryDelay||10,this.mode=='local'?10:250);this.dqTask=new Ext.util.DelayedTask(this.initQuery,this);if(this.typeAhead){this.taTask=new Ext.util.DelayedTask(this.onTypeAhead,this)}if(this.editable!==false){this.el.on("keyup",this.onKeyUp,this)}if(this.forceSelection){this.on('blur',this.doForce,this)}},initList:function(){if(!this.list){var cls='x-treefield-list';this.list=new Ext.Layer({shadow:this.shadow,cls:[cls,this.listClass].join(' '),constrain:false});var lw=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);this.list.setWidth(lw);this.list.swallowEvent('mousewheel');this.innerList=this.list.createChild({cls:cls+'-inner'});this.innerList.setWidth(lw-this.list.getFrameWidth('lr'));this.innerList.setHeight(this.listHeight||this.minListHeight);if(!this.tree){this.tree=this.createTree(this.innerList)}this.tree.on('click',this.select,this);this.tree.render()}},onRender:function(ct,position){WXTL.Widgets.CommonForm.ComboWithTree.superclass.onRender.call(this,ct,position);if(this.hiddenName){this.hiddenField=this.el.insertSibling({tag:'input',type:'hidden',name:this.hiddenName,id:(this.hiddenId||this.hiddenName)},'before',true);this.hiddenField.value=this.hiddenValue!==undefined?this.hiddenValue:this.value!==undefined?this.value:'';this.el.dom.removeAttribute('name')}if(Ext.isGecko){this.el.dom.setAttribute('autocomplete','off')}this.initList()},select:function(node){if(this.fireEvent('beforeselect',node,this)!=false){this.onSelect(node);this.fireEvent('select',this,node)}},onSelect:function(node){this.setValue(node);this.collapse()},createTree:function(el){var obj=this;var Tree=Ext.tree;var root=new Tree.AsyncTreeNode(this.treeRootConfig);var tree=new Ext.tree.TreePanel({el:el,autoScroll:true,animate:true,containerScroll:true,root:root,rootVisible:this.treeRootVisible,loader:new Tree.TreeLoader({dataUrl:this.dataUrl,listeners:{"beforeload":function(treeloader,node){treeloader.baseParams=obj.baseParams}}})});tree.expandAll();return tree},filterTree:function(e,treeComb){var obj=this;var text=e.getTextValue();var filter=new Ext.tree.TreeFilter(treeComb,{clearBlank:true,autoClear:true});Ext.each(obj.hiddenPkgs,function(n){n.ui.show()});if(!text){filter.clear();return}treeComb.expandAll();var re=new RegExp(Ext.escapeRe(text),'i');filter.filterBy(function(n){var textval=n.text;return!n.isLeaf()||re.test(n.text)});e.hiddenPkgs=[];var k=0;e.filterPkgs=[];treeComb.root.cascade(function(n){if(n.isLeaf()&&!re.test(n.text)){n.ui.hide();obj.hiddenPkgs.push(n)}if(!n.isLeaf()&&n.ui.ctNode.offsetHeight<3&&!re.test(n.text)){n.ui.hide();obj.hiddenPkgs.push(n)}if(n.id!='root'){if(!n.isLeaf()&&n.ui.ctNode.offsetHeight>=3&&hasChild(n,re)==false&&!re.test(n.text)){n.ui.hide();obj.hiddenPkgs.push(n)}}if(re.test(n.text)){k++;obj.filterPkgs.push(n);}});function hasChild(n,re){var str=false;n.cascade(function(n1){if(re.test(n1.text)){str=true;return}});return str}},getValue:function(){if(this.valueField){return typeof this.value!='undefined'?this.value:''}else{return WXTL.Widgets.CommonForm.ComboWithTree.superclass.getValue.call(this)}},getTextValue:function(){if(this.displayValue){return typeof this.displayValue!='undefined'?this.displayValue:''}else{return WXTL.Widgets.CommonForm.ComboWithTree.superclass.getValue.call(this)}},setValue:function(node){var text,value;if(node&&typeof node=='object'){text=node[this.displayField];value=node[this.valueField||this.displayField]}else{text=node;value=node}if(this.hiddenField){this.hiddenField.value=value}WXTL.Widgets.CommonForm.ComboWithTree.superclass.setValue.call(this,text);this.value=value},onResize:function(w,h){WXTL.Widgets.CommonForm.ComboWithTree.superclass.onResize.apply(this,arguments);if(this.list&&this.listWidth==null){var lw=Math.max(w,this.minListWidth);this.list.setWidth(lw);this.innerList.setWidth(lw-this.list.getFrameWidth('lr'))}},validateBlur:function(){return!this.list||!this.list.isVisible()},onDestroy:function(){if(this.list){this.list.destroy()}if(this.wrap){this.wrap.remove()}WXTL.Widgets.CommonForm.ComboWithTree.superclass.onDestroy.call(this)},collapseIf:function(e){if(!e.within(this.wrap)&&!e.within(this.list)){this.collapse()}},collapse:function(){if(!this.isExpanded()){return}this.list.hide();Ext.getDoc().un('mousewheel',this.collapseIf,this);Ext.getDoc().un('mousedown',this.collapseIf,this);this.fireEvent('collapse',this)},expand:function(){if(this.isExpanded()||!this.hasFocus){return}this.onExpand();this.list.alignTo(this.wrap,this.listAlign);this.list.show();Ext.getDoc().on('mousewheel',this.collapseIf,this);Ext.getDoc().on('mousedown',this.collapseIf,this);this.fireEvent('expand',this)},onExpand:function(){var doc=Ext.getDoc();this.on('click',function(){alert(111)},this)},isExpanded:function(){return this.list&&this.list.isVisible()},onTriggerClick:function(){if(this.disabled){return}if(this.isExpanded()){this.collapse()}else{this.onFocus({});this.expand()}this.el.focus()}});Ext.reg('ComboWithTree',WXTL.Widgets.CommonForm.ComboWithTree);WXTL.Widgets.CommonForm.ClickLabel=Ext.extend(Ext.form.Label,{initComponent:function(){WXTL.Widgets.CommonForm.ClickLabel.superclass.initComponent.call(this);this.addEvents('click')},onRender:function(ct,position){if(!this.el){if(this.src&&this.src!=""){this.el=document.createElement('img');this.el.src=this.src;if(this.forId){this.el.setAttribute('htmlFor',this.forId)}}}WXTL.Widgets.CommonForm.ClickLabel.superclass.onRender.call(this,ct,position);Ext.fly(this.el).on('click',function(){this.fireEvent('click',this)},this)}});Ext.reg('ClickLabel',WXTL.Widgets.CommonForm.ClickLabel);WXTL.Widgets.CommonForm.ThemeCycleButton=Ext.extend(Ext.CycleButton,{cssItems:[{file:'ext-all.css',text:'默认主题 ',checked:true,iconCls:'icon-blue-theme'},{file:'ext-all.css',text:'蓝色月影 ',iconCls:'icon-blue-theme'},{file:'xtheme-gray.css',text:'灰色回忆 ',iconCls:'icon-gray-theme'},{file:'xtheme-slate.css',text:'深蓝心情 ',iconCls:'icon-slate-theme'},{file:'xtheme-black.css',text:'黑色物语 ',iconCls:'icon-black-theme'},{file:'xtheme-olive.css',text:'绿色芳香 ',iconCls:'icon-olive-theme'},{file:'xtheme-chocolate.css',text:'巧克力味 ',iconCls:'icon-chocolate-theme'},{file:'xtheme-gray-extend.css',text:'香远逸清 ',iconCls:'icon-gray-extend-theme'},{file:'xtheme-peppermint.css',text:'永恒不变 ',iconCls:'icon-peppermint-theme'},{file:'xtheme-purple.css',text:'诱惑紫色 ',iconCls:'icon-purple-theme'}],themeVar:'style',headVar:'head',cssPath:'extjs2.2/resources/css/',initComponent:function(){Ext.apply(this,{showText:true,prependText:' ',items:this.cssItems});if(Ext.state.Manager){var selectedTheme=Ext.state.Manager.get(this.themeVar);if(selectedTheme){for(var i=0;i<this.items.length;i++){if(this.items[i].file==selectedTheme){this.items[i].checked=true;this.changeHandler(this,this.items[i]);break}}}}WXTL.Widgets.CommonForm.ThemeCycleButton.superclass.initComponent.apply(this,arguments)},changeHandler:function(o,i){if(Ext.state.Manager.getProvider()){Ext.state.Manager.set(this.themeVar,i.file);Ext.state.Manager.set(this.headVar,i.head)}Ext.util.CSS.swapStyleSheet(this.themeVar,this.cssPath+i.file);Ext.util.CSS.getRule('.x-panel-body',true).style.background='url('+i.head+')';document.getElementById("imgLogo").src="jspack/product/common/Images/"+i.iconCls+".jpg";if(Ext.getCmp('viewport')){Ext.getCmp('viewport').layout.center.panel.setSize(Ext.getCmp('viewport').layout.center.getSize().width+1);Ext.getCmp('viewport').doLayout();Ext.getCmp('viewport').layout.center.panel.setSize(Ext.getCmp('viewport').layout.center.getSize().width-1);Ext.getCmp('viewport').doLayout()}}});Ext.reg('ThemeCycleButton',WXTL.Widgets.CommonForm.ThemeCycleButton);WXTL.Widgets.CommonGrid.GridPanelOriginal=Ext.extend(Ext.grid.EditorGridPanel,{title:"查询结果",style:'padding:5px 0px 0px 0px',frame:true,pageSize:12,needPage:true,needMenu:true,needRightMenu:false,structure:'1',loadMask:true,autoExpandColumn:7,autoScroll:true,autoHeight:true,inertMethod:'',updateMethod:'',deleteMethod:'',afterEditURL:'',initComponent:function(){if(this.structure!=''){this.initStructure()}WXTL.Widgets.CommonGrid.GridPanel.superclass.initComponent.call(this);var obj=this;for(var i=1;i<=10;i++){if(obj.colModel.lookup[i]!=null&&obj.colModel.lookup[i].editor!=null){obj.colModel.lookup[i].editor.addListener("complete",function(){obj.getStore().reload()})}}},onRender:function(ct,position){if(this.getColumnModel().getColumnId(0)!="checker"){this.getSelectionModel().singleSelect=true}else{this.getSelectionModel().singleSelect=false}WXTL.Widgets.CommonGrid.GridPanel.superclass.onRender.call(this,ct,position)},initStructure:function(){var ogrid=this;this.view=new Ext.grid.GroupingView({enableGroupingMenu:false,forceFit:true,sortAscText:'正序排列',sortDescText:'倒序排列',columnsText:'列显示/隐藏',groupByText:'根据本列分组',showGroupsText:'是否采用分组显示'});if(this.needPage){var pagingToolbar=new Ext.PagingToolbar({displayInfo:true,store:this.store,emptyMsg:'没有符合条件的记录',displayInfo:true,displayMsg:'当前记录 {0} -- {1} 条 共 {2} 条记录',prevText:"上一页",nextText:"下一页",refreshText:"刷新",lastText:"最后页",firstText:"第一页",beforePageText:"当前页",afterPageText:"共{0}页"});pagingToolbar.pageSize=this.pageSize;this.bbar=pagingToolbar;this.bottomToolbar=this.bbar;var oSearch=new Ext.form.TextField({id:'search',xtype:'textfield',align:'right'})};if(this.needMenu){var keyField=this.keyField;var topToolbar=new Ext.Toolbar({items:[{iconCls:'addicon',text:"新增",handler:function(){ogrid.doInsert()}},"","-","",{iconCls:'editicon',text:"修改",handler:function(){ogrid.doEdit()}},"","-","",{iconCls:'deleteicon',text:"删除",handler:function(){ogrid.doDelete()}}]});this.tbar=topToolbar;this.topToolbar=this.tbar};if(this.needRightMenu){var ServiceCodeClick=new Ext.menu.Menu({items:[{text:'新增',iconCls:'addicon',handler:function(){ogrid.doInsert();ogrid.getStore().reload()}},{text:'修改',iconCls:'editicon',handler:function(){ogrid.doEdit()}},{text:'删除',iconCls:'deleteicon',handler:function(){ogrid.doDelete()}},{text:'刷新',iconCls:'refreshicon',handler:function(){ogrid.getStore().reload()}}]});this.addListener("rowcontextmenu",function(grid,rowIndex,e){e.stopEvent();ServiceCodeClick.showAt(e.getXY())});this.addListener("afteredit",function(e){ogrid.afterEdit(e)})}},doInsert:function(){eval(this.inertMethod+"()")},doEdit:function(id){var row=this.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("温馨提示","请您选择一条记录!")}else{if(row.length>1){Ext.Msg.alert("温馨提示","对不起，您只能选择一条记录!")}else{if(row.length==1){eval(this.updateMethod+"(row[0])")}}}},doDelete:function(){var ogrid=this;var row=this.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("温馨提示","请您选择记录!")}else{Ext.Msg.confirm("温馨提示!","您确定要删除信息吗?",function(btn){if(btn=="yes"){eval(ogrid.deleteMethod+"(row)");}else{}})}},afterEdit:function(e){var ogrid=this;var g=e.grid;var r=e.record;var f=e.field;var v=e.value;var orgin=e.originalValue;var row=e.row;var col=e.column;Ext.Ajax.request({url:this.afterEditURL,method:"POST",params:{flag:"update",field:f,value:v,id:r.id},success:function(response,option){ogrid.getStore().reload()},failure:function(){Ext.Msg.alert("不好意思","修改失败了!")}})}});Ext.namespace("Ext.ux");Ext.ux.Portal=Ext.extend(Ext.Panel,{layout:'column',autoScroll:true,cls:'x-portal',defaultType:'portalcolumn',initComponent:function(){Ext.ux.Portal.superclass.initComponent.call(this);this.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true})},initEvents:function(){Ext.ux.Portal.superclass.initEvents.call(this);this.dd=new Ext.ux.Portal.DropZone(this,this.dropConfig)}});Ext.reg('portal',Ext.ux.Portal);Ext.ux.Portal.DropZone=function(portal,cfg){this.portal=portal;Ext.dd.ScrollManager.register(portal.body);Ext.ux.Portal.DropZone.superclass.constructor.call(this,portal.bwrap.dom,cfg);portal.body.ddScrollConfig=this.ddScrollConfig};Ext.extend(Ext.ux.Portal.DropZone,Ext.dd.DropTarget,{ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(dd,e,data,col,c,pos){return{portal:this.portal,panel:data.panel,columnIndex:col,column:c,position:pos,data:data,source:dd,rawEvent:e,status:this.dropAllowed}},notifyOver:function(dd,e,data){var xy=e.getXY(),portal=this.portal,px=dd.proxy;if(!this.grid){this.grid=this.getGrid()}var cw=portal.body.dom.clientWidth;if(!this.lastCW){this.lastCW=cw}else if(this.lastCW!=cw){this.lastCW=cw;portal.doLayout();this.grid=this.getGrid()}var col=0,xs=this.grid.columnX,cmatch=false;for(var len=xs.length;col<len;col++){if(xy[0]<(xs[col].x+xs[col].w)){cmatch=true;break}}if(!cmatch){col--}var p,match=false,pos=0,c=portal.items.itemAt(col),items=c.items.items;for(var len=items.length;pos<len;pos++){p=items[pos];var h=p.el.getHeight();if(h!==0&&(p.el.getY()+(h/2))>xy[1]){match=true;break}}var overEvent=this.createEvent(dd,e,data,col,c,match&&p?pos:c.items.getCount());if(portal.fireEvent('validatedrop',overEvent)!==false&&portal.fireEvent('beforedragover',overEvent)!==false){px.getProxy().setWidth('auto');if(p){px.moveProxy(p.el.dom.parentNode,match?p.el.dom:null)}else{px.moveProxy(c.el.dom,null)}this.lastPos={c:c,col:col,p:match&&p?pos:false};this.scrollPos=portal.body.getScroll();portal.fireEvent('dragover',overEvent);return overEvent.status}else{return overEvent.status}},notifyOut:function(){delete this.grid},notifyDrop:function(dd,e,data){delete this.grid;if(!this.lastPos){return}var c=this.lastPos.c,col=this.lastPos.col,pos=this.lastPos.p;var dropEvent=this.createEvent(dd,e,data,col,c,pos!==false?pos:c.items.getCount());if(this.portal.fireEvent('validatedrop',dropEvent)!==false&&this.portal.fireEvent('beforedrop',dropEvent)!==false){dd.proxy.getProxy().remove();dd.panel.el.dom.parentNode.removeChild(dd.panel.el.dom);if(pos!==false){c.insert(pos,dd.panel)}else{c.add(dd.panel)}c.doLayout();this.portal.fireEvent('drop',dropEvent);var st=this.scrollPos.top;if(st){var d=this.portal.body.dom;setTimeout(function(){d.scrollTop=st},10)}}delete this.lastPos},getGrid:function(){var box=this.portal.bwrap.getBox();box.columnX=[];this.portal.items.each(function(c){box.columnX.push({x:c.el.getX(),w:c.el.getWidth()})});return box}});Ext.ux.PortalColumn=Ext.extend(Ext.Container,{layout:'anchor',autoEl:'div',defaultType:'portlet',cls:'x-portal-column'});Ext.reg('portalcolumn',Ext.ux.PortalColumn);Ext.ux.Portlet=Ext.extend(Ext.Panel,{anchor:'100%',frame:true,collapsible:true,draggable:true,cls:'x-portlet'});Ext.reg('portlet',Ext.ux.Portlet);Ext.override(Ext.form.RadioGroup,{getValue:function(){var v;if(this.rendered){this.items.each(function(item){if(!item.getValue())return true;v=item.getRawValue();return false})}else{for(var k in this.items){if(this.items[k].checked){v=this.items[k].inputValue;break}}}return v},setValue:function(v){if(this.rendered)this.items.each(function(item){item.setValue(item.getRawValue()==v)});else{for(var k in this.items){this.items[k].checked=this.items[k].inputValue==v}}}});Ext.override(Ext.form.BasicForm,{findField:function(id){var field=this.items.get(id);if(!field){this.items.each(function(f){if(f.isXType('radiogroup')||f.isXType('checkboxgroup')){f.items.each(function(c){if(c.isFormField&&(c.dataIndex==id||c.id==id||c.getName()==id)){field=c;return false}})}if(f.isFormField&&(f.dataIndex==id||f.id==id||f.getName()==id)){field=f;return false}})}return field||null}});Ext.override(Ext.form.CheckboxGroup,{getValue:function(){var v=[];this.items.each(function(item){if(item.getValue()){v.push(item.getRawValue())}else{v.push('')}});return v},setValue:function(vals){var a=[];if(Ext.isArray(vals)){a=vals}else{a=[vals]}this.items.each(function(item){item.setValue(false);for(var i=0;i<a.length;i++){var val=a[i];if(val==item.getRawValue()){item.setValue(true)}}})}});if('function'!==typeof RegExp.escape){RegExp.escape=function(s){if('string'!==typeof s){return s}return s.replace(/([.*+?^=!:${}()|[\]\/\\])/g,'\\$1')};};Ext.ns('Ext.ux.form');Ext.ux.form.LovCombo=Ext.extend(Ext.form.ComboBox,{checkField:'checked',separator:',',initComponent:function(){if(!this.tpl){this.tpl='<tpl for=".">'+'<div class="x-combo-list-item">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'class="ux-lovcombo-icon ux-lovcombo-icon-'+'{[values.'+this.checkField+'?"checked":"unchecked"'+']}">'+'<div class="ux-lovcombo-item-text">{'+(this.displayField||'text')+'}</div>'+'</div>'+'</tpl>'}Ext.ux.form.LovCombo.superclass.initComponent.apply(this,arguments);this.on({scope:this,beforequery:this.onBeforeQuery,blur:this.onRealBlur});this.onLoad=this.onLoad.createSequence(function(){if(this.el){var v=this.el.dom.value;this.el.dom.value='';this.el.dom.value=v}})},initEvents:function(){Ext.ux.form.LovCombo.superclass.initEvents.apply(this,arguments);this.keyNav.tab=false},clearValue:function(){this.value='';this.setRawValue(this.value);this.store.clearFilter();this.store.each(function(r){r.set(this.checkField,false)},this);if(this.hiddenField){this.hiddenField.value=''}this.applyEmptyText()},getCheckedDisplay:function(){var re=new RegExp(this.separator,"g");return this.getCheckedValue(this.displayField).replace(re,this.separator+' ')},getCheckedValue:function(field){field=field||this.valueField;var c=[];var snapshot=this.store.snapshot||this.store.data;snapshot.each(function(r){if(r.get(this.checkField)){c.push(r.get(field))}},this);return c.join(this.separator)},expandSelect:function(){var c=[];c=this.getRawValue().split(this.separator);var snapshot=this.store.snapshot||this.store.data;var displayField=this.displayField;var isTrue=false;if(this.getRawValue().indexOf(this.separator)>-1){snapshot.each(function(r){isTrue=false;for(var i=0;i<c.length;i++){if(r.get(displayField)==c[i].replace(/(^\s*)|(\s*$)/g,"")){isTrue=true;break}}r.set(this.checkField,isTrue)},this)}else if(this.getRawValue()!=""){snapshot.each(function(r){isTrue=false;if(r.get(displayField)==c){isTrue=true}r.set(this.checkField,isTrue)},this)}else{snapshot.each(function(r){r.set(this.checkField,false)},this)}this.store.data=snapshot},onBeforeQuery:function(qe){this.expandSelect();qe.query=qe.query.replace(new RegExp(this.getCheckedDisplay()+'[ '+this.separator+']*'),'')},onRealBlur:function(){this.list.hide();var rv=this.getRawValue();var rva=rv.split(new RegExp(RegExp.escape(this.separator)+' *'));var va=[];var snapshot=this.store.snapshot||this.store.data;Ext.each(rva,function(v){snapshot.each(function(r){if(v===r.get(this.displayField)){va.push(r.get(this.valueField))}},this)},this);this.setValue(va.join(this.separator));this.store.clearFilter()},onSelect:function(record,index){if(this.fireEvent('beforeselect',this,record,index)!==false){record.set(this.checkField,!record.get(this.checkField));if(this.store.isFiltered()){this.doQuery(this.allQuery)}this.setValue(this.getCheckedValue());this.fireEvent('select',this,record,index)}},setValue:function(v){if(v){v=''+v;if(this.valueField){this.store.clearFilter();this.store.each(function(r){var checked=!(!v.match('(^|'+this.separator+')'+RegExp.escape(r.get(this.valueField))+'('+this.separator+'|$)'));r.set(this.checkField,checked)},this);this.value=this.getCheckedValue();this.setRawValue(this.getCheckedDisplay());if(this.hiddenField){this.hiddenField.value=this.value}}else{this.value=v;this.setRawValue(v);if(this.hiddenField){this.hiddenField.value=v}}if(this.el){this.el.removeClass(this.emptyClass)}}else{this.clearValue()}},selectAll:function(){this.store.each(function(record){record.set(this.checkField,true)},this);this.doQuery(this.allQuery);this.setValue(this.getCheckedValue())},deselectAll:function(){this.clearValue()}});Ext.reg('lovcombo',Ext.ux.form.LovCombo);