Ext.namespace('Js.Center.Business.ServiceCodeAdd');Js.Center.Common.GatewayStore.Add=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.GatewayURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:['numgwid','vc2gatewayname'],root:'data',id:'numgwid'}),baseParams:{columnlist:'numgwid,vc2gatewayname',flag:'selectall',serviceflag:'selectbyservicetype',instids:'numinstid'}});Js.Center.Business.ServiceCodeAdd.func=function(){var busareaCombox=new Ext.form.ComboBox({xtype:"xComboBox",name:"numbusarea",hiddenName:"numbusarea",id:'Js.Center.Business.ServiceCodeAdd.NumBusArea',emptyText:"-=请选择=-",allowBlank:false,blankText:"请选通道商务归属",fieldLabel:"<font color=red>通道商务归属</font>",readOnly:true,mode:"local",displayField:"vc2branchcompany",valueField:"numbranchcompany",triggerAction:"all",store:Js.Center.Common.BranchCompanyStore});WXTL.Common.showWaitLoading(true);function setVc2ServCode(){if(Ext.getCmp("Js.Center.Business.ServiceCodeAdd.tempnumgwid").getValue()!=""){Ext.Ajax.request({url:Js.Center.Business.ServiceCodeByGatewayURL,method:"POST",params:{numGatewayId:Ext.getCmp("Js.Center.Business.ServiceCodeAdd.tempnumgwid").getValue(),flag:"getgatewayspnumber"},success:function(form,action){var objJson=Ext.util.JSON.decode(form.responseText);var flag=objJson.success;if(true==flag){var vc2servercode=Ext.getCmp("Js.Center.Business.ServiceCodeAdd.vc2longcode").getValue();Ext.getCmp("Js.Center.Business.ServiceCodeAdd.vc2servcode").setValue(objJson.error+vc2servercode)}},failure:function(){Ext.Msg.alert("温馨提示","系统忙，请稍候...!")}})}else{var vc2servercode=Ext.getCmp("Js.Center.Business.ServiceCodeAdd.vc2longcode").getValue();Ext.getCmp("Js.Center.Business.ServiceCodeAdd.vc2servcode").setValue(vc2servercode)}};var addServiceCodeInfofp=new Ext.form.FormPanel({frame:true,labelWidth:80,defaults:{anchor:"100%",msgTarget:"side"},items:[{layout:'column',items:[{xtype:"hidden",name:"flag",value:"insert"},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2svc",fieldLabel:"<font color=red>业务代码</font>",allowBlank:false,blankText:"业务编码不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:10,maxLengthText:'长度不能超过10！'},{xtype:"combo",name:"vc2type",fieldLabel:"<font color=red>计费类型</font>",hiddenName:"vc2type",emptyText:"请选择",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:1,allowBlank:false,blankText:"计费类型不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["免费","0"],["按条","1"],["包月","2"]]})},{xtype:'numberfield',name:'vc2feevalue',fieldLabel:"<font color=red>资费(分)</font>",allowBlank:false,blankText:'资费不允许为空',maxValue:9999999999,maxText:'最大不能超过9999999999',minValue:0,minText:'最小不能小于1'},{xtype:"textfield",name:"vc2longcode",id:"Js.Center.Business.ServiceCodeAdd.vc2longcode",fieldLabel:"业务子码",allowBlank:true,maxLength:20,maxLengthText:'长度不能超过20！',listeners:{"blur":function(){setVc2ServCode()}}}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2svcname",fieldLabel:"<font color=red>业务名称</font>",allowBlank:false,blankText:"业务名称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50,maxLengthText:'长度不能超过50！'},{xtype:"combo",name:"vc2servicetype",fieldLabel:"<font color=red>短彩类型</font>",hiddenName:"vc2servicetype",readOnly:true,allowBlank:false,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",emptyText:'-=请选择=-',blankText:"短彩类型不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["短信","1"],["彩信","2"],["wap","3"]]}),listeners:{"select":function(){Ext.getCmp('Js.Center.Business.ServiceCodeAdd.tempnumgwid').reset();Js.Center.Common.GatewayStore.Add.load({params:{vc2servicetype:this.getValue(),serviceflag:'selectbyservicetype'}})}}},{xtype:"xComboBox",name:"numgwid",id:"Js.Center.Business.ServiceCodeAdd.tempnumgwid",fieldLabel:"<font color=red>网关名称</font>",hiddenName:"numgwid",mode:"local",store:Js.Center.Common.GatewayStore.Add,triggerAction:'all',emptyText:'-=请先选择短彩类型=-',valueNotFoundText:'-=请先选择短彩类型=-',width:130,allowBlank:false,blankText:"网关名称不允许为空",displayField:'vc2gatewayname',valueField:'numgwid',isNeedDefaultChoose:false,listeners:{"select":function(){var numgwid=Ext.getCmp("Js.Center.Business.ServiceCodeAdd.tempnumgwid").getValue();if(numgwid==""){return}Ext.Ajax.request({url:Js.Center.Business.ServiceCodeURL,method:"POST",params:{numgwid:numgwid,flag:"queryservicecodebygwidandpftype"},success:function(form,action){var objJson=Ext.util.JSON.decode(form.responseText);var flag=objJson.success;if(false==flag){Ext.Msg.alert("提示信息",objJson.info)}},failure:function(){Ext.Msg.alert("温馨提示","系统忙，请稍候...!")}});setVc2ServCode()}}},{xtype:"lovcombo",name:"numinstid",fieldLabel:"<font color=red>通道地区</font>",hiddenName:"numinstid",allowBlank:false,blankText:"通道地区不允许为空",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numinstid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.InstStore,onSelect:function(record,index){if(this.fireEvent('beforeselect',this,record,index)!==false){if(false==this.store.data.items[0].data.checked||0==index){if(0==index&&false==record.get(this.checkField)){this.clearValue()}record.set(this.checkField,!record.get(this.checkField))}if(this.store.isFiltered()){this.doQuery(this.allQuery)}this.setValue(this.getCheckedValue());this.fireEvent('select',this,record,index)}}}]},{columnWidth:1,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0 0 0 15px",items:[{xtype:"panel",html:"<HR align=left color=#B6D3EE SIZE=1 noShade>"}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[busareaCombox,{xtype:"combo",name:"numshare",fieldLabel:"共享/独享",hiddenName:"numshare",emptyText:"-=请选择=-",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:1,allowBlank:false,blankText:"共享/独享不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["共享","1"],["独享","0"],["按产品","3"]]})},{xtype:"combo",name:"numisfeeback",fieldLabel:"通道是否返佣",hiddenName:"numisfeeback",emptyText:"-=请选择=-",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:1,allowBlank:false,blankText:"通道是否返佣不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["返佣","1"],["不返佣","0"]]})},{xtype:"textfield",name:"numfeebakratio",fieldLabel:"<font color=red>返佣比率</font>",allowBlank:false,regex:WXTL.Common.regex.Double,regexText:"请输入数值",maxLength:9,maxLengthText:'长度不能超过9！',value:0},{xtype:"combo",name:"vc2feetype",fieldLabel:"计费方式",hiddenName:"vc2feetype",emptyText:"-=请选择=-",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:1,allowBlank:false,blankText:"计费方式不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["按条","1"],["按套餐","2"],["按产品","3"]]})},{xtype:"textfield",name:"vc2servcode",fieldLabel:"服务代码",id:"Js.Center.Business.ServiceCodeAdd.vc2servcode",allowBlank:true,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:200,maxLengthText:'长度不能超过200！'}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"combo",name:"vc2validflag",fieldLabel:"状态",hiddenName:"vc2validflag",emptyText:"-=请选择=-",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:1,allowBlank:false,blankText:"状态不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["商用","1"],["暂停","0"]]})},{xtype:"combo",name:"numisbigec",fieldLabel:"是否大EC",hiddenName:"numisbigec",emptyText:"-=请选择=-",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:1,allowBlank:false,blankText:"是否大E不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["大EC","1"],["非大EC","0"]]})},{xtype:"textfield",name:"vc2costdesc",fieldLabel:"成本",allowBlank:true,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:200,maxLengthText:'长度不能超过200！'},{xtype:"combo",name:"vc2signstatus",fieldLabel:"签名",hiddenName:"vc2signstatus",emptyText:"-=请选择=-",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:1,allowBlank:false,blankText:"签名不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["签名可去","1"],["签名不可去","2"],["无签名","3"]]})},{xtype:"textfield",name:"vc2signature",fieldLabel:"签名内容",allowBlank:true,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:200,maxLengthText:'长度不能超过200！'},{xtype:"combo",name:"numsigntype",fieldLabel:"返佣/直签",hiddenName:"numsigntype",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",allowBlank:false,blankText:"返佣/直签不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["返佣","1"],["直签","0"]]})}]}]},{xtype:"textarea",labelStyle:"text-align:center;width:100;",align:"right",name:"vc2dsc",fieldLabel:"描述",anchor:'90%',height:150,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:100,maxLengthText:'长度不能超过100！'}]});var mainForm=addServiceCodeInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加通道",mainForm:mainForm,updateURL:Js.Center.Business.ServiceCodeUpdateURL,displayStore:Js.Center.Business.ServiceCode.Infostore,items:[addServiceCodeInfofp],needLoadDataStore:true,loadDataStoreFunc:function(){Js.Center.Common.BranchCompanyStore.reload()},needButtons:false,buttons:[new Ext.Button({text:'确定',minWidth:70,handler:function(){if(addServiceCodeInfofp.getForm().isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.Business.ServiceCodeAdd.window.mainFormSubmitFunc()}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){Js.Center.Common.GatewayStore.Add.removeAll();addServiceCodeInfofp.getForm().reset()}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){Js.Center.Business.ServiceCodeAdd.window.hide()}})],listeners:{"beforehide":function(){Js.Center.Common.GatewayStore.Add.removeAll();}}})};Ext.namespace('Js.Center.Business.ServiceCodedelete');Js.Center.Business.ServiceCodedelete.func=function(row){var deleteSplit="";for(var i=0;i<row.length;i++){if(row.length==1){deleteSplit=row[i].data.numsvcid}else{if(i<(row.length-1)){deleteSplit=row[i].data.numsvcid+","+deleteSplit}if(i==(row.length-1)){deleteSplit=deleteSplit+row[i].data.numsvcid}}};var params={ids:deleteSplit,flag:"delete"};doAjax(Js.Center.Business.ServiceCodeUpdateURL,params,Js.Center.Business.ServiceCode.Infostore)};Ext.namespace('Js.Center.Business.ServiceCodeDetail');Js.Center.Business.ServiceCodeDetail.func=function(row){var detailServiceCodeInfofp=new Ext.form.FormPanel({width:600,frame:true,labelWidth:80,items:[{layout:'column',items:[{xtype:"hidden",name:"flag",value:"updateall"},{xtype:"hidden",name:"numsvcid",fieldLabel:"编号"},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2svc",fieldLabel:"<font color=red>业务编码</font>",allowBlank:false,readOnly:true,blankText:"业务编码不允许为空"},{xtype:"combo",name:"numgwid",disabled:true,fieldLabel:"网关名称",hiddenName:"numgwid",readOnly:true,mode:"local",tpl:'<tpl for="."><div ext:qtip="{vc2gwname}" class="x-combo-list-item">{vc2gwname}</div></tpl>',store:Js.Center.Business.ServiceCode.gatewaystore,typeAhead:true,triggerAction:'all',selectOnFocus:true,emptyText:'-=请选择=-',forceSelection:true,resizable:true,width:130,value:"1",displayField:'vc2gwname',valueField:'numgwid',mode:'local'},{xtype:"textfield",name:"nummonthcnt",readOnly:true,fieldLabel:"<font color=red>包月下行条数</font>",allowBlank:false,blankText:"包月下行条数不允许为空",regex:WXTL.Common.regex.Number,regexText:"请输入数值"},{xtype:"combo",name:"numstatflag",disabled:true,fieldLabel:"是否统计",hiddenName:"numstatflag",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:"0",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["不统计","0"],["统计","1"]]})},{xtype:"combo",name:"vc2svctype",fieldLabel:"业务类型",disabled:true,hiddenName:"vc2svctype",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:"1",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["定制","1"],["点播","2"]]})},{xtype:"textfield",fieldLabel:'开始时间',readOnly:true,name:'datstart'}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2svcname",fieldLabel:"<font color=red>业务名称</font>",allowBlank:false,readOnly:true,blankText:"业务名称不允许为空"},{xtype:"textfield",name:"vc2feevalue",fieldLabel:"<font color=red>费率</font>",allowBlank:false,readOnly:true,blankText:"费率不允许为空",regex:/^[1-9][0-9.]{1,10}$/,regexText:"2到10位数字可有小数点-第一位不允许有小数点"},{xtype:"textfield",name:"vc2prodseq",readOnly:true,fieldLabel:"<font color=red>产品流水号</font>",allowBlank:false,blankText:"产品流水号不允许为空"},{xtype:"combo",name:"vc2ischg",fieldLabel:"是否扣费",disabled:true,hiddenName:"vc2ischg",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:"1",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["否","0"],["是","1"]]})},{xtype:"combo",name:"vc2type",disabled:true,fieldLabel:"计费类型",hiddenName:"vc2type",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:"1",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["免费","0"],["安条","1"],["包月","2"]]})},{xtype:"textfield",fieldLabel:'结束时间',readOnly:true,name:'datend'}]}]},{xtype:"textfield",labelStyle:"text-align:center;width:100;",align:"right",name:"vc2dsc",fieldLabel:"描述",readOnly:true,anchor:'90% 50%'}]});var detailServiceCodeInfoWin=new Ext.Window({title:"运营商详细",width:650,plain:true,iconCls:"addicon",resizable:false,defaultType:"textfield",labelWidth:100,collapsible:true,closeAction:'hide',closable:true,plain:true,modal:'true',buttonAlign:"center",bodyStyle:"padding:10px 0 0 15px",items:[detailServiceCodeInfofp],listeners:{"show":function(){dfobj=detailServiceCodeInfofp.findByType("datefield");if(dfobj){for(var i=0;i<dfobj.length;i++){if(dfobj[i].name=="datstart"){dfobj[i].emptyText=row.get('datstart')}else if(dfobj[i].name=="datend"){dfobj[i].emptyText=row.get('datend')}}}detailServiceCodeInfofp.getForm().loadRecord(row);}}});detailServiceCodeInfoWin.show()};Ext.namespace('Js.Center.Business.ServiceCode');Js.Center.Business.ServiceCode.serviceCodeInfo=function(node){if(Ext.get("Js.Center.Business.ServiceCode.servicecodepanel")==null){Js.Center.Common.GatewayStore.Search=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.GatewayURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:['numgwid','vc2gatewayname'],root:'data',id:'numgwid'}),baseParams:{columnlist:'numgwid,vc2gatewayname',flag:'selectall',serviceflag:'selectbyservicetype'}});Js.Center.Common.InstStore.reload();var feeTypeStore=new Ext.data.SimpleStore({fields:["vc2name","value"],data:[["免费","0"],["按条","1"],["包月","2"]]});var _pageSize=12;var fields=["numsvcid","vc2svc","vc2svcname","datstart","datend","numgwid","vc2feevalue","nummonthcnt","vc2prodseq","numstatflag","vc2ischg","vc2svctype","vc2type","vc2dsc","vc2gatewayname","vc2servicetype","vc2longcode","numshare","numbusarea","vc2validflag","numisfeeback","numisbigec","numfeebakratio","vc2costdesc","vc2feetype","vc2signstatus","vc2signature","vc2servcode","numsigntype"];Js.Center.Business.ServiceCode.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.ServiceCodeURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numsvcid",totalProperty:"totalCount"}),sortInfo:{field:'vc2svcname',direction:'DESC'},baseParams:{vc2svcname:'',vc2svc:'',numgwid:'',vc2servicetype:'-1',flag:'selectbykey'}});Js.Center.Business.ServiceCode.Infostore.load({params:{start:0,limit:_pageSize,vc2svcname:'',vc2svc:'',numgwid:'',flag:'selectbykey'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numsvcid"});var cm=new Ext.grid.ColumnModel([sm,{header:"业务名称",tooltip:"业务名称",dataIndex:"vc2svcname",sortable:true},{header:"业务代码",tooltip:"业务代码",dataIndex:"vc2svc",sortable:true},{header:"计费类型",tooltip:"计费类型",dataIndex:"vc2type",sortable:true,renderer:function(value){if(value=="0"){return"免费"}else if(value=="1"){return"按条"}else if(value=="2"){return"包月"}}},{header:"短彩类型",tooltip:"短彩类型",dataIndex:"vc2servicetype",sortable:true,renderer:function(value){if(value=="1"){return"短信"}else if(value=="2"){return"彩信"}else if(value=="3"){return"wap"}else if(value=="4"){return"短信PV"}else if(value=="5"){return"彩信PV"}else if(value=="6"){return"wapPV"}}},{header:"网关名称",tooltip:"网关名称",dataIndex:"vc2gatewayname",sortable:true},{header:"服务代码",tooltip:"服务代码",dataIndex:"vc2longcode",sortable:true},{header:"描述",tooltip:"描述",dataIndex:"vc2dsc",sortable:true}]);var serviceCodeGrid=new WXTL.Widgets.CommonGrid.GridPanel({id:"Js.Center.Business.ServiceCode.servicecodeGridPanel",anchor:'100% 100%',pageSize:_pageSize,store:Js.Center.Business.ServiceCode.Infostore,afterEditURL:Js.Center.Business.servicecodeUpdateURL,inertMethod:'Js.Center.Business.ServiceCodeAdd',updateMethod:'Js.Center.Business.ServiceCodeUpdate',deleteMethod:'Js.Center.Business.ServiceCodedelete.func',sm:sm,cm:cm});var gatewayCombo=new WXTL.Widgets.CommonForm.ComboBox({xtype:"xComboBox",name:"numgwid_ext",id:"Js.Center.Business.ServiceCode.numgwid_ext",fieldLabel:"网关名称",hiddenName:"Js.Center.Business.ServiceCode.servicodegwid",mode:"local",displayField:"vc2gatewayname",valueField:"numgwid",triggerAction:"all",emptyText:'-=请先选择短彩类型=-',valueNotFoundText:'-=请先选择短彩类型=-',isNeedDefaultChoose:false,store:Js.Center.Common.GatewayStore.Search});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"Js.Center.Business.ServiceCode.servicecodeSelectPanel",height:150,labelWidth:100,needButtons:false,queryMethod:"Js.Center.Business.ServiceCode.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",fieldLabel:'业务名称',name:'vc2svcname',id:'Js.Center.Business.ServiceCode.servicecodeinfosvcname',regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50,maxLengthText:'长度不能超过50！'},{xtype:"combo",name:"vc2servicetype",fieldLabel:"短彩类型",hiddenName:"Js.Center.Business.ServiceCode.stype",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择短彩类型=-","-1"],["短信","1"],["彩信","2"],["wap","3"]]}),listeners:{"select":function(){Ext.getCmp('Js.Center.Business.ServiceCode.numgwid_ext').setValue('');Js.Center.Common.GatewayStore.Search.reload({params:{vc2servicetype:this.getValue(),serviceflag:'selectbyservicetype'}})}}}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",fieldLabel:'业务代码',name:'vc2svc',id:'Js.Center.Business.ServiceCode.servicecodeinfosvc',regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:10,maxLengthText:'长度不能超过10！'},gatewayCombo]}]}],buttons:[new Ext.Button({text:'查询',handler:function(){Js.Center.Business.ServiceCode.queryGrid()}}),new Ext.Button({text:'重置',handler:function(){selectPanel.getForm().reset();Js.Center.Common.GatewayStore.Search.removeAll()}})]});Js.Center.Business.ServiceCode.queryGrid=function(){if(selectPanel.getForm().isValid()){var serviceCodeName=Ext.get("Js.Center.Business.ServiceCode.servicecodeinfosvcname").getValue();var vc2svc=Ext.get("Js.Center.Business.ServiceCode.servicecodeinfosvc").getValue();var numgwid=Ext.get("Js.Center.Business.ServiceCode.servicodegwid").getValue();var stype=Ext.get("Js.Center.Business.ServiceCode.stype").getValue();var flag='selectbykey';Js.Center.Business.ServiceCode.Infostore.baseParams={vc2svcname:serviceCodeName,vc2svc:vc2svc,numgwid:numgwid,vc2servicetype:stype,flag:flag};Js.Center.Business.ServiceCode.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.Business.ServiceCode.ServiceCodePanel=new Ext.Panel({id:"Js.Center.Business.ServiceCode.servicecodepanel",frame:true,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,serviceCodeGrid]})};GridMain(node,Js.Center.Business.ServiceCode.ServiceCodePanel,"openroomiconinfo","Js.Center.Business.ServiceCode.Infostore")};Ext.namespace('Js.Center.Business.ServiceCodeUpdate');Js.Center.Business.ServiceCodeUpdate.func=function(row){Js.Center.Common.BranchCompanyStore.reload();Js.Center.Business.ServiceCodeUpdate.GatewayStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.GatewayURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:['numgwid','vc2gatewayname'],root:'data',id:'numgwid'}),baseParams:{flag:'selectall',columnlist:'numgwid,vc2gatewayname'}});var busareaUpdateCombox=new Ext.form.ComboBox({xtype:"xComboBox",name:"numbusarea",hiddenName:"numbusarea",id:'Js.Center.Business.ServiceCodeUpdate.NumBusArea',emptyText:"-=请选择=-",allowBlank:false,blankText:"请选通道商务归属",fieldLabel:"<font color=red>通道商务归属</font>",readOnly:true,mode:"local",displayField:"vc2branchcompany",valueField:"numbranchcompany",triggerAction:"all",store:Js.Center.Common.BranchCompanyStore});function setVc2ServCode(){Ext.Ajax.request({url:Js.Center.Business.ServiceCodeByGatewayURL,method:"POST",params:{numGatewayId:Ext.getCmp("Js.Center.Business.ServiceCodeUpdate.tempnumgwid").getValue(),flag:"getgatewayspnumber"},success:function(form,action){var objJson=Ext.util.JSON.decode(form.responseText);var flag=objJson.success;if(true==flag){var vc2servercode=Ext.getCmp("Js.Center.Business.ServiceCodeUpdate.vc2longcode").getValue();Ext.getCmp("Js.Center.Business.ServiceCodeUpdate.vc2servcode").setValue(objJson.error+vc2servercode)}},failure:function(){Ext.Msg.alert("温馨提示","系统忙，请稍候...!")}})};var gatewayCombo={xtype:"combo",name:"numgwid",id:"Js.Center.Business.ServiceCodeUpdate.tempnumgwid",fieldLabel:"<font color=red>网关名称</font>",hiddenName:"numgwid",readOnly:true,mode:"local",store:Js.Center.Business.ServiceCodeUpdate.GatewayStore,typeAhead:true,triggerAction:'all',selectOnFocus:true,emptyText:'-=请选择=-',forceSelection:true,width:130,allowBlank:false,blankText:"网关名称不允许为空",displayField:'vc2gatewayname',valueField:'numgwid',mode:'local',listeners:{"select":function(){var numgwid=Ext.getCmp("Js.Center.Business.ServiceCodeUpdate.tempnumgwid").getValue();var numsvcid=Ext.getCmp("Js.Center.Business.ServiceCodeUpdate.numsvcid").getValue();Ext.Ajax.request({url:Js.Center.Business.ServiceCodeURL,method:"POST",params:{numgwid:numgwid,numsvcid:numsvcid,flag:"queryservicecodebygwidandpftype"},success:function(form,action){var objJson=Ext.util.JSON.decode(form.responseText);var flag=objJson.success;if(false==flag){Ext.Msg.alert("提示信息",objJson.info)}},failure:function(){Ext.Msg.alert("温馨提示","系统忙，请稍候...!")}});setVc2ServCode()}}};var updateServiceCodeInfofp=new Ext.form.FormPanel({frame:true,labelWidth:80,defaults:{anchor:"90%",msgTarget:"side"},items:[{layout:'column',items:[{xtype:"hidden",name:"flag",value:"updateall"},{xtype:"hidden",name:"numsvcid",id:"Js.Center.Business.ServiceCodeUpdate.numsvcid",fieldLabel:"编号"},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2svc",fieldLabel:"<font color=red>业务代码</font>",allowBlank:false,blankText:"业务编码不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:10,maxLengthText:'长度不能超过10！'},{xtype:"combo",name:"vc2type",fieldLabel:"<font color=red>计费类型</font>",hiddenName:"vc2type",emptyText:"请选择",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",allowBlank:false,blankText:"计费类型不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["免费","0"],["按条","1"],["包月","2"]]})},{xtype:'numberfield',name:'vc2feevalue',fieldLabel:"<font color=red>资费(分)</font>",allowBlank:false,blankText:'资费不允许为空',maxValue:9999999999,maxText:'最大不能超过9999999999',minValue:0,minText:'最小不能小于0'},{xtype:"textfield",name:"vc2longcode",id:"Js.Center.Business.ServiceCodeUpdate.vc2longcode",fieldLabel:"业务子码",allowBlank:true,maxLength:20,maxLengthText:'长度不能超过20！',listeners:{"blur":function(){setVc2ServCode()}}}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"vc2svcname",fieldLabel:"<font color=red>业务名称</font>",allowBlank:false,blankText:"业务名称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50,maxLengthText:'长度不能超过50！'},{xtype:"combo",name:"vc2servicetype",fieldLabel:"<font color=red>短彩类型</font>",hiddenName:"vc2servicetype",readOnly:true,allowBlank:false,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",selectOnFocus:true,emptyText:'-=请选择=-',blankText:"短彩类型不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["短信","1"],["彩信","2"],["wap","3"]]}),listeners:{"select":function(){Ext.getCmp('Js.Center.Business.ServiceCodeUpdate.tempnumgwid').setValue('-=请选择=-');Js.Center.Business.ServiceCodeUpdate.GatewayStore.reload({params:{vc2servicetype:this.getValue(),serviceflag:'selectbyservicetype'}})}}},gatewayCombo,{xtype:"lovcombo",name:"numinstid",fieldLabel:"<font color=red>通道地区</font>",hiddenName:"numinstid",id:"Js.Center.Business.ServiceCodeUpdate.numinstid",allowBlank:false,blankText:"地区不允许为空",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numinstid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.InstStore,onSelect:function(record,index){if(this.fireEvent('beforeselect',this,record,index)!==false){if(false==this.store.data.items[0].data.checked||index==0){if(0==index&&false==record.get(this.checkField)){this.clearValue()}record.set(this.checkField,!record.get(this.checkField))}if(this.store.isFiltered()){this.doQuery(this.allQuery)}this.setValue(this.getCheckedValue());this.fireEvent('select',this,record,index)}}}]},{columnWidth:1,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0 0 0 15px",items:[{xtype:"panel",html:"<HR align=left color=#B6D3EE SIZE=1 noShade>"}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[busareaUpdateCombox,{xtype:"combo",name:"numshare",fieldLabel:"共享/独享",hiddenName:"numshare",emptyText:"请选择",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:1,allowBlank:false,blankText:"共享/独享不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["共享","1"],["独享","0"],["按产品","3"]]})},{xtype:"combo",name:"numisfeeback",fieldLabel:"通道是否返佣",hiddenName:"numisfeeback",emptyText:"请选择",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:1,allowBlank:false,blankText:"通道是否返佣不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["返佣","1"],["不返佣","0"]]})},{xtype:"textfield",name:"numfeebakratio",fieldLabel:"<font color=red>返佣比率</font>",allowBlank:false,regex:WXTL.Common.regex.Double,regexText:"请输入数值",maxLength:9,maxLengthText:'长度不能超过9！',value:0},{xtype:"combo",name:"vc2feetype",fieldLabel:"计费方式",hiddenName:"vc2feetype",emptyText:"请选择",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:1,allowBlank:false,blankText:"计费方式不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["按条","1"],["按套餐","2"],["按产品","3"]]})},{xtype:"textfield",name:"vc2servcode",id:"Js.Center.Business.ServiceCodeUpdate.vc2servcode",fieldLabel:"服务代码",allowBlank:true,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:200,maxLengthText:'长度不能超过200！'}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"combo",name:"vc2validflag",fieldLabel:"状态",hiddenName:"vc2validflag",emptyText:"请选择",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:1,allowBlank:false,blankText:"状态不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["商用","1"],["暂停","0"]]})},{xtype:"combo",name:"numisbigec",fieldLabel:"是否大EC",hiddenName:"numisbigec",emptyText:"请选择",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:1,allowBlank:false,blankText:"是否大EC不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["大EC","1"],["非大EC","0"]]})},{xtype:"textfield",name:"vc2costdesc",fieldLabel:"成本",allowBlank:true,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:200,maxLengthText:'长度不能超过200！'},{xtype:"combo",name:"vc2signstatus",fieldLabel:"签名",hiddenName:"vc2signstatus",emptyText:"请选择",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:1,allowBlank:false,blankText:"状签名不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["签名可去","1"],["签名不可去","2"],["无签名","3"]]})},{xtype:"textfield",name:"vc2signature",fieldLabel:"签名内容",allowBlank:true,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:200,maxLengthText:'长度不能超过200！'},{xtype:"combo",name:"numsigntype",fieldLabel:"返佣/直签",hiddenName:"numsigntype",emptyText:"-=请选择=-",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",value:1,allowBlank:false,blankText:"返佣/直签不允许为空",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-","-=请选择=-"],["返佣","1"],["直签","0"]]})}]}]},{xtype:"textarea",labelStyle:"text-align:center;width:100;",align:"right",name:"vc2dsc",fieldLabel:"描述",anchor:'90%',height:150,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:100,maxLengthText:'长度不能超过100！'}]});var mainForm=updateServiceCodeInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"修改通道",mainForm:mainForm,updateURL:Js.Center.Business.ServiceCodeUpdateURL,displayStore:Js.Center.Business.ServiceCode.Infostore,updateState:true,updateRecord:row,loadDataStoreFunc:function(){Js.Center.Common.BranchCompanyStore.reload()},needButtons:false,items:[updateServiceCodeInfofp],buttons:[new Ext.Button({text:'确定',minWidth:70,handler:function(){if(updateServiceCodeInfofp.getForm().isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.Business.ServiceCodeUpdate.window.mainFormSubmitFunc();Js.Center.Business.ServiceCode.Infostore.reload()}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){updateServiceCodeInfofp.getForm().reset();Js.Center.Business.ServiceCodeUpdate.window.mainForm.loadRecord(Js.Center.Business.ServiceCodeUpdate.window.updateRecord);getSvcInst()}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){Js.Center.Business.ServiceCodeUpdate.window.hide()}})],needLoadDataStore:true,loadDataStoreFunc:function(){Js.Center.Business.ServiceCodeUpdate.GatewayStore.reload({params:{vc2servicetype:Js.Center.Business.ServiceCodeUpdate.window.updateRecord.get("vc2servicetype"),serviceflag:'selectbyservicetype'},callback:function(records,options,success){Ext.getCmp("Js.Center.Business.ServiceCodeUpdate.tempnumgwid").setValue(Js.Center.Business.ServiceCodeUpdate.window.updateRecord.get("numgwid"))}});getSvcInst()}});getSvcInst=function(){var svcinst=Js.Center.Business.ServiceCodeUpdate.window.updateRecord.get("numsvcid");var Url="URL/business/servicecode/servicecode.ashx?flag=selectsvcinst&svcid="+svcinst;var JsonInst=eval(doSynRequest(Url));var strSvcInst="";for(var i=0;i<JsonInst.totalCount;i++){strSvcInst+=JsonInst.data[i].numinstid;if((i+1)!=JsonInst.totalCount){strSvcInst+=','}}Ext.getCmp("Js.Center.Business.ServiceCodeUpdate.numinstid").setValue(strSvcInst)}};Ext.namespace('Js.Center.Business.ServiceInfo');Js.Center.Business.ServiceInfo.func=function(node){if(Ext.get("Js.Center.Business.ServiceInfo.servicepanel")==null){Js.Center.Common.GatewayStore.Search=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.GatewayURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:['numgwid','vc2gatewayname'],root:'data',id:'numgwid'}),baseParams:{columnlist:'numgwid,vc2gatewayname',flag:'selectall',serviceflag:'selectbyservicetype'}});Js.Center.Common.GatewayStore.Search.on("load",function(a){if(a.getAt(0)!=null&&a.getAt(0).data[obj.valueField]!=''){var r=new Ext.data.Record({});r.set(o.valueField,'');r.set(o.displayField,'-=请先选择短彩类型=-');a.insert(0,r)}});Js.Center.Common.GatewayStore.Search.reload();var _pageSize=12;var fields=["numprodid","vc2name","numsvcid","vc2svcname","vc2spnum","vc2validflag","vc2subcode","vc2servicetype"];Js.Center.Business.ServiceInfo.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.ServiceURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"",totalProperty:"totalCount"}),sortInfo:{field:'vc2svcname',direction:'DESC'},baseParams:{vc2subcode:'',vc2name:'',vc2servicetype:'',numgwid:'',flag:'querychildrenservicecode'}});Js.Center.Business.ServiceInfo.Infostore.load({params:{start:0,limit:_pageSize,vc2subcode:'',vc2name:'',vc2servicetype:'',numgwid:'',flag:'querychildrenservicecode'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numsvcid"});var cm=new Ext.grid.ColumnModel([{header:"通道组名称",tooltip:"通道组名称",dataIndex:"vc2name",sortable:true},{header:"产品名称",tooltip:"产品名称",dataIndex:"vc2svcname",sortable:true},{header:"服务代码",tooltip:"服务代码",dataIndex:"vc2spnum",sortable:true},{header:"子号码",tooltip:"子号码",dataIndex:"vc2subcode",sortable:true},{header:"状态",tooltip:"状态",dataIndex:"vc2validflag",sortable:true,renderer:function(value){if(value=="1"){return"商用"}else if(value=="0"){return"暂停"}}}]);var serviceGrid=new WXTL.Widgets.CommonGrid.GridPanel({id:"Js.Center.Business.ServiceInfo.serviceinfoGridPanel",anchor:'100% 100%',pageSize:_pageSize,store:Js.Center.Business.ServiceInfo.Infostore,sm:sm,cm:cm,needMenu:false});var gatewayCombo=new WXTL.Widgets.CommonForm.ComboBox({xtype:"xComboBox",name:"numgwid_ext",id:"Js.Center.Business.ServiceInfo.numgwid_ext",fieldLabel:"网关名称",hiddenName:"Js.Center.Business.ServiceInfo.servicodegwid",mode:"local",displayField:"vc2gatewayname",valueField:"numgwid",triggerAction:"all",emptyText:'-=请先选择短彩类型=-',valueNotFoundText:'-=请先选择短彩类型=-',store:Js.Center.Common.GatewayStore.Search});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"Js.Center.Business.ServiceInfo.servicecodeSelectPanel",height:150,labelWidth:100,needButtons:false,queryMethod:"Js.Center.Business.ServiceInfo.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",fieldLabel:'子号码',name:'vc2subcode',id:'Js.Center.Business.ServiceInfo.serviceinfovc2subcode',regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50,maxLengthText:'长度不能超过50！'},{xtype:"combo",name:"vc2servicetype",fieldLabel:"短彩类型",hiddenName:"Js.Center.Business.ServiceInfo.stype",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择短彩类型=-",""],["短信","1"],["彩信","2"],["wap","3"]]}),listeners:{"select":function(){Ext.getCmp('Js.Center.Business.ServiceInfo.numgwid_ext').setValue('');Js.Center.Common.GatewayStore.Search.reload({params:{vc2servicetype:this.getValue(),serviceflag:'selectbyservicetype'}})}}}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",fieldLabel:'通道组名称',name:'vc2name',id:'Js.Center.Business.ServiceInfo.serviceinfovc2name',regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:10,maxLengthText:'长度不能超过10！'},gatewayCombo]}]}],buttons:[new Ext.Button({text:'查询',handler:function(){Js.Center.Business.ServiceInfo.queryGrid()}}),new Ext.Button({text:'重置',handler:function(){selectPanel.getForm().reset();Js.Center.Common.GatewayStore.Search.removeAll()}})]});Js.Center.Business.ServiceInfo.queryGrid=function(){if(selectPanel.getForm().isValid()){var vc2name=Ext.get("Js.Center.Business.ServiceInfo.serviceinfovc2name").getValue();var vc2subcode=Ext.get("Js.Center.Business.ServiceInfo.serviceinfovc2subcode").getValue();var numgwid=Ext.get("Js.Center.Business.ServiceInfo.servicodegwid").getValue();var vc2servicetype=Ext.get("Js.Center.Business.ServiceInfo.stype").getValue();var flag='querychildrenservicecode';Js.Center.Business.ServiceInfo.Infostore.baseParams={numgwid:numgwid,vc2subcode:vc2subcode,vc2name:vc2name,vc2servicetype:vc2servicetype,flag:flag};Js.Center.Business.ServiceInfo.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.Business.ServiceInfo.ServicePanel=new Ext.Panel({id:"Js.Center.Business.ServiceInfo.servicepanel",frame:true,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,serviceGrid]})};GridMain(node,Js.Center.Business.ServiceInfo.ServicePanel,"openroomiconinfo","Js.Center.Business.ServiceInfo.Infostore")};Ext.namespace('Js.Center.Business.SvcBatchUpAndDownInfo');Js.Center.Business.SvcBatchUpAndDownInfo=function(node){if(Ext.get("Js.Center.Business.SvcBatchUpAndDownInfo.servicepanel")==null){var productName="";var productIDS="";var prodIdAndName="";var clientIDS="";var clientName="";var routeIds="";var clientIdAndName="";var isNeedOp=false;Js.Center.Common.ServiceCodeStore.reload();var _pageSize=1000000;var _downFlag="querysvcbatchlist";var _upFlag="querysvcbatchupanddownlist";var downFields=["numprodid","vc2name","numsvcid","vc2svcname","numopid"];var upFields=["numclientid","vc2clientname","numsvcid","vc2svcname","numrouteid"];Js.Center.Business.SvcBatchUpAndDownInfo.DownInfoStore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.SvcBatchURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:downFields,root:"data",id:"numrowasdf",totalProperty:"totalCount"}),listeners:{"load":function(){Js.Center.Business.SvcBatchUpAndDownInfo.UpInfoStore.reload()}},sortInfo:{field:'numprodid',direction:'DESC'},baseParams:{numsvcid:'',flag:_downFlag}});Js.Center.Business.SvcBatchUpAndDownInfo.UpInfoStore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.SvcBatchURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:upFields,root:"data",id:"numrowasdf",totalProperty:"totalCount"}),sortInfo:{field:'numclientid',direction:'DESC'},baseParams:{numsvcid:'',flag:_upFlag}});var downSm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numprodid"});var upSm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numclientid"});var downCm=new Ext.grid.ColumnModel([downSm,{header:"通道组ID",tooltip:"通道组ID",dataIndex:"numprodid",sortable:true},{header:"通道组名称",tooltip:"通道组名称",dataIndex:"vc2name",sortable:true},{header:"通道ID",tooltip:"通道ID",dataIndex:"numsvcid",sortable:true},{header:"通道名称",tooltip:"通道名称",dataIndex:"vc2svcname",sortable:true}]);var upCm=new Ext.grid.ColumnModel([upSm,{header:"客户端ID",tooltip:"客户端ID",dataIndex:"numclientid",sortable:true},{header:"客户端名称",tooltip:"客户端名称",dataIndex:"vc2clientname",sortable:true},{header:"上行路由ID",tooltip:"上行路由ID",dataIndex:"numrouteid",sortable:true},{header:"通道ID",tooltip:"通道ID",dataIndex:"numsvcid",sortable:true},{header:"通道名称",tooltip:"通道名称",dataIndex:"vc2svcname",sortable:true}]);var svcUpdate_arrInitLoadFunc=new Array();svcUpdate_arrInitLoadFunc[0]="Js.Center.Business.UpdateSvcBatch.func";svcUpdate_arrInitLoadFunc[1]="Js.Center.Business.ECservice.func";svcUpdate_arrInitLoadFunc[2]="Js.Center.Business.ECserviceAdd.func";var downGrid=new WXTL.Widgets.CommonGrid.GridPanel({anchor:'100% 100%',pageSize:_pageSize,title:"下 行",store:Js.Center.Business.SvcBatchUpAndDownInfo.DownInfoStore,sm:downSm,cm:downCm,needMenu:false,needPage:false,otherInitLoadFunc:svcUpdate_arrInitLoadFunc});var upGrid=new WXTL.Widgets.CommonGrid.GridPanel({anchor:'100% 100%',pageSize:_pageSize,title:"上  行",store:Js.Center.Business.SvcBatchUpAndDownInfo.UpInfoStore,sm:upSm,cm:upCm,needMenu:false,needPage:false});Js.Center.Business.SvcBatchUpAndDownInfo.SvcStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.SvcBatchURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:['numsvcid','vc2svcname'],root:'data',id:'numsvcid'}),baseParams:{columnlist:'numsvcid,vc2svcname,numopid',flag:'getsvccodebyopidandexistsvcid'}});var submitPanel=new Ext.form.FormPanel({height:80,headerAsText:false,hideCollapseTool:true,buttonAlign:"left",frame:true,items:[{xtype:"hidden",name:"isSupport",value:"1"},{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"70%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:5px 0 5px 5px",items:[{xtype:"xComboBox",name:"numsvcidnew",fieldLabel:"<font color=red>替换通道</font>",hiddenName:"numsvcidnew",readOnly:false,allowBlank:false,mode:"local",displayField:"vc2svcname",valueField:"numsvcid",triggerAction:"all",store:Js.Center.Business.SvcBatchUpAndDownInfo.SvcStore,listeners:{"select":function(){getIsSupportSubCodeBySvcId()}}}]},{columnWidth:.3,layout:'form',defaultType:"textfield",defaults:{anchor:"70%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"panel",html:"<div id=\"Js.Center.Business.SvcBatchUpAndDownInfo.IsSupDiv\"></div>"}]}]}],buttons:[new Ext.Button({text:' 提 交 ',minWidth:100,handler:function(){if(submitPanel.getForm().isValid()&&selectPanel.getForm().isValid()){var downrows=downGrid.getSelectionModel().getSelections();var uprows=upGrid.getSelectionModel().getSelections();if(downrows.length==0&&uprows.length==0){Ext.Msg.alert("提示","请选择一个通道！");return}qenProductIDsAndProductNames();genClientIDsAndClientNames();if(downrows.length>0){Js.Center.Business.SvcBatchUpAndDownInfo.UpdateSvcBatch();}else if(downrows.length==0&&uprows.length>0){Js.Center.Business.SvcBatchUpAndDownInfo.UpdateSvcBatch()}}}})]});function getIsHasNeedOpEcByProdsAndNewSvcId(){Ext.MessageBox.show({msg:'正在验证EC业务，请稍等...',progressText:'Search...',width:300,wait:true,icon:'download',animEl:'saving'});Ext.Ajax.request({url:Js.Center.Business.SvcBatchURL,method:"POST",params:{numsvcidnew:submitPanel.getForm().findField("numsvcidnew").getValue(),productids:productIDS,flag:"ishasneedopecbyprodsandnewsvcid"},success:function(form,action){var objJson=Ext.util.JSON.decode(form.responseText);var flag=objJson.success;if(true==flag){if(objJson.data.length>0){var ecNames="";var ecNameLinks="";for(var i=0;i<objJson.data.length;i++){ecNames+=objJson.data[i].vc2ecname;ecNameLinks+=String.format("<a href=javascript:void(0) onclick=Js.Center.Business.SvcBatchUpAndDownInfo.showEcSvcManaWin('{0}','{1}')>{2}</a>",objJson.data[i].numecid,objJson.data[i].vc2ecid,objJson.data[i].vc2ecname);if(i!=objJson.data.length-1){ecNames+=",";ecNameLinks+=","}}Ext.fly("Js.Center.Business.SvcBatchUpAndDownInfo.EcList.Div").dom.innerHTML=ecNameLinks;ecListWin.show()}else{Js.Center.Business.SvcBatchUpAndDownInfo.UpdateSvcBatch()}}setTimeout(function(){Ext.MessageBox.hide()},100)},failure:function(){Ext.MessageBox.hide();Ext.Msg.alert("温馨提示","系统忙，请稍候...!")}})};function getIsSupportSubCodeBySvcId(){if(submitPanel.getForm().findField("numsvcidnew").getValue()!=""){Ext.MessageBox.show({msg:'正在验证是否支持子号码，请稍等...',progressText:'Search...',width:300,wait:true,icon:'download',animEl:'saving'});Ext.Ajax.request({url:Js.Center.Business.SvcBatchURL,method:"POST",params:{numsvcidnew:submitPanel.getForm().findField("numsvcidnew").getValue(),flag:"getissupportsubcodebysvcid"},success:function(form,action){var objJson=Ext.util.JSON.decode(form.responseText);var flag=objJson.success;if(true==flag){var isSup=objJson.error;if(isSup==0){Ext.fly("Js.Center.Business.SvcBatchUpAndDownInfo.IsSupDiv").dom.innerHTML="<font color=red>提示：当前要替换的通道不支持扩展子号码！</font>";submitPanel.getForm().findField("isSupport").setValue("0")}else{Ext.fly("Js.Center.Business.SvcBatchUpAndDownInfo.IsSupDiv").dom.innerHTML="<font color=green>当前要替换的通道支持扩展子号码！</font>"}}setTimeout(function(){Ext.MessageBox.hide()},1000)},failure:function(){Ext.MessageBox.hide();Ext.Msg.alert("温馨提示","系统忙，请稍候...!")}})}}var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"Js.Center.Business.SvcBatchUpAndDownInfo.servicecodeSelectPanel",height:100,labelWidth:100,needButtons:false,queryMethod:"Js.Center.Business.SvcBatchUpAndDownInfo.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[new WXTL.Widgets.CommonForm.ComboBox({xtype:"xComboBox",name:"numsvcid",fieldLabel:"选择通道",hiddenName:"numsvcid",readOnly:false,allowBlank:false,mode:"local",displayField:"vc2svcname",valueField:"numsvcid",triggerAction:"all",store:Js.Center.Common.ServiceCodeStore,listeners:{"select":function(){submitPanel.getForm().findField("numsvcidnew").clearValue();Ext.fly("Js.Center.Business.SvcBatchUpAndDownInfo.IsSupDiv").dom.innerHTML="";Js.Center.Business.SvcBatchUpAndDownInfo.SvcStore.reload({params:{flag:'getsvccodebyopidandexistsvcid',numsvcid:this.getValue()}})}}})]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"right",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"panel",html:"<a href='#' onclick=\"Ext.Msg.alert('log')\" title='查询详细日志'></a>"}]}]}],buttons:[new Ext.Button({text:' 查 询 ',handler:function(){Js.Center.Business.SvcBatchUpAndDownInfo.queryGrid()}}),new Ext.Button({text:" 重 置 ",handler:function(){selectPanel.getForm().reset();submitPanel.getForm().reset();Ext.fly("Js.Center.Business.SvcBatchUpAndDownInfo.IsSupDiv").dom.innerHTML=""}})]});Js.Center.Business.SvcBatchUpAndDownInfo.queryGrid=function(){if(selectPanel.getForm().isValid()){var _numsvcid=selectPanel.getForm().findField("numsvcid").getValue();Js.Center.Business.SvcBatchUpAndDownInfo.DownInfoStore.baseParams={numsvcid:_numsvcid,flag:_downFlag};Js.Center.Business.SvcBatchUpAndDownInfo.DownInfoStore.load({params:{start:0,limit:_pageSize}});Js.Center.Business.SvcBatchUpAndDownInfo.UpInfoStore.baseParams={numsvcid:_numsvcid,flag:_upFlag};Js.Center.Business.SvcBatchUpAndDownInfo.UpInfoStore.load({params:{start:0,limit:_pageSize}})}};Js.Center.Business.SvcBatchUpAndDownInfo.ServicePanel=new Ext.Panel({id:"Js.Center.Business.SvcBatchUpAndDownInfo.servicepanel",frame:true,bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,downGrid,upGrid,submitPanel]})};function qenProductIDsAndProductNames(){var rows=downGrid.getSelectionModel().getSelections();productName="";productIDS="";prodIdAndName="";if(rows.length==0){return}for(var i=0;i<rows.length;i++){if(rows.length==1){productName=rows[i].data.vc2name;productIDS=rows[i].data.numprodid;prodIdAndName+=rows[i].data.vc2name+"["+rows[i].data.numprodid+"]"}else{if(i<(rows.length-1)){productName=rows[i].data.vc2name+","+productName;productIDS=rows[i].data.numprodid+","+productIDS;prodIdAndName+=rows[i].data.vc2name+"["+rows[i].data.numprodid+"]"+","}if(i==(rows.length-1)){productName=productName+rows[i].data.vc2name;productIDS=productIDS+rows[i].data.numprodid;prodIdAndName+=rows[i].data.vc2name+"["+rows[i].data.numprodid+"]"}}}}function genClientIDsAndClientNames(){var rows=upGrid.getSelectionModel().getSelections();clientName="";clientIDS="";clientIdAndName="";routeIds="";if(rows.length==0){;return}for(var i=0;i<rows.length;i++){if(rows.length==1){clientName=rows[i].data.vc2clientname;clientIDS=rows[i].data.numclientid;clientIdAndName+=rows[i].data.vc2clientname+"["+rows[i].data.numclientid+"]";routeIds+=rows[i].data.numrouteid}else{if(i<(rows.length-1)){clientName+=rows[i].data.vc2clientname+",";clientIDS+=rows[i].data.numclientid+",";clientIdAndName+=rows[i].data.vc2clientname+"["+rows[i].data.numclientid+"]"+",";routeIds+=rows[i].data.numrouteid+","}if(i==(rows.length-1)){clientName+=rows[i].data.vc2clientname;clientIDS+=rows[i].data.numclientid;clientIdAndName+=rows[i].data.vc2clientname+"["+rows[i].data.numclientid+"]";routeIds+=rows[i].data.numrouteid}}}}Js.Center.Business.SvcBatchUpAndDownInfo.UpdateSvcBatch=function(){var jsonData={numsvcid:selectPanel.getForm().findField("numsvcid").getValue(),numsvcname:selectPanel.getForm().findField("numsvcid").getRawValue(),numsvcidnew:submitPanel.getForm().findField("numsvcidnew").getValue(),numsvcnamenew:submitPanel.getForm().findField("numsvcidnew").getRawValue(),productids:productIDS,clientids:clientIDS,prodidandname:prodIdAndName,clientidandname:clientIdAndName,issupport:submitPanel.getForm().findField("isSupport").getValue(),routeids:routeIds};var record=new Ext.data.Record.create([{name:'numsvcid',type:'string'},{name:'numsvcname',type:'string'},{name:'numsvcidnew',type:'string'},{name:'numsvcnamenew',type:'string'},{name:'productids',type:'string'},{name:'clientids',type:'string'},{name:'prodidandname',type:'string'},{name:'clientidandname',type:'string'},{name:'issupport',type:'string'},{name:'routeids',type:'string'}]);var upRecord=new record({});if(jsonData!=null){for(var i=0;i<upRecord.fields.items.length;i++){upRecord.set(upRecord.fields.items[i].name,jsonData[upRecord.fields.items[i].name])}}Js.Center.Business.UpdateSvcBatch.window.updateRecord=upRecord;Js.Center.Business.UpdateSvcBatch.window.mainForm.loadRecord(upRecord);Js.Center.Business.UpdateSvcBatch.window.show()};var ecListWin=new WXTL.Widgets.CommonWindows.Window({title:"需要手动配置EC业务的EC",width:400,height:300,autoScroll:true,frame:true,updateState:true,needLoadDataStore:false,needButtons:false,items:[{xtype:"panel",width:"100%",height:"100%",name:"eclist",id:"Js.Center.Business.SvcBatchUpAndDownInfo.EcList",html:"<div id=Js.Center.Business.SvcBatchUpAndDownInfo.EcList.Div></div>"}],buttons:[{text:"关  闭",minWidth:70,handler:function(){ecListWin.hide()}}]});Js.Center.Business.SvcBatchUpAndDownInfo.showEcSvcManaWin=function(numecid,vc2ecid){var svcRecord=new Ext.data.Record.create([{name:'numecid',type:'string'},{name:'vc2ecid',type:'string'}]);var row=new svcRecord({});row.set("numecid",numecid);row.set("vc2ecid",vc2ecid);Js.Center.Business.ECservice.window.updateRecord=row;Js.Center.Business.ECservice.window.show();Ext.apply(Js.Center.Business.ECservice.Infostore.baseParams,{ecId:numecid,flag:'selectbykey'});Js.Center.Business.ECservice.Infostore.load({params:{start:0,limit:12,ecId:numecid,flag:'selectbykey'}})};GridMain(node,Js.Center.Business.SvcBatchUpAndDownInfo.ServicePanel,"openroomiconinfo","Js.Center.Business.SvcBatchUpAndDownInfo.DownInfoStore")};Ext.namespace('Js.Center.Business.UpdateSvcBatch');Js.Center.Business.UpdateSvcBatch.func=function(){if(Js.Center.Business.UpdateSvcBatch.window==null){var svcBatchPanel=new Ext.form.FormPanel({frame:true,labelWidth:80,defaults:{anchor:'100%',msgTarget:'side'},bodyBorder:false,border:false,autoScroll:true,items:[{xtype:"hidden",name:"flag",value:"svcbatchupdate"},{xtype:"hidden",name:"numsvcid"},{xtype:"hidden",name:"productids"},{xtype:"hidden",name:"numsvcidnew"},{xtype:"hidden",name:"clientids"},{xtype:"hidden",name:"issupport"},{xtype:"hidden",name:"routeids"},{layout:'column',items:[{columnWidth:.99,layout:'form',defaultType:"textfield",buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",bodyBorder:false,border:false,defaults:{anchor:"90%",msgTarget:"side"},items:[{xtype:"textfield",name:"numsvcname",fieldLabel:"通道名称",disabled:true},{xtype:"textfield",name:"numsvcnamenew",fieldLabel:"替换通道",disabled:true},{xtype:"textarea",name:"prodidandname",fieldLabel:"选择的通道组",height:100,disabled:true},{xtype:"textarea",name:"clientidandname",fieldLabel:"选择的客户端",height:100,disabled:true},{xtype:"textarea",name:"remark",fieldLabel:"<font color=red>备注</font>",minLength:20,maxLength:200,allowBlank:false,height:100}]}]}]});function exeUpdateSvcBatch(){Js.Center.Business.UpdateSvcBatch.window.mainFormSubmitFunc();Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000)}var mainForm=svcBatchPanel.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"通道批量替换",width:700,height:470,autoScroll:true,frame:true,mainForm:mainForm,updateState:true,needLoadDataStore:false,updateURL:Js.Center.Business.SvcBatchURL,displayStore:Js.Center.Business.SvcBatchUpAndDownInfo.DownInfoStore,items:[svcBatchPanel],needButtons:false,buttons:[new Ext.Button({text:'确定',minWidth:70,handler:function(){if(svcBatchPanel.getForm().isValid()){Ext.Msg.confirm("批量替换提示！","您确定要批量替换当前选择的通道吗?",function(btn){if(btn=="yes"){exeUpdateSvcBatch()}})}}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){Js.Center.Business.UpdateSvcBatch.window.hide()}})]})}};Ext.namespace('Js.Center.Business');Js.Center.Business.ServiceCodeURL='URL/business/servicecode/servicecodeyxt.ashx';Js.Center.Business.ServiceCodeByGatewayURL='URL/system/gateway/gatewayqueryyxt.ashx';Js.Center.Business.ServiceCodeUpdateURL='URL/business/servicecode/servicecodeyxt.ashx';Js.Center.Business.ServiceURL='URL/business/servicecode/servicecodeyxt.ashx';Js.Center.Business.SvcBatchURL="URL/business/servicecode/svcbatchyxt.ashx";