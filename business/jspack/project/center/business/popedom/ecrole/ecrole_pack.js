Ext.namespace('Js.Center.Popedom.ECRole');Js.Center.Popedom.ECRoleURL='URL/ECRole/ECRole.ashx';Js.Center.Popedom.ECQueryURL='URL/Business/ECmanage/EcListQuery.ashx';Ext.namespace('Js.Center.Popedom.ECRoleAdd');Js.Center.Popedom.ECRoleAdd.func=function(){var ECList;var addInfoFormPanel=new Ext.form.FormPanel({frame:true,labelWidth:80,items:[{layout:'column',items:[{columnWidth:.6,layout:'form',defaults:{anchor:"95%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0px 0 0px 15px",items:[{xtype:"hidden",name:"flag",value:"insert"},{xtype:"textfield",name:"vc2rolename",fieldLabel:"<font color=red>角色名称</font>",allowBlank:false,blankText:"角色名称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50},{xtype:"textfield",name:"vc2roledesc",width:.5,fieldLabel:"备注",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50}]},{columnWidth:1,layout:'form',defaults:{anchor:"95%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0px 0 0px 15px",items:[{xtype:"textfield",fieldLabel:"选择EC",hidden:true},{html:'<div id="Js.Center.Popedom.ECRoleAdd.ECPanelFieldSet" style="float:left;margin:0px;border:1px solid #c3daf9;width:95%;height:270px;"></div>'}]}]}]});var mainForm=addInfoFormPanel.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加角色",width:'700',mainForm:mainForm,updateURL:Js.Center.Popedom.ECRoleURL,displayStore:Js.Center.Popedom.ECRoleInfo.Infostore,items:[addInfoFormPanel],needButtons:false,needLoadDataStore:true,buttons:[new Ext.Button({text:'保存退出',minWidth:70,qtip:"保存退出",handler:function(){var ecIds='';for(var i=0;i<ECList.getValue().length;i++){var ecId=ECList.getValue()[i];if(ecId){if(ecIds.length==0){ecIds+=ecId}else{ecIds+=','+ecId}}}if(ecIds.length==0){Ext.Msg.alert("温馨提示","请选择授权EC!");return}else if(mainForm.isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.Popedom.ECRoleAdd.window.mainFormSubmitFunc()}}}),new Ext.Button({text:'重置',qtip:"重置",minWidth:70,handler:function(){addInfoFormPanel.getForm().reset();ECList.reset()}}),new Ext.Button({text:'关闭',qtip:"关闭",minWidth:70,handler:function(){Js.Center.Popedom.ECRoleAdd.window.hide()}})],loadDataStoreFunc:function(){initEcList()}});function initEcList(){document.getElementById('Js.Center.Popedom.ECRoleAdd.ECPanelFieldSet').innerHTML='';Ext.get('Js.Center.Popedom.ECRoleAdd.ECPanelFieldSet').dom.innerHTML='';ECList=new WXTL.Widgets.CommonForm.CheckboxGroup.RemoteCheckboxGroup({url:Js.Center.Popedom.ECQueryURL,queryparams:'flag=queryec',requestname:'ecids',defaultsItemsName:'ecids',defaultsItemsboxLable:'对不起，没有相关EC信息。',numcolumns:6,messageID:1,reader:new Ext.data.JsonReader({totalProperty:'totalProperty',root:'data',fields:[{name:'id'},{name:'name'},{name:'boxLabel',mapping:"vc2ecname"},{name:'inputValue',mapping:"numecid"},{name:'checked'}]})});var ecGroupPanel=new Ext.Panel({style:'padding:0 0 0 5px',autoHeight:true,width:600,items:[{items:[ECList]}]});ecGroupPanel.doLayout();ecGroupPanelFieldSet=new Ext.Panel({applyTo:'Js.Center.Popedom.ECRoleAdd.ECPanelFieldSet',title:'EC',width:630,autoScroll:true,items:[ecGroupPanel]})}};Ext.namespace('Js.Center.Popedom.ECRoleDelete');Js.Center.Popedom.ECRoleDelete.func=function(row){var deleteSplit="";for(var i=0;i<row.length;i++){if(row.length==1){deleteSplit=row[i].data.numroleid}else{if(i<(row.length-1)){deleteSplit=row[i].data.numroleid+","+deleteSplit}if(i==(row.length-1)){deleteSplit=deleteSplit+row[i].data.numroleid}}};var params={ids:deleteSplit,flag:"delete"};doAjax(Js.Center.Popedom.ECRoleURL,params,Js.Center.Popedom.ECRoleInfo.Infostore)};Ext.namespace('Js.Center.Popedom.ECRoleInfo');Js.Center.Popedom.ECRoleInfo.info=function(node){if(Ext.get("Js.Center.Popedom.ECRoleInfo.MainPanel")==null){ecRoleUpdate=function(rowIndex){var row=ecRoleGrid.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("温馨提示","请您选择一条记录!")}else{if(row.length>1){Ext.Msg.alert("温馨提示","对不起，您只能选择一条记录!")}else{if(row.length==1){Js.Center.Popedom.ECRoleUpdate.window.updateRecord=row[0];Js.Center.Popedom.ECRoleUpdate.window.mainForm.loadRecord(row[0]);Js.Center.Popedom.ECRoleUpdate.window.show()}}}};ecRoleDelete=function(rowIndex){var row=ecRoleGrid.getSelectionModel().getSelections();if(row.length>1){Ext.Msg.alert("提示信息","您只能选择一个删除!")}else if(row.length==1){Ext.Msg.confirm("提示!","您确定要删除信息吗?",function(btn){if(btn=="yes"){Js.Center.Popedom.ECRoleDelete.func(row)}})}};roleArrayDelete=function(){var row=ecRoleGrid.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("提示信息","请您至少选择一个!")}else{Ext.Msg.confirm("提示!","您确定要删除信息吗?",function(btn){if(btn=="yes"){Js.Center.Popedom.ECRoleDelete.func(row)}})}};var _pageSize=12;var fields=["numroleid","vc2rolename","numdepartid","vc2departname","vc2roledesc","numrolestate","numcreator","vc2creatorname","datcreatetime","numlastmodifyuser","vc2lastmodifyname","datlastmodifytime"];Js.Center.Popedom.ECRoleInfo.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Popedom.ECRoleURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numroleid",totalProperty:"totalCount"}),sortInfo:{field:'datcreatetime',direction:'DESC'},baseParams:{rolename:'',limit:_pageSize,flag:'selectbykey'}});Js.Center.Popedom.ECRoleInfo.Infostore.load({params:{start:0,limit:_pageSize,rolename:'',flag:'selectbykey'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numroleid"});var cm=new Ext.grid.ColumnModel([sm,{header:"序号",tooltip:"序号",dataIndex:"numroleid",sortable:true},{header:"角色名称",tooltip:"角色名称",dataIndex:"vc2rolename",sortable:true},{header:"创建部门",tooltip:"创建部门",dataIndex:"vc2departname",sortable:true},{header:"创建者",tooltip:"创建者",dataIndex:"vc2creatorname",sortable:true},{header:"创建时间",tooltip:"创建时间",dataIndex:"datcreatetime",sortable:true},{header:"修改人",tooltip:"修改人",dataIndex:"vc2lastmodifyname",sortable:true},{header:"修改时间",tooltip:"修改时间",dataIndex:"datlastmodifytime",sortable:true},{header:"备注",tooltip:"备注",dataIndex:"vc2roledesc",sortable:true},{header:"角色操作",tooltip:"角色操作",dataIndex:"numroleid",renderer:function(value,meta,record,rowIndex,colIndex,store){return"<a href='#' onclick='ecRoleUpdate(\""+rowIndex+"\")'>修改</a>　<a href='#' onclick='ecRoleDelete(\""+rowIndex+"\")'>删除</a>"}}]);var ecRoleGrid=new WXTL.Widgets.CommonGrid.GridPanel({anchor:'100% 100%',pageSize:_pageSize,needMenu:false,needRightMenu:false,store:Js.Center.Popedom.ECRoleInfo.Infostore,afterEditURL:Js.Center.Popedom.ECRoleURL,inertMethod:'Js.Center.Popedom.ECRoleAdd',updateMethod:'Js.Center.Popedom.ECRoleUpdate',deleteMethod:'Js.Center.Popedom.ECRoleDelete.func',sm:sm,cm:cm,tbar:new Ext.Toolbar({items:[{iconCls:'addicon',text:"添加角色",tooltip:"添加角色",handler:function(){ecRoleGrid.doInsert()}},"","-","",{text:"删除",tooltip:"删除",iconCls:"deleteicon",handler:function(){ecRoleGrid.doDelete()}}]})});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({id:"Js.Center.Popedom.ECRoleInfo.selectPanel",height:100,queryMethod:"Js.Center.Popedom.ECRoleInfo.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:'90%',msgTarget:"side"},items:[{fieldLabel:'角色名称',name:'rolename',id:'Js.Center.Popedom.ECRoleInfo.RoleName',regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50}]}]}]});Js.Center.Popedom.ECRoleInfo.queryGrid=function(){if(selectPanel.getForm().isValid()){var _roleName=Ext.get("Js.Center.Popedom.ECRoleInfo.RoleName").getValue();var _flag='selectbykey';Js.Center.Popedom.ECRoleInfo.Infostore.baseParams={rolename:_roleName,flag:_flag};Js.Center.Popedom.ECRoleInfo.Infostore.load({params:{start:0,limit:_pageSize,rolename:_roleName,flag:_flag}})}};Js.Center.Popedom.ECRoleInfo.MainPanel=new Ext.Panel({frame:true,id:"Js.Center.Popedom.ECRoleInfo.MainPanel",bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,ecRoleGrid]})};GridMain(node,Js.Center.Popedom.ECRoleInfo.MainPanel,"openroomiconinfo","Js.Center.Popedom.ECRoleInfo.Infostore")};Ext.namespace('Js.Center.Popedom.ECRoleUpdate');Js.Center.Popedom.ECRoleUpdate.func=function(row){var ECList;var updateInfoFormPanel=new Ext.form.FormPanel({frame:true,labelWidth:80,items:[{layout:'column',items:[{columnWidth:.6,layout:'form',defaults:{anchor:"95%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0px 0 0px 15px",items:[{xtype:"hidden",name:"flag",value:"update"},{xtype:"hidden",id:'Js.Center.Popedom.ECRoleUpdate.roleId',name:"roleId"},{xtype:"textfield",name:"vc2rolename",fieldLabel:"<font color=red>角色名称</font>",allowBlank:false,blankText:"角色名称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50},{xtype:"textfield",name:"vc2roledesc",width:.5,fieldLabel:"备注",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50}]},{columnWidth:1,layout:'form',defaults:{anchor:"95%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0px 0 0px 15px",items:[{xtype:"textfield",fieldLabel:"选择EC",hidden:true},{html:'<div id="Js.Center.Popedom.ECRoleUpdate.ECPanelFieldSet" style="float:left;margin:0px;border:1px solid #c3daf9;width:95%;height:270px;"></div>'}]}]}]});var mainForm=updateInfoFormPanel.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加角色",width:'700',mainForm:mainForm,updateURL:Js.Center.Popedom.ECRoleURL,displayStore:Js.Center.Popedom.ECRoleInfo.Infostore,updateState:true,updateRecord:row,items:[updateInfoFormPanel],needButtons:false,needLoadDataStore:true,buttons:[new Ext.Button({text:'保存退出',minWidth:70,qtip:"保存退出",handler:function(){var roleId=Js.Center.Popedom.ECRoleUpdate.window.updateRecord.get("numroleid");Ext.getCmp("Js.Center.Popedom.ECRoleUpdate.roleId").setValue(roleId);var ecIds='';for(var i=0;i<ECList.getValue().length;i++){var ecId=ECList.getValue()[i];if(ecId){if(ecIds.length==0){ecIds+=ecId}else{ecIds+=','+ecId}}}if(ecIds.length==0){Ext.Msg.alert("温馨提示","请选择授权EC!");return}else if(mainForm.isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);Js.Center.Popedom.ECRoleUpdate.window.mainFormSubmitFunc()}}}),new Ext.Button({text:'重置',qtip:"重置",minWidth:70,handler:function(){updateInfoFormPanel.getForm().loadRecord(Js.Center.Popedom.ECRoleUpdate.window.updateRecord);ECList.reset()}}),new Ext.Button({text:'关闭',qtip:"关闭",minWidth:70,handler:function(){Js.Center.Popedom.ECRoleUpdate.window.hide()}})],loadDataStoreFunc:function(){initEcList()}});function initEcList(){document.getElementById('Js.Center.Popedom.ECRoleUpdate.ECPanelFieldSet').innerHTML='';Ext.get('Js.Center.Popedom.ECRoleUpdate.ECPanelFieldSet').dom.innerHTML='';ECList=new WXTL.Widgets.CommonForm.CheckboxGroup.RemoteCheckboxGroup({url:Js.Center.Popedom.ECQueryURL,queryparams:'flag=queryecByRole&roleId='+Js.Center.Popedom.ECRoleUpdate.window.updateRecord.get("numroleid"),requestname:'ecids',defaultsItemsName:'ecids',defaultsItemsboxLable:'对不起，没有相关EC信息。',numcolumns:6,messageID:1,reader:new Ext.data.JsonReader({totalProperty:'totalProperty',root:'data',fields:[{name:'id'},{name:'name'},{name:'boxLabel',mapping:"vc2ecname"},{name:'inputValue',mapping:"numecid"},{name:'checked',mapping:"checked"}]})});var ecGroupPanel=new Ext.Panel({style:'padding:0 0 0 5px',autoHeight:true,width:600,items:[{items:[ECList]}]});ecGroupPanel.doLayout();ecGroupPanelFieldSet=new Ext.Panel({applyTo:'Js.Center.Popedom.ECRoleUpdate.ECPanelFieldSet',title:'EC',width:630,autoScroll:true,items:[ecGroupPanel]})}};