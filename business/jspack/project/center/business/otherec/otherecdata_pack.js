Ext.namespace('Js.Center.OtherEC');Js.Center.OtherEC.OtherDataURL='URL/Business/OtherEC/OtherData.ashx';Js.Center.OtherEC.OtherECURL='URL/Business/OtherEC/tlotherecinfo.ashx';Ext.namespace('Js.Center.OtherEC.OtherDataImport');Ext.QuickTips.init();Js.Center.OtherEC.OtherDataImport.func=function(){if(Js.Center.OtherEC.OtherDataImport.window==null){var ImportOtherDataInfofp=new Ext.form.FormPanel({fileUpload:true,frame:true,labelWidth:80,layout:'form',defaults:{anchor:"90%",msgTarget:"side"},items:[{xtype:"hidden",name:"flag",value:"importotherdata"},{xtype:'fileuploadfield',name:'filepath',id:'Js.Center.OtherEC.OtherDataImport.filepath',fieldLabel:getHelpMsg("文件",true,'1、文件格式为xls,xlsx<br>2、文件大小须小于4M<br>3、各单元格格式必须为文本<br/> 4、内容格式:　<img src=jspack/project/common/Images/help/otherdatafile.jpg align=top/>'),allowBlank:false,blankText:"请选择上传文件",validator:function(){var filePath=this.getValue();if(filePath!=''){ImportOtherDataInfofp.getForm().items.items[2].el.dom.value=getFileMessage(filePath);var endWith=filePath.substring(filePath.lastIndexOf("."));if(".xls"==endWith||".xlsx"==endWith){return true}else{this.invalidText="文件格式应为xls,xlsx";return false}}else return false}},{xtype:'textarea',name:'filemessage',fieldLabel:'文件信息',readOnly:true,width:500,height:180}]});var mainForm=ImportOtherDataInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"导入其他平台数据",mainForm:mainForm,items:[ImportOtherDataInfofp],needButtons:false,buttons:[new Ext.Button({text:'确定',minWidth:70,qtip:"确定",handler:function(){if(mainForm.isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},300000);mainForm.submit({url:Js.Center.OtherEC.OtherDataURL,method:"POST",success:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);var falg=objJson.success;if(falg==true){Ext.Msg.alert("温馨提示",objJson.error);ImportOtherDataInfofp.getForm().items.items[1].el.dom.value="";ImportOtherDataInfofp.getForm().items.items[2].el.dom.value="";Js.Center.OtherEC.OtherData.OtherDatastore.reload()}else{Ext.Msg.alert('温馨提示',objJson.info)}},failure:function(form,action){var objJson=Ext.util.JSON.decode(action.response.responseText);Ext.Msg.alert('温馨提示',objJson.info)}})}}}),new Ext.Button({text:'重置',minWidth:70,qtip:"重置数据",handler:function(){mainForm.reset()}}),new Ext.Button({text:'取消',minWidth:70,handler:function(){Js.Center.OtherEC.OtherDataImport.window.hide()}})]})}};Ext.namespace('Js.Center.OtherEC.OtherData');Js.Center.OtherEC.OtherData.info=function(node){if(Ext.get("Js.Center.OtherEC.OtherData.OtherDataPanel")==null){Js.Center.Common.OperatorStore.reload();otherDataUpdate=function(rowIndex){var row=Js.Center.OtherEC.OtherData.OtherDatastore.getAt(rowIndex);Js.Center.OtherEC.OtherDataUpdate.window.updateRecord=row;Js.Center.OtherEC.OtherDataUpdate.window.show();Js.Center.OtherEC.OtherDataUpdate.window.mainForm.loadRecord(row)};otherDataImport=function(){Js.Center.OtherEC.OtherDataImport.window.show()};var _pageSize=12;var fields=["vc2month","vc2shortname","vc2ecid","vc2servcode","numopid","vc2name","numsvctype","vc2svctype","nummtcnt"];Js.Center.OtherEC.OtherData.OtherDatastore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.OtherEC.OtherDataURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numrowasdf",totalProperty:"totalCount"}),baseParams:{startdate:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),enddate:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),ecname:'',servicecode:'',servicetype:'',operatortype:'',flag:'otherdataquery'},sortInfo:{field:'vc2month',direction:'DESC'}});Js.Center.OtherEC.OtherData.OtherDatastore.load({params:{start:0,limit:_pageSize,flag:'otherdataquery'}});var opidComboxQuery=new WXTL.Widgets.CommonForm.ComboBox({name:"operatortype",hiddenName:"numopida",emptyText:"-=请选择=-",fieldLabel:"运营商",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numopid",triggerAction:"all",store:Js.Center.Common.OperatorStore});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"vc2month"});var cm=new Ext.grid.ColumnModel([{header:"账期",tooltip:"账期",dataIndex:"vc2month",sortable:true},{header:"客户名称",tooltip:"客户名称",dataIndex:"vc2shortname",sortable:true},{header:"客户ID",tooltip:"客户ID",dataIndex:"vc2ecid",sortable:true},{header:"服务代码",tooltip:"服务代码",dataIndex:"vc2servcode",sortable:true},{header:"运营商",tooltip:"运营商",dataIndex:"vc2name",sortable:true},{header:"短彩类型",tooltip:"短彩类型",dataIndex:"vc2svctype",sortable:true},{header:"发送量",tooltip:"发送量",dataIndex:"nummtcnt",sortable:true},{header:"操作",tooltip:"操作",dataIndex:"nummtcnt",renderer:function(value,meta,record,rowIndex,colIndex,store){return"<a href='#' onclick='otherDataUpdate(\""+rowIndex+"\")'>修改</a>"}}]);var queryStartDate=new Ext.form.DateField({fieldLabel:"开始时间",format:'Y-m',labelWidth:100,bodyStyle:'padding:5px 5px 0',readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m'),fieldLabel:"开始时间",name:"startdate",id:"startdate",validateOnBlur:false,validator:function(){var strat_time=Ext.get("startdate").dom.value;var end_time=Ext.get("enddate").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'});var queryEndDate=new Ext.form.DateField({fieldLabel:"结束时间",format:'Y-m',labelWidth:100,bodyStyle:'padding:5px 5px 0',readOnly:true,emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m'),fieldLabel:"结束时间",name:"enddate",id:"enddate",validateOnBlur:false,validator:function(){var strat_time=Ext.get("startdate").dom.value;var end_time=Ext.get("enddate").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'});var ContentSelectPanelQuery=new WXTL.Widgets.CommonPanel.QueryFormPanel({height:160,queryMethod:"Js.Center.OtherEC.OtherData.OtherDataMainGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[queryStartDate,{xtype:"textfield",name:"ecname",id:"ecname",fieldLabel:"客户名称",maxLength:10,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText},opidComboxQuery]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[queryEndDate,{xtype:"textfield",name:"servicecode",id:"servicecode",fieldLabel:"服务代码",maxLength:10,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText},{xtype:"combo",name:"servicetype",id:"servicetype",fieldLabel:"短彩类型",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["短信","1"],["彩信","2"]]})}]}]}]});Js.Center.OtherEC.OtherData.OtherDataMainGrid=function(){if(ContentSelectPanelQuery.getForm().isValid()){var startdate=Ext.get("startdate").dom.value;var enddate=Ext.get("enddate").dom.value;var ecname=Ext.getCmp("ecname").getValue();var servicecode=Ext.getCmp("servicecode").getValue();var servicetype=Ext.getCmp("servicetype").getValue();var operatortype=opidComboxQuery.getValue();var flag='otherdataquery';Js.Center.OtherEC.OtherData.OtherDatastore.baseParams={startdate:startdate,enddate:enddate,ecname:ecname,servicecode:servicecode,servicetype:servicetype,operatortype:operatortype,flag:flag};Js.Center.OtherEC.OtherData.OtherDatastore.load({params:{start:0,limit:_pageSize}})}};var OtherDataImportarrInitLoadFunc=new Array();OtherDataImportarrInitLoadFunc[0]="Js.Center.OtherEC.OtherDataImport.func";OtherDataImportarrInitLoadFunc[1]="Js.Center.OtherEC.OtherDataUpdate.func";var OtherDataInfoGrid=new WXTL.Widgets.CommonGrid.GridPanel({anchor:'100% 100%',pageSize:_pageSize,needMenu:false,store:Js.Center.OtherEC.OtherData.OtherDatastore,otherInitLoadFunc:OtherDataImportarrInitLoadFunc,sm:sm,cm:cm,tbar:new Ext.Toolbar({items:[{iconCls:'exporticon',text:"数据导入",handler:otherDataImport},"","-","",{iconCls:'exporticon',text:"数据导出",handler:function(){var startdate=Ext.get("startdate").dom.value;var enddate=Ext.get("enddate").dom.value;var ecname=encodeURI(Ext.getCmp("ecname").getValue());var servicecode=Ext.getCmp("servicecode").getValue();var servicetype=Ext.getCmp("servicetype").getValue();var operatortype=opidComboxQuery.getValue();windowOpen(Js.Center.OtherEC.OtherDataURL+"?"+"flag=exportotherdata&startdate="+startdate+"&enddate="+enddate+"&ecname="+ecname+"&servicecode="+servicecode+"&servicetype="+servicetype+"&operatortype="+operatortype,400,300)}}]})});Js.Center.OtherEC.OtherData.OtherDataPanel=new Ext.Panel({frame:true,id:"Js.Center.OtherEC.OtherData.OtherDataPanel",bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[ContentSelectPanelQuery,OtherDataInfoGrid]})};GridMain(node,Js.Center.OtherEC.OtherData.OtherDataPanel,"openroomiconinfo","Js.Center.OtherEC.OtherData.OtherDatastore")};Ext.namespace('Js.Center.OtherEC.OtherDataUpdate');Js.Center.OtherEC.OtherDataUpdate.func=function(row){var updateInfoFormPanel=new Ext.form.FormPanel({plain:true,layout:"form",labelWidth:80,defaults:{anchor:"95%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",bodyBorder:false,border:false,items:[{xtype:"hidden",name:"flag",value:"updateotherdata"},{xtype:"hidden",name:"numsvctype"},{xtype:"hidden",name:"numopid"},{xtype:"textfield",name:"vc2month",fieldLabel:"账期",blankText:"账期",readOnly:true},{xtype:"textfield",name:"vc2ecid",fieldLabel:"客户id",blankText:"客户id",readOnly:true},{xtype:"textfield",name:"vc2servcode",fieldLabel:"服务代码",blankText:"服务代码",readOnly:true},{xtype:"textfield",name:"vc2svctype",fieldLabel:"短彩类型",readOnly:true},{xtype:"textfield",name:"vc2name",fieldLabel:"运营商",readOnly:true},{xtype:"textfield",name:"nummtcnt",fieldLabel:"<font color=red>发送量<font>",regex:WXTL.Common.regex.Integer,regexText:"只能输入数字",allowBlank:false,maxLength:9,maxLengthText:'长度不能超过9'}]});var mainForm=updateInfoFormPanel.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({width:400,title:"修改其他平台数据",mainForm:mainForm,updateURL:Js.Center.OtherEC.OtherDataURL,displayStore:Js.Center.OtherEC.OtherData.OtherDatastore,updateState:true,updateRecord:row,items:[updateInfoFormPanel]})};