Ext.namespace('Js.Center.Business.ECmanage');Js.Center.Business.ECmanage.EcQueryURL='URL/Business/ECmanage/EcListQuery.ashx';Js.Center.Business.ECmanage.EcUpdateURL='URL/Business/ECmanage/EcUpdate.ashx';Js.Center.Business.ECmanage.ECsvcInfoURL='URL/Business/ECservice/EcServiceInfo.ashx';Js.Center.Business.ECmanage.ECsvcDeleteURL='URL/Business/ECservice/EcServiceDelete.ashx';Js.Center.Business.ECmanage.ECsvcUpdateURL='URL/Business/ECmanage/EcServiceUpdate.ashx';Js.Center.Business.ECmanage.ECSigntureURL='URL/Business/ECmanage/EcSignture.ashx';Ext.namespace('Js.Center.Business.ECmanage.EcAdd');Ext.QuickTips.init();Js.Center.Business.ECmanage.EcAdd.func=function(){var AreaCombox=new WXTL.Widgets.CommonForm.ComboBox({xtype:"xComboBox",name:"vc2area",hiddenName:"vc2area",emptyText:"-=请选择=-",allowBlank:false,blankText:"请选择地区",fieldLabel:"<font color=red>地区</font>",readOnly:true,mode:"local",displayField:"vc2branchcompany",valueField:"numbranchcompany",triggerAction:"all",store:Js.Center.Common.BranchCompanyStore});Js.Center.Common.BranchCompanyStore.reload();var IndustryCombox=new WXTL.Widgets.CommonForm.ComboBox({xtype:"xComboBox",name:"numindustry",hiddenName:"numindustry",emptyText:"-=请选择=-",allowBlank:false,blankText:"请选择行业",fieldLabel:"<font color=red>行业</font>",readOnly:true,mode:"local",displayField:"vc2industry",valueField:"numindustry",triggerAction:"all",store:Js.Center.Common.IndustryStore});Js.Center.Common.IndustryStore.reload();var updateInfofp=new Ext.form.FormPanel({fileUpload:true,frame:true,labelWidth:80,defaults:{anchor:'100%',msgTarget:'side'},bodyBorder:false,border:false,autoScroll:true,items:[{xtype:"hidden",name:"flag",value:"insert"},{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",bodyBorder:false,border:false,defaults:{anchor:"90%",msgTarget:"side"},items:[{xtype:"textfield",name:"vc2fullname",fieldLabel:"<font color=red>客户全称</font>",allowBlank:false,blankText:"客户全称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:25,maxLengthText:'长度不能超过25'},{xtype:"combo",name:"numismas",hiddenName:"numismas",fieldLabel:"<font color=red>MAS客户</font>",readOnly:true,mode:"local",allowBlank:false,displayField:"show",valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["是","1"],["否","2"]]})},{xtype:"combo",name:"numcustype",hiddenName:"numcustype",fieldLabel:"<font color=red>客户类型</font>",readOnly:true,mode:"local",allowBlank:false,displayField:"show",valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["渠道","1"],["直客","2"],["内部","3"]]})},{xtype:"combo",name:"numlevel",hiddenName:"numlevel",fieldLabel:"<font color=red>级别</font>",readOnly:true,mode:"local",displayField:"show",allowBlank:false,valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["1","1"],["2","2"],["3","3"]]})},{xtype:"combo",name:"numsvctype",hiddenName:"numsvctype",fieldLabel:"<font color=red>通道类型</font>",readOnly:true,mode:"local",displayField:"show",allowBlank:false,valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["短信","1"],["彩信","2"],["短彩信","3"]]})},{xtype:"combo",name:"numstatus",hiddenName:"numstatus",fieldLabel:"<font color=red>状态</font>",readOnly:true,mode:"local",displayField:"show",allowBlank:false,valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["商用","1"],["暂停","2"]]})},{xtype:"textfield",name:"vc2conperson",fieldLabel:"联系人",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:15,maxLengthText:'长度不能超过15'},{xtype:"xComboBox",name:"numsigntypeid",hiddenName:"numsigntypeid",fieldLabel:"<font color=red>签名类型</font>",readOnly:true,mode:"local",allowBlank:false,displayField:"vc2typename",valueField:"numtypeid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.EcSignTypeStore}]},{columnWidth:.5,layout:'form',defaultType:"textfield",buttonAlign:"center",bodyBorder:false,border:false,bodyStyle:"padding:10px 0 10px 15px",defaults:{anchor:"90%",msgTarget:"side"},items:[{xtype:"textfield",name:"vc2ecname",fieldLabel:"<font color=red>客户简称</font>",allowBlank:false,blankText:"客户简称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:25,maxLengthText:'长度不能超过25'},IndustryCombox,AreaCombox,{xtype:"textfield",name:"vc2manager",fieldLabel:"<font color=red>商务经理</font>",allowBlank:false,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:15,maxLengthText:'长度不能超过15'},{xtype:"combo",name:"vc2chargetype",hiddenName:"vc2chargetype",fieldLabel:"<font color=red>付费类型</font>",readOnly:true,mode:"local",displayField:"show",allowBlank:false,valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["预付费","1"],["后付费","2"]]})},{xtype:"textfield",name:"numlimited",fieldLabel:"<font color=red>条数限制</font>",regex:WXTL.Common.regex.Integer,regexText:"只能输入数字",allowBlank:false,maxLength:9,maxLengthText:'长度不能超过9'},{xtype:"textfield",name:"vc2contact",fieldLabel:"联系方式",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:50,maxLengthText:'长度不能超过50'}]}]},{columnWidth:1,layout:'form',defaultType:"textfield",buttonAlign:"center",bodyBorder:false,border:false,bodyStyle:"padding:0px 0 10px 15px",defaults:{anchor:"90%",msgTarget:"side"},items:[{name:"oapicfile",id:'Js.Center.Business.ECmanage.EcAdd.VC2OAPIC',xtype:'fileuploadfield',style:'border: 1px solid #C0C0C0;height:22;cursor:hand',fieldLabel:getHelpMsg("文件",false,"1、文件格式为jpg/gif/png/bmp等图片"),allowBlank:true,blankText:"请选择上传文件",width:400,validator:function(){var filePath=Ext.getCmp("Js.Center.Business.ECmanage.EcAdd.VC2OAPIC").getValue();var fileTypeArr1=new Array();fileTypeArr1[0]="jpg";fileTypeArr1[1]="gif";fileTypeArr1[2]="png";fileTypeArr1[3]="bmp";var fileTypeArrDesc1="jpg,gif,png,bmp";if(filePath!=''){if(checkFileWithTypeArr(filePath,fileTypeArr1,fileTypeArrDesc1)!=''){this.invalidText=checkFileWithTypeArr(filePath,fileTypeArr1,fileTypeArrDesc1);return false}else{return true}}else{return false}}}]}]});var mainForm=updateInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"添加新EC客户",mainForm:mainForm,updateURL:Js.Center.Business.ECmanage.EcUpdateURL,displayStore:Js.Center.Business.ECmanage.Infostore,items:[updateInfofp]})};Ext.namespace('Js.Center.Business.ECmanageDetail');Js.Center.Business.ECmanageDetail.func=function(){if(Js.Center.Business.ECmanageDetail.window==null){var AreaCombox=new WXTL.Widgets.CommonForm.ComboBox({xtype:"xComboBox",name:"vc2area",hiddenName:"vc2area",emptyText:"-=请选择=-",allowBlank:false,blankText:"请选择地区",fieldLabel:"<font color=red>地区</font>",disabled:true,mode:"local",displayField:"vc2branchcompany",valueField:"numbranchcompany",triggerAction:"all",store:Js.Center.Common.BranchCompanyStore});Js.Center.Common.BranchCompanyStore.reload();var IndustryCombox=new WXTL.Widgets.CommonForm.ComboBox({xtype:"xComboBox",name:"numindustry",hiddenName:"numindustry",emptyText:"-=请选择=-",allowBlank:false,blankText:"请选择行业",fieldLabel:"<font color=red>行业</font>",disabled:true,mode:"local",displayField:"vc2industry",valueField:"numindustry",triggerAction:"all",store:Js.Center.Common.IndustryStore});Js.Center.Common.IndustryStore.reload();var ecManageDetailPanel=new Ext.form.FormPanel({frame:true,labelWidth:80,defaults:{anchor:'100%',msgTarget:'side'},bodyBorder:false,border:false,autoScroll:true,items:[{xtype:"hidden",name:"flag",value:"update"},{xtype:"hidden",name:"numecid",fieldLabel:"EC主键"},{xtype:"hidden",name:"vc2ecid",fieldLabel:"EC编号"},{xtype:"hidden",id:"Js.Center.Business.ECmanageDetail.vc2contact",name:"vc2ecid",fieldLabel:"EC编号"},{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",bodyBorder:false,border:false,defaults:{anchor:"90%",msgTarget:"side"},items:[{xtype:"textfield",name:"vc2fullname",fieldLabel:"<font color=red>客户全称</font>",disabled:true},{xtype:"combo",name:"numismas",hiddenName:"numismas",fieldLabel:"<font color=red>MAS客户</font>",disabled:true,displayField:"show",valueField:"value",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["是","1"],["否","2"]]})},{xtype:"combo",name:"numcustype",hiddenName:"numcustype",fieldLabel:"<font color=red>客户类型</font>",disabled:true,displayField:"show",valueField:"value",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["渠道","1"],["直客","2"],["内部","3"]]})},{xtype:"combo",name:"numlevel",hiddenName:"numlevel",fieldLabel:"<font color=red>级别</font>",disabled:true,displayField:"show",valueField:"value",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["1","1"],["2","2"],["3","3"]]})},{xtype:"combo",name:"numsvctype",hiddenName:"numsvctype",fieldLabel:"<font color=red>短彩类型</font>",disabled:true,displayField:"show",valueField:"value",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["短信","1"],["彩信","2"],["短彩信","3"]]})},{xtype:"combo",name:"numstatus",hiddenName:"numstatus",fieldLabel:"<font color=red>状态</font>",disabled:true,displayField:"show",valueField:"value",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["商用","1"],["暂停","2"]]})},{xtype:"textfield",name:"vc2conperson",disabled:true,fieldLabel:"联系人"}]},{columnWidth:.5,layout:'form',defaultType:"textfield",buttonAlign:"center",bodyBorder:false,border:false,bodyStyle:"padding:10px 0 10px 15px",defaults:{anchor:"90%",msgTarget:"side"},items:[{xtype:"textfield",name:"vc2ecname",fieldLabel:"<font color=red>客户简称</font>",disabled:true},IndustryCombox,AreaCombox,{xtype:"textfield",name:"vc2manager",fieldLabel:"<font color=red>商务经理</font>",disabled:true},{xtype:"combo",name:"vc2chargetype",hiddenName:"vc2chargetype",fieldLabel:"<font color=red>付费类型</font>",disabled:true,displayField:"show",valueField:"value",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["预付费","1"],["后付费","2"]]})},{xtype:"textfield",name:"numlimited",fieldLabel:"<font color=red>条数限制</font>",disabled:true},{xtype:"label",name:"vc2contact",fieldLabel:"联系方式"}]}]},{columnWidth:1,layout:'form',buttonAlign:"center",bodyBorder:false,border:false,bodyStyle:"padding:0px 0 10px 15px",defaults:{anchor:"90%",msgTarget:"side"},items:[{id:"Js.Center.Business.ECmanageDetail.vc2oapic",xtype:"hidden",name:'vc2oapic'},{xtype:"panel",headerAsText:false,boder:false,html:'<div id="Js.Center.Business.ECmanageDetail.DIV" width="100%"></div>'}]}]});var pageSize=12;var fields=["numrowasdf","numprodid","longcode","vc2svcname","vc2gatewayname","numsubcode","vc2inputtype","vc2cusip","vc2feetype","vc2confeerule","numstatus","vc2name","numpftype","numsigntype"];Js.Center.Business.ECmanageDetail.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.ECmanage.ECsvcInfoURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numrowasdf",totalProperty:"totalCount"}),baseParams:{ecId:'',flag:'selectbykey'},sortInfo:{field:'numrowasdf',direction:'DESC'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numcolumnid"});var cm=new Ext.grid.ColumnModel([{header:"服务代码",tooltip:"服务代码",dataIndex:"longcode",sortable:true,editor:new Ext.form.TextField},{header:"运营商",tooltip:"运营商",dataIndex:"vc2name",sortable:true,editor:new Ext.form.TextField},{header:"接入网关",tooltip:"接入网关",dataIndex:"vc2gatewayname",sortable:true,editor:new Ext.form.TextField},{header:"建议子号码",tooltip:"建议子号码",dataIndex:"numsubcode",sortable:true,editor:new Ext.form.TextField},{header:"直签/返佣",tooltip:"直签/返佣",dataIndex:"numsigntype",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){if(value=="1"){return"返佣"}else if(value=="0"){return"直签"}}},{header:"统/辅",tooltip:"统/辅",dataIndex:"numpftype",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){if(value=="1"){return"统付"}else if(value=="2"){return"辅通道"}}},{header:"接入方式",tooltip:"接入方式",dataIndex:"vc2inputtype",sortable:true,editor:new Ext.form.TextField,renderer:function(value){var type='';var types=value.split(',');if(types.length==1){if(value==1){return"页面"}else if(value==2){return"接口"}}else if(types.length==2){if(types[0]==1){type="页面"}else if(types[0]==2){type="接口"}if(types[1]==1){type+=", 页面"}else if(types[1]==2){type+=", 接口"}return type}}},{header:"客户IP",tooltip:"客户IP",dataIndex:"vc2cusip",sortable:true,editor:new Ext.form.TextField},{header:"计费方式",tooltip:"计费方式",dataIndex:"vc2feetype",sortable:true,editor:new Ext.form.TextField,renderer:function(value){if(value==1){return"按条"}else if(value==2){return"套餐"}else if(value==3){return"产品"}}},{header:"计费规则",tooltip:"计费规则",dataIndex:"vc2confeerule",sortable:true,editor:new Ext.form.TextField},{header:"状态",tooltip:"状态",dataIndex:"numstatus",sortable:true,editor:new Ext.form.TextField,renderer:function(value){if(value==1){return"可用"}else{return"删除"}}}]);var ecManageGrid=new WXTL.Widgets.CommonGrid.GridPanel({title:"业务列表",anchor:'100% 100%',width:810,store:Js.Center.Business.ECmanageDetail.Infostore,sm:sm,cm:cm,needMenu:false});var mainPanel=new Ext.Panel({items:[ecManageDetailPanel,ecManageGrid]});var mainForm=ecManageDetailPanel.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"操作详细信息",width:850,height:430,autoScroll:true,frame:true,mainForm:mainForm,displayStore:Js.Center.Business.ECmanageDetail.Infostore,updateState:true,needLoadDataStore:true,items:[mainPanel],needButtons:false,buttons:[{text:"关  闭",minWidth:70,handler:function(){Js.Center.Business.ECmanageDetail.window.hide()}}],loadDataStoreFunc:function(){Js.Center.Business.ECmanageDetail.Infostore.load({params:{start:0,limit:pageSize}})}});}};Ext.namespace('Js.Center.Business.ECmanage');Js.Center.Business.ECmanage.info=function(node){if(Ext.get("Js.Center.Business.ECmanage.ECMainPanel")==null){Js.Center.Common.OperatorStore.reload();Js.Center.Common.EcSignTypeStore.reload();var _pageSize=12;var fields=["numrowasdf","numecid","vc2ecid","vc2ecname","numstatus","numdepartid","numismas","numindustry","numsvctype","numpftype","vc2area","vc2area1","vc2manager","numcustype","numlevel","vclevel","numlimited","vc2chargetype","vc2fullname","vc2oapic","vc2conperson","vc2contact","datinsert","numisfeeback","numsigntype","numsigntypeid","vc2typename"];Js.Center.Business.ECmanage.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.ECmanage.EcQueryURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numrowasdf",totalProperty:"totalCount"}),baseParams:{vc2ecid:'',vc2ecname:'',NUMSVCTYPE:'',NUMSUBCODE:'',opid:'',flag:'selectecbysearchkey'},sortInfo:{field:'numecid',direction:'DESC'}});Js.Center.Business.ECmanage.Infostore.load({params:{start:0,limit:_pageSize,vc2ecid:'',flag:'selectecbysearchkey'}});var opidCombox=new WXTL.Widgets.CommonForm.ComboBox({xtype:"xComboBox",name:"numopida",hiddenName:"numopida",emptyText:"-=请选择=-",allowBlank:true,blankText:"请选择",fieldLabel:"运营商",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numopid",triggerAction:"all",store:Js.Center.Common.OperatorStore});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numecid"});var cm=new Ext.grid.ColumnModel([{header:"序列ID",tooltip:"序列ID",dataIndex:"numecid",hidden:true,sortable:true},{header:"EC编号",tooltip:"EC编号",dataIndex:"vc2ecid",sortable:true},{header:"简称",tooltip:"简称",dataIndex:"vc2ecname",sortable:true},{header:"客户接入状态",tooltip:"客户接入状态",dataIndex:"numstatus",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){if(value=="1"){return"商用"}else if(value=="2"){return"停用"}}},{header:"客户级别",tooltip:"客户级别",dataIndex:"vclevel",sortable:true},{header:"直签/返佣",tooltip:"直签/返佣",dataIndex:"numsigntype",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){if(value=="1"){return"返佣"}else if(value=="0"){return"直签"}}},{header:"计入商务归属地",tooltip:"计入商务归属地",dataIndex:"vc2area1",sortable:true},{header:"接入商务",tooltip:"接入商务",dataIndex:"vc2manager",sortable:true},{header:"签名类型",tooltip:"签名类型",dataIndex:"vc2typename",sortable:true},{header:"操作",tooltip:"操作",dataIndex:"numecid",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){return"<a href='#' onclick='Js.Center.Business.ECmanage.selectEcInfoDetail(\""+value+"\")'>详细</a>"}}]);var ECSelectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({height:160,queryMethod:"Js.Center.Business.ECmanage.queryMainGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"Js.Center.Business.ECmanage.vc2ecid",id:'Js.Center.Business.ECmanage.vc2ecid',fieldLabel:"EC编号",maxLength:20,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText},{xtype:"combo",name:"NUMSVCTYPE",id:"Js.Center.Business.ECmanage.NUMSVCTYPE",hiddenName:"NUMSVCTYPE",fieldLabel:"短彩类型",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["短信","1"],["彩信","2"],["短彩信","3"]]})},opidCombox]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"Js.Center.Business.ECmanage.vc2ecname",id:'Js.Center.Business.ECmanage.vc2ecname',fieldLabel:"简称",maxLength:20,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText},{xtype:"textfield",name:"NUMSUBCODE",id:'Js.Center.Business.ECmanage.NUMSUBCODE',fieldLabel:"扩展码",maxLength:20,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText}]}]}]});Js.Center.Business.ECmanage.queryMainGrid=function(){if(ECSelectPanel.getForm().isValid()){var vc2ecid=Ext.get("Js.Center.Business.ECmanage.vc2ecid").getValue();var vc2ecname=Ext.get("Js.Center.Business.ECmanage.vc2ecname").getValue();var NUMSVCTYPE=Ext.getCmp("Js.Center.Business.ECmanage.NUMSVCTYPE").getValue();var NUMSUBCODE=Ext.get("Js.Center.Business.ECmanage.NUMSUBCODE").getValue();var opid=opidCombox.getValue();var flag='selectecbysearchkey';Js.Center.Business.ECmanage.Infostore.baseParams={vc2ecid:vc2ecid,vc2ecname:vc2ecname,NUMSVCTYPE:NUMSVCTYPE,NUMSUBCODE:NUMSUBCODE,opid:opid,flag:flag};Js.Center.Business.ECmanage.Infostore.load({params:{start:0,limit:_pageSize}})}};var ecmanage_arrInitLoadFunc=new Array();ecmanage_arrInitLoadFunc[0]="Js.Center.Business.ECservice.func";ecmanage_arrInitLoadFunc[1]="Js.Center.Business.ECserviceAdd.func";ecmanage_arrInitLoadFunc[2]="Js.Center.Business.ECmanageDetail.func";ecmanage_arrInitLoadFunc[3]="Js.Center.Business.ECsignture.func";ecmanage_arrInitLoadFunc[4]="Js.Center.Business.ECsigntureAdd.func";ecmanage_arrInitLoadFunc[5]="Js.Center.Business.ECsigntureUpdate.func";var EcQueryInfoGrid=new WXTL.Widgets.CommonGrid.GridPanel({anchor:'100% 100%',pageSize:_pageSize,needMenu:false,store:Js.Center.Business.ECmanage.Infostore,sm:sm,cm:cm,needRightMenu:false,afterEditURL:Js.Center.Business.UserGroupUpdateURL,inertMethod:'Js.Center.Business.ECmanage.EcAdd',updateMethod:'Js.Center.Business.ECmanage.EcUpdate',otherInitLoadFunc:ecmanage_arrInitLoadFunc,tbar:new Ext.Toolbar({items:[{iconCls:'addicon',text:"添加",handler:function(){EcQueryInfoGrid.doInsert()}},"","-","",{iconCls:'editicon',text:"修改",handler:function(){EcQueryInfoGrid.doEdit()}},"","-","",{iconCls:'editicon',text:"业务管理",handler:function(){var row=EcQueryInfoGrid.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("提示信息","请您选择一条记录!")}else if(row.length>1){Ext.Msg.alert("提示信息","对不起只能选择一个!")}else if(row.length==1){Js.Center.Business.ECservice.window.updateRecord=row[0];Js.Center.Business.ECservice.window.show();Ext.apply(Js.Center.Business.ECservice.Infostore.baseParams,{ecId:row[0].get('numecid'),flag:'selectbykey'});Js.Center.Business.ECservice.Infostore.load({params:{start:0,limit:12,ecId:row[0].get('numecid'),flag:'selectbykey'}})}}},"","-","",{iconCls:'editicon',text:"报备签名",handler:function(){var row=EcQueryInfoGrid.getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("提示信息","请您选择一条记录!")}else if(row.length>1){Ext.Msg.alert("提示信息","对不起只能选择一个!")}else if(row.length==1){Js.Center.Business.ECsignture.window.updateRecord=row[0];Js.Center.Business.ECsignture.window.show();}}}]})});Js.Center.Business.ECmanage.ECMainPanel=new Ext.Panel({frame:true,id:"Js.Center.Business.ECmanage.ECMainPanel",bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[ECSelectPanel,EcQueryInfoGrid]})};GridMain(node,Js.Center.Business.ECmanage.ECMainPanel,"openroomiconinfo","Js.Center.Business.ECmanage.Infostore");Js.Center.Business.ECmanage.selectEcInfoDetail=function(rowValue){var row=EcQueryInfoGrid.getSelectionModel().getSelections();Js.Center.Business.ECmanageDetail.window.updateRecord=row[0];Js.Center.Business.ECmanageDetail.window.mainForm.loadRecord(row[0]);Js.Center.Business.ECmanageDetail.window.show();if(""!=Ext.fly("Js.Center.Business.ECmanageDetail.vc2oapic").getValue()){Ext.fly("Js.Center.Business.ECmanageDetail.DIV").dom.innerHTML="<img src='"+Ext.fly("Js.Center.Business.ECmanageDetail.vc2oapic").getValue()+"' width=100% />"}else{Ext.fly("Js.Center.Business.ECmanageDetail.DIV").dom.innerHTML=""};Ext.apply(Js.Center.Business.ECmanageDetail.Infostore.baseParams,{ecId:rowValue,flag:'selectbykey'});Js.Center.Business.ECmanageDetail.Infostore.load({params:{start:0,limit:12,ecId:rowValue,flag:'selectbykey'}})}};Ext.namespace('Js.Center.Business.ECmanage.query');Js.Center.Business.ECmanage.query=function(node){if(Ext.get("Js.Center.Business.ECmanage.ECQueryPanel")==null){Js.Center.Common.OperatorStore.reload();var _pageSize=12;var fields=["numrowasdf","numecid","vc2ecid","vc2ecname","numstatus","numdepartid","numismas","numindustry","numsvctype","numpftype","vc2area","vc2area1","vc2manager","numcustype","numlevel","vclevel","numlimited","vc2chargetype","vc2fullname","vc2oapic","vc2conperson","vc2contact","datinsert","numisfeeback","numsigntype"];Js.Center.Business.ECmanage.Querystore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.ECmanage.EcQueryURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numrowasdf",totalProperty:"totalCount"}),baseParams:{vc2ecid:'',vc2ecname:'',NUMSVCTYPE:'',NUMSUBCODE:'',opid:'',flag:'selectecbysearchkey'},sortInfo:{field:'numecid',direction:'DESC'}});Js.Center.Business.ECmanage.Querystore.load({params:{start:0,limit:_pageSize,vc2ecid:'',flag:'selectecbysearchkey'}});var opidComboxQuery=new WXTL.Widgets.CommonForm.ComboBox({name:"numopida",hiddenName:"numopida",emptyText:"-=请选择=-",fieldLabel:"运营商",readOnly:true,mode:"local",displayField:"vc2name",valueField:"numopid",triggerAction:"all",store:Js.Center.Common.OperatorStore});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numecid"});var cm=new Ext.grid.ColumnModel([{header:"序列ID",tooltip:"序列ID",dataIndex:"numecid",hidden:true,sortable:true},{header:"EC编号",tooltip:"EC编号",dataIndex:"vc2ecid",sortable:true},{header:"简称",tooltip:"简称",dataIndex:"vc2ecname",sortable:true},{header:"客户接入状态",tooltip:"客户接入状态",dataIndex:"numstatus",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){if(value=="1"){return"商用"}else if(value=="2"){return"停用"}}},{header:"客户级别",tooltip:"客户级别",dataIndex:"vclevel",sortable:true},{header:"返佣/直签",tooltip:"返佣/直签",dataIndex:"numsigntype",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){if(value=="1"){return"返佣"}else if(value=="0"){return"直签"}}},{header:"计入商务归属",tooltip:"计入商务归属区",dataIndex:"vc2area1",sortable:true},{header:"接入商务",tooltip:"接入商务",dataIndex:"vc2manager",sortable:true},{header:"操作",tooltip:"操作",dataIndex:"numecid",sortable:true,renderer:function(value,meta,record,rowIndex,colIndex,store){return"<a href='#' onclick='Js.Center.Business.ECmanage.selectEcInfoDetail(\""+value+"\")'>详细</a>"}}]);var ECSelectPanelQuery=new WXTL.Widgets.CommonPanel.QueryFormPanel({height:160,queryMethod:"Js.Center.Business.ECmanage.QueryMainGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"Js.Center.Business.ECmanage.vc2ecid",id:'Js.Center.Business.ECmanage.query.vc2ecid',fieldLabel:"EC编号",maxLength:20,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText},{xtype:"combo",name:"NUMSVCTYPE",id:"Js.Center.Business.ECmanage.query.NUMSVCTYPE",hiddenName:"NUMSVCTYPE",fieldLabel:"短彩类型",readOnly:true,mode:"local",displayField:"show",valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["短信","1"],["彩信","2"],["短彩信","3"]]})},opidComboxQuery]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"textfield",name:"Js.Center.Business.ECmanage.vc2ecname",id:'Js.Center.Business.ECmanage.query.vc2ecname',fieldLabel:"简称",maxLength:20,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText},{xtype:"textfield",name:"NUMSUBCODE",id:'Js.Center.Business.ECmanage.query.NUMSUBCODE',fieldLabel:"扩展码",maxLength:20,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText}]}]}]});Js.Center.Business.ECmanage.QueryMainGrid=function(){if(ECSelectPanelQuery.getForm().isValid()){var vc2ecid=Ext.get("Js.Center.Business.ECmanage.query.vc2ecid").getValue();var vc2ecname=Ext.get("Js.Center.Business.ECmanage.query.vc2ecname").getValue();var NUMSVCTYPE=Ext.getCmp("Js.Center.Business.ECmanage.query.NUMSVCTYPE").getValue();var NUMSUBCODE=Ext.get("Js.Center.Business.ECmanage.query.NUMSUBCODE").getValue();var opid=opidComboxQuery.getValue();var flag='selectecbysearchkey';Js.Center.Business.ECmanage.Querystore.baseParams={vc2ecid:vc2ecid,vc2ecname:vc2ecname,NUMSVCTYPE:NUMSVCTYPE,NUMSUBCODE:NUMSUBCODE,opid:opid,flag:flag};Js.Center.Business.ECmanage.Querystore.load({params:{start:0,limit:_pageSize}})}};var ecmanage_arrInitLoadFunc=new Array();ecmanage_arrInitLoadFunc[0]="Js.Center.Business.ECmanageDetail.func";var EcByQueryInfoGrid=new WXTL.Widgets.CommonGrid.GridPanel({anchor:'100% 100%',pageSize:_pageSize,needMenu:false,store:Js.Center.Business.ECmanage.Querystore,sm:sm,cm:cm,needRightMenu:false,otherInitLoadFunc:ecmanage_arrInitLoadFunc});Js.Center.Business.ECmanage.ECQueryPanel=new Ext.Panel({frame:true,id:"Js.Center.Business.ECmanage.ECQueryPanel",bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[ECSelectPanelQuery,EcByQueryInfoGrid]})};GridMain(node,Js.Center.Business.ECmanage.ECQueryPanel,"openroomiconinfo","Js.Center.Business.ECmanage.Querystore");Js.Center.Business.ECmanage.selectEcInfoDetail=function(rowValue){var row=EcByQueryInfoGrid.getSelectionModel().getSelections();Js.Center.Business.ECmanageDetail.window.updateRecord=row[0];Js.Center.Business.ECmanageDetail.window.mainForm.loadRecord(row[0]);Js.Center.Business.ECmanageDetail.window.show();if(""!=Ext.fly("Js.Center.Business.ECmanageDetail.vc2oapic").getValue()){Ext.fly("Js.Center.Business.ECmanageDetail.DIV").dom.innerHTML="<img src='"+Ext.fly("Js.Center.Business.ECmanageDetail.vc2oapic").getValue()+"' width=100% />"}else{Ext.fly("Js.Center.Business.ECmanageDetail.DIV").dom.innerHTML=""};Ext.apply(Js.Center.Business.ECmanageDetail.Infostore.baseParams,{ecId:rowValue,flag:'selectbykey'});Js.Center.Business.ECmanageDetail.Infostore.load({params:{start:0,limit:12,ecId:rowValue,flag:'selectbykey'}})}};Ext.namespace('Js.Center.Business.ECserviceAdd');Js.Center.Business.ECserviceAdd.func=function(row){var opidCombox=new WXTL.Widgets.CommonForm.ComboBox({xtype:"xComboBox",name:"numopid",hiddenName:"numopid",emptyText:"-=请选择=-",allowBlank:false,blankText:"请选择",fieldLabel:"<font color=red>运营商</font>",mode:"local",displayField:"vc2name",valueField:"numopid",triggerAction:"all",store:Js.Center.Common.OperatorStore,listeners:{"select":function(){Ext.getCmp('Js.Center.Business.ECserviceAdd.numsvcid').setValue('');Js.Center.Common.ServiceCodeByOPIDStore.reload({params:{numopid:this.getValue(),flag:'queryservicecodebyopid'}})}}});Js.Center.Common.OperatorStore.reload();var svcidCombox={xtype:"xComboBox",name:"numsvcid",id:'Js.Center.Business.ECserviceAdd.numsvcid',hiddenName:"numsvcid",emptyText:"-=请先选择运营商=-",valueNotFoundText:'-=请先选择运营商=-',allowBlank:false,blankText:"-=请先选择运营商=-",fieldLabel:"<font color=red>运营商业务</font>",mode:"local",displayField:"vc2svcname",valueField:"numsvcid",triggerAction:"all",isNeedDefaultChoose:false,store:Js.Center.Common.ServiceCodeByOPIDStore};var signCombox=new WXTL.Widgets.CommonForm.ComboBox({xtype:"xComboBox",name:"numsign",hiddenName:"numsign",emptyText:"-=请选择=-",allowBlank:false,blankText:"请选择",fieldLabel:"<font color=red>签约主体编号</font>",readOnly:true,mode:"local",displayField:"vc2sign",valueField:"numsign",triggerAction:"all",store:Js.Center.Common.SignStore});Js.Center.Common.SignStore.reload();var AreaCombox=new WXTL.Widgets.CommonForm.ComboBox({xtype:"xComboBox",name:"numfeearea",hiddenName:"numfeearea",emptyText:"-=请选择=-",allowBlank:false,blankText:"请选择地区",fieldLabel:"<font color=red>结算地</font>",readOnly:true,mode:"local",displayField:"vc2branchcompany",valueField:"numbranchcompany",triggerAction:"all",store:Js.Center.Common.BranchCompanyStore});Js.Center.Common.BranchCompanyStore.reload();var AddtlecservicecodeInfofp=new Ext.form.FormPanel({width:375,plain:true,layout:"form",defaultType:"textfield",labelWidth:100,baseCls:"x-plain",defaults:{anchor:"95%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0 0 0 0;margin:10 15",items:[{xtype:"hidden",name:"numseqid"},{xtype:"hidden",id:"Js.Center.Business.ECserviceAdd.numecid",name:"numecid"},{xtype:"hidden",id:"Js.Center.Business.ECserviceAdd.vc2ecid",name:"vc2ecid"},{xtype:"hidden",id:"Js.Center.Business.ECserviceAdd.flag",name:"flag"},opidCombox,svcidCombox,{xtype:"hidden",name:"numstatus",hiddenName:"numstatus",value:1},{xtype:"textfield",name:"numsubcode",id:"Js.Center.Business.ECserviceAdd.numsubcode",fieldLabel:"建议子号码",allowBlank:true,regex:/^\d+$/,regexText:"建议子号码只能输入数字",maxLength:10,maxLengthText:'长度不能超过10'},{xtype:"checkboxgroup",name:"vc2inputtype",allowBlank:false,blankText:'请选择接入方式',id:"Js.Center.Business.ECserviceAdd.inputtype",fieldLabel:"<font color=red>接入方式</font>",frame:true,items:[{boxLabel:'页面',name:"vc2inputtype",inputValue:'1'},{boxLabel:'接口',name:"vc2inputtype",inputValue:'2'}],listeners:{}},{xtype:"textfield",name:"vc2cusip",fieldLabel:"客户IP",blankText:"客户IP不允许为空",regex:WXTL.Common.regex.IP,regexText:'客户IP格式不正确',maxLength:15,maxLengthText:'长度不能超过15'},{xtype:"combo",name:"vc2feetype",hiddenName:"vc2feetype",fieldLabel:"<font color=red>计费方式</font>",readOnly:true,mode:"local",allowBlank:false,displayField:"show",valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["按条","1"],["按套餐","2"],["按产品","3"]]})},signCombox,AreaCombox,{xtype:"textarea",name:"vc2confeerule",fieldLabel:"计费规则",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:500,maxLengthText:'长度不能超过500'}]});var mainForm=AddtlecservicecodeInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({width:400,title:"添加业务",updateState:true,mainForm:mainForm,updateURL:Js.Center.Business.ECmanage.ECsvcInfoURL,displayStore:Js.Center.Business.ECservice.Infostore,items:[AddtlecservicecodeInfofp],needLoadDataStore:true,loadDataStoreFunc:function(){Ext.getCmp("Js.Center.Business.ECserviceAdd.numecid").setValue(Ext.getCmp("Js.Center.Business.ECservice.numecid").getValue());Ext.getCmp("Js.Center.Business.ECserviceAdd.vc2ecid").setValue(Ext.getCmp("Js.Center.Business.ECservice.vc2ecid").getValue())},needButtons:false,buttons:[{text:"确定",minWidth:70,handler:function(){var flag="insert";if(Js.Center.Business.ECserviceAdd.updateRecord&&Js.Center.Business.ECserviceAdd.updateRecord.data.numseqid){flag="update"}Ext.getCmp("Js.Center.Business.ECserviceAdd.flag").setValue(flag);if(AddtlecservicecodeInfofp.getForm().isValid()){Ext.MessageBox.show({msg:'正在保存，请稍等...',progressText:'Saving...',width:300,wait:true,waitConfig:{interval:200},icon:'download',animEl:'saving'});setTimeout(function(){Ext.MessageBox.hide()},1000);AddtlecservicecodeInfofp.form.submit({url:Js.Center.Business.ECmanage.ECsvcInfoURL,method:"POST",success:function(){if(flag=="insert"){Ext.Msg.alert("恭喜您","添加成功了!")}else{Ext.Msg.alert("恭喜您","修改成功了!")}Js.Center.Business.ECserviceAdd.window.hide();Js.Center.Business.ECservice.Infostore.reload()},failure:function(){if(flag=="insert"){Ext.Msg.alert("恭喜您","添加失败了!")}else{Ext.Msg.alert("恭喜您","修改失败了!")}}})}}},{text:"重置",minWidth:70,qtip:"重置数据",handler:function(){if(Js.Center.Business.ECserviceAdd.updateRecord&&Js.Center.Business.ECserviceAdd.updateRecord.data.numseqid){Js.Center.Business.ECserviceAdd.window.mainForm.loadRecord(Js.Center.Business.ECserviceAdd.updateRecord);var inputtype=Js.Center.Business.ECserviceAdd.updateRecord.data.vc2inputtype.split(",");Ext.getCmp("Js.Center.Business.ECserviceAdd.inputtype").items.items[0].setValue(false);Ext.getCmp("Js.Center.Business.ECserviceAdd.inputtype").items.items[1].setValue(false);for(i=0;i<inputtype.length;i++){if(inputtype[i]==1){Ext.getCmp("Js.Center.Business.ECserviceAdd.inputtype").items.items[0].setValue(true)}else if(inputtype[i]==2){Ext.getCmp("Js.Center.Business.ECserviceAdd.inputtype").items.items[1].setValue(true)}}}else{AddtlecservicecodeInfofp.getForm().reset();Ext.getCmp("Js.Center.Business.ECserviceAdd.numecid").setValue(Ext.getCmp("Js.Center.Business.ECservice.numecid").getValue());Ext.getCmp("Js.Center.Business.ECserviceAdd.vc2ecid").setValue(Ext.getCmp("Js.Center.Business.ECservice.vc2ecid").getValue())}}},{text:"取 消",minWidth:70,handler:function(){Js.Center.Business.ECserviceAdd.window.hide()}}]})};Ext.namespace('Js.Center.Business.ECserviceDelete');Js.Center.Business.ECserviceDelete.func=function(row){var deletesplit="";for(var i=0;i<row.length;i++){if(row.length==1){deletesplit=row[i].data.numseqid}else{if(i<(row.length-1)){deletesplit=row[i].data.numseqid+","+deletesplit}if(i==(row.length-1)){deletesplit=deletesplit+row[i].data.numseqid}}}Ext.Ajax.request({url:Js.Center.Business.ECmanage.ECsvcInfoURL,method:"POST",params:{ids:deletesplit,numecid:row[0].data.numecid,flag:"delete"},success:function(){Ext.Msg.alert("恭喜您","删除成功了!");Js.Center.Business.ECservice.Infostore.reload()},failure:function(){Ext.Msg.alert("提 示","删除失败了!")}})};Ext.namespace('Js.Center.Business.ECservice');Js.Center.Business.ECservice.func=function(row){if(Js.Center.Business.ECservice.window==null){var pageSize=12;var fields=["numrowasdf","numecid","numseqid","numprodid","longcode","vc2svcname","vc2gatewayname","numsubcode","vc2inputtype","vc2cusip","vc2feetype","vc2confeerule","numstatus","numopid","numfeearea","numsvcid","numsign","vc2name"];Js.Center.Business.ECservice.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.ECmanage.ECsvcInfoURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numrowasdf",totalProperty:"totalCount"}),baseParams:{flag:'selectbykey'},sortInfo:{field:'numrowasdf',direction:'DESC'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numcolumnid"});var cm=new Ext.grid.ColumnModel([sm,{header:"通道组编号",tooltip:"通道组编号",dataIndex:"numprodid",sortable:true,hidden:true,editor:new Ext.form.TextField},{header:"服务代码",tooltip:"服务代码",dataIndex:"longcode",sortable:true,editor:new Ext.form.TextField},{header:"运营商",tooltip:"运营商",dataIndex:"vc2name",sortable:true,editor:new Ext.form.TextField},{header:"接入网关",tooltip:"接入网关",dataIndex:"vc2gatewayname",sortable:true,editor:new Ext.form.TextField},{header:"建议子号码",tooltip:"建议子号码",dataIndex:"numsubcode",sortable:true,editor:new Ext.form.TextField},{header:"接入方式",tooltip:"接入方式",dataIndex:"vc2inputtype",sortable:true,editor:new Ext.form.TextField,renderer:function(value){var types=value.split(',');if(types.length==1){if(value==1){return"页面"}else if(value==2){return"接口"}}else if(types.length==2){var type='';if(types[0]==1){type="页面"}else if(types[0]==2){type="接口"}if(types[1]==1){type+=", 页面"}else if(types[1]==2){type+=", 接口"}return type}}},{header:"客户IP",tooltip:"客户IP",dataIndex:"vc2cusip",sortable:true,editor:new Ext.form.TextField},{header:"计费方式",tooltip:"计费方式",dataIndex:"vc2feetype",sortable:true,editor:new Ext.form.TextField,renderer:function(value){if(value==1){return"按条"}else if(value==2){return"套餐"}else if(value==3){return"产品"}}},{header:"计费规则",tooltip:"计费规则",dataIndex:"vc2confeerule",sortable:true,editor:new Ext.form.TextField},{header:"状态",tooltip:"状态",dataIndex:"numstatus",sortable:true,editor:new Ext.form.TextField,renderer:function(value){if(value==1){return"可用"}else{return"删除"}}}]);var tlecservicecodegrid=new WXTL.Widgets.CommonGrid.GridPanel({title:"业务列表",anchor:'100% 100%',width:810,id:"ecserviceinfo",store:Js.Center.Business.ECservice.Infostore,sm:sm,cm:cm,needMenu:false,tbar:new Ext.Toolbar({items:[{text:"添加",tooltip:"添加",iconCls:"addicon",handler:function(){Js.Center.Business.ECserviceAdd.updateRecord="";var numecid=Js.Center.Business.ECservice.window.updateRecord.data.numecid;var vc2ecid=Js.Center.Business.ECservice.window.updateRecord.data.vc2ecid;Ext.getCmp("Js.Center.Business.ECservice.numecid").setValue(numecid);Ext.getCmp("Js.Center.Business.ECservice.vc2ecid").setValue(vc2ecid);Js.Center.Business.ECserviceAdd.window.show()}},"","-","",{text:"编辑",tooltip:"编辑",iconCls:"editicon",handler:function(){var row=Ext.getCmp("ecserviceinfo").getSelectionModel().getSelections();var numecid=Js.Center.Business.ECservice.window.updateRecord.data.numecid;var vc2ecid=Js.Center.Business.ECservice.window.updateRecord.data.vc2ecid;Ext.getCmp("Js.Center.Business.ECservice.numecid").setValue(numecid);Ext.getCmp("Js.Center.Business.ECservice.vc2ecid").setValue(vc2ecid);if(row.length==0){Ext.Msg.alert("提示信息","您没有选中任何行!")}else if(row.length>1){Ext.Msg.alert("提示信息","对不起只能选择一个!")}else if(row.length==1){if(row[0].data.numstatus==1){Ext.getCmp('Js.Center.Business.ECserviceAdd.numsvcid').store.reload({params:{numopid:row[0].data.numopid,flag:'queryservicecodebyopid'},callback:function(){Js.Center.Business.ECserviceAdd.window.show();Js.Center.Business.ECserviceAdd.updateRecord=row[0];Js.Center.Business.ECserviceAdd.window.mainForm.loadRecord(row[0]);var inputtype=row[0].data.vc2inputtype.split(",");Ext.getCmp("Js.Center.Business.ECserviceAdd.inputtype");for(i=0;i<inputtype.length;i++){if(inputtype[i]==1){Ext.getCmp("Js.Center.Business.ECserviceAdd.inputtype").items.items[0].setValue(true)}else if(inputtype[i]==2){Ext.getCmp("Js.Center.Business.ECserviceAdd.inputtype").items.items[1].setValue(true)}}}})}else{Ext.Msg.alert("提示信息","不能编辑被删除的业务!")}}}},"","-","",{text:"删除",tooltip:"删除",iconCls:"editicon",handler:function(){var row=Ext.getCmp("ecserviceinfo").getSelectionModel().getSelections();if(row.length==0){Ext.Msg.alert("提示信息","请您至少选择一个!")}else{for(i=0;i<row.length;i++){if(row[i].data.numstatus==0){Ext.Msg.alert("提示信息","不能选择已删除信息!");return}}Ext.Msg.confirm("提示!","您确定要删除信息吗?",function(btn){if(btn=="yes"){Js.Center.Business.ECserviceDelete.func(row)}})}}}]})});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({height:160,items:[{xtype:"hidden",id:"Js.Center.Business.ECservice.numecid",name:"Js.Center.Business.ECservice.numecid",fieldLabel:"EC主键"},{xtype:"hidden",id:"Js.Center.Business.ECservice.vc2ecid",name:"Js.Center.Business.ECservice.vc2ecid",fieldLabel:"EC编号"}]});var mainPanel=new Ext.Panel({frame:true,bodyBorder:false,border:false,autoScroll:true,defaults:{collapsible:true},items:[tlecservicecodegrid]});this.window=new WXTL.Widgets.CommonWindows.Window({title:"操作详细信息",width:850,height:430,autoScroll:true,frame:true,displayStore:Js.Center.Business.ECservice.Infostore,updateState:true,needLoadDataStore:true,items:[mainPanel],needButtons:false,buttons:[{text:"关  闭",minWidth:70,handler:function(){Js.Center.Business.ECservice.window.hide()}}],loadDataStoreFunc:function(){Js.Center.Business.ECservice.Infostore.load({params:{start:0,limit:pageSize}})}});}};Ext.namespace('Js.Center.Business.ECmanage.EcUpdate');Js.Center.Business.ECmanage.EcUpdate.func=function(row){var AreaCombox=new WXTL.Widgets.CommonForm.ComboBox({xtype:"xComboBox",name:"vc2area",hiddenName:"vc2area",emptyText:"-=请选择=-",allowBlank:false,blankText:"请选择地区",fieldLabel:"<font color=red>地区</font>",readOnly:true,mode:"local",displayField:"vc2branchcompany",valueField:"numbranchcompany",triggerAction:"all",store:Js.Center.Common.BranchCompanyStore});Js.Center.Common.BranchCompanyStore.reload();var IndustryCombox=new WXTL.Widgets.CommonForm.ComboBox({xtype:"xComboBox",name:"numindustry",hiddenName:"numindustry",emptyText:"-=请选择=-",allowBlank:false,blankText:"请选择行业",fieldLabel:"<font color=red>行业</font>",readOnly:true,mode:"local",displayField:"vc2industry",valueField:"numindustry",triggerAction:"all",store:Js.Center.Common.IndustryStore});Js.Center.Common.IndustryStore.reload();function createUpFile(){var UpFile=new WXTL.Widgets.CommonForm.FileUploadField({name:"oapicfile",style:'border: 1px solid #C0C0C0;height:22;cursor:hand',fieldLabel:getHelpMsg("文件",false,"1、文件格式为jpg/gif/png/bmp等图片"),allowBlank:true,blankText:"请选择上传文件",width:400,validator:function(){var filePath=this.getValue();var fileTypeArr1=new Array();fileTypeArr1[0]="jpg";fileTypeArr1[1]="gif";fileTypeArr1[2]="png";fileTypeArr1[3]="bmp";var fileTypeArrDesc1="jpg,gif,png,bmp";if(filePath!=''){if(checkFileWithTypeArr(filePath,fileTypeArr1,fileTypeArrDesc1)!=''){this.invalidText=checkFileWithTypeArr(filePath,fileTypeArr1,fileTypeArrDesc1);return false}else{return true}}else return false}});return UpFile}var UpFile=createUpFile();var updateInfofp=new Ext.form.FormPanel({frame:true,fileUpload:true,labelWidth:80,defaults:{anchor:'100%',msgTarget:'side'},bodyBorder:false,border:false,autoScroll:true,items:[{xtype:"hidden",name:"flag",value:"update"},{xtype:"hidden",name:"numecid",fieldLabel:"EC主键"},{xtype:"hidden",name:"vc2ecid",fieldLabel:"EC编号"},{xtype:"hidden",name:"numdepartid",fieldLable:"部门编号"},{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",bodyBorder:false,border:false,defaults:{anchor:"90%",msgTarget:"side"},items:[{xtype:"textfield",name:"vc2fullname",fieldLabel:"<font color=red>客户全称</font>",allowBlank:false,blankText:"客户全称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:25,maxLengthText:'长度不能超过25'},{xtype:"combo",name:"numismas",hiddenName:"numismas",fieldLabel:"<font color=red>MAS客户</font>",readOnly:true,mode:"local",allowBlank:false,displayField:"show",valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["是","1"],["否","2"]]})},{xtype:"combo",name:"numcustype",hiddenName:"numcustype",fieldLabel:"<font color=red>客户类型</font>",readOnly:true,mode:"local",allowBlank:false,displayField:"show",valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["渠道","1"],["直客","2"],["内部","3"]]})},{xtype:"combo",name:"numlevel",hiddenName:"numlevel",fieldLabel:"<font color=red>级别</font>",readOnly:true,mode:"local",displayField:"show",allowBlank:false,valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["1","1"],["2","2"],["3","3"]]})},{xtype:"combo",name:"numsvctype",hiddenName:"numsvctype",fieldLabel:"<font color=red>通道类型</font>",readOnly:true,mode:"local",displayField:"show",allowBlank:false,valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["短信","1"],["彩信","2"],["短彩信","3"]]})},{xtype:"combo",name:"numstatus",hiddenName:"numstatus",fieldLabel:"<font color=red>状态</font>",readOnly:true,mode:"local",displayField:"show",allowBlank:false,valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["商用","1"],["暂停","2"]]})},{xtype:"textfield",name:"vc2conperson",fieldLabel:"联系人",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:30,maxLengthText:'长度不能超过30'},{xtype:"xComboBox",name:"numsigntypeid",hiddenName:"numsigntypeid",fieldLabel:"<font color=red>签名类型</font>",readOnly:true,mode:"local",allowBlank:false,displayField:"vc2typename",valueField:"numtypeid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.EcSignTypeStore}]},{columnWidth:.5,layout:'form',defaultType:"textfield",buttonAlign:"center",bodyBorder:false,border:false,bodyStyle:"padding:10px 0 10px 15px",defaults:{anchor:"90%",msgTarget:"side"},items:[{xtype:"textfield",name:"vc2ecname",fieldLabel:"<font color=red>客户简称</font>",allowBlank:false,blankText:"客户简称不允许为空",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:25,maxLengthText:'长度不能超过25'},IndustryCombox,AreaCombox,{xtype:"textfield",name:"vc2manager",fieldLabel:"<font color=red>商务经理</font>",allowBlank:false,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:15,maxLengthText:'长度不能超过15'},{xtype:"combo",name:"vc2chargetype",hiddenName:"vc2chargetype",fieldLabel:"<font color=red>付费类型</font>",readOnly:true,mode:"local",displayField:"show",allowBlank:false,valueField:"value",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["show","value"],data:[["-=请选择=-",""],["预付费","1"],["后付费","2"]]})},{xtype:"textfield",name:"numlimited",fieldLabel:"<font color=red>条数限制</font>",regex:WXTL.Common.regex.Integer,regexText:"只能输入数字",allowBlank:false,maxLength:9,maxLengthText:'长度不能超过9'},{xtype:"textfield",name:"vc2contact",fieldLabel:"联系方式",regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText,maxLength:100,maxLengthText:'长度不能超过100'}]}]},{columnWidth:1,layout:'form',defaultType:"textfield",buttonAlign:"center",bodyBorder:false,border:false,bodyStyle:"padding:0px 0 10px 15px",defaults:{anchor:"90%",msgTarget:"side"},items:[UpFile]}]});var mainForm=updateInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"修改客户信息",mainForm:mainForm,updateURL:Js.Center.Business.ECmanage.EcUpdateURL,displayStore:Js.Center.Business.ECmanage.Infostore,updateState:true,updateRecord:row,items:[updateInfofp]})};Ext.namespace('Js.Center.Business.ECsigntureAdd');Js.Center.Business.ECsigntureAdd.func=function(row){if(Js.Center.Business.ECsigntureAdd.window==null){var AddtlecservicecodeInfofp=new Ext.form.FormPanel({width:375,plain:true,layout:"form",defaultType:"textfield",labelWidth:100,baseCls:"x-plain",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0 0 0 0;margin:10 15",items:[{xtype:"hidden",fieldLabel:"EC编号",id:"Js.Center.Business.ECsigntureAdd.numecid",name:"numecid"},{xtype:"hidden",name:"flag",value:"insert"},{xtype:"xComboBox",name:"numtypeid",hiddenName:"numtypeid",fieldLabel:"<font color=red>签名类型</font>",readOnly:true,mode:"local",allowBlank:false,displayField:"vc2typename",valueField:"numtypeid",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["vc2typename","numtypeid"],data:[["严签名","1"],["宽签名","2"]]}),listeners:{'select':function(combox,record,numidex){var typeId=record.data.numtypeid;if(typeId==1){Ext.getCmp("Js.Center.Business.ECsigntureAdd.Signature").regex=/^((\[[^,【】\[\]]+\])|(【[^,【】\[\]]+】))$/;Ext.getCmp("Js.Center.Business.ECsigntureAdd.Signature").regexText="首尾必须是成对的[]或者【】,且内容不能为空"}if(typeId==2){Ext.getCmp("Js.Center.Business.ECsigntureAdd.Signature").regex=/^((\]{1})|(】{1}))$/;Ext.getCmp("Js.Center.Business.ECsigntureAdd.Signature").regexText="只能输入一个]或一个】"}}}},{xtype:"textfield",name:"vc2signture",id:"Js.Center.Business.ECsigntureAdd.Signature",fieldLabel:"<font color=red>报备签名</font>",allowBlank:false,blankText:"报备签名不能为空",regex:/^((\[[^,【】\[\]]+\])|(【[^,【】\[\]]+】))$/,regexText:"首尾必须是成对的[]或者【】,且内容不能为空",maxLength:20,maxLengthText:'长度不能超过20'}]});var mainForm=AddtlecservicecodeInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({width:410,title:"添加报备签名",updateState:true,mainForm:mainForm,updateURL:Js.Center.Business.ECmanage.ECSigntureURL,displayStore:Js.Center.Business.ECsignture.Infostore,items:[AddtlecservicecodeInfofp],needLoadDataStore:true,loadDataStoreFunc:function(){Ext.getCmp("Js.Center.Business.ECsigntureAdd.numecid").setValue(Ext.get("Js.Center.Business.ECsignture.numecid").getValue())}})}};Ext.namespace('Js.Center.Business.ECsigntureDelete');Js.Center.Business.ECsigntureDelete.func=function(row){var deleteSplit="";for(var i=0;i<row.length;i++){if(row.length==1){deleteSplit=row[i].data.numid}else{if(i<(row.length-1)){deleteSplit=row[i].data.numid+","+deleteSplit}if(i==(row.length-1)){deleteSplit=deleteSplit+row[i].data.numid}}};var params={ids:deleteSplit,flag:"delete"};doAjax(Js.Center.Business.ECmanage.ECSigntureURL,params,Js.Center.Business.ECsignture.Infostore)};Ext.namespace('Js.Center.Business.ECsignture');Js.Center.Business.ECsignture.func=function(row){if(Js.Center.Business.ECsignture.window==null){var pageSize=12;var fields=["numid","numecid","numtypeid","vc2typename","vc2signture"];Js.Center.Business.ECsignture.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.Business.ECmanage.ECSigntureURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numid",totalProperty:"totalCount"}),baseParams:{flag:'selectecsignturebykey',numecid:0,numtypeid:''},sortInfo:{field:'numid',direction:'DESC'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numid"});var cm=new Ext.grid.ColumnModel([sm,{header:"签名内容",tooltip:"签名内容",dataIndex:"vc2signture",sortable:true},{header:"签名类型",tooltip:"签名类型",dataIndex:"vc2typename",sortable:true}]);var tlecservicecodegrid=new WXTL.Widgets.CommonGrid.GridPanel({title:"报备签名列表",anchor:'100% 100%',width:810,store:Js.Center.Business.ECsignture.Infostore,sm:sm,cm:cm,afterEditURL:Js.Center.Business.ECmanage.ECSigntureURL,inertMethod:'Js.Center.Business.ECsigntureAdd',updateMethod:'Js.Center.Business.ECsigntureUpdate',deleteMethod:'Js.Center.Business.ECsigntureDelete.func'});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({height:100,queryMethod:"Js.Center.Business.ECsignture.queryMainGrid",defaults:{anchor:"90%",msgTarget:"side"},items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[{xtype:"hidden",id:"Js.Center.Business.ECsignture.numecid",name:"numecid",fieldLabel:"EC主键"},{xtype:"xComboBox",name:"numtypeid",hiddenName:"Js.Center.Business.ECsignture.NumSignTypeID",fieldLabel:"签名类型",readOnly:true,mode:"local",displayField:"vc2typename",valueField:"numtypeid",triggerAction:"all",emptyText:"-=请选择=-",store:Js.Center.Common.EcSignTypeStore}]}]}]});Js.Center.Business.ECsignture.queryMainGrid=function(){if(selectPanel.getForm().isValid()){var numecid=Ext.get("Js.Center.Business.ECsignture.numecid").getValue();var typeid=Ext.get("Js.Center.Business.ECsignture.NumSignTypeID").getValue();var flag='selectecsignturebykey';Js.Center.Business.ECsignture.Infostore.baseParams={numecid:numecid,numtypeid:typeid,flag:flag};Js.Center.Business.ECsignture.Infostore.load({params:{start:0,limit:pageSize}})}};var mainPanel=new Ext.Panel({frame:true,bodyBorder:false,border:false,autoScroll:true,defaults:{collapsible:true},items:[selectPanel,tlecservicecodegrid]});var mainForm=selectPanel.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({title:"报备签名信息",width:850,height:430,autoScroll:true,frame:true,mainForm:mainForm,displayStore:Js.Center.Business.ECsignture.Infostore,updateState:true,updateRecord:row,needLoadDataStore:true,items:[mainPanel],needButtons:false,buttons:[{text:"关  闭",minWidth:70,handler:function(){Js.Center.Business.ECsignture.window.hide()}}],loadDataStoreFunc:function(){Js.Center.Common.EcSignTypeStore.reload();var numecid=Ext.get("Js.Center.Business.ECsignture.numecid").getValue();var typeid=Ext.get("Js.Center.Business.ECsignture.NumSignTypeID").getValue();var flag='selectecsignturebykey';Js.Center.Business.ECsignture.Infostore.baseParams={numecid:numecid,numtypeid:typeid,flag:flag};Js.Center.Business.ECsignture.Infostore.load({params:{numecid:Js.Center.Business.ECsignture.window.updateRecord.get("numecid"),numtypeid:'',start:0,limit:pageSize}})}});}};Ext.namespace('Js.Center.Business.ECsigntureUpdate');Js.Center.Business.ECsigntureUpdate.func=function(row){if(Js.Center.Business.ECsigntureUpdate.window==null){var UpdatetlecservicecodeInfofp=new Ext.form.FormPanel({width:375,plain:true,layout:"form",defaultType:"textfield",labelWidth:100,baseCls:"x-plain",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:0 0 0 0;margin:10 15",items:[{xtype:"hidden",fieldLabel:"签名编号",name:"numid"},{xtype:"hidden",fieldLabel:"EC编号",name:"numecid"},{xtype:"hidden",name:"flag",value:"update"},{xtype:"xComboBox",name:"numtypeid",hiddenName:"numtypeid",fieldLabel:"<font color=red>签名类型</font>",readOnly:true,mode:"local",allowBlank:false,displayField:"vc2typename",valueField:"numtypeid",triggerAction:"all",emptyText:"-=请选择=-",store:new Ext.data.SimpleStore({fields:["vc2typename","numtypeid"],data:[["严签名","1"],["宽签名","2"]]}),listeners:{'select':function(combox,record,numidex){var typeId=record.data.numtypeid;if(typeId==1){Ext.getCmp("Js.Center.Business.ECsigntureUpdate.Signature").regex=/^((\[[^,【】\[\]]+\])|(【[^,【】\[\]]+】))$/;Ext.getCmp("Js.Center.Business.ECsigntureUpdate.Signature").regexText="首尾必须是成对的[]或者【】,且内容不能为空"}if(typeId==2){Ext.getCmp("Js.Center.Business.ECsigntureUpdate.Signature").regex=/^((\]{1})|(】{1}))$/;Ext.getCmp("Js.Center.Business.ECsigntureUpdate.Signature").regexText="只能输入一个]或一个】"}}}},{xtype:"textfield",name:"vc2signture",id:'Js.Center.Business.ECsigntureUpdate.Signature',fieldLabel:"<font color=red>报备签名</font>",allowBlank:false,blankText:"报备签名不能为空",maxLength:20,maxLengthText:'长度不能超过20'}]});var mainForm=UpdatetlecservicecodeInfofp.getForm();this.window=new WXTL.Widgets.CommonWindows.Window({width:400,title:"修改报备签名",updateState:true,mainForm:mainForm,updateURL:Js.Center.Business.ECmanage.ECSigntureURL,displayStore:Js.Center.Business.ECsignture.Infostore,items:[UpdatetlecservicecodeInfofp],needLoadDataStore:true,loadDataStoreFunc:function(){var typeId=Js.Center.Business.ECsigntureUpdate.window.updateRecord.get("numtypeid");if(typeId==1){Ext.getCmp("Js.Center.Business.ECsigntureUpdate.Signature").regex=/^((\[[^,【】\[\]]+\])|(【[^,【】\[\]]+】))$/;Ext.getCmp("Js.Center.Business.ECsigntureUpdate.Signature").regexText="首尾必须是成对的[]或者【】,且内容不能为空"}if(typeId==2){Ext.getCmp("Js.Center.Business.ECsigntureUpdate.Signature").regex=/^((\]{1})|(】{1}))$/;Ext.getCmp("Js.Center.Business.ECsigntureUpdate.Signature").regexText="只能输入一个]或一个】"}Ext.getCmp("Js.Center.Business.ECsigntureUpdate.Signature").focus()}})}};