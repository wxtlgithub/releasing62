Ext.namespace('Js.Center.SendSMS.DepartMoQuery');Js.Center.SendSMS.DepartMoQuery.departmoinfo=function(node){var clientStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"URL/Common/Data/IndustryQuery.ashx",method:"POST"}),reader:new Ext.data.JsonReader({fields:['numclientid','vc2clientname'],root:"data",id:"numclientid"}),baseParams:{flag:'queryclient'}});clientStore.reload();if(Ext.get("Js.Center.SendSMS.DepartMoQuery.DepartMoInfoPanel")==null){var _pageSize=12;var fields=["numseqid","vc2srcmobile","vc2content","longcode","vc2departname","datrecv","vc2username","vc2svcname"];Js.Center.SendSMS.DepartMoQuery.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.SendSMS.YXTMOqueryURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numseqid",totalProperty:"totalCount"}),baseParams:{datstart:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),datend:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),vc2Content:'',longcode:'',vc2mobile:'',clientid:'',flag:'selectbykey'}});Js.Center.SendSMS.DepartMoQuery.Infostore.load({params:{start:0,limit:_pageSize,datstart:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),datend:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),vc2Content:'',longcode:'',vc2mobile:'',clientid:'',flag:'selectbykey'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numcustomerid"});var cm=new Ext.grid.ColumnModel([{header:"手机号码",tooltip:"手机号码",dataIndex:"vc2srcmobile",sortable:true},{header:"短信内容",tooltip:"短信内容",dataIndex:"vc2content",sortable:true,width:200,renderer:function(value){return"<font qtip='"+value+"'>"+value+"</font>"},readOnly:true,editor:new Ext.form.TextField({readOnly:true})},{header:"收到时间",tooltip:"收到时间",dataIndex:"datrecv",sortable:true},{header:"子通道号码",tooltip:"子通道号码",dataIndex:"longcode",sortable:true},{header:"运营商业务",tooltip:"运营商业务",dataIndex:"vc2svcname",sortable:true}]);var departMoInfoGrid=new WXTL.Widgets.CommonGrid.GridPanel({anchor:'100% 100%',pageSize:_pageSize,needMenu:false,store:Js.Center.SendSMS.DepartMoQuery.Infostore,sm:sm,cm:cm,needRightMenu:false});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({height:170,queryMethod:"Js.Center.SendSMS.DepartMoQuery.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[new Ext.form.DateField({fieldLabel:'开始时间',name:'datstart',id:'Js.Center.SendSMS.DepartMoQuery.DatStart',emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),format:'Y-m-d',readOnly:true,validateOnBlur:false,validator:function(){var strat_time=Ext.get("Js.Center.SendSMS.DepartMoQuery.DatStart").dom.value;var end_time=Ext.get("Js.Center.SendSMS.DepartMoQuery.DatEnd").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'}),{xtype:"textfield",name:"vc2content",id:'Js.Center.SendSMS.DepartMoQuery.SMSContent',fieldLabel:"短信内容",maxLength:50,regex:WXTL.Common.regex.Illegal,regexText:WXTL.Common.regexText.IllegalText},{xtype:"textfield",name:"vc2mobile",id:"Js.Center.SendSMS.DepartMoQuery.SMSSendMobile",fieldLabel:"手机号码",regex:WXTL.Common.regex.Mobile,regexText:"手机号码格式不正确"}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[new Ext.form.DateField({fieldLabel:'结束时间',name:'datend',id:'Js.Center.SendSMS.DepartMoQuery.DatEnd',emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),format:'Y-m-d',readOnly:true,validateOnBlur:false,validator:function(){var strat_time=Ext.get("Js.Center.SendSMS.DepartMoQuery.DatStart").dom.value;var end_time=Ext.get("Js.Center.SendSMS.DepartMoQuery.DatEnd").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'}),{xtype:"textfield",name:"longcode",id:"Js.Center.SendSMS.DepartMoQuery.SMSLongCode",fieldLabel:"子通道号码",regex:/^\d{1,20}$/,regexText:"只能输入长度20位以内的数字"},new Ext.form.ComboBox({xtype:"combo",id:"Js.Center.SendSMS.DepartMoQuery.clientid",name:"clientid",hiddenName:"clientid",fieldLabel:"程序编号",mode:"local",displayField:"numclientid",valueField:"numclientid",triggerAction:"all",store:clientStore})]}]}]});Js.Center.SendSMS.DepartMoQuery.queryGrid=function(){if(selectPanel.getForm().isValid()){var datStart=Ext.get("Js.Center.SendSMS.DepartMoQuery.DatStart").getValue();var datEnd=Ext.get("Js.Center.SendSMS.DepartMoQuery.DatEnd").getValue();var vc2Content=Ext.get("Js.Center.SendSMS.DepartMoQuery.SMSContent").getValue();var vc2Mobile=Ext.get("Js.Center.SendSMS.DepartMoQuery.SMSSendMobile").getValue();var longCode=Ext.get("Js.Center.SendSMS.DepartMoQuery.SMSLongCode").getValue();var clientid=Ext.getCmp("Js.Center.SendSMS.DepartMoQuery.clientid").getValue();var flag='selectbykey';Js.Center.SendSMS.DepartMoQuery.Infostore.baseParams={datstart:datStart,datend:datEnd,vc2Content:vc2Content,longcode:longCode,vc2mobile:vc2Mobile,clientid:clientid,flag:flag};Js.Center.SendSMS.DepartMoQuery.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.SendSMS.DepartMoQuery.BlackAdd=function(vc2Mobile){Ext.Msg.confirm("提示!","您确定要将此号码加入黑名单吗?",function(btn){if(btn=="yes"){doSynRequest(Js.Center.Business.BlackUpdateURL+"?whitelistaddnumsvcid=1&flag=insertbylist&mobilelist="+vc2Mobile);}else{}})};Js.Center.SendSMS.DepartMoQuery.DepartMoInfoPanel=new Ext.Panel({frame:true,id:"Js.Center.SendSMS.DepartMoQuery.DepartMoInfoPanel",bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,departMoInfoGrid]})};GridMain(node,Js.Center.SendSMS.DepartMoQuery.DepartMoInfoPanel,"openroomiconinfo","Js.Center.SendSMS.DepartMoQuery.Infostore")};Ext.namespace('Js.Center.SendSMS.SelfDepartMoQuery');Js.Center.SendSMS.SelfDepartMoQuery.departmoinfo=function(node){var clientStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"URL/Common/Data/IndustryQuery.ashx",method:"POST"}),reader:new Ext.data.JsonReader({fields:['numclientid','vc2clientname'],root:"data",id:"numclientid"}),baseParams:{flag:'queryDepartclient'}});clientStore.reload();if(Ext.get("Js.Center.SendSMS.SelfDepartMoQuery.DepartMoInfoPanel")==null){var _pageSize=12;var fields=["numseqid","vc2srcmobile","vc2content","longcode","vc2departname","datrecv","vc2username","vc2svcname"];Js.Center.SendSMS.SelfDepartMoQuery.Infostore=new WXTL.Widgets.CommonData.GroupingStore({proxy:new Ext.data.HttpProxy({url:Js.Center.SendSMS.MOSelfqueryURL,method:"POST"}),reader:new Ext.data.JsonReader({fields:fields,root:"data",id:"numseqid",totalProperty:"totalCount"}),baseParams:{datstart:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),datend:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),vc2Content:'',numsvcid:'',clientId:'',vc2mobile:'',flag:'selectbyselfdepartment'}});Js.Center.SendSMS.SelfDepartMoQuery.Infostore.load({params:{start:0,limit:_pageSize,datstart:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),datend:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),vc2Content:'',numsvcid:'',vc2mobile:'',longcode:'',clientId:'',flag:'selectbyselfdepartment'}});var sm=new Ext.grid.CheckboxSelectionModel({dataIndex:"numcustomerid"});var cm=new Ext.grid.ColumnModel([{header:"手机号码",tooltip:"手机号码",dataIndex:"vc2srcmobile",sortable:true},{header:"短信内容",tooltip:"短信内容",dataIndex:"vc2content",sortable:true,width:200,renderer:function(value){return"<font qtip='"+value+"'>"+value+"</font>"},readOnly:true,editor:new Ext.form.TextField({readOnly:true})},{header:"收到时间",tooltip:"收到时间",dataIndex:"datrecv",sortable:true},{header:"子通道号码",tooltip:"子通道号码",dataIndex:"longcode",sortable:true},{header:"运营商业务",tooltip:"运营商业务",dataIndex:"vc2svcname",sortable:true}]);var departMoInfoGrid=new WXTL.Widgets.CommonGrid.GridPanel({anchor:'100% 100%',pageSize:_pageSize,needMenu:false,store:Js.Center.SendSMS.SelfDepartMoQuery.Infostore,sm:sm,cm:cm,needRightMenu:false,tbar:new Ext.Toolbar({items:[{iconCls:'exporticon',text:"数据导出",handler:function(){var datStart=Ext.get("Js.Center.SendSMS.SelfDepartMoQuery.DatStart").getValue();var datEnd=Ext.get("Js.Center.SendSMS.SelfDepartMoQuery.DatEnd").getValue();var vc2Content=Ext.get("Js.Center.SendSMS.SelfDepartMoQuery.SMSContent").getValue();var longCode=Ext.get("Js.Center.SendSMS.SelfDepartMoQuery.SMSLongCode").getValue();var clientid=Ext.getCmp("Js.Center.SendSMS.SelfDepartMoQuery.clientid").getValue();var vc2Mobile=Ext.get("Js.Center.SendSMS.SelfDepartMoQuery.SMSSendMobile").getValue();var limit=Js.Center.SendSMS.SelfDepartMoQuery.Infostore.getTotalCount();windowOpen(Js.Center.SendSMS.MOSelfqueryURL+"?"+"flag=expot&start=0&limit="+limit+"&datstart="+datStart+"&datend="+datEnd+"&vc2Content="+vc2Content+"&longcode="+longCode+"&vc2mobile="+vc2Mobile+"&clientId="+clientid,400,300)}}]})});var selectPanel=new WXTL.Widgets.CommonPanel.QueryFormPanel({height:170,queryMethod:"Js.Center.SendSMS.SelfDepartMoQuery.queryGrid",items:[{layout:'column',items:[{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[new Ext.form.DateField({fieldLabel:'开始时间',name:'datstart',id:'Js.Center.SendSMS.SelfDepartMoQuery.DatStart',emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),format:'Y-m-d',readOnly:true,validateOnBlur:false,validator:function(){var strat_time=Ext.get("Js.Center.SendSMS.SelfDepartMoQuery.DatStart").dom.value;var end_time=Ext.get("Js.Center.SendSMS.SelfDepartMoQuery.DatEnd").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'}),{xtype:"textfield",name:"vc2content",id:'Js.Center.SendSMS.SelfDepartMoQuery.SMSContent',fieldLabel:"短信内容",maxLength:50,regex:WXTL.Common.regex.IllegalDiy,regexText:WXTL.Common.regexText.IllegalText},{xtype:"textfield",name:"vc2mobile",id:"Js.Center.SendSMS.SelfDepartMoQuery.SMSSendMobile",fieldLabel:"手机号码",regex:WXTL.Common.regex.Mobile,regexText:"手机号码格式不正确"}]},{columnWidth:.5,layout:'form',defaultType:"textfield",defaults:{anchor:"90%",msgTarget:"side"},buttonAlign:"center",bodyStyle:"padding:10px 0 10px 15px",items:[new Ext.form.DateField({fieldLabel:'结束时间',name:'datend',id:'Js.Center.SendSMS.SelfDepartMoQuery.DatEnd',emptyText:Ext.util.Format.date(WXTL.Common.dateTime.getNow(),'Y-m-d'),format:'Y-m-d',readOnly:true,validateOnBlur:false,validator:function(){var strat_time=Ext.get("Js.Center.SendSMS.SelfDepartMoQuery.DatStart").dom.value;var end_time=Ext.get("Js.Center.SendSMS.SelfDepartMoQuery.DatEnd").dom.value;if(strat_time<=end_time){return true}else{return false}},invalidText:'结束时间不能小于开始时间！'}),{xtype:"textfield",name:"longcode",id:"Js.Center.SendSMS.SelfDepartMoQuery.SMSLongCode",fieldLabel:"子通道号码",regex:/^\d{1,20}$/,regexText:"只能输入长度20位以内的数字"},new Ext.form.ComboBox({xtype:"combo",id:"Js.Center.SendSMS.SelfDepartMoQuery.clientid",name:"clientid",hiddenName:"clientid",fieldLabel:"程序编号",mode:"local",displayField:"numclientid",valueField:"numclientid",triggerAction:"all",store:clientStore})]}]}]});Js.Center.SendSMS.SelfDepartMoQuery.queryGrid=function(){if(selectPanel.getForm().isValid()){var datStart=Ext.get("Js.Center.SendSMS.SelfDepartMoQuery.DatStart").getValue();var datEnd=Ext.get("Js.Center.SendSMS.SelfDepartMoQuery.DatEnd").getValue();var vc2Content=Ext.get("Js.Center.SendSMS.SelfDepartMoQuery.SMSContent").getValue();var longCode=Ext.get("Js.Center.SendSMS.SelfDepartMoQuery.SMSLongCode").getValue();var clientid=Ext.getCmp("Js.Center.SendSMS.SelfDepartMoQuery.clientid").getValue();var vc2Mobile=Ext.get("Js.Center.SendSMS.SelfDepartMoQuery.SMSSendMobile").getValue();var flag='selectbyselfdepartment';Js.Center.SendSMS.SelfDepartMoQuery.Infostore.baseParams={datstart:datStart,datend:datEnd,vc2Content:vc2Content,longcode:longCode,vc2mobile:vc2Mobile,clientId:clientid,flag:flag};Js.Center.SendSMS.SelfDepartMoQuery.Infostore.load({params:{start:0,limit:_pageSize}})}};Js.Center.SendSMS.SelfDepartMoQuery.DepartMoInfoPanel=new Ext.Panel({frame:true,id:"Js.Center.SendSMS.SelfDepartMoQuery.DepartMoInfoPanel",bodyBorder:false,border:false,autoScroll:true,layout:"anchor",defaults:{collapsible:true},items:[selectPanel,departMoInfoGrid]})};GridMain(node,Js.Center.SendSMS.SelfDepartMoQuery.DepartMoInfoPanel,"openroomiconinfo","Js.Center.SendSMS.SelfDepartMoQuery.Infostore")};Ext.namespace('Js.Center.SendSMS');Js.Center.SendSMS.MOqueryURL='URL/sendSMS/SendQuery/YXTSendQuery.ashx';Js.Center.SendSMS.YXTMOqueryURL='URL/sendSMS/MOQuery/YXTMOQuery.ashx';Js.Center.SendSMS.MOSelfqueryURL='URL/sendSMS/MOQuery/YXTMOSelfQuery.ashx';