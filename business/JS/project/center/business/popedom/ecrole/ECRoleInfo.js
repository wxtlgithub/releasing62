Ext.namespace('Js.Center.Popedom.ECRoleInfo');Js.Center.Popedom.ECRoleInfo.info = function(node){    if (Ext.get("Js.Center.Popedom.ECRoleInfo.MainPanel") == null) {        // ====================================================================== 定义添加、删除、修改、授权方法        //===================== 修改方法        ecRoleUpdate = function(rowIndex){            var row = ecRoleGrid.getSelectionModel().getSelections();
            if (row.length == 0) {
                Ext.Msg.alert("温馨提示", "请您选择一条记录!");
			} else {
                if (row.length > 1) {
                    Ext.Msg.alert("温馨提示", "对不起，您只能选择一条记录!");
                } else {
                    if (row.length == 1) {
               	        Js.Center.Popedom.ECRoleUpdate.window.updateRecord=row[0];
	                    Js.Center.Popedom.ECRoleUpdate.window.mainForm.loadRecord(row[0]);
	                    Js.Center.Popedom.ECRoleUpdate.window.show();
                    }                }            }        };        //====================== 删除方法        ecRoleDelete = function(rowIndex){            var row = ecRoleGrid.getSelectionModel().getSelections();            if (row.length > 1) {                Ext.Msg.alert("提示信息", "您只能选择一个删除!");            } else if( row.length == 1) {	            Ext.Msg.confirm("提示!", "您确定要删除信息吗?", function(btn){	                if (btn == "yes") {	                    Js.Center.Popedom.ECRoleDelete.func(row);	                }	            })            }        };                //====================== 删除方法        roleArrayDelete = function(){            //得到多个record对象            var row = ecRoleGrid.getSelectionModel().getSelections();            if (row.length == 0) {                Ext.Msg.alert("提示信息", "请您至少选择一个!");            } else {                Ext.Msg.confirm("提示!", "您确定要删除信息吗?", function(btn){                    if (btn == "yes") {                        Js.Center.Popedom.ECRoleDelete.func(row);                    }                })            }        };        //======================================================================== 定义GridPanel相关        // 分页每页显示数量        var _pageSize = 12;        // 指定列参数        var fields = ["numroleid", "vc2rolename", "numdepartid", "vc2departname", "vc2roledesc", "numrolestate", "numcreator", "vc2creatorname", "datcreatetime", "numlastmodifyuser", "vc2lastmodifyname", "datlastmodifytime"];        Js.Center.Popedom.ECRoleInfo.Infostore = new WXTL.Widgets.CommonData.GroupingStore({            proxy: new Ext.data.HttpProxy({                url: Js.Center.Popedom.ECRoleURL,                method: "POST"            }),            reader: new Ext.data.JsonReader({                fields: fields,                root: "data",                id: "numroleid",                totalProperty: "totalCount"                        }),            sortInfo: {                field: 'datcreatetime',                direction: 'DESC'            },//解决分组无效代码            baseParams: {                rolename: '',                limit: _pageSize,                flag: 'selectbykey'            }        });        Js.Center.Popedom.ECRoleInfo.Infostore.load({            params: {                start: 0,                limit: _pageSize,                rolename: '',                flag: 'selectbykey'            }        });                // ==================================================== 列选择模式        var sm = new Ext.grid.CheckboxSelectionModel({            dataIndex: "numroleid"        });        // ===================================================== 列头        var cm = new Ext.grid.ColumnModel([sm, {            header: "序号",            tooltip: "序号",            dataIndex: "numroleid",            sortable: true        }, {            header: "角色名称",            tooltip: "角色名称",            dataIndex: "vc2rolename",            sortable: true        }, {            header: "创建部门",            tooltip: "创建部门",            dataIndex: "vc2departname",            sortable: true        }, {            header: "创建者",            tooltip: "创建者",            dataIndex: "vc2creatorname",            sortable: true        }, {            header: "创建时间",            tooltip: "创建时间",            dataIndex: "datcreatetime",            sortable: true        }, {            header: "修改人",            tooltip: "修改人",            dataIndex: "vc2lastmodifyname",            sortable: true        }, {            header: "修改时间",            tooltip: "修改时间",            dataIndex: "datlastmodifytime",            sortable: true        }, {            header: "备注",            tooltip: "备注",            dataIndex: "vc2roledesc",            sortable: true        }, {            header: "角色操作",            tooltip: "角色操作",            dataIndex: "numroleid",            renderer: function(value, meta, record, rowIndex, colIndex, store){                            return "<a href='#' onclick='ecRoleUpdate(\"" + rowIndex + "\")'>修改</a>　<a href='#' onclick='ecRoleDelete(\"" + rowIndex + "\")'>删除</a>";            }        }]);                //==============================================================定义grid        var ecRoleGrid = new WXTL.Widgets.CommonGrid.GridPanel({            anchor: '100% 100%',            pageSize: _pageSize,            needMenu: false,            needRightMenu: false,            store: Js.Center.Popedom.ECRoleInfo.Infostore,            //但字段修改路径定义            afterEditURL: Js.Center.Popedom.ECRoleURL,            //添加调用方法名称            inertMethod: 'Js.Center.Popedom.ECRoleAdd',            //修改调用方法名称            updateMethod: 'Js.Center.Popedom.ECRoleUpdate',            //删除调用方法名称            deleteMethod: 'Js.Center.Popedom.ECRoleDelete.func',            sm: sm,            cm: cm,            tbar: new Ext.Toolbar({                items: [{                    iconCls: 'addicon',                    text: "添加角色",                    tooltip: "添加角色",                    handler: function(){
						ecRoleGrid.doInsert();
					}                                   }, "", "-", "", {                    text: "删除",                    tooltip: "删除",                    iconCls: "deleteicon",                    handler: function(){
						ecRoleGrid.doDelete();
					}                }]            })                });                //============================================================================ 定义formpanel        var selectPanel = new WXTL.Widgets.CommonPanel.QueryFormPanel({            id: "Js.Center.Popedom.ECRoleInfo.selectPanel",            height: 100,            //查询调用的方法            queryMethod: "Js.Center.Popedom.ECRoleInfo.queryGrid",            items: [{                layout: 'column',                items: [{                    columnWidth: .5,                    layout: 'form',                    defaultType: "textfield",                    defaults: {                        anchor: '90%',                        msgTarget: "side"                    },                    items: [{                        fieldLabel: '角色名称',                        name: 'rolename',                        id: 'Js.Center.Popedom.ECRoleInfo.RoleName',                        regex: WXTL.Common.regex.Illegal,                        regexText: WXTL.Common.regexText.IllegalText,                        maxLength: 50                    }]                }]            }]        });                //============================================================== 定义查询按钮事件方法        Js.Center.Popedom.ECRoleInfo.queryGrid = function(){            if (selectPanel.getForm().isValid()) {                var _roleName = Ext.get("Js.Center.Popedom.ECRoleInfo.RoleName").getValue();                var _flag = 'selectbykey';                Js.Center.Popedom.ECRoleInfo.Infostore.baseParams = {                    rolename: _roleName,                    flag: _flag                };                Js.Center.Popedom.ECRoleInfo.Infostore.load({                    params: {                        start: 0,                        limit: _pageSize,                        rolename: _roleName,                        flag: _flag                    }                });            }        };                //============================================================================定义主panel        Js.Center.Popedom.ECRoleInfo.MainPanel = new Ext.Panel({            frame: true, // 渲染面板            id: "Js.Center.Popedom.ECRoleInfo.MainPanel",            bodyBorder: false,            border: false,            autoScroll: true, // 自动显示滚动条            layout: "anchor",            defaults: {                collapsible: true // 允许展开和收缩            },            items: [selectPanel, ecRoleGrid]                 });    };    //============================================================================绑定到center    GridMain(node, Js.Center.Popedom.ECRoleInfo.MainPanel, "openroomiconinfo", "Js.Center.Popedom.ECRoleInfo.Infostore");};