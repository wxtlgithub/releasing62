Ext.namespace('Js.Center.Popedom.Role');Js.Center.Popedom.Role.info = function(node){      if (Ext.get("Js.Center.Popedom.Role.MainPanel") == null) {        // ====================================================================== 定义添加、删除、修改、授权方法                //===================== 修改方法        roleUpdate = function(rowIndex){             var row=roleGrid.getSelectionModel().getSelections();
                 if (row.length == 0) {
                    Ext.Msg.alert("温馨提示", "请您选择一条记录!");
                }
                else 
                    if (row.length > 1) {
                        Ext.Msg.alert("温馨提示", "对不起，您只能选择一条记录!");
                    }
                    else 
                        if (row.length == 1) {
                   	        Js.Center.Popedom.RoleUpdate.window.updateRecord=row[0];
		                    Js.Center.Popedom.RoleUpdate.window.mainForm.loadRecord(row[0]);
		                    Js.Center.Popedom.RoleUpdate.window.show();
                        }        };        //====================== 删除方法        roleDelete = function(rowIndex){            //var row = Js.Center.Popedom.Role.Infostore.getAt(rowIndex);            var row = roleGrid.getSelectionModel().getSelections();            if (row.length > 1) {                Ext.Msg.alert("提示信息", "您只能选择一个删除!");            }            else if( row.length == 1) {                        Ext.Msg.confirm("提示!", "您确定要删除信息吗?", function(btn){                if (btn == "yes") {                    Js.Center.Popedom.RoleDelete.func(row);                }                else {                }            })                        }        };                //====================== 删除方法        roleArrayDelete = function(){            //得到多个record对象            var row = roleGrid.getSelectionModel().getSelections();            if (row.length == 0) {                Ext.Msg.alert("提示信息", "请您至少选择一个!");            }            else {                Ext.Msg.confirm("提示!", "您确定要删除信息吗?", function(btn){                    if (btn == "yes") {                                                                                Js.Center.Popedom.RoleDelete.func(row);                                           }                    else {                                        }                })            }        };                // =====================授权方法        rolePermit = function(){            Js.Center.Popedom.Role.RolePermit.window.updateRecord=null ;			Js.Center.Popedom.Role.RolePermit.window.show();            //Js.Center.Popedom.Role.RolePermit.func(roleId, roleName, departId, departName);        };        // =====================角色授权给用户方法        rolePermitToUser = function(){               var row=roleGrid.getSelectionModel().getSelections();
                 if (row.length == 0) {
                    Ext.Msg.alert("温馨提示", "请您选择一条记录!");
                }
                else 
                    if (row.length > 1) {
                        Ext.Msg.alert("温馨提示", "对不起，您只能选择一条记录!");
                    }
                    else 
                        if (row.length == 1) {
                   	        Js.Center.Popedom.Role.RolePermitToUser.window.updateRecord=row[0];
		                    Js.Center.Popedom.Role.RolePermitToUser.window.mainForm.loadRecord(row[0]);
		                    Js.Center.Popedom.Role.RolePermitToUser.window.show();
                        }                    //Js.Center.Popedom.Role.RolePermitToUser.func(roleId, roleName, departId, departName, roleDesc);        };        // =====================角色授权给部门方法        rolePermitToDepart = function(){         var row=roleGrid.getSelectionModel().getSelections();
                 if (row.length == 0) {
                    Ext.Msg.alert("温馨提示", "请您选择一条记录!");
                }
                else 
                    if (row.length > 1) {
                        Ext.Msg.alert("温馨提示", "对不起，您只能选择一条记录!");
                    }
                    else 
                        if (row.length == 1) {
                   	        Js.Center.Popedom.Role.RolePermitToDepart.window.updateRecord=row[0];
		                    Js.Center.Popedom.Role.RolePermitToDepart.window.mainForm.loadRecord(row[0]);
		                    Js.Center.Popedom.Role.RolePermitToDepart.window.show();
                        }            //Js.Center.Popedom.Role.RolePermitToDepart.func(roleId, roleName, departId, departName, roleDesc);        };        //======================================================================== 定义GridPanel相关        // 分页每页显示数量        var _pageSize = 12;        // 指定列参数                var fields = ["numroleid", "vc2rolename", "numdepartid", "vc2departname", "vc2roledesc", "numrolestate", "numcreator", "vc2creatorname", "datcreatetime", "numlastmodifyuser", "vc2lastmodifyname", "datlastmodifytime", "departcount", "usercount"];        Js.Center.Popedom.Role.Infostore = new WXTL.Widgets.CommonData.GroupingStore({            proxy: new Ext.data.HttpProxy({                url: Js.Center.Popedom.UserFuncRoleURL,                method: "POST"            }),            reader: new Ext.data.JsonReader({                fields: fields,                root: "data",                id: "numroleid",                totalProperty: "totalCount"                        }),            sortInfo: {                field: 'datcreatetime',                direction: 'DESC'            },//解决分组无效代码            baseParams: {                rolename: '',                departid: '',                limit: _pageSize,                flag: 'selectbykey'            }        });        Js.Center.Popedom.Role.Infostore.load({            params: {                start: 0,                limit: _pageSize,                rolename: '',                departid: '',                flag: 'selectbykey'            }        });                // ==================================================== 列选择模式        var sm = new Ext.grid.CheckboxSelectionModel({            dataIndex: "numroleid"        });        // ===================================================== 列头        var cm = new Ext.grid.ColumnModel([sm, {            header: "序号",            tooltip: "序号",            dataIndex: "numroleid",            sortable: true        }, {            header: "角色名称",            tooltip: "角色名称",            dataIndex: "vc2rolename",            sortable: true        }, {            header: "创建部门",            tooltip: "创建部门",            dataIndex: "vc2departname",            sortable: true        }, {            header: "创建者",            tooltip: "创建者",            dataIndex: "vc2creatorname",            sortable: true        }, {            header: "创建时间",            tooltip: "创建时间",            dataIndex: "datcreatetime",            sortable: true        }, {            header: "修改人",            tooltip: "修改人",            dataIndex: "vc2lastmodifyname",            sortable: true        }, {            header: "修改时间",            tooltip: "修改时间",            dataIndex: "datlastmodifytime",            sortable: true        }, {            header: "备注",            tooltip: "备注",            dataIndex: "vc2roledesc",            sortable: true        }, {            header: "授权账户",            tooltip: "授权账户",            dataIndex: "usercount",            renderer: function(value, meta, record, rowIndex, colIndex, store){                return "&nbsp;&nbsp;<a href='#' onclick='rolePermitToUser()'>授权</a>　";            }        }, {            header: "授权部门",            tooltip: "授权部门",            dataIndex: "departcount",            renderer: function(value, meta, record, rowIndex, colIndex, store){                return "&nbsp;&nbsp;<a href='#' onclick='rolePermitToDepart()'>授权</a>　";            }        }, {            header: "角色操作",            tooltip: "角色操作",            dataIndex: "numroleid",            renderer: function(value, meta, record, rowIndex, colIndex, store){                            return "<a href='#' onclick='roleUpdate(\"" + rowIndex + "\")'>修改</a>　<a href='#' onclick='roleDelete(\"" + rowIndex + "\")'>删除</a>";            }        }]);                var RolearrInitLoadFunc = new Array();
		    RolearrInitLoadFunc[0] = "Js.Center.Popedom.Role.RolePermitToUser.func";		    RolearrInitLoadFunc[1] = "Js.Center.Popedom.Role.RolePermitToDepart.func";		    RolearrInitLoadFunc[2] = "Js.Center.Popedom.Role.RolePermit.func";         //==============================================================定义grid        var roleGrid = new WXTL.Widgets.CommonGrid.GridPanel({            anchor: '100% 100%',            pageSize: _pageSize,            needMenu: false,            needRightMenu: false,            store: Js.Center.Popedom.Role.Infostore,            //但字段修改路径定义            afterEditURL: Js.Center.Popedom.UserFuncRoleUpdateURL,            //添加调用方法名称            inertMethod: 'Js.Center.Popedom.RoleAdd',            //修改调用方法名称            updateMethod: 'Js.Center.Popedom.RoleUpdate',            //删除调用方法名称            deleteMethod: 'Js.Center.Popedom.RoleDelete.func',            //其他需要预加载函数
			otherInitLoadFunc:RolearrInitLoadFunc,
            sm: sm,            cm: cm,            tbar: new Ext.Toolbar({                items: [{                    iconCls: 'addicon',                    text: "添加角色",                    tooltip: "添加角色",                    handler: function(){
						roleGrid.doInsert();
					}                                   }, "", "-", "", {                    text: "角色授权",                    tooltip: "角色授权",                    iconCls: "editicon",                    handler: function(){                        rolePermit();                    }                }, "", "-", "", {                    text: "删除",                    tooltip: "删除",                    iconCls: "deleteicon",                    handler: function(){
						roleGrid.doDelete();
					}                }]            })                });                //============================================================================ 定义formpanel        //定义部门结构树        var departComboxTree = new WXTL.Widgets.CommonForm.ComboWithTree({            name: 'numdepartid',            hiddenName: 'numdepartid',            id: 'Js.Center.Popedom.RoleInfo.departComboxTree',            fieldLabel: "部门名称",            valueField: 'id',            //treeRootVisible: true,            listHeight: '150',            baseParams: {                columnlist: "numdepartid,vc2departname",                flag: 'selectallbycurrentuser'            },            dataUrl: Js.Center.Popedom.DepartmentsQueryURL//'URL/tree.ashx'        });        var selectPanel = new WXTL.Widgets.CommonPanel.QueryFormPanel({            id: "Js.Center.Popedom.Role.selectPanel",            height: 100,            //查询调用的方法            queryMethod: "Js.Center.Popedom.Role.queryGrid",            items: [{                layout: 'column',                items: [{                    columnWidth: .5,                    layout: 'form',                    defaultType: "textfield",                    defaults: {                        anchor: '90%',                        msgTarget: "side"                    },                    items: [{                        fieldLabel: '角色名称',                        name: 'rolename',                        id: 'Js.Center.Popedom.Role.RoleName',                        regex: WXTL.Common.regex.Illegal,                        regexText: WXTL.Common.regexText.IllegalText,                        maxLength: 50                    }]                }, {                    columnWidth: .5,                    layout: 'form',                    defaultType: "textfield",                    defaults: {                        anchor: '90%',                        msgTarget: "side"                    },                    items: [departComboxTree]                }]            }]        });                //============================================================== 定义查询按钮事件方法        Js.Center.Popedom.Role.queryGrid = function(){            if (selectPanel.getForm().isValid()) {                var _roleName = Ext.get("Js.Center.Popedom.Role.RoleName").getValue();                var _departId = departComboxTree.getValue() == null ? "" : departComboxTree.getValue().replace("s", "");                var _flag = 'selectbykey';                Js.Center.Popedom.Role.Infostore.baseParams = {                    rolename: _roleName,                    departid: _departId,                    flag: _flag                };                Js.Center.Popedom.Role.Infostore.load({                    params: {                        start: 0,                        limit: _pageSize,                        rolename: _roleName,                        departid: _departId,                        flag: _flag                    }                });            }        };                //============================================================================定义主panel        Js.Center.Popedom.Role.MainPanel = new Ext.Panel({            frame: true, // 渲染面板            id: "Js.Center.Popedom.Role.MainPanel",            bodyBorder: false,            border: false,            autoScroll: true, // 自动显示滚动条            layout: "anchor",            defaults: {                collapsible: true // 允许展开和收缩            },            items: [selectPanel, roleGrid]                 });    };    //============================================================================绑定到center    GridMain(node, Js.Center.Popedom.Role.MainPanel, "openroomiconinfo", "Js.Center.Popedom.Role.Infostore");};