Ext.namespace('Js.Center.YXTStatistics.mtByCustomer');Js.Center.YXTStatistics.mtByCustomer.info = function(node){    if (Ext.get("Js.Center.YXTStatistics.mtByCustomer.mainpanel") == null) {        //============================================================================定义GridPanel相关        // 分页每页显示数量        var _pageSize = -1;        //==============================================================Grid数据定义        Js.Center.YXTStatistics.mtByCustomer.querydate = 1;        Js.Center.YXTStatistics.mtByCustomer.SMSInfostore = new WXTL.Widgets.CommonData.GroupingStore({            proxy: new Ext.data.HttpProxy({                url: Js.Center.Statistics.YXTStatisticsMtURL,                method: "POST"            }),            reader: new Ext.data.JsonReader({                fields: ["datstat", "numorder", "numuserid", "vc2username", "numall", "numsuccess", "numfailed", "numnoreport", "num_rate", "numdepartid", "vc2departname", "vc2opname", "num_all_fee"],                root: "data",                id: "numlogid",                totalProperty: "totalCount"            }),            sortInfo: {                field: 'datstat',                direction: 'ASC'            },//解决分组无效代码            baseParams: {                start: 0,
                limit: _pageSize,                datcreattimestart: Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(), -7/*减3天*/), 'Y-m-d'),                datcreattimeend: Ext.util.Format.date(WXTL.Common.dateTime.getNow(), 'Y-m-d'),                numsmstype: '',                vc2departname: '',                vc2username: '',                querydate:Js.Center.YXTStatistics.mtByCustomer.querydate ,                flag: 'countbycustomer'            }        });        //==============================================================列选择模式         var SMSsm = new Ext.grid.CheckboxSelectionModel({            dataIndex: "numlogid"        });        //==============================================================列头        var SMScm = new Ext.grid.ColumnModel([{            header: "统计时间",            tooltip: "统计时间",            dataIndex: "datstat",            sortable: true        }, {            header: "用户名称",            tooltip: "用户名称",            dataIndex: "vc2username",            sortable: true        }, {            header: "部门顺序号",            tooltip: "部门顺序号",            dataIndex: "numorder",            sortable: true        }, {            header: "部门名称",            tooltip: "部门名称",            dataIndex: "vc2departname",            sortable: true        }, {            header: "运营商名称",            tooltip: "运营商名称",            dataIndex: "vc2opname",            sortable: true        }, {            header: "总数",            tooltip: "总数",            dataIndex: "numall",            sortable: true        }, {            header: "成功数",            tooltip: "成功数",            dataIndex: "numsuccess",            sortable: true        }, {            header: "失败数",            tooltip: "失败数",            dataIndex: "numfailed",            sortable: true        }, {            header: "未知数",            tooltip: "未知数",            dataIndex: "numnoreport",            sortable: true        }, {            header: "成功率",            tooltip: "成功率",            dataIndex: "num_rate",            sortable: true        }, {            header: "费用（元）",            tooltip: "费用（元）",            dataIndex: "num_all_fee",            sortable: true        }]);                //==============================================================定义grid        var userGroupSMSGrid = new WXTL.Widgets.CommonGrid.GridPanel({            anchor: '100% 100%',            title:'短信用户统计信息',            needPage: false,            store: Js.Center.YXTStatistics.mtByCustomer.SMSInfostore,            needMenu: false,            needRightMenu: false,            sm: SMSsm,            cm: SMScm,            tbar: new Ext.Toolbar({                items: [{                    iconCls: 'exporticon',                    text: "数据导出",                    handler: function(){                    	//exportData(Js.Center.Statistics.YXTStatisticsMtURL, "flag=loadbycustomer&start=0&limit=-1&datcreattimestart=" + Ext.get("Js.Center.YXTStatistics.mtByCustomer.DatStart").getValue() + "&datcreattimeend=" + Ext.get("Js.Center.YXTStatistics.mtByCustomer.DatEnd").getValue() + "&vc2departname=" + encodeURI(Ext.get("Js.Center.YXTStatistics.mtByCustomer.DepartmentName").getValue()) + "&vc2username=" + encodeURI(Ext.get("Js.Center.YXTStatistics.mtByCustomer.UserName").getValue()));                    	windowOpen(Js.Center.Statistics.YXTStatisticsMtURL + "?" + "flag=loadbycustomer&start=0&limit=-1&datcreattimestart=" + Ext.get("Js.Center.YXTStatistics.mtByCustomer.DatStart").getValue() + "&datcreattimeend=" + Ext.get("Js.Center.YXTStatistics.mtByCustomer.DatEnd").getValue() + "&vc2departname=" + encodeURI(Ext.get("Js.Center.YXTStatistics.mtByCustomer.DepartmentName").getValue()) + "&vc2username=" + encodeURI(Ext.get("Js.Center.YXTStatistics.mtByCustomer.UserName").getValue()), 400, 300);                    }                }]            })        });        //=============================================================短信grad完毕        //=============================================================彩信grad开始        Js.Center.YXTStatistics.mtByCustomer.MMSInfostore = new WXTL.Widgets.CommonData.GroupingStore({            proxy: new Ext.data.HttpProxy({                url: Js.Center.MMSStatistics.YXTMMSStatisticsMtURL,                method: "POST"            }),            reader: new Ext.data.JsonReader({                fields: ["datstat", "numorder", "numuserid", "vc2username", "numall", "numsuccess", "numfailed", "numnoreport", "num_rate", "numdepartid", "vc2departname", "vc2opname", "num_all_fee"],//["datstat", "numdepartid", "vc2departname", "nummessageformat", "nummtcnt", "numsuccnt", "numfaicnt", "numnocnt", "numsuc_rate"],                root: "data",                id: "numlogid",                totalProperty: "totalCount"            }),            sortInfo: {                field: 'datstat',                direction: 'ASC'            },//解决分组无效代码            baseParams: {                start: 0,                limit: _pageSize,                datcreattimestart: Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(), -7/*减3天*/), 'Y-m-d'),                datcreattimeend: Ext.util.Format.date(WXTL.Common.dateTime.getNow(), 'Y-m-d'),                vc2departname: '',                vc2username: '',                flag: 'countbycustomer'            }        });        //==============================================================列选择模式         var MMSsm = new Ext.grid.CheckboxSelectionModel({            dataIndex: "numlogid"        });        //==============================================================列头        var MMScm = new Ext.grid.ColumnModel([{            header: "统计时间",            tooltip: "统计时间",            dataIndex: "datstat",            sortable: true        }, {            header: "用户名称",            tooltip: "用户名称",            dataIndex: "vc2username",            sortable: true        }, {            header: "部门顺序号",            tooltip: "部门顺序号",            dataIndex: "numorder",            sortable: true        }, {            header: "部门名称",            tooltip: "部门名称",            dataIndex: "vc2departname",            sortable: true        }, {            header: "运营商名称",            tooltip: "运营商名称",            dataIndex: "vc2opname",            sortable: true        }, {            header: "总数",            tooltip: "总数",            dataIndex: "numall",            sortable: true        }, {            header: "成功数",            tooltip: "成功数",            dataIndex: "numsuccess",            sortable: true        }, {            header: "失败数",            tooltip: "失败数",            dataIndex: "numfailed",            sortable: true        }, {            header: "未知数",            tooltip: "未知数",            dataIndex: "numnoreport",            sortable: true        }, {            header: "成功率",            tooltip: "成功率",            dataIndex: "num_rate",            sortable: true        }, {            header: "费用（元）",            tooltip: "费用（元）",            dataIndex: "num_all_fee",            sortable: true        }]);                //==============================================================定义grid        var userGroupMMSGrid = new WXTL.Widgets.CommonGrid.GridPanel({            anchor: '100% 100%',            title:'彩信用户统计信息',            needPage: false,            store: Js.Center.YXTStatistics.mtByCustomer.MMSInfostore,            needMenu: false,            needRightMenu: false,            sm: MMSsm,            cm: MMScm,            tbar: new Ext.Toolbar({                items: [{                    iconCls: 'exporticon',                    text: "数据导出",                    handler: function(){                    	//exportData(Js.Center.MMSStatistics.MMSStatisticsMtURL, "flag=loadbycustomer&start=0&limit=-1&datcreattimestart=" + Ext.get("Js.Center.YXTStatistics.mtByCustomer.DatStart").getValue() + "&datcreattimeend=" + Ext.get("Js.Center.YXTStatistics.mtByCustomer.DatEnd").getValue() + "&vc2departname=" + encodeURI(Ext.get("Js.Center.YXTStatistics.mtByCustomer.DepartmentName").getValue()) + "&vc2username=" + encodeURI(Ext.get("Js.Center.YXTStatistics.mtByCustomer.UserName").getValue()));                    	windowOpen(Js.Center.MMSStatistics.YXTMMSStatisticsMtURL + "?" + "flag=loadbycustomer&start=0&limit=-1&datcreattimestart=" + Ext.get("Js.Center.YXTStatistics.mtByCustomer.DatStart").getValue() + "&datcreattimeend=" + Ext.get("Js.Center.YXTStatistics.mtByCustomer.DatEnd").getValue() + "&vc2departname=" + encodeURI(Ext.get("Js.Center.YXTStatistics.mtByCustomer.DepartmentName").getValue()) + "&vc2username=" + encodeURI(Ext.get("Js.Center.YXTStatistics.mtByCustomer.UserName").getValue()), 400, 300);                    }                }]            })        });        //=============================================================彩信grad完毕        //=============================================================定义formpanel        var mtByDepStartdate = new Ext.form.DateField({            fieldLabel: "开始时间",            format: 'Y-m-d',            labelWidth: 100,            bodyStyle: 'padding:5px 5px 0',            readOnly: true,            emptyText: Ext.util.Format.date(WXTL.Common.dateTime.addDay(WXTL.Common.dateTime.getNow(), -7/*减3天*/), 'Y-m-d'),            fieldLabel: "开始时间",            name: "datcreattimestart",            id: "Js.Center.YXTStatistics.mtByCustomer.DatStart",            validateOnBlur: false,            validator: function(){                var strat_time = Ext.get("Js.Center.YXTStatistics.mtByCustomer.DatStart").dom.value;                var end_time = Ext.get("Js.Center.YXTStatistics.mtByCustomer.DatEnd").dom.value;                if (strat_time <= end_time) {                    return true;                }                else {                    return false;                }            },            invalidText: '结束时间不能小于开始时间！'        });        var mtByDepEnddate = new Ext.form.DateField({            fieldLabel: "结束时间",            labelWidth: 100,            format: 'Y-m-d',            bodyStyle: 'padding:5px 5px 0',            readOnly: true,            emptyText: Ext.util.Format.date(WXTL.Common.dateTime.getNow(), 'Y-m-d'),            name: "datcreattimeend",            id: "Js.Center.YXTStatistics.mtByCustomer.DatEnd",            validateOnBlur: false,            validator: function(){                var strat_time = Ext.get("Js.Center.YXTStatistics.mtByCustomer.DatStart").dom.value;                var end_time = Ext.get("Js.Center.YXTStatistics.mtByCustomer.DatEnd").dom.value;                if (strat_time <= end_time) {                    return true;                }                else {                    return false;                }            },            invalidText: '结束时间不能小于开始时间！'        });        var selectPanel = new WXTL.Widgets.CommonPanel.QueryFormPanel({            //查询调用的方法            bodyStyle: "padding:10px 0 10px 15px",            buttonAlign: "center",            height: 150,            queryMethod: "Js.Center.YXTStatistics.mtByCustomer.queryGrid",            items: [{                layout: 'column',                items: [{                    columnWidth: .5,                    layout: 'form',                    defaultType: "textfield",                    //锚点布局-                    defaults: {                        anchor: "90%",                        msgTarget: "side"                    },                    items: [mtByDepStartdate, {                        xtype: "textfield",                        name: "vc2departname",                        id: "Js.Center.YXTStatistics.mtByCustomer.DepartmentName",                        fieldLabel: "部门名称",                        regex: WXTL.Common.regex.Illegal,                        regexText: WXTL.Common.regexText.IllegalText,                        maxLength: 15,                        maxLengthText: '长度不能超过15！'                    }]                }, {                    columnWidth: .5,                    layout: 'form',                    defaultType: "textfield",                    //锚点布局-                    defaults: {                        anchor: "90%",                        msgTarget: "side"                    },                                        items: [mtByDepEnddate, {                        xtype: "textfield",                        name: "vc2username",                        id: "Js.Center.YXTStatistics.mtByCustomer.UserName",                        fieldLabel: "用户名",                        regex: WXTL.Common.regex.Illegal,                        regexText: WXTL.Common.regexText.IllegalText,                        maxLength: 15,                        maxLengthText: '长度不能超过15！'                    }]                }]            }]        });                //============================================================== 定义查询按钮事件方法        Js.Center.YXTStatistics.mtByCustomer.queryGrid = function(){            if (selectPanel.getForm().isValid()) {                var _datCreatTimeStart = Ext.get("Js.Center.YXTStatistics.mtByCustomer.DatStart").getValue();                var _datCreatTimeend = Ext.get("Js.Center.YXTStatistics.mtByCustomer.DatEnd").getValue();                var _vc2departname = Ext.get("Js.Center.YXTStatistics.mtByCustomer.DepartmentName").getValue();                var _username = Ext.get("Js.Center.YXTStatistics.mtByCustomer.UserName").getValue();                var _flag = 'countbycustomer';                //短信查询load及参数                Js.Center.YXTStatistics.mtByCustomer.SMSInfostore.baseParams = {                    flag: _flag,                    datcreattimestart: _datCreatTimeStart,                    datcreattimeend: _datCreatTimeend,                    vc2departname: _vc2departname,                    vc2username: _username                };                Js.Center.YXTStatistics.mtByCustomer.SMSInfostore.load({                    params: {                        start: 0,                        limit: _pageSize                    }                });                //彩信查询load及参数                Js.Center.YXTStatistics.mtByCustomer.MMSInfostore.baseParams = {                        flag: _flag,                        datcreattimestart: _datCreatTimeStart,                        datcreattimeend: _datCreatTimeend,                        vc2departname: _vc2departname,                        vc2username: _username                    };                Js.Center.YXTStatistics.mtByCustomer.MMSInfostore.load({                        params: {                        start: 0,                        limit: _pageSize                    }                });            }        };                //============================================================================定义主panel        Js.Center.YXTStatistics.mtByCustomer.MainPanel = new Ext.Panel({            id: "Js.Center.YXTStatistics.mtByCustomer.mainpanel",            frame: true, // 渲染面板            bodyBorder: false,            border: false,            autoScroll: true, // 自动显示滚动条            layout: "anchor",            defaults: {                collapsible: true // 允许展开和收缩            },            items: [selectPanel, userGroupSMSGrid, userGroupMMSGrid]        });    };    //============================================================================绑定到center    GridMain(node, Js.Center.YXTStatistics.mtByCustomer.MainPanel, "openroomiconinfo", "Js.Center.YXTStatistics.mtByCustomer.MMSInfostore","Js.Center.YXTStatistics.mtByCustomer.queryGrid()");};