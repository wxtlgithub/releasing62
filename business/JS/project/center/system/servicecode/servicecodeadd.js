Ext.namespace('Js.Center.Business.ServiceCodeAdd');//==============================================================网关下拉列表数据定义Js.Center.Common.GatewayStore.Add = new Ext.data.Store({    proxy: new Ext.data.HttpProxy({        url: Js.Center.Business.GatewayURL,        method: "POST"    }),    reader: new Ext.data.JsonReader({        fields: ['numgwid', 'vc2gatewayname'],        root: 'data',        id: 'numgwid'    }),    baseParams: {        columnlist: 'numgwid,vc2gatewayname',        flag: 'selectall',        serviceflag: 'selectbyservicetype',        instids:'numinstid'    }});Js.Center.Business.ServiceCodeAdd.func = function(){		var busareaCombox = new Ext.form.ComboBox({        xtype: "xComboBox",        name: "numbusarea",        hiddenName: "numbusarea",        id: 'Js.Center.Business.ServiceCodeAdd.NumBusArea',        emptyText: "-=请选择=-",        allowBlank: false,        blankText: "请选通道商务归属",        fieldLabel: "<font color=red>通道商务归属</font>",        readOnly: true,        mode: "local",        displayField: "vc2branchcompany",        valueField: "numbranchcompany",        triggerAction: "all",        store:Js.Center.Common.BranchCompanyStore    });	    WXTL.Common.showWaitLoading(true);    /*    Js.Center.Common.GatewayStore.Add.reload({        params: {            vc2servicetype: "-1",            serviceflag: 'selectbyservicetype',            instids:'numinstid'        }    });    */     //得到网关号码+业务子码 赋值服务代码    function setVc2ServCode(){    	if(Ext.getCmp("Js.Center.Business.ServiceCodeAdd.tempnumgwid").getValue()!=""){    	 Ext.Ajax.request({	                url: Js.Center.Business.ServiceCodeByGatewayURL,	                method: "POST",	                params: {	                	numGatewayId: Ext.getCmp("Js.Center.Business.ServiceCodeAdd.tempnumgwid").getValue(),	                    flag: "getgatewayspnumber"	                },	                success: function(form, action) {	                    var objJson = Ext.util.JSON.decode(form.responseText);	                    var flag = objJson.success;	                    if(true == flag){	                    	 var vc2servercode=Ext.getCmp("Js.Center.Business.ServiceCodeAdd.vc2longcode").getValue();	   					     Ext.getCmp("Js.Center.Business.ServiceCodeAdd.vc2servcode").setValue(objJson.error+vc2servercode);	                    }	                },	                failure: function() {	                    Ext.Msg.alert("温馨提示", "系统忙，请稍候...!");	                }	            });    	}else{    		var vc2servercode=Ext.getCmp("Js.Center.Business.ServiceCodeAdd.vc2longcode").getValue();    		Ext.getCmp("Js.Center.Business.ServiceCodeAdd.vc2servcode").setValue(vc2servercode);    	}    };    // ================================================================== 定义FormPanel    var addServiceCodeInfofp = new Ext.form.FormPanel({        frame: true,        labelWidth: 80,        defaults: {            anchor: "100%",            msgTarget: "side"        },        items: [{            layout: 'column',            items: [{                xtype: "hidden",                name: "flag",                value: "insert"            }, {                columnWidth: .5,                layout: 'form',                defaultType: "textfield",                //锚点布局-                defaults: {                    anchor: "90%",                    msgTarget: "side"                },                buttonAlign: "center",                bodyStyle: "padding:10px 0 10px 15px",                items: [{                    xtype: "textfield",                    name: "vc2svc",                    fieldLabel: "<font color=red>业务代码</font>",                    allowBlank: false,                    blankText: "业务编码不允许为空",                    regex: WXTL.Common.regex.Illegal,                    regexText: WXTL.Common.regexText.IllegalText,                    maxLength: 10,                    maxLengthText: '长度不能超过10！'                }, {                    xtype: "combo",                    name: "vc2type",                    fieldLabel: "<font color=red>计费类型</font>",                    hiddenName: "vc2type",                    emptyText: "请选择",                    readOnly: true,                    mode: "local",                    displayField: "show",                    valueField: "value",                    triggerAction: "all",                    value: 1,                    allowBlank: false,                    blankText: "计费类型不允许为空",                    store: new Ext.data.SimpleStore({                        fields: ["show", "value"],                        data: [["免费", "0"], ["按条", "1"], ["包月", "2"]]                    })                }, {                    xtype: 'numberfield',                    name: 'vc2feevalue',                    fieldLabel: "<font color=red>资费(分)</font>",                    allowBlank: false,                    blankText: '资费不允许为空',                    maxValue: 9999999999,                    maxText: '最大不能超过9999999999',                    minValue: 0,                    minText: '最小不能小于1'                }, {                    xtype: "textfield",                    name: "vc2longcode",                    id:"Js.Center.Business.ServiceCodeAdd.vc2longcode",                    fieldLabel: "业务子码",                    allowBlank: true,                    maxLength: 20,                    maxLengthText: '长度不能超过20！',                     listeners:{                    	"blur":function(){                    	 //自动生成服务代码	           			 setVc2ServCode();                    	}                    }                }]            }, {                columnWidth: .5,                layout: 'form',                defaultType: "textfield",                //锚点布局-                defaults: {                    anchor: "90%",                    msgTarget: "side"                },                buttonAlign: "center",                bodyStyle: "padding:10px 0 10px 15px",                items: [{                    xtype: "textfield",                    name: "vc2svcname",                    fieldLabel: "<font color=red>业务名称</font>",                    allowBlank: false,                    blankText: "业务名称不允许为空",                    regex: WXTL.Common.regex.Illegal,                    regexText: WXTL.Common.regexText.IllegalText,                    maxLength: 50,                    maxLengthText: '长度不能超过50！'                }, {                    xtype: "combo",                    name: "vc2servicetype",                    fieldLabel: "<font color=red>短彩类型</font>",                    hiddenName: "vc2servicetype",                    readOnly: true,                    allowBlank: false,                    mode: "local",                    displayField: "show",                    valueField: "value",                    triggerAction: "all",                    emptyText: '-=请选择=-',                    blankText: "短彩类型不允许为空",                    store: new Ext.data.SimpleStore({                        fields: ["show", "value"],                        data: [["短信", "1"], ["彩信", "2"], ["wap", "3"]]                    }),                    listeners: {                        "select": function(){                            							Ext.getCmp('Js.Center.Business.ServiceCodeAdd.tempnumgwid').reset();                            Js.Center.Common.GatewayStore.Add.load({                                params: {                                    vc2servicetype: this.getValue(),                                    serviceflag: 'selectbyservicetype'                                }                            })                        }                    }                }, {                    xtype: "xComboBox",                    name: "numgwid",                    id: "Js.Center.Business.ServiceCodeAdd.tempnumgwid",                    fieldLabel: "<font color=red>网关名称</font>",                    hiddenName: "numgwid",                    //readOnly: true,                    mode: "local",                    store: Js.Center.Common.GatewayStore.Add,                    //typeAhead: true,                    triggerAction: 'all',                    //selectOnFocus: true,                    emptyText: '-=请先选择短彩类型=-',                    valueNotFoundText: '-=请先选择短彩类型=-',                    //forceSelection: true, // 要求输入值必须在列表中存在                    width: 130,                    allowBlank: false,                    blankText: "网关名称不允许为空",                    displayField: 'vc2gatewayname',                    valueField: 'numgwid',                    isNeedDefaultChoose : false,//是否显示-=请选择=-                	listeners:{                        "select": function(){                        	var numgwid = Ext.getCmp("Js.Center.Business.ServiceCodeAdd.tempnumgwid").getValue();            	            if(numgwid == ""){            	            	return;            	            }            	            Ext.Ajax.request({            	                url: Js.Center.Business.ServiceCodeURL,            	                method: "POST",            	                params: {            	                	numgwid: numgwid,            	                    flag: "queryservicecodebygwidandpftype"            	                },            	                success: function(form, action) {            	                    var objJson = Ext.util.JSON.decode(form.responseText);            	                    var flag = objJson.success;            	                    if(false == flag){            	                    	Ext.Msg.alert("提示信息", objJson.info);            	                    }            	                },            	                failure: function() {            	                    Ext.Msg.alert("温馨提示", "系统忙，请稍候...!");            	                }            	            });            	             //自动生成服务代码	          				 setVc2ServCode();                        }                	}                },{                	xtype: "lovcombo",                    name: "numinstid",                    fieldLabel: "<font color=red>通道地区</font>",                    hiddenName: "numinstid",                    allowBlank: false,                    blankText: "通道地区不允许为空",                    readOnly: true,                    mode: "local",                    displayField: "vc2name",                    valueField: "numinstid",                    triggerAction: "all",                    emptyText: "-=请选择=-",                    store: Js.Center.Common.InstStore,                	onSelect:function(record, index) {                        if(this.fireEvent('beforeselect', this, record, index) !== false){                        	if(false == this.store.data.items[0].data.checked || 0 == index){                        		if(0 == index && false == record.get(this.checkField)){                        			//如果选中全国则清空                        			this.clearValue();                        		}                    			record.set(this.checkField, !record.get(this.checkField));                        	}                			if(this.store.isFiltered()) {                				this.doQuery(this.allQuery);                			}                			this.setValue(this.getCheckedValue());                            this.fireEvent('select', this, record, index);                        }                	}                }]            },{				    columnWidth: 1,                    layout: 'form',                    defaultType: "textfield",                    //锚点布局-                    defaults: {                        anchor: "90%",                        msgTarget: "side"                    },                    buttonAlign: "center",                    bodyStyle: "padding:0 0 0 15px",                    items:[{                    	xtype : "panel",						html : "<HR align=left color=#B6D3EE SIZE=1 noShade>"                    }]            },{                columnWidth: .5,                layout: 'form',                defaultType: "textfield",                //锚点布局-                defaults: {                    anchor: "90%",                    msgTarget: "side"                },                buttonAlign: "center",                bodyStyle: "padding:10px 0 10px 15px",                items: [busareaCombox,                {                    xtype: "combo",                    name: "numshare",                    fieldLabel: "共享/独享",                    hiddenName: "numshare",                    emptyText: "-=请选择=-",                    readOnly: true,                    mode: "local",                    displayField: "show",                    valueField: "value",                    triggerAction: "all",                    value: 1,                    allowBlank: false,                    blankText: "共享/独享不允许为空",                    store: new Ext.data.SimpleStore({                        fields: ["show", "value"],                        data: [["共享", "1"], ["独享", "0"],["按产品", "3"]]                    })                },                {                    xtype: "combo",                    name: "numisfeeback",                    fieldLabel: "通道是否返佣",                    hiddenName: "numisfeeback",                    emptyText: "-=请选择=-",                    readOnly: true,                    mode: "local",                    displayField: "show",                    valueField: "value",                    triggerAction: "all",                    value: 1,                    allowBlank: false,                    blankText: "通道是否返佣不允许为空",                    store: new Ext.data.SimpleStore({                        fields: ["show", "value"],                        data: [["返佣", "1"], ["不返佣", "0"]]                    })                },{                    xtype: "textfield",                    name: "numfeebakratio",                    fieldLabel: "<font color=red>返佣比率</font>",                    allowBlank: false,                    regex: WXTL.Common.regex.Double,                    regexText: "请输入数值",                    maxLength: 9,                    maxLengthText: '长度不能超过9！',                    value:0                },{                    xtype: "combo",                    name: "vc2feetype",                    fieldLabel: "计费方式",                    hiddenName: "vc2feetype",                    emptyText: "-=请选择=-",                    readOnly: true,                    mode: "local",                    displayField: "show",                    valueField: "value",                    triggerAction: "all",                    value: 1,                    allowBlank: false,                    blankText: "计费方式不允许为空",                    store: new Ext.data.SimpleStore({                        fields: ["show", "value"],                        data: [["按条", "1"], ["按套餐", "2"],["按产品", "3"]]                    })                },{                    xtype: "textfield",                    name: "vc2servcode",                    fieldLabel: "服务代码",                    id:"Js.Center.Business.ServiceCodeAdd.vc2servcode",                    allowBlank: true,                    regex: WXTL.Common.regex.Illegal,                    regexText: WXTL.Common.regexText.IllegalText,                    maxLength: 200,                    maxLengthText: '长度不能超过200！'                }]            },{			                columnWidth: .5,                layout: 'form',                defaultType: "textfield",                //锚点布局-                defaults: {                    anchor: "90%",                    msgTarget: "side"                },                buttonAlign: "center",                bodyStyle: "padding:10px 0 10px 15px",                items: [{                    xtype: "combo",                    name: "vc2validflag",                    fieldLabel: "状态",                    hiddenName: "vc2validflag",                    emptyText: "-=请选择=-",                    readOnly: true,                    mode: "local",                    displayField: "show",                    valueField: "value",                    triggerAction: "all",                    value: 1,                    allowBlank: false,                    blankText: "状态不允许为空",                    store: new Ext.data.SimpleStore({                        fields: ["show", "value"],                        data: [["商用", "1"], ["暂停", "0"]]                    })                },{                    xtype: "combo",                    name: "numisbigec",                    fieldLabel: "是否大EC",                    hiddenName: "numisbigec",                    emptyText: "-=请选择=-",                    readOnly: true,                    mode: "local",                    displayField: "show",                    valueField: "value",                    triggerAction: "all",                    value: 1,                    allowBlank: false,                    blankText: "是否大E不允许为空",                    store: new Ext.data.SimpleStore({                        fields: ["show", "value"],                        data: [["大EC", "1"], ["非大EC", "0"]]                    })                },{                    xtype: "textfield",                    name: "vc2costdesc",                    fieldLabel: "成本",                    allowBlank: true,                    regex: WXTL.Common.regex.Illegal,                    regexText: WXTL.Common.regexText.IllegalText,                    maxLength: 200,                    maxLengthText: '长度不能超过200！'                },{                    xtype: "combo",                    name: "vc2signstatus",                    fieldLabel: "签名",                    hiddenName: "vc2signstatus",                    emptyText: "-=请选择=-",                    readOnly: true,                    mode: "local",                    displayField: "show",                    valueField: "value",                    triggerAction: "all",                    value: 1,                    allowBlank: false,                    blankText: "签名不允许为空",                    store: new Ext.data.SimpleStore({                        fields: ["show", "value"],                        data: [["签名可去", "1"], ["签名不可去", "2"],["无签名", "3"]]                    })                },{                    xtype: "textfield",                    name: "vc2signature",                    fieldLabel: "签名内容",                    allowBlank: true,                    regex: WXTL.Common.regex.Illegal,                    regexText: WXTL.Common.regexText.IllegalText,                    maxLength: 200,                    maxLengthText: '长度不能超过200！'                }, {                    xtype: "combo",                    name: "numsigntype",                    fieldLabel: "返佣/直签",                    hiddenName: "numsigntype",                    readOnly: true,                    mode: "local",                    displayField: "show",                    valueField: "value",                    triggerAction: "all",                    emptyText: "-=请选择=-",                    allowBlank: false,                    blankText: "返佣/直签不允许为空",                    store: new Ext.data.SimpleStore({                        fields: ["show", "value"],                        data: [["-=请选择=-", ""], ["返佣", "1"], ["直签", "0"]]                    })                }]            }]        }, {            xtype: "textarea",            labelStyle: "text-align:center;width:100;",            align: "right",            name: "vc2dsc",            fieldLabel: "描述",            anchor: '90%',            height : 150,            regex: WXTL.Common.regex.Illegal,            regexText: WXTL.Common.regexText.IllegalText,            maxLength: 100,            maxLengthText: '长度不能超过100！'        }]    });    // ======================================================================= 定义窗体    var mainForm = addServiceCodeInfofp.getForm();    this.window = new WXTL.Widgets.CommonWindows.Window({        title: "添加通道",        mainForm: mainForm,        updateURL: Js.Center.Business.ServiceCodeUpdateURL,        displayStore: Js.Center.Business.ServiceCode.Infostore,        items: [addServiceCodeInfofp],        needLoadDataStore: true,        loadDataStoreFunc: function(){        	Js.Center.Common.BranchCompanyStore.reload();        },        needButtons:false,        buttons: [new Ext.Button({            text: '确定',            minWidth: 70,            handler: function(){                if (addServiceCodeInfofp.getForm().isValid()) {                    // 弹出效果                    Ext.MessageBox.show({                        msg: '正在保存，请稍等...',                        progressText: 'Saving...',                        width: 300,                        wait: true,                        icon: 'download',                        animEl: 'saving'                    });                    setTimeout(function(){                        Ext.MessageBox.hide();                    }, 300000);                    Js.Center.Business.ServiceCodeAdd.window.mainFormSubmitFunc();                                    }            }        }), new Ext.Button({            text: '重置',            minWidth: 70,            qtip: "重置数据",            handler: function(){                                Js.Center.Common.GatewayStore.Add.removeAll();                addServiceCodeInfofp.getForm().reset();            }        }), new Ext.Button({            text: '取消',            minWidth: 70,            handler: function(){                Js.Center.Business.ServiceCodeAdd.window.hide();            }        })],		listeners:{			"beforehide":function(){				Js.Center.Common.GatewayStore.Add.removeAll();   //重置网关			}		}    });    };